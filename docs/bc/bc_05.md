# éƒ¨åˆ†Â II.Â Ethereum ä»¥å¤ªåŠ

## ç¬¬Â 9Â ç« Â ä»¥å¤ªåŠ

## 1.Â åè¯è§£é‡Š

DAPPÂ å»ä¸­å¿ƒåŒ–åº”ç”¨

ç¦»çº¿çš„é’±åŒ…å°±æ˜¯å†·é’±åŒ…ï¼Œ
åœ¨çº¿çš„é’±åŒ…å°±æ˜¯çƒ­é’±åŒ…ï¼Œ

ä»å®‰å…¨æ€§è§’åº¦çœ‹ï¼šå†·é’±åŒ…>çƒ­é’±åŒ…>å¹³å°
ä»ä¾¿æ·æ€§çœ‹ï¼šå¹³å°>çƒ­é’±åŒ…>å†·é’±åŒ…

bip32Â =Â hdÂ wallets,Â whatÂ theyÂ areÂ howÂ theyÂ work
bip39Â =Â specificÂ typeÂ ofÂ mnemonic,Â andÂ theÂ processÂ forÂ turningÂ itÂ intoÂ aÂ bip32Â seed
bip44Â =Â aÂ specificÂ formatÂ ofÂ aÂ bip32Â wallet

## 2.Â IBAN (International Bank Account Number)

ä»¥å¤ªåŠå®˜ç½‘çš„è¯´æ˜ï¼š [`github.com/ethereum/wiki/wiki/ICAP:-Inter-exchange-Client-Address-Protocol`](https://github.com/ethereum/wiki/wiki/ICAP:-Inter-exchange-Client-Address-Protocol)

### 2.1.Â ibanï¼šå›½é™…é“¶è¡Œè´¦å·

iban å…¶è‹±æ–‡å…¨ç§°ä¸º International Bank Account Numberï¼Œ å³å›½é™…é“¶è¡Œå¸å·ã€‚iban çš„ä½œç”¨æ˜¯ä¸ºå…¨çƒä»»æ„ä¸€å®¶é“¶è¡Œä¸­çš„ä»»æ„ä¸€ä¸ªè´¦æˆ· ç”Ÿæˆä¸€ä¸ªå…¨çƒå”¯ä¸€çš„è´¦å·ï¼Œä»¥ä¾¿è¿›è¡Œè·¨è¡Œäº¤æ˜“ã€‚ä¸€ä¸ª iban è´¦å·çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```

XE039RBH0XKV9FZMTH2701Q37FLX10NTWXU		

```

iban åœ°å€æœ€å¤šå¯ä»¥åŒ…å« 34 ä¸ªå­—æ¯å’Œæ•°å­—ï¼Œå…¶ä¸­çš„å­—æ¯å¤§å°å†™ä¸æ•æ„Ÿã€‚

iban ä¸­åŒ…å«ä»¥ä¸‹ä¿¡æ¯

1.  å›½åˆ«ç ï¼Œç”¨æ¥æ ‡è¯†å›½å®¶ï¼Œéµå¾ª ISO3166-1 alpha-2 æ ‡å‡†
2.  é”™è¯¯è¯†åˆ«ç ï¼Œç”¨æ¥å¯¹åœ°å€è¿›è¡Œæ ¡éªŒï¼Œé‡‡ç”¨ mod-97-10 æ ¡éªŒå’Œåè®®ï¼Œå³ ISO/IEC 7064:2003 æ ‡å‡†
3.  åŸºæœ¬é“¶è¡Œè´¦å·ï¼Œå³ BBANï¼ˆBasic Bank Account Numberï¼‰ï¼Œç”¨æ¥æ ‡è¯†é“¶è¡Œæœºæ„ã€ç½‘ç‚¹åŠ å®¢æˆ·åœ¨è¯¥æœºæ„å†…çš„è´¦å·ï¼Œè¿™ä¸‰éƒ¨åˆ†ä¿¡æ¯çš„ç¼–ç æ–¹æ¡ˆä¾èµ–äºå‰é¢æåŠçš„å›½åˆ«ç 

### 2.2.Â ä»¥å¤ªåŠ ibanï¼šæ–°çš„å›½åˆ«ç å’Œ BBAN ç¼–ç æ–¹æ¡ˆ

ä»¥å¤ªåŠå¼•å…¥äº†ä¸€ä¸ªæ–°çš„ IBAN å›½åˆ«ç ï¼šXEï¼Œå…¶ä¸­ E ä»£è¡¨ Ethereumï¼ŒX ä»£è¡¨éæ³•å¸ï¼ˆnon-jurisdictional currenciesï¼‰ã€‚åŒæ—¶ï¼Œä»¥å¤ªåŠæå‡ºäº†ä¸‰ç§ BBAN çš„ç¼–ç æ ¼å¼ï¼šdirectã€basic å’Œ indirectã€‚

direct ç¼–ç æ–¹æ¡ˆä¸­çš„ BBAN ä¸º 30 ä¸ªå­—æ¯/æ•°å­—ï¼Œåªæœ‰ä¸€ä¸ªå­—æ®µï¼šè´¦æˆ·ç¼–å·ã€‚ä¾‹å¦‚ï¼Œä»¥å¤ªåŠ åœ°å€ 00c5496aee77c1ba1f0854206a26dda82a81d6d8 è½¬æ¢ä¸º direct æ–¹æ¡ˆçš„ BBAN è´¦å·ï¼Œå°± å¾—åˆ° XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZSã€‚

å¯ä»¥ä½¿ç”¨ web3.js ä¸­çš„ web3.eth.Iban.toIban() æ–¹æ³•æ¥æ‰§è¡Œè¿™ä¸€è½¬æ¢ï¼š

```

var Web3 = require('web3');
var web3 = new Web3();
web3.eth.Iban.toIban("0x00c5496aEe77C1bA1f0854206A26DdA82a81D6D8");

'XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS'

```

basic ç¼–ç æ–¹æ¡ˆä¸ direct æ–¹æ¡ˆçš„å”¯ä¸€åŒºåˆ«åœ¨äºï¼Œå…¶ BBAN é•¿åº¦ä¸º 31 ä¸ªå­—æ¯/æ•°å­—ï¼Œå› æ­¤è¯¥æ–¹æ¡ˆ ä¸å…¼å®¹ IBANã€‚

indrect ç¼–ç æ–¹æ¡ˆä¸­çš„ BBAN é•¿åº¦ä¸º 16 ä¸ªå­—æ¯/æ•°å­—ï¼ŒåŒ…å«ä¸‰ä¸ªå­—æ®µ

1.  èµ„äº§ç¼–å·ï¼Œç”± 3 ä¸ªå­—æ¯/æ•°å­—ç»„æˆ
2.  æœºæ„ç¼–å·ï¼Œç”± 4 ä¸ªå­—æ¯/æ•°å­—ç»„æˆ
3.  æœºæ„å†…å®¢æˆ·ç¼–å·ï¼Œç”± 9 ä¸ªå­—æ¯/æ•°å­—ç»„æˆ

ä¾‹å¦‚ï¼Œä¸€ä¸ªé‡‡ç”¨ indrect ç¼–ç æ–¹æ¡ˆçš„ä»¥å¤ªåŠ iban è´¦å·ï¼Œçœ‹èµ·æ¥æ˜¯è¿™æ ·ï¼š

```

XE81ETHXREGGAVOFYORK

```

XE81ETHXREGGAVOFYORK

1.  ETHï¼šåœ¨æœ¬ä¾‹ä¸­ï¼Œè¡¨ç¤ºå®¢æˆ·è´¦æˆ·å†…çš„èµ„äº§ç¼–å·ã€‚ç›®å‰ ETH æ˜¯å”¯ä¸€æœ‰æ•ˆçš„èµ„äº§ç¼–å·
2.  XREGï¼šæœºæ„ç¼–å·ï¼ŒXREG è¡¨ç¤ºä»¥å¤ªåŠåŸºæœ¬æ³¨å†Œåˆçº¦
3.  GAVOFYORKï¼šæœºæ„å†…å®¢æˆ·çš„ç¼–å·

### 2.3.Â iban è´¦å·ä¸ä»¥å¤ªåŠåœ°å€çš„è½¬æ¢

å¦‚å‰æ‰€è¿°ï¼Œä½¿ç”¨ web3.eth.Iban.toIban()æ–¹æ³•ï¼Œå¯ä»¥å°†ä¸€ä¸ªä»¥å¤ªåŠåœ°å€ è½¬æ¢ä¸º direct ç¼–ç æ–¹æ¡ˆçš„ iban è´¦å·ã€‚ä¸ä¹‹å¯¹åº”çš„ï¼Œå¯ä»¥ä½¿ç”¨ web3.eth.Iban.toAddress()æ–¹æ³•ï¼Œ å°†ä¸€ä¸ªé‡‡ç”¨ direct ç¼–ç æ–¹æ¡ˆçš„ iban è´¦å·ï¼Œè½¬æ¢å›ä»¥å¤ªåŠåœ°å€ã€‚ä¾‹å¦‚ï¼š

```

var Web3 = require('web3');
var web3 = new Web3();
web3.eth.Iban.toAddress("XE7338O073KYGTWWZN0F2WZ0R8PX5ZPPZS");

'0x00c5496aEe77C1bA1f0854206A26DdA82a81D6D8'

```

### 2.4.Â æ£€æŸ¥ iban è´¦å·çš„æœ‰æ•ˆæ€§

iban è´¦å·ä¸­çš„æ ¡éªŒå’Œç”¨æ¥å¸®åŠ©æ ¸éªŒä¸€ä¸ªç»™å®šå­—ç¬¦ä¸²æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ iban è´¦å·ã€‚å¯ä»¥ä½¿ç”¨ web3.js ä¸­çš„ web3.eth.Iban.isValid() æ¥è¿›è¡Œæ‰§è¡Œæ ¡éªŒã€‚ä¾‹å¦‚ï¼š

```

> web3.eth.Iban.isValid("XE81ETHXREGGAVOFYORK");
true

> var iban = new web3.eth.Iban("XE81ETHXREGGAVOFYORK");
undefined
> iban.isValid();
true

> web3.eth.Iban.isValid("XE82ETHXREGGAVOFYORK");
false

```

## 3.Â å¦‚ä½•è®¡ç®— Gas æ‰‹ç»­è´¹

ä¸‹é¢æˆ‘ä»¬ç”¨å®ä¾‹è®²è§£æ€æ ·è®¡ç®—ä»¥å¤ªåŠåœ¨æ‰§è¡Œäº¤æ˜“æ—¶èŠ±è´¹çš„ gas è´¹ç”¨ã€‚

```

> miner.start(1)
null

```

å‡†å¤‡ä¸¤ä¸ªè´¦å·

```

> eth.getBalance(eth.accounts[3])
1000000000000000000
> eth.getBalance(eth.accounts[5])
0

```

å¼€å§‹è®¡ç®— gas è´¹ç”¨

```

> var estimateGas = eth.estimateGas({from:eth.accounts[1], to: eth.accounts[2], value: web3.toWei(1)})
undefined
> console.log(estimateGas)
21000
undefined
> 
> var cost = estimateGas * gasPrice
undefined
> console.log(cost)
378000000000000
undefined
> web3.fromWei(cost)
"0.000378"

```

gas èŠ±è´¹ 0.000378 ETH

## 4.Â è½¬å‡ºè´¦å·ä¸­æ‰€æœ‰ ETHï¼ŒEthereum Wallet ä¸­çš„ Send everything å®ç°æ–¹æ³•

```

> personal.unlockAccount(eth.accounts[3], "12345678")
true

> eth.sendTransaction({from: eth.accounts[3], to: eth.accounts[5], value: eth.getBalance(eth.accounts[3]) - cost, gas: estimateGas})
"0x4e27a477e128b200239bc2ecd899077c6ae064da963a919fef41bcc7462aec8d"

```

æŸ¥çœ‹äº¤æ˜“ç»†èŠ‚

```

> web3.eth.getTransaction("0x4e27a477e128b200239bc2ecd899077c6ae064da963a919fef41bcc7462aec8d")
{
  blockHash: "0x59a9905831e7ae3cb9e7c6f125cf48e2688ef4b39317838f6f6b6c8837d01404",
  blockNumber: 4367,
  from: "0x8efb99ec55bcfbe2cfe47918f2d9e55fa732111f",
  gas: 21000,
  gasPrice: 18000000000,
  hash: "0x4e27a477e128b200239bc2ecd899077c6ae064da963a919fef41bcc7462aec8d",
  input: "0x",
  nonce: 15,
  r: "0xa297401df3a1fb0298cbc1dd609deebe9ded319fadc55934ecef4d525198215",
  s: "0x780d8c46bc8d1bb89ae9d78055307d9d68a4f89ba699ef86d3f8ba88383139a6",
  to: "0xf0688330101d53bd0c6ede2ef04d33c2010e9a5d",
  transactionIndex: 0,
  v: "0x42",
  value: 999622000000000000
}

```

ç°åœ¨æŸ¥çœ‹ from è´¦å·ï¼Œä½™é¢å·²ç»æ¸…é›¶ã€‚

```

> eth.getBalance(eth.accounts[3])
0		

```

## 5.Â ï¼ˆ0/12 block confirmations)

```

web3.eth.blockNumber-web3.eth.getTransaction(<txhash>).blockNumber		

```

## 6.Â å¤ªåŠè´¦æˆ·ç®¡ç† keystore æ–‡ä»¶

PostÂ author:Â MartinÂ Wang
PostÂ link:Â http://stevenocean.github.io/2018/04/02/about-ethereum-keystore.html
CopyrightÂ Notice:Â AllÂ articlesÂ inÂ thisÂ blogÂ areÂ licensedÂ underÂ CCÂ BY-NC-SAÂ 4.0Â unlessÂ statingÂ additionally.

### 6.1.Â ä»€ä¹ˆæ˜¯ keystore æ–‡ä»¶

ä»¥å¤ªåŠçš„æ¯ä¸ªå¤–éƒ¨è´¦æˆ·éƒ½æ˜¯ç”±ä¸€å¯¹å¯†é’¥ï¼ˆä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ï¼‰å®šä¹‰çš„ã€‚è´¦æˆ·ä»¥åœ°å€ä¸ºç´¢å¼•ï¼Œåœ°å€ç”±å…¬é’¥è¡ç”Ÿè€Œæ¥ï¼Œå–å…¬é’¥çš„æœ€å 20 ä¸ªå­—èŠ‚ã€‚æ¯å¯¹ç§é’¥ /åœ°å€éƒ½ç¼–ç åœ¨ä¸€ä¸ªé’¥åŒ™æ–‡ä»¶é‡Œï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ keystore æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶æ˜¯ JSON æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€å’Œæµè§ˆã€‚é’¥åŒ™æ–‡ä»¶çš„å…³é”®éƒ¨åˆ†ï¼Œè´¦æˆ·ç§é’¥ï¼Œé€šå¸¸ç”¨ä½ åˆ›å»ºå¸æˆ·æ—¶è®¾ç½®çš„å¯†ç è¿›è¡ŒåŠ å¯†ã€‚ä¹Ÿå°±æ˜¯è¯´ keystore æ–‡ä»¶ï¼Œå°±æ˜¯ä½ ç‹¬æœ‰çš„ã€ç”¨äºç­¾ç½²äº¤æ˜“çš„ä»¥å¤ªåŠç§é’¥çš„åŠ å¯†æ–‡ä»¶ã€‚å¦‚æœä½ ä¸¢å¤±äº†è¿™ä¸ªæ–‡ä»¶ï¼Œä½ å°±ä¸¢å¤±äº†ç§é’¥ï¼Œæ„å‘³ç€ä½ å¤±å»äº†ç­¾ç½²äº¤æ˜“çš„èƒ½åŠ›ï¼Œæ„å‘³ç€ä½ çš„èµ„é‡‘è¢«æ°¸ä¹…çš„é”å®šåœ¨äº†ä½ çš„è´¦æˆ·é‡Œã€‚

### 6.2.Â keystore æ–‡ä»¶çš„å†…å®¹

æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ keystore æ–‡ä»¶éƒ½åŒ…å«å“ªäº›æ•°æ®:

```

neo@MacBook-Pro ~/Library/Ethereum/testnet/keystore % cat UTC--2018-04-01T09-30-44.943874000Z--d5eeae04932dbc2e65b948a76a6cdfd44323a5dd
{	"address":"d5eeae04932dbc2e65b948a76a6cdfd44323a5dd",
	"crypto":{
		"cipher":"aes-128-ctr",
		"ciphertext":"16715298517abb35cb44e9a32d1f81f21ead63006c57eb0ff434318a6ea3ed3f",
		"cipherparams":{
			"iv":"1ff6fea34e682158e7660ae67960ff76"
		},
		"kdf":"scrypt",
		"kdfparams":{
			"dklen":32,
			"n":262144,
			"p":1,
			"r":8,
			"salt":"a99af42dac2363db631ef7c57a25705c7efdee73b19c11b27f9a91d41cd32d1c"
		},
		"mac":"dcd248fb996604dfcb69a86604af3992b4a9b8d20cc05e0c7608189dbbe66eda"
	},
	"id":"55edb869-1c86-4c68-924e-8247575a158b",
	"version":3
}			

```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†å†…å®¹éƒ½åœ¨Â cryptoÂ å­—æ®µä¸­ï¼Œè¿™é‡ŒåŒ…æ‹¬ï¼š

cipherï¼šå¯¹ç§°Â AESÂ ç®—æ³•çš„åç§°;
cipherparamsï¼šä¸Šè¿°Â cipherÂ ç®—æ³•éœ€è¦çš„å‚æ•°;
ciphertextï¼šä½ çš„ä»¥å¤ªåŠç§é’¥ä½¿ç”¨ä¸Šè¿°Â cipherÂ ç®—æ³•è¿›è¡ŒåŠ å¯†;
kdfï¼šå¯†é’¥ç”Ÿæˆå‡½æ•°ï¼Œç”¨äºè®©ä½ ç”¨å¯†ç åŠ å¯†Â keystoreÂ æ–‡ä»¶;
kdfparamsï¼šä¸Šè¿°Â kdfÂ ç®—æ³•éœ€è¦çš„å‚æ•°;
Macï¼šç”¨äºéªŒè¯å¯†ç çš„ä»£ç ã€‚

### 6.3.Â keystore æ–‡ä»¶å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

#### 6.3.1.Â åŠ å¯†ä½ çš„ç§é’¥

å°±åƒä¹‹å‰æåˆ°çš„ï¼Œä¸€ä¸ªä»¥å¤ªåŠè´¦æˆ·å°±æ˜¯ç”¨äºåŠ å¯†ç­¾ç½²äº¤æ˜“çš„ä¸€ä¸ªç§é’¥-å…¬é’¥å¯¹ã€‚ä¸ºäº†ç¡®ä¿ä½ çš„ç§é’¥æ²¡æœ‰åœ¨æ–‡ä»¶ä¸­æ˜æ–‡å­˜å‚¨ï¼ˆå³ä»»ä½•äººåªè¦èƒ½å¾—åˆ°è¿™ä¸ªæ–‡ä»¶å°±èƒ½è¯»ï¼‰ï¼Œä½¿ç”¨å¼ºå¯¹ç§°ç®—æ³•ï¼ˆcipherï¼‰å¯¹å…¶åŠ å¯†è‡³å…³é‡è¦ã€‚

è¿™äº›å¯¹ç§°ç®—æ³•ä½¿ç”¨å¯†é’¥æ¥åŠ å¯†æ•°æ®ã€‚åŠ å¯†åçš„æ•°æ®å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•å’ŒåŒæ ·çš„å¯†é’¥æ¥è§£å¯†ï¼Œå› æ­¤ç®—æ³•å‘½åä¸ºå¯¹ç§°ç®—æ³•ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå¯¹ç§°å¯†é’¥ä¸ºè§£å¯†å¯†é’¥ï¼Œå› ä¸ºå®ƒå°†ç”¨äºå¯¹æˆ‘ä»¬çš„ä»¥å¤ªåŠç§é’¥è¿›è¡Œè§£å¯†ã€‚

åŠ å¯†è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š

| ![](img/keystore-1.png) |

ä»¥ä¸‹æ˜¯ cipherï¼Œcipherparams å’Œ ciphertext å¯¹åº”çš„æ¦‚å¿µï¼š

1.  cipher: æ˜¯ç”¨äºåŠ å¯†ä»¥å¤ªåŠç§é’¥çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚æ­¤å¤„ cipher ç”¨çš„æ˜¯ aes-128-ctr åŠ å¯†æ¨¡å¼ã€‚

2.  cipherparams: æ˜¯ aes-128-ctr åŠ å¯†ç®—æ³•éœ€è¦çš„å‚æ•°ã€‚åœ¨è¿™é‡Œï¼Œç”¨åˆ°çš„å”¯ä¸€çš„å‚æ•° ivï¼Œæ˜¯ aes-128-ctr åŠ å¯†ç®—æ³•éœ€è¦çš„åˆå§‹åŒ–å‘é‡ã€‚

3.  ciphertext: å¯†æ–‡æ˜¯ aes-128-ctr å‡½æ•°çš„åŠ å¯†è¾“å…¥ã€‚

åœ¨è¿™é‡Œï¼Œä½ å·²ç»æœ‰äº†è¿›è¡Œè§£å¯†ä»¥å¤ªåŠç§é’¥è®¡ç®—æ‰€éœ€è¦çš„ä¸€åˆ‡ã€‚ä½†æ˜¯æˆ‘ä»¬é¦–å…ˆè¦å–å›è§£å¯†å¯†é’¥ã€‚

#### 6.3.2.Â ç”¨ä½ çš„å¯†ç æ¥ä¿æŠ¤å®ƒ

è¦ç¡®ä¿è§£é”ä½ çš„è´¦æˆ·å¾ˆå®¹æ˜“ï¼Œä½ ä¸éœ€è¦è®°ä½ä½ çš„æ¯ä¸€ä¸ªåˆé•¿åˆéç”¨æˆ·å‹å¥½å‹çš„ç”¨äºè§£å¯† ciphertext å¯†æ–‡è§£å¯†å¯†é’¥ã€‚ç›¸åï¼Œä»¥å¤ªåŠå¼€å‘è€…é€‰æ‹©äº†åŸºäºå¯†ç çš„ä¿æŠ¤ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åªéœ€è¦è¾“å…¥å¯†ç å°±èƒ½æ‹¿å›è§£å¯†å¯†é’¥ã€‚

ä¸ºäº†èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œä»¥å¤ªåŠç”¨äº†ä¸€ä¸ªå¯†é’¥ç”Ÿæˆå‡½æ•°ï¼Œè¾“å…¥å¯†ç å’Œä¸€ç³»åˆ—å‚æ•°å°±èƒ½è®¡ç®—è§£å¯†å¯†é’¥ã€‚

è¿™å°±æ˜¯ kdf å’Œ kdfparams çš„ç”¨é€”ï¼š

1.  kdf: æ˜¯ä¸€ä¸ªå¯†é’¥ç”Ÿæˆå‡½æ•°ï¼Œæ ¹æ®ä½ çš„å¯†ç è®¡ç®—ï¼ˆæˆ–è€…å–å›ï¼‰è§£å¯†å¯†é’¥ã€‚åœ¨è¿™é‡Œï¼Œkdf ç”¨çš„æ˜¯ scrypt ç®—æ³•ã€‚

2.  kdfparams: æ˜¯ scrypt å‡½æ•°éœ€è¦çš„å‚æ•°ã€‚åœ¨è¿™é‡Œï¼Œç®€å•æ¥è¯´ï¼Œdklenã€nã€rã€p å’Œ salt æ˜¯ kdf å‡½æ•°çš„å‚æ•°ã€‚

åœ¨è¿™é‡Œï¼Œç”¨ kdfparams å‚æ•°å¯¹ scrypt å‡½æ•°è¿›è¡Œè°ƒæ•´ï¼Œåé¦ˆåˆ°æˆ‘ä»¬çš„å¯†ç ä¸­ï¼Œä½ å°±ä¼šå¾—åˆ°è§£å¯†å¯†é’¥ä¹Ÿå°±æ˜¯å¯†é’¥ç”Ÿæˆå‡½æ•°çš„è¾“å‡ºã€‚

| ![](img/keystore-2.png) |

#### 6.3.3.Â ç¡®è®¤è¾“å…¥çš„å¯†ç æ˜¯æ­£ç¡®çš„

è¿™å°±æ˜¯ keystore æ–‡ä»¶ä¸­ mac å€¼èµ·ä½œç”¨çš„åœ°æ–¹ã€‚åœ¨å¯†é’¥ç”Ÿæˆå‡½æ•°æ‰§è¡Œä¹‹åï¼Œå®ƒçš„è¾“å‡ºï¼ˆè§£å¯†å¯†é’¥ï¼‰å’Œ ciphertext å¯†æ–‡å°±è¢«å¤„ç†ï¼Œå¹¶ä¸”å’Œ macï¼ˆå°±åƒä¸€ç§è®¤å¯çš„å°ç« ï¼‰ä½œæ¯”è¾ƒã€‚å¦‚æœç»“æœå’Œ mac ç›¸åŒï¼Œé‚£ä¹ˆå¯†ç å°±æ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”è§£å¯†å°±å¯ä»¥å¼€å§‹äº†ã€‚

| ![](img/keystore-3.png) |

#### 6.3.4.Â å°†è¿™ä¸‰æ­¥ç»“åˆèµ·æ¥

é¦–å…ˆï¼Œä½ è¾“å…¥äº†å¯†ç ï¼Œè¿™ä¸ªå¯†ç ä½œä¸º kdf å¯†é’¥ç”Ÿæˆå‡½æ•°çš„è¾“å…¥ï¼Œæ¥è®¡ç®—è§£å¯†å¯†é’¥ã€‚ç„¶åï¼Œåˆšåˆšè®¡ç®—å‡ºçš„è§£å¯†å¯†é’¥å’Œ ciphertext å¯†æ–‡è¿æ¥å¹¶è¿›è¡Œå¤„ç†ï¼Œå’Œ mac æ¯”è¾ƒæ¥ç¡®ä¿å¯†ç æ˜¯æ­£ç¡®çš„ã€‚æœ€åï¼Œé€šè¿‡ cipher å¯¹ç§°å‡½æ•°ç”¨è§£å¯†å¯†é’¥å¯¹ ciphertext å¯†æ–‡è§£å¯†ã€‚

| ![](img/keystore-4.png) |

å°±åƒä½ ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹åšä¸€ä¸ªé»‘ç›’ï¼ˆä¸è¿‡ï¼Œå›¾ä¸­æ˜¯ä¸ªç°ç›’ï¼‰ï¼Œä½ çš„å¯†ç æ˜¯æƒŸä¸€çš„è¾“å…¥ï¼Œä½ çš„ä»¥å¤ªåŠç§é’¥æ˜¯æƒŸä¸€çš„è¾“å‡ºã€‚æ‰€éœ€çš„å…¶ä»–ä¿¡æ¯éƒ½å¯ä»¥åœ¨ä½ çš„ä»¥å¤ªåŠè´¦æˆ·åˆ›å»ºæ—¶ç”Ÿæˆçš„ keystore æ–‡ä»¶ä¸­è·å¾—ã€‚

## 7.Â æ‰¹é‡è½¬è´¦é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

æœ‰æ—¶æˆ‘ä»¬éœ€è¦å°† Token å‘é€åˆ°å¤šä¸ªåœ°å€ä¸Šå»ã€‚é€šå¸¸çš„åšæ³•å°±æ˜¯ä½¿ç”¨ web.js å†™ä¸€ä¸ªå¾ªç¯ç¨‹åºï¼Œä½†æ˜¯å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°è¿™ç§åšæ³•å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œå¸¸ä¼šå‘ç”Ÿè½¬è´¦å¤±è´¥æƒ…å†µã€‚

ç»è¿‡åˆ†æé€ æˆå‘é€å¤±è´¥åŸå› æ˜¯ï¼Œé¢‘ç‡å¤ªé«˜ï¼Œå› ä¸º web.js æ˜¯å¼‚æ­¥æ“ä½œï¼Œå½“å‰ç¨‹åºè¿˜æœªå®Œæˆäº¤æ˜“ï¼Œäº¤æ˜“å°šæœªç¡®è®¤çš„æƒ…å†µä¸‹ç¬¬äºŒç¬”äº¤æ˜“å‘é€å‡ºå»ï¼Œè¿™æ—¶å°±ä¼šå‡ºé”™ã€‚

```

web3.eth.getTransactionCount(from).then(function(nonce){
	// é—®é¢˜å°±å‡ºåœ¨ nonce ï¼Œ nonce å¦‚åŒæ•°æ®åº“ä¸­çš„åºåˆ—ä¸»é”®ï¼Œå¦‚æœä¸Šä¸€ä¸ªäº¤æ˜“æ²¡æœ‰å®Œæˆï¼Œä¸‹ä¸€ä¸ªäº¤æ˜“å–å¾— nonce + 1 åä¸ä¸Šä¸€ä¸ª pending çš„äº¤æ˜“ç›¸åŒï¼Œäº§ç”Ÿå†²çª
}		

```

æœ€å¥½çš„è§£æ–¹æ¡ˆæ˜¯åœ¨åˆçº¦ä¸­å®ç°æ‰¹é‡è½¬è´¦åŠŸèƒ½ï¼Œè¿™æ ·éœ€è¦ä¸€ä¸ªäº¤æ˜“ txhash å®Œæˆå¤šæ¯”äº¤æ˜“ã€‚

å¦‚æœä½ çš„ Token å·²ç»åœ¨ä½¿ç”¨äº†ï¼Œä¸”æ²¡æœ‰æ‰¹é‡è½¬è´¦çš„åŠŸèƒ½æ€ä¹ˆè§£å†³å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨å†™ä¸€ä¸ª Token ç»§æ‰¿åŸæ¥çš„ Tokenï¼Œåœ¨æ–°çš„ Token ä¸­å®ç°æ‰¹é‡è½¬è´¦åŠŸèƒ½

```

Function: batchTransfer(address[] _to, uint256[] _value)

MethodID: 0x88d695b2
[0]:  0000000000000000000000000000000000000000000000000000000000000040
[1]:  00000000000000000000000000000000000000000000000000000000000000a0
[2]:  0000000000000000000000000000000000000000000000000000000000000002
[3]:  000000000000000000000000372967130b1a7cd386348bc59de905e628e36f3a
[4]:  000000000000000000000000372967130b1a7cd386348bc59de905e628e36f3b
[5]:  0000000000000000000000000000000000000000000000000000000000000002
[6]:  000000000000000000000000000000000000000000000000000000000000000c
[7]:  0000000000000000000000000000000000000000000000000000000000000022		

```

## 8.Â ä»£å¸å…‘æ¢

å…‘æ¢ä»£å¸é€šå¸¸æ˜¯æŒ‡ä½¿ç”¨ ETH æˆ–è€…å…¶ä»–å¸å…‘æ¢ Tokenï¼Œæˆ‘æ˜¯è¿™æ ·å®ç°çš„ï¼Œä½¿ç”¨æ™ºèƒ½åˆçº¦ï¼Œå°† ETH è¾¾åˆ°æŒ‡å®šåˆçº¦åœ°å€ï¼Œåˆçº¦ä¼šæ‰“å›ä»£å¸ç»™ç”¨æˆ·ã€‚

```

User --> Wallet --> transfer ETH --> contract Address 
           ^                              |
           |                              |
           +----------- Token ------------+	

```

è¿™ç§æ–¹å¼ä¸ç”¨äººå·¥å‚ä¸ï¼Œä¹Ÿä¸ç”¨å¼€å‘ç¨‹åºã€‚ç¼ºç‚¹ä¸èƒ½æ—¶æ—¶æ±‡ç‡ï¼Œéœ€è¦äººå·¥è®¾ç½®æ±‡ç‡ã€‚

## ç¬¬Â 10Â ç« Â ä»¥å¤ªåŠç§é“¾å…¥é—¨

æœ¬æ–‡æ‰€ç”¨è½¯ä»¶ç‰ˆæœ¬

*   geth v.1.8.13

*   truffle v4.0.6

*   web3.js v1.0.0

*   Solidity Version: 0.4.24

## 1.Â è½¯ä»¶å®‰è£…ä¸é…ç½®

### 1.1.Â Ubuntu

#### 1.1.1.Â å®‰è£… geth

å®‰è£…ç¯å¢ƒ

UbuntuÂ 17.10

```

sudo apt upgrade -y
sudo apt install software-properties-common
sudo add-apt-repository -y ppa:ethereum/ethereum
sudo apt update
sudo apt install ethereum			

```

```

neo@netkiller ~ % geth version
Geth
Version: 1.8.10-stable
Git Commit: 4bb3c89d44e372e6a9ab85a8be0c9345265c763a
Architecture: amd64
Protocol Versions: [63 62]
Network Id: 1
Go Version: go1.9.5
Operating System: linux
GOPATH=
GOROOT=/usr/lib/go-1.9

```

#### 1.1.2.Â å®‰è£… solc

```

sudo apt install solc -y

```

```

neo@netkiller ~ % solc --version
solc, the solidity compiler commandline interface
Version: 0.4.19+commit.c4cbbb05.Linux.g++				

```

#### 1.1.3.Â Node.js

```

curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -
sudo apt-get install -y nodejs				

```

### 1.2.Â CentOS 7

```

yum update -y
yum install git wget bzip2 -y	
yum install golang -y

cd /usr/local/src
git clone https://github.com/ethereum/go-ethereum.git
cd go-ethereum/
gmake all
mv build /srv/go-ethereum

echo "export PATH=$PATH:$PWD/build/bin" >> /etc/profile
source /etc/profile		

```

ä¸Šé¢å®‰è£…ç‰ˆæœ¬æ˜¯ unstable ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ Release ç‰ˆæœ¬ [`github.com/ethereum/go-ethereum/tags`](https://github.com/ethereum/go-ethereum/tags)

```

wget https://github.com/ethereum/go-ethereum/archive/v1.8.10.tar.gz
tar zxvf v1.8.10.tar.gz
cd go-ethereum-1.8.10/
gmake all

mv build /srv/go-ethereum-1.8.10

```

### 1.3.Â Windows

```

è®¿é—® https://geth.ethereum.org/downloads/
ä¸‹è½½å¹¶å®‰è£… Geth for Windows				

```

### 1.4.Â Mac OS

```

brew update
brew upgrade				
brew tap ethereum/ethereum
brew install ethereum
brew install solidity

```

#### 1.4.1.Â å®‰è£… Node

```

brew install node
brew install npm
npm config set registry https://registry.npm.taobao.org

```

#### 1.4.2.Â Ethereum Wallet

ä¸‹è½½å®‰è£…ä»¥å¤ªåŠé’±åŒ…ï¼ˆå¤§é™†ç½‘ç»œå¯èƒ½ä¸‹è½½æœ‰é—®é¢˜ï¼Œéœ€è¦ç¿»å¢™ï¼‰

[`github.com/ethereum/mist/releases/download/v0.9.3/Ethereum-Wallet-macosx-0-9-3.dmg`](https://github.com/ethereum/mist/releases/download/v0.9.3/Ethereum-Wallet-macosx-0-9-3.dmg)

### 1.5.Â ç¼–è¯‘å®‰è£…

```

git clone https://github.com/ethereum/go-ethereum
sudo apt-get install -y build-essential golang
cd go-ethereum
make geth

```

### 1.6.Â Netkiller OSCM ä¸€é”®å®‰è£…

Netkiller OSCM æ˜¯ç”± Netkiller åˆ¶ä½œçš„ä¸€å¥—è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ã€‚

é€‚ç”¨äº CentOS 7

#### 1.6.1.Â 1.8.10

```

curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/centos/go-ethereum-1.8.10.sh | bash			

```

å®‰è£…å®Œæˆåä½¿ç”¨ä¸‹é¢å‘½ä»¤è¿›å…¥æ§åˆ¶å°

```

[root@localhost ~]# su - ethereum
Last login: Sat Feb  3 00:23:52 EST 2018 on pts/0

[ethereum@localhost ~]$ geth attach
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.10-stable/linux-amd64/go1.8.10
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> 

```

#### 1.6.2.Â 1.8.1

```

curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/centos/go-ethereum-1.8.1.sh | bash

```

#### 1.6.3.Â 1.8.10

```

curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/gcc/gcc.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/golang/golang-1.10.2.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/centos/go-ethereum-1.8.10.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/systemd/private.sh | bash

curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/node-v10.1.0.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/profile.d.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/truffle/truffle.sh | bash

```

### 1.7.Â é˜²æ­¢ geth å¼‚å¸¸é€€å‡º

åœ¨åŒæ­¥ä¸»ç½‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°ç»å¸¸å‡ºç° geth å´©æºƒé€€å‡ºï¼Œä¸ºäº†é˜²æ­¢å¼‚å¸¸é€€å‡ºï¼Œæˆ‘ä»¬å†™äº†è¿™ä¸ªè„šæœ¬ã€‚

```

[ethereum@netkiller ~]$ cat run.sh 
#!/bin/bash
for (( ; ; ))
do
	#geth --syncmode light --cache 2048 --maxpeers 200
	# geth --syncmode light --cache 2048 --maxpeers 200 --rpc --rpcaddr 0.0.0.0 --rpcport 7545 --rpcapi web3,admin,eth,personal --port 30303 2> /tmp/geth.log
	geth --datadir private --networkid 44444 --port 30302 --mine --rpc
	#geth --testnet --syncmode light --cache 2048 --maxpeers 200 --rpc 2> /tmp/geth.log
	sleep 10

done &

```

## 2.Â åˆ›ä¸–åŒºå—

```

cd ~
mkdir -p ethereum
cd ethereum		

```

### 2.1.Â åˆå§‹åŒ–åˆ›ä¸–åŒºå—

åˆ›å»ºæ–‡ä»¶ genesis.json

```

{
  "nonce": "0x0000000000000042",
  "difficulty": "0x020000",
  "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "coinbase": "0x0000000000000000000000000000000000000000",
  "timestamp": "0x00",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "extraData": "0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa",
  "gasLimit": "0x4c4b40",
  "config": {
      "chainId": 15,
      "homesteadBlock": 0,
      "eip155Block": 0,
      "eip158Block": 0
  },
  "alloc": { }
}

```

mixhash:Â ä¸ nonce é…åˆç”¨äºæŒ–çŸ¿ï¼Œç”±ä¸Šä¸€ä¸ªåŒºå—çš„ä¸€éƒ¨åˆ†ç”Ÿæˆçš„ hashã€‚æ³¨æ„ä»–å’Œ nonce çš„è®¾ç½®éœ€è¦æ»¡è¶³ä»¥å¤ªåŠçš„ YellowÂ paper,Â 4.3.4.Â BlockÂ HeaderÂ Validity,Â (44)ç« èŠ‚æ‰€æè¿°çš„æ¡ä»¶ã€‚.

nonce:Â nonce å°±æ˜¯ä¸€ä¸ª 64 ä½éšæœºæ•°ï¼Œç”¨äºæŒ–çŸ¿ï¼Œæ³¨æ„ä»–å’Œ mixhash çš„è®¾ç½®éœ€è¦æ»¡è¶³ä»¥å¤ªåŠçš„ YellowÂ paper,Â 4.3.4.Â BlockÂ HeaderÂ Validity,Â (44)ç« èŠ‚æ‰€æè¿°çš„æ¡ä»¶ã€‚

difficulty:Â è®¾ç½®å½“å‰åŒºå—çš„éš¾åº¦ï¼Œå¦‚æœéš¾åº¦è¿‡å¤§ï¼Œcpu æŒ–çŸ¿å°±å¾ˆéš¾ï¼Œè¿™é‡Œè®¾ç½®è¾ƒå°éš¾åº¦

alloc:Â ç”¨æ¥é¢„ç½®è´¦å·ä»¥åŠè´¦å·çš„ä»¥å¤ªå¸æ•°é‡ï¼Œå› ä¸ºç§æœ‰é“¾æŒ–çŸ¿æ¯”è¾ƒå®¹æ˜“ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦é¢„ç½®æœ‰å¸çš„è´¦å·ï¼Œéœ€è¦çš„æ—¶å€™è‡ªå·±åˆ›å»ºå³å¯ä»¥ã€‚

coinbase:Â çŸ¿å·¥çš„è´¦å·ï¼Œéšä¾¿å¡«

timestamp:Â è®¾ç½®åˆ›ä¸–å—çš„æ—¶é—´æˆ³

parentHash:Â ä¸Šä¸€ä¸ªåŒºå—çš„ hash å€¼ï¼Œå› ä¸ºæ˜¯åˆ›ä¸–å—ï¼Œæ‰€ä»¥è¿™ä¸ªå€¼æ˜¯ 0

extraData:Â é™„åŠ ä¿¡æ¯ï¼Œéšä¾¿å¡«ï¼Œå¯ä»¥å¡«ä½ çš„ä¸ªæ€§ä¿¡æ¯

gasLimit:Â è¯¥å€¼è®¾ç½®å¯¹ GAS çš„æ¶ˆè€—æ€»é‡é™åˆ¶ï¼Œç”¨æ¥é™åˆ¶åŒºå—èƒ½åŒ…å«çš„äº¤æ˜“ä¿¡æ¯æ€»å’Œï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ç§æœ‰é“¾ï¼Œæ‰€ä»¥å¡«æœ€å¤§ã€‚

åˆå§‹åŒ–åˆ›ä¸–åŒºå—

```

neo@netkiller ~/ethereum % geth init genesis.json 
WARN [01-19|17:35:17] No etherbase set and no accounts found as default 
INFO [01-19|17:35:17] Allocated cache and file handles         database=/home/neo/.ethereum/geth/chaindata cache=16 handles=16
INFO [01-19|17:35:17] Writing custom genesis block 
INFO [01-19|17:35:17] Successfully wrote genesis state         database=chaindata                          hash=611596â€¦424d04
INFO [01-19|17:35:17] Allocated cache and file handles         database=/home/neo/.ethereum/geth/lightchaindata cache=16 handles=16
INFO [01-19|17:35:18] Writing custom genesis block 
INFO [01-19|17:35:18] Successfully wrote genesis state         database=lightchaindata                          hash=611596â€¦424d04		

```

é»˜è®¤ç›®å½•æ˜¯ /home/neo/.ethereum/ ä½ å¯ä»¥é€šè¿‡ --datadir å‚æ•°æŒ‡å®šç›®å½•

```

neo@netkiller ~/ethereum % geth --datadir data init genesis.json
WARN [01-19|17:38:16] No etherbase set and no accounts found as default 
INFO [01-19|17:38:16] Allocated cache and file handles         database=/home/neo/ethereum/data/geth/chaindata cache=16 handles=16
INFO [01-19|17:38:17] Writing custom genesis block 
INFO [01-19|17:38:17] Successfully wrote genesis state         database=chaindata                              hash=611596â€¦424d04
INFO [01-19|17:38:17] Allocated cache and file handles         database=/home/neo/ethereum/data/geth/lightchaindata cache=16 handles=16
INFO [01-19|17:38:17] Writing custom genesis block 
INFO [01-19|17:38:17] Successfully wrote genesis state         database=lightchaindata                              hash=611596â€¦424d04		

neo@netkiller ~/ethereum % find data 
data
data/keystore
data/geth
data/geth/chaindata
data/geth/chaindata/LOCK
data/geth/chaindata/LOG
data/geth/chaindata/MANIFEST-000000
data/geth/chaindata/CURRENT
data/geth/chaindata/000001.log
data/geth/lightchaindata
data/geth/lightchaindata/LOCK
data/geth/lightchaindata/LOG
data/geth/lightchaindata/MANIFEST-000000
data/geth/lightchaindata/CURRENT
data/geth/lightchaindata/000001.log		

```

ç›®å½•ç»“æ„

```

data
â”œâ”€â”€ geth
â”‚  â”œâ”€â”€ chaindata
â”‚  â”‚  â”œâ”€â”€ 000001.log
â”‚  â”‚  â”œâ”€â”€ CURRENT
â”‚  â”‚  â”œâ”€â”€ LOCK
â”‚  â”‚  â”œâ”€â”€ LOG
â”‚  â”‚  â””â”€â”€ MANIFEST-000000
â”‚  â””â”€â”€ lightchaindata
â”‚      â”œâ”€â”€ 000001.log
â”‚      â”œâ”€â”€ CURRENT
â”‚      â”œâ”€â”€ LOCK
â”‚      â”œâ”€â”€ LOG
â”‚      â””â”€â”€ MANIFEST-000000
â””â”€â”€ keystore		

```

### 2.2.Â åˆ›å»ºä¸»è´¦å·

```

neo@netkiller ~/ethereum % geth account new
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase: 
Repeat passphrase: 
Address: {39211a30bfe33d4b12fcbd786472c8a552b93389}			

```

### æç¤º

å¯†ç å¯ä»¥ç›´æ¥å›è½¦ï¼Œä½†æ˜¯åé¢ Ethereum Wallet é‡åˆ°äº†éº»çƒ¦ï¼Œ Ethereum Wallet è¦æ±‚å¯†ç å¿…é¡»æ˜¯ 8 ä¸ºæ•°

### 2.3.Â å¯åŠ¨èŠ‚ç‚¹

```

neo@netkiller ~/ethereum % geth --networkid 123456 --rpc --rpccorsdomain "*" --nodiscover console 
WARN [01-19|17:47:06] No etherbase set and no accounts found as default 
INFO [01-19|17:47:06] Starting peer-to-peer node               instance=Geth/v1.8.10-stable-4bb3c89d/linux-amd64/go1.9.5
INFO [01-19|17:47:06] Allocated cache and file handles         database=/home/neo/.ethereum/geth/chaindata cache=128 handles=1024
INFO [01-19|17:47:06] Initialised chain configuration          config="{ChainID: 15 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: <nil> EIP155: 0 EIP158: 0 Byzantium: <nil> Engine: unknown}"
INFO [01-19|17:47:06] Disk storage enabled for ethash caches   dir=/home/neo/.ethereum/geth/ethash count=3
INFO [01-19|17:47:06] Disk storage enabled for ethash DAGs     dir=/home/neo/.ethash               count=2
INFO [01-19|17:47:06] Initialising Ethereum protocol           versions="[63 62]" network=123456
INFO [01-19|17:47:06] Loaded most recent local header          number=0 hash=611596â€¦424d04 td=131072
INFO [01-19|17:47:06] Loaded most recent local full block      number=0 hash=611596â€¦424d04 td=131072
INFO [01-19|17:47:06] Loaded most recent local fast block      number=0 hash=611596â€¦424d04 td=131072
INFO [01-19|17:47:06] Loaded local transaction journal         transactions=0 dropped=0
INFO [01-19|17:47:06] Regenerated local transaction journal    transactions=0 accounts=0
INFO [01-19|17:47:06] Starting P2P networking 
INFO [01-19|17:47:06] RLPx listener up                         self="enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@[::]:30303?discport=0"
INFO [01-19|17:47:06] IPC endpoint opened: /home/neo/.ethereum/geth.ipc 
INFO [01-19|17:47:06] HTTP endpoint opened: http://127.0.0.1:8545 
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.10-stable-4bb3c89d/linux-amd64/go1.9.5
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> INFO [01-19|17:47:09] Mapped network port                      proto=tcp extport=30303 intport=30303 interface="UPNP IGDv1-IP1"			

```

identity:Â åŒºå—é“¾çš„æ ‡ç¤ºï¼Œéšä¾¿å¡«å†™ï¼Œç”¨äºæ ‡ç¤ºç›®å‰ç½‘ç»œçš„åå­—

init:Â æŒ‡å®šåˆ›ä¸–å—æ–‡ä»¶çš„ä½ç½®ï¼Œå¹¶åˆ›å»ºåˆå§‹å—

datadir:Â è®¾ç½®å½“å‰åŒºå—é“¾ç½‘ç»œæ•°æ®å­˜æ”¾çš„ä½ç½®

port:Â ç½‘ç»œç›‘å¬ç«¯å£

rpc:Â å¯åŠ¨ rpc é€šä¿¡ï¼Œå¯ä»¥è¿›è¡Œæ™ºèƒ½åˆçº¦çš„éƒ¨ç½²å’Œè°ƒè¯•

rpcapi:Â è®¾ç½®å…è®¸è¿æ¥çš„ rpc çš„å®¢æˆ·ç«¯ï¼Œä¸€èˆ¬ä¸º db,eth,net,web3

networkid:Â è®¾ç½®å½“å‰åŒºå—é“¾çš„ç½‘ç»œ IDï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„ç½‘ç»œï¼Œæ˜¯ä¸€ä¸ªæ•°å­—

console:Â å¯åŠ¨å‘½ä»¤è¡Œæ¨¡å¼ï¼Œå¯ä»¥åœ¨ Geth ä¸­æ‰§è¡Œå‘½ä»¤

### 2.4.Â ä½¿ç”¨èŠ‚ç‚¹è¿›è¡ŒæŒ–çŸ¿

#### 2.4.1.Â å¯åŠ¨çŸ¿å·¥å¼€å§‹æŒ–çŸ¿

```

> miner.start(1)		

```

è¿™é‡Œçš„ 1 è¡¨ç¤ºåªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿è¡Œ,ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶å°†å¼€å§‹åˆ›å»º DAG æ–‡ä»¶ï¼Œåªéœ€ç­‰å¾…è¿›åº¦æ¡åˆ° 100ï¼Œåˆ™å°†å¼€å§‹æŒ–çŸ¿ã€‚ å®é™…ä½ çœ‹åˆ°çš„æŒ–çŸ¿é€Ÿåº¦å¾ˆå¿«ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å·²ç»åœ¨åˆå§‹åŒ–åˆ›ä¸–åŒºå—æ—¶é…ç½®ä¸º:"nonce": "0x0000000000000042"ã€‚ â€œ0x42â€éš¾åº¦èƒ½è®©ä½ åœ¨ç§æœ‰æµ‹è¯•ç½‘é“¾ä¸Šå¿«é€ŸæŒ–ä»¥å¤ªå¸ã€‚

### æç¤º

æŒ–çŸ¿æ—¶å¿…ç„¶æœ‰çŸ¿å·¥è´¦æˆ·ï¼Œè€Œç³»ç»Ÿé»˜è®¤ä½¿ç”¨åˆ›å»ºçš„ç¬¬ä¸€ä¸ªè´¦å·ã€‚

```

> miner.start(1)
INFO [01-19|21:06:43] Updated mining threads                   threads=1
INFO [01-19|21:06:43] Transaction pool price threshold updated price=18000000000
INFO [01-19|21:06:43] Starting mining operation 
null
> INFO [01-19|21:06:43] Commit new mining work                   number=1 txs=0 uncles=0 elapsed=717.552Âµs
INFO [01-19|21:06:46] Generating ethash verification cache     epoch=0 percentage=91 elapsed=3.000s
INFO [01-19|21:06:46] Generated ethash verification cache      epoch=0 elapsed=3.273s
INFO [01-19|21:06:51] Generating DAG in progress               epoch=0 percentage=0  elapsed=5.056s
INFO [01-19|21:06:56] Generating DAG in progress               epoch=0 percentage=1  elapsed=10.140s
INFO [01-19|21:07:01] Generating DAG in progress               epoch=0 percentage=2  elapsed=15.119s
INFO [01-19|21:07:06] Generating DAG in progress               epoch=0 percentage=3  elapsed=19.924s
INFO [01-19|21:07:11] Generating DAG in progress               epoch=0 percentage=4  elapsed=24.739s
INFO [01-19|21:07:16] Generating DAG in progress               epoch=0 percentage=5  elapsed=29.473s
INFO [01-19|21:07:22] Generating DAG in progress               epoch=0 percentage=6  elapsed=35.641s
INFO [01-19|21:07:26] Generating DAG in progress               epoch=0 percentage=7  elapsed=40.374s
INFO [01-19|21:07:31] Generating DAG in progress               epoch=0 percentage=8  elapsed=45.134s
INFO [01-19|21:07:36] Generating DAG in progress               epoch=0 percentage=9  elapsed=49.908s
INFO [01-19|21:07:41] Generating DAG in progress               epoch=0 percentage=10 elapsed=54.633s	
......
......
......
INFO [01-19|21:22:43] Generated ethash verification cache      epoch=0 elapsed=15m57.328s
INFO [01-19|21:22:47] Generating ethash verification cache     epoch=1 percentage=17 elapsed=3.031s
INFO [01-19|21:22:50] Generating ethash verification cache     epoch=1 percentage=34 elapsed=6.056s
INFO [01-19|21:22:53] Generating ethash verification cache     epoch=1 percentage=49 elapsed=9.562s
INFO [01-19|21:22:57] Generating ethash verification cache     epoch=1 percentage=70 elapsed=13.115s
INFO [01-19|21:23:00] Generating ethash verification cache     epoch=1 percentage=90 elapsed=16.123s
INFO [01-19|21:23:01] Generated ethash verification cache      epoch=1 elapsed=17.576s
INFO [01-19|21:23:19] Generating DAG in progress               epoch=1 percentage=0  elapsed=18.198s
INFO [01-19|21:23:32] Successfully sealed new block            number=1 hash=e2b5b9â€¦9b1bfe
INFO [01-19|21:23:32] ğŸ”¨ mined potential block                  number=1 hash=e2b5b9â€¦9b1bfe
INFO [01-19|21:23:32] Commit new mining work                   number=2 txs=0 uncles=0 elapsed=1.188ms
INFO [01-19|21:23:37] Generating DAG in progress               epoch=1 percentage=1  elapsed=35.913s
INFO [01-19|21:23:41] Successfully sealed new block            number=2 hash=62db3fâ€¦e27b50
INFO [01-19|21:23:41] ğŸ”¨ mined potential block                  number=2 hash=62db3fâ€¦e27b50
INFO [01-19|21:23:41] Commit new mining work                   number=3 txs=0 uncles=0 elapsed=772.239Âµs
INFO [01-19|21:23:43] Successfully sealed new block            number=3 hash=34384bâ€¦c387f2
INFO [01-19|21:23:43] ğŸ”¨ mined potential block                  number=3 hash=34384bâ€¦c387f2
INFO [01-19|21:23:43] Commit new mining work                   number=4 txs=0 uncles=0 elapsed=1.002ms
INFO [01-19|21:23:55] Generating DAG in progress               epoch=1 percentage=2  elapsed=53.757s
INFO [01-19|21:24:13] Generating DAG in progress               epoch=1 percentage=3  elapsed=1m11.561s
INFO [01-19|21:24:30] Generating DAG in progress               epoch=1 percentage=4  elapsed=1m28.986s
INFO [01-19|21:24:30] Successfully sealed new block            number=4 hash=681970â€¦462135
INFO [01-19|21:24:30] ğŸ”¨ mined potential block                  number=4 hash=681970â€¦462135
INFO [01-19|21:24:30] Commit new mining work                   number=5 txs=0 uncles=0 elapsed=833.629Âµs
INFO [01-19|21:24:36] Successfully sealed new block            number=5 hash=7b058bâ€¦d2f07a
INFO [01-19|21:24:36] ğŸ”¨ mined potential block                  number=5 hash=7b058bâ€¦d2f07a
INFO [01-19|21:24:36] Commit new mining work                   number=6 txs=0 uncles=0 elapsed=897.815Âµs
INFO [01-19|21:24:43] Successfully sealed new block            number=6 hash=a5fc3dâ€¦b1221e
INFO [01-19|21:24:43] ğŸ”— block reached canonical chain          number=1 hash=e2b5b9â€¦9b1bfe
INFO [01-19|21:24:43] ğŸ”¨ mined potential block                  number=6 hash=a5fc3dâ€¦b1221e
INFO [01-19|21:24:43] Commit new mining work                   number=7 txs=0 uncles=0 elapsed=758.061Âµs
INFO [01-19|21:24:47] Successfully sealed new block            number=7 hash=003b02â€¦e886fd
INFO [01-19|21:24:47] ğŸ”— block reached canonical chain          number=2 hash=62db3fâ€¦e27b50
INFO [01-19|21:24:47] ğŸ”¨ mined potential block                  number=7 hash=003b02â€¦e886fd
INFO [01-19|21:24:47] Commit new mining work                   number=8 txs=0 uncles=0 elapsed=920.862Âµs
INFO [01-19|21:24:48] Generating DAG in progress               epoch=1 percentage=5  elapsed=1m46.827s
INFO [01-19|21:25:06] Generating DAG in progress               epoch=1 percentage=6  elapsed=2m4.338s
INFO [01-19|21:25:23] Successfully sealed new block            number=8 hash=fd23c9â€¦361c65
INFO [01-19|21:25:23] ğŸ”— block reached canonical chain          number=3 hash=34384bâ€¦c387f2
INFO [01-19|21:25:23] ğŸ”¨ mined potential block                  number=8 hash=fd23c9â€¦361c65
INFO [01-19|21:25:23] Commit new mining work                   number=9 txs=0 uncles=0 elapsed=825.737Âµs
INFO [01-19|21:25:23] Generating DAG in progress               epoch=1 percentage=7  elapsed=2m22.061s

```

#### 2.4.2.Â åœæ­¢æŒ–çŸ¿

```

> miner.stop()
true
>

```

#### 2.4.3.Â æŸ¥çœ‹æ‰€æŒ–é‡‘é¢

```

> eth.getBalance(eth.accounts[0])
70000000000000000000				

```

### 2.5.Â åœ¨åˆ›ä¸–é“¾ä¸­åˆ¶å®šçŸ¿å·¥è´¦å·å¹¶ä¸ºå®ƒå……å€¼

```

  "alloc": {
    "0xe8abf98484325fd6afc59b804ac15804b978e607": {
      "balance": "300000"
    },
    "0x013b5e735e1b48421dd3de3b931d6f03e769e22b": {
      "balance": "400000"
    }
  }		

```

## 3.Â Blockchain explorer (åŒºå—é“¾æµè§ˆå™¨)

[`github.com/ethereumproject/explorer`](https://github.com/ethereumproject/explorer)

## 4.Â å•æœºå¤šå®ä¾‹æ¼”ç¤º

åœ¨æ²¡æœ‰æ¡ä»¶å®‰è£…è™šæ‹Ÿæœºä¹Ÿæ²¡æœ‰å¤šå°æœåŠ¡å™¨çš„æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€å°æœåŠ¡å™¨è¿è¡Œå¤šä¸ªå®ä¾‹çš„æ–¹æ³•ä¹Ÿå¯ä»¥å®ç°å¤šä¸ªèŠ‚ç‚¹è¿è¡Œç¯å¢ƒã€‚

```

cd ~
mkdir -p ethereum
cd ethereum
mkdir data{1,2}

```

åˆ›å»ºæ–‡ä»¶ genesis.json

```

{
  "nonce": "0x0000000000000042",
  "difficulty": "0x020000",
  "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "coinbase": "0x0000000000000000000000000000000000000000",
  "timestamp": "0x00",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "extraData": "0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa",
  "gasLimit": "0x4c4b40",
  "config": {
      "chainId": 15,
      "homesteadBlock": 0,
      "eip155Block": 0,
      "eip158Block": 0
  },
  "alloc": { }
}			

```

### 4.1.Â å®ä¾‹ä¸€

```

geth --datadir ~/ethereum/data1 init genesis.json
geth --datadir="~/ethereum/data1" --networkid 123456 --port 30301 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" --rpcport 8541		

```

å¯åŠ¨åç»ˆç«¯è¾“å‡º

```

neo@netkiller ~/ethereum % geth --datadir ~/ethereum/data1 init genesis.json
WARN [02-02|22:09:56] No etherbase set and no accounts found as default 
INFO [02-02|22:09:56] Allocated cache and file handles         database=/home/neo/ethereum/data1/geth/chaindata cache=16 handles=16
INFO [02-02|22:09:56] Writing custom genesis block 
INFO [02-02|22:09:56] Successfully wrote genesis state         database=chaindata                               hash=611596â€¦424d04
INFO [02-02|22:09:56] Allocated cache and file handles         database=/home/neo/ethereum/data1/geth/lightchaindata cache=16 handles=16
INFO [02-02|22:09:57] Writing custom genesis block 
INFO [02-02|22:09:57] Successfully wrote genesis state         database=lightchaindata                               hash=611596â€¦424d04

neo@netkiller ~ % geth --datadir="~/ethereum/data1" --networkid 123456 --port 30301 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" -rpcport 8541             
WARN [02-02|22:36:02] No etherbase set and no accounts found as default 
INFO [02-02|22:36:02] Starting peer-to-peer node               instance=Geth/v1.8.10-stable-4bb3c89d/linux-amd64/go1.9.5
INFO [02-02|22:36:02] Allocated cache and file handles         database=/home/neo/ethereum/data1/geth/chaindata cache=128 handles=1024
INFO [02-02|22:36:02] Initialised chain configuration          config="{ChainID: 15 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: <nil> EIP155: 0 EIP158: 0 Byzantium: <nil> Engine: unknown}"
INFO [02-02|22:36:02] Disk storage enabled for ethash caches   dir=/home/neo/ethereum/data1/geth/ethash count=3
INFO [02-02|22:36:02] Disk storage enabled for ethash DAGs     dir=/home/neo/.ethash                    count=2
INFO [02-02|22:36:02] Initialising Ethereum protocol           versions="[63 62]" network=123456
INFO [02-02|22:36:02] Loaded most recent local header          number=0 hash=611596â€¦424d04 td=131072
INFO [02-02|22:36:02] Loaded most recent local full block      number=0 hash=611596â€¦424d04 td=131072
INFO [02-02|22:36:02] Loaded most recent local fast block      number=0 hash=611596â€¦424d04 td=131072
INFO [02-02|22:36:02] Loaded local transaction journal         transactions=0 dropped=0
INFO [02-02|22:36:02] Regenerated local transaction journal    transactions=0 accounts=0
INFO [02-02|22:36:02] Starting P2P networking 
INFO [02-02|22:36:05] UDP listener up                          self=enode://53433417f11d1d9a17f155cbaad2c4ec375af7b141e2989f049b572fc3f856d78f254e58fa82ed6eab48a16b7d625527214522ec0fd3e3af030b5b8dfdadc062@14.103.209.119:30301
INFO [02-02|22:36:05] HTTP endpoint opened: http://0.0.0.0:8541 
INFO [02-02|22:36:05] IPC endpoint opened: /home/neo/ethereum/data1/geth.ipc 
INFO [02-02|22:36:05] RLPx listener up                         self=enode://53433417f11d1d9a17f155cbaad2c4ec375af7b141e2989f049b572fc3f856d78f254e58fa82ed6eab48a16b7d625527214522ec0fd3e3af030b5b8dfdadc062@14.103.209.119:30301
INFO [02-02|22:36:05] Mapped network port                      proto=udp extport=30301 intport=30301 interface="UPNP IGDv1-IP1"
INFO [02-02|22:36:07] Mapped network port                      proto=tcp extport=30301 intport=30301 interface="UPNP IGDv1-IP1"

```

### 4.2.Â å®ä¾‹äºŒ

```

geth --datadir ~/ethereum/data2 init genesis.json
geth --datadir="~/ethereum/data2" --networkid 123456 --port 30302 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" --rpcport 8542		

```

å¯åŠ¨åæ§åˆ¶å°è¾“å‡ºä¸å®ä¾‹ä¸€ç±»ä¼¼

### 4.3.Â æ·»åŠ èŠ‚ç‚¹

å¼€å¯ä¸€ä¸ªæ–°ç»ˆç«¯çª—å£ï¼Œè¿è¡Œä¸‹é¢å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹ä¸€çš„ enode å­—ç¬¦ä¸²

```

geth --exec 'admin.nodeInfo.enode' attach ethereum/data1/geth.ipc
"enode://53433417f11d1d9a17f155cbaad2c4ec375af7b141e2989f049b572fc3f856d78f254e58fa82ed6eab48a16b7d625527214522ec0fd3e3af030b5b8dfdadc062@[::]:30301?discport=0"				

```

è¿›å…¥èŠ‚ç‚¹äºŒï¼Œå¹¶è¿æ¥åˆ°èŠ‚ç‚¹ä¸€ã€‚

```

neo@netkiller ~ % geth attach ethereum/data2/geth.ipc
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.10-stable-4bb3c89d/linux-amd64/go1.9.5
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> admin.addPeer("enode://53433417f11d1d9a17f155cbaad2c4ec375af7b141e2989f049b572fc3f856d78f254e58fa82ed6eab48a16b7d625527214522ec0fd3e3af030b5b8dfdadc062@[::]:30302")
true
> admin.addPeer("enode://53433417f11d1d9a17f155cbaad2c4ec375af7b141e2989f049b572fc3f856d78f254e58fa82ed6eab48a16b7d625527214522ec0fd3e3af030b5b8dfdadc062@[::]:30301")
true

```

æŸ¥çœ‹èŠ‚ç‚¹

```

> admin.peers
[{
    caps: ["eth/63"],
    id: "53433417f11d1d9a17f155cbaad2c4ec375af7b141e2989f049b572fc3f856d78f254e58fa82ed6eab48a16b7d625527214522ec0fd3e3af030b5b8dfdadc062",
    name: "Geth/v1.8.10-stable-4bb3c89d/linux-amd64/go1.9.5",
    network: {
      localAddress: "[::1]:51250",
      remoteAddress: "[::1]:30301"
    },
    protocols: {
      eth: {
        difficulty: 131072,
        head: "0x611596e7979cd4e7ca1531260fa706093a5492ecbdf58f20a39545397e424d04",
        version: 63
      }
    }
}]

```

è‡³æ­¤ï¼ŒèŠ‚ç‚¹å·²ç»æ·»åŠ å®Œæ¯•ã€‚

```

> exit				

```

é€€å‡º

### 4.4.Â èŠ‚ç‚¹æµ‹è¯•

è¿™é‡Œæˆ‘ä»¬å®ç°ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„ä»¥å¤ªå¸è½¬è´¦ã€‚

ç°åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æ²¡æœ‰ä»»ä½•è´¦å·

```

neo@netkiller ~ % geth --exec 'personal.listAccounts' attach ethereum/data1/geth.ipc                                        
[]
neo@netkiller ~ % geth --exec 'personal.listAccounts' attach ethereum/data2/geth.ipc
[]

```

åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šåˆ†åˆ«åˆ›å»ºä¸¤ä¸ªè´¦å·ï¼Œä¸€ä¸ªæ˜¯çŸ¿å·¥è´¦å·ï¼Œå¦ä¸€ä¸ªæ˜¯æ™®é€šè´¦å·ã€‚

```

neo@netkiller ~ % geth --exec 'personal.newAccount("abc123")' attach ethereum/data1/geth.ipc
"0x5ad227e8d7e460713c78eebbe558473571edae72"

neo@netkiller ~ % geth --exec 'personal.newAccount("abc123")' attach ethereum/data1/geth.ipc
"0x3e822e05ee975e02be3f15f32b0fddced8d5bdd0"

neo@netkiller ~ % geth --exec 'personal.listAccounts' attach ethereum/data1/geth.ipc 
["0x5ad227e8d7e460713c78eebbe558473571edae72", "0x3e822e05ee975e02be3f15f32b0fddced8d5bdd0"]

neo@netkiller ~ % geth --exec 'personal.newAccount("abc123")' attach ethereum/data2/geth.ipc
"0xa6df3e3c141e27726f4aeb21a5dab2e5c76c9565"

neo@netkiller ~ % geth --exec 'personal.newAccount("abc123")' attach ethereum/data2/geth.ipc
"0xa66c7b8b1c26856d284a0b962385babe02caa51d"

neo@netkiller ~ % geth --exec 'personal.listAccounts' attach ethereum/data2/geth.ipc 
["0xa6df3e3c141e27726f4aeb21a5dab2e5c76c9565", "0xa66c7b8b1c26856d284a0b962385babe02caa51d"]

```

å¯åŠ¨æŒ–çŸ¿

```

geth --exec 'miner.start(1)' attach ethereum/data1/geth.ipc 
geth --exec 'miner.start(1)' attach ethereum/data2/geth.ipc 

```

å¦‚æœæ­£å¸¸è¿è¡Œï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„çŸ¿å·¥è´¦å·éƒ½ä¼šæœ‰ä¸€å®šçš„ä»¥å¤ªå¸ã€‚è€Œæ™®é€šè´¦å·é¢åº¦åº”è¯¥ä¸ºé›¶ã€‚

```

neo@netkiller ~ % geth --exec 'eth.getBalance(eth.accounts[0])' attach ethereum/data1/geth.ipc
299438256000000000000

neo@netkiller ~ % geth --exec 'eth.getBalance(eth.accounts[1])' attach ethereum/data1/geth.ipc
0

neo@netkiller ~ % geth --exec 'eth.getBalance(eth.accounts[1])' attach ethereum/data1/geth.ipc
298000056000000000000

neo@netkiller ~ % geth --exec 'eth.getBalance(eth.accounts[1])' attach ethereum/data2/geth.ipc
0				

```

æˆ‘ä»¬å°è¯•ä»èŠ‚ç‚¹ä¸€çŸ¿å·¥è´¦å·å‘èŠ‚ç‚¹äºŒä¸Šçš„æ™®é€šç”¨æˆ·è½¬è´¦ã€‚

```

neo@netkiller ~ % geth attach ethereum/data1/geth.ipc                               
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.10-stable-4bb3c89d/linux-amd64/go1.9.5
coinbase: 0x5ad227e8d7e460713c78eebbe558473571edae72
at block: 144 (Fri, 02 Feb 2018 23:24:35 HST)
 datadir: /home/neo/ethereum/data1
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> personal.listAccounts
["0x5ad227e8d7e460713c78eebbe558473571edae72"]

> personal.unlockAccount(eth.accounts[0], "abc123")
true

> eth.sendTransaction({from: "0x5ad227e8d7e460713c78eebbe558473571edae72", to: "0xa66c7b8b1c26856d284a0b962385babe02caa51d", value: web3.toWei(1, "ether")})
"0x87c059d0769c8a74499ddd08c04a10f23b7681651615a28098d73ec63a943684"

> eth.pendingTransactions
[{
    blockHash: null,
    blockNumber: null,
    from: "0x5ad227e8d7e460713c78eebbe558473571edae72",
    gas: 90000,
    gasPrice: 18000000000,
    hash: "0x87c059d0769c8a74499ddd08c04a10f23b7681651615a28098d73ec63a943684",
    input: "0x",
    nonce: 2,
    r: "0xce004f964f268a00e90cadd4e8a685131aa34f37144f7e2e47dc7fe4ec784e55",
    s: "0x412209c18513a28422e62c4bdb85a223f190e133cf71990a87c570a3a53ae093",
    to: "0xa66c7b8b1c26856d284a0b962385babe02caa51d",
    transactionIndex: 0,
    v: "0x41",
    value: 1000000000000000000
}]

```

ç¨åä¸€ä¼šï¼Œå½“ä½¿ç”¨ eth.pendingTransactions æŸ¥çœ‹æŒ‚èµ·äº¤æ˜“ä¸ºç©ºçš„æ—¶å€™ï¼Œè¡¨ç¤ºå·²ç»å¤„ç†å®Œæ¯•ã€‚è¿™æ—¶é€€å‡ºæ§åˆ¶å°ã€‚

```

> eth.pendingTransactions
[]
> exit				

```

ç°åœ¨æŸ¥çœ‹èŠ‚ç‚¹äºŒä¸Šçš„ç¬¬äºŒä¸ªæ™®é€šè´¦å·ä½™é¢

```

neo@netkiller ~ % geth --exec 'eth.getBalance(eth.accounts[1])' attach ethereum/data2/geth.ipc
1000000000000000000

```

è½¬è´¦æˆåŠŸ

ç°åœ¨æˆ‘ä»¬ä»èŠ‚ç‚¹äºŒä¸Šçš„æ™®é€šç”¨æˆ·å‘èŠ‚ç‚¹ä¸€ä¸Šçš„æ™®é€šç”¨æˆ·è½¬è´¦ã€‚

```

neo@netkiller ~ % geth attach ethereum/data2/geth.ipc                                        
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.10-stable-4bb3c89d/linux-amd64/go1.9.5
coinbase: 0xa6df3e3c141e27726f4aeb21a5dab2e5c76c9565
at block: 319 (Fri, 02 Feb 2018 23:50:07 HST)
 datadir: /home/neo/ethereum/data2
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> personal.unlockAccount(eth.accounts[1], "abc123")
true

> eth.sendTransaction({from: "0xa66c7b8b1c26856d284a0b962385babe02caa51d", to: "0x3e822e05ee975e02be3f15f32b0fddced8d5bdd0", value: web3.toWei(0.1, "ether")})
"0x951bd161dfd000ff825379cb0644c4acd4afd4d3e1ac4f4c1c6009b3c2a1d366"

> eth.pendingTransactions
[]
> exit		

```

æŸ¥çœ‹ä¸¤ä¸ªæ™®é€šè´¦å·çš„ä½™é¢

```

neo@netkiller ~ % geth --exec 'eth.getBalance(eth.accounts[1])' attach ethereum/data1/geth.ipc
100000000000000000
neo@netkiller ~ % geth --exec 'eth.getBalance(eth.accounts[1])' attach ethereum/data2/geth.ipc
899622000000000000

```

## 5.Â ä½¿ç”¨ pm2 å¯åŠ¨ä»¥å¤ªåŠ

```

npm install -g pm2

```

åˆ›å»º ~/geth.json æ–‡ä»¶

```

[
  {
    "name"              : "geth",
    "cwd"               : "/usr/bin/",
    "script"            : "geth",
    "args"              : "--rpcapi eth,web3 --rpc --dev --datadir /home/neo/ethereum",
    "log_date_format"   : "YYYY-MM-DD HH:mm Z",
    "out_file"      : "/home/neo/ethereum/log/geth_out.log",
    "error_file"    : "/home/neo/ethereum/log/geth_err.log",
    "log_file"      : "/home/neo/ethereum/log/geth_log.log",
    "merge_logs"        : false,
    "watch"             : false,
    "max_restarts"      : 10,
    "exec_interpreter"  : "none",
    "exec_mode"         : "fork_mode"
  }
]

```

å¯åŠ¨ä»¥å¤ªåŠ

```

pm2 start geth.json

```

## ç¬¬Â 11Â ç« Â geth v1.8.16 å‘½ä»¤è¯¦è§£

[`geth.ethereum.org`](https://geth.ethereum.org)

ç‰ˆæœ¬å·

```

neo@MacBook-Pro ~/ethereum/web3 % geth version
Geth
Version: 1.8.16-stable
Architecture: amd64
Protocol Versions: [63 62]
Network Id: 1
Go Version: go1.10
Operating System: darwin
GOPATH=
GOROOT=/usr/local/opt/go/libexec		

```

å¸®åŠ©ä¿¡æ¯

```

neo@MacBook-Pro ~/ethereum/web3 % geth --help
NAME:
   geth - the go-ethereum command line interface

   Copyright 2013-2017 The go-ethereum Authors

USAGE:
   geth [options] command [command options] [arguments...]

VERSION:
   1.8.16-stable

COMMANDS:
   account     Manage accounts
   attach      Start an interactive JavaScript environment (connect to node)
   bug         opens a window to report a bug on the geth repo
   console     Start an interactive JavaScript environment
   copydb      Create a local chain from a target chaindata folder
   dump        Dump a specific block from storage
   dumpconfig  Show configuration values
   export      Export blockchain into file
   import      Import a blockchain file
   init        Bootstrap and initialize a new genesis block
   js          Execute the specified JavaScript files
   license     Display license information
   makecache   Generate ethash verification cache (for testing)
   makedag     Generate ethash mining DAG (for testing)
   monitor     Monitor and visualize node metrics
   removedb    Remove blockchain and state databases
   version     Print version numbers
   wallet      Manage Ethereum presale wallets
   help, h     Shows a list of commands or help for one command

ETHEREUM OPTIONS:
  --config value                           TOML configuration file
  --datadir "/Users/neo/Library/Ethereum"  Data directory for the databases and keystore
  --keystore                               Directory for the keystore (default = inside the datadir)
  --nousb                                  Disables monitoring for and managing USB hardware wallets
  --networkid value                        Network identifier (integer, 1=Frontier, 2=Morden (disused), 3=Ropsten, 4=Rinkeby) (default: 1)
  --testnet                                Ropsten network: pre-configured proof-of-work test network
  --rinkeby                                Rinkeby network: pre-configured proof-of-authority test network
  --syncmode "fast"                        Blockchain sync mode ("fast", "full", or "light")
  --gcmode value                           Blockchain garbage collection mode ("full", "archive") (default: "full")
  --ethstats value                         Reporting URL of a ethstats service (nodename:secret@host:port)
  --identity value                         Custom node name
  --lightserv value                        Maximum percentage of time allowed for serving LES requests (0-90) (default: 0)
  --lightpeers value                       Maximum number of LES client peers (default: 100)
  --lightkdf                               Reduce key-derivation RAM & CPU usage at some expense of KDF strength

DEVELOPER CHAIN OPTIONS:
  --dev               Ephemeral proof-of-authority network with a pre-funded developer account, mining enabled
  --dev.period value  Block period to use in developer mode (0 = mine only if transaction pending) (default: 0)

ETHASH OPTIONS:
  --ethash.cachedir                     Directory to store the ethash verification caches (default = inside the datadir)
  --ethash.cachesinmem value            Number of recent ethash caches to keep in memory (16MB each) (default: 2)
  --ethash.cachesondisk value           Number of recent ethash caches to keep on disk (16MB each) (default: 3)
  --ethash.dagdir "/Users/neo/.ethash"  Directory to store the ethash mining DAGs (default = inside home folder)
  --ethash.dagsinmem value              Number of recent ethash mining DAGs to keep in memory (1+GB each) (default: 1)
  --ethash.dagsondisk value             Number of recent ethash mining DAGs to keep on disk (1+GB each) (default: 2)

TRANSACTION POOL OPTIONS:
  --txpool.nolocals            Disables price exemptions for locally submitted transactions
  --txpool.journal value       Disk journal for local transaction to survive node restarts (default: "transactions.rlp")
  --txpool.rejournal value     Time interval to regenerate the local transaction journal (default: 1h0m0s)
  --txpool.pricelimit value    Minimum gas price limit to enforce for acceptance into the pool (default: 1)
  --txpool.pricebump value     Price bump percentage to replace an already existing transaction (default: 10)
  --txpool.accountslots value  Minimum number of executable transaction slots guaranteed per account (default: 16)
  --txpool.globalslots value   Maximum number of executable transaction slots for all accounts (default: 4096)
  --txpool.accountqueue value  Maximum number of non-executable transaction slots permitted per account (default: 64)
  --txpool.globalqueue value   Maximum number of non-executable transaction slots for all accounts (default: 1024)
  --txpool.lifetime value      Maximum amount of time non-executable transaction are queued (default: 3h0m0s)

PERFORMANCE TUNING OPTIONS:
  --cache value            Megabytes of memory allocated to internal caching (default: 1024)
  --cache.database value   Percentage of cache memory allowance to use for database io (default: 75)
  --cache.gc value         Percentage of cache memory allowance to use for trie pruning (default: 25)
  --trie-cache-gens value  Number of trie node generations to keep in memory (default: 120)

ACCOUNT OPTIONS:
  --unlock value    Comma separated list of accounts to unlock
  --password value  Password file to use for non-interactive password input

API AND CONSOLE OPTIONS:
  --rpc                  Enable the HTTP-RPC server
  --rpcaddr value        HTTP-RPC server listening interface (default: "localhost")
  --rpcport value        HTTP-RPC server listening port (default: 8545)
  --rpcapi value         API's offered over the HTTP-RPC interface
  --ws                   Enable the WS-RPC server
  --wsaddr value         WS-RPC server listening interface (default: "localhost")
  --wsport value         WS-RPC server listening port (default: 8546)
  --wsapi value          API's offered over the WS-RPC interface
  --wsorigins value      Origins from which to accept websockets requests
  --ipcdisable           Disable the IPC-RPC server
  --ipcpath              Filename for IPC socket/pipe within the datadir (explicit paths escape it)
  --rpccorsdomain value  Comma separated list of domains from which to accept cross origin requests (browser enforced)
  --rpcvhosts value      Comma separated list of virtual hostnames from which to accept requests (server enforced). Accepts '*' wildcard. (default: "localhost")
  --jspath loadScript    JavaScript root path for loadScript (default: ".")
  --exec value           Execute JavaScript statement
  --preload value        Comma separated list of JavaScript files to preload into the console

NETWORKING OPTIONS:
  --bootnodes value     Comma separated enode URLs for P2P discovery bootstrap (set v4+v5 instead for light servers)
  --bootnodesv4 value   Comma separated enode URLs for P2P v4 discovery bootstrap (light server, full nodes)
  --bootnodesv5 value   Comma separated enode URLs for P2P v5 discovery bootstrap (light server, light nodes)
  --port value          Network listening port (default: 30303)
  --maxpeers value      Maximum number of network peers (network disabled if set to 0) (default: 25)
  --maxpendpeers value  Maximum number of pending connection attempts (defaults used if set to 0) (default: 0)
  --nat value           NAT port mapping mechanism (any|none|upnp|pmp|extip:<IP>) (default: "any")
  --nodiscover          Disables the peer discovery mechanism (manual peer addition)
  --v5disc              Enables the experimental RLPx V5 (Topic Discovery) mechanism
  --netrestrict value   Restricts network communication to the given IP networks (CIDR masks)
  --nodekey value       P2P node key file
  --nodekeyhex value    P2P node key as hex (for testing)

MINER OPTIONS:
  --mine                    Enable mining
  --minerthreads value      Number of CPU threads to use for mining (default: 8)
  --etherbase value         Public address for block mining rewards (default = first account created) (default: "0")
  --targetgaslimit value    Target gas limit sets the artificial target gas floor for the blocks to mine (default: 4712388)
  --gasprice "18000000000"  Minimal gas price to accept for mining a transactions
  --extradata value         Block extra data set by the miner (default = client version)

GAS PRICE ORACLE OPTIONS:
  --gpoblocks value      Number of recent blocks to check for gas prices (default: 20)
  --gpopercentile value  Suggested gas price is the given percentile of a set of recent transaction gas prices (default: 60)

VIRTUAL MACHINE OPTIONS:
  --vmdebug  Record information useful for VM and contract debugging

LOGGING AND DEBUGGING OPTIONS:
  --metrics                 Enable metrics collection and reporting
  --fakepow                 Disables proof-of-work verification
  --nocompaction            Disables db compaction after import
  --verbosity value         Logging verbosity: 0=silent, 1=error, 2=warn, 3=info, 4=debug, 5=detail (default: 3)
  --vmodule value           Per-module verbosity: comma-separated list of <pattern>=<level> (e.g. eth/*=5,p2p=4)
  --backtrace value         Request a stack trace at a specific logging statement (e.g. "block.go:271")
  --debug                   Prepends log messages with call-site location (file and line number)
  --pprof                   Enable the pprof HTTP server
  --pprofaddr value         pprof HTTP server listening interface (default: "127.0.0.1")
  --pprofport value         pprof HTTP server listening port (default: 6060)
  --memprofilerate value    Turn on memory profiling with the given rate (default: 524288)
  --blockprofilerate value  Turn on block profiling with the given rate (default: 0)
  --cpuprofile value        Write CPU profile to the given file
  --trace value             Write execution trace to the given file

WHISPER (EXPERIMENTAL) OPTIONS:
  --shh                       Enable Whisper
  --shh.maxmessagesize value  Max message size accepted (default: 1048576)
  --shh.pow value             Minimum POW accepted (default: 0.2)

DEPRECATED OPTIONS:
  --fast   Enable fast syncing through state downloads
  --light  Enable light client mode

MISC OPTIONS:
  --help, -h  show help

COPYRIGHT:
   Copyright 2013-2017 The go-ethereum Authors		

```

ä¸­æ–‡ç¿»è¯‘

å‘½ä»¤:
accountÂ Â Â Â ç®¡ç†è´¦æˆ·
attachÂ Â Â Â Â å¯åŠ¨äº¤äº’å¼ JavaScript ç¯å¢ƒï¼ˆè¿æ¥åˆ°èŠ‚ç‚¹ï¼‰
bugÂ Â Â Â Â Â Â Â ä¸ŠæŠ¥ bugÂ Issues
consoleÂ Â Â Â å¯åŠ¨äº¤äº’å¼ JavaScript ç¯å¢ƒ
copydbÂ Â Â Â Â ä»æ–‡ä»¶å¤¹åˆ›å»ºæœ¬åœ°é“¾
dumpÂ Â Â Â Â Â Â Dumpï¼ˆåˆ†æï¼‰ä¸€ä¸ªç‰¹å®šçš„å—å­˜å‚¨
dumpconfigÂ æ˜¾ç¤ºé…ç½®å€¼
exportÂ Â Â Â Â å¯¼å‡ºåŒºå—é“¾åˆ°æ–‡ä»¶
importÂ Â Â Â Â å¯¼å…¥ä¸€ä¸ªåŒºå—é“¾æ–‡ä»¶
initÂ Â Â Â Â Â Â å¯åŠ¨å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„åˆ›ä¸–çºªå—
jsÂ Â Â Â Â Â Â Â Â æ‰§è¡ŒæŒ‡å®šçš„ JavaScript æ–‡ä»¶(å¤šä¸ª)
licenseÂ Â Â Â æ˜¾ç¤ºè®¸å¯ä¿¡æ¯
makecacheÂ Â ç”Ÿæˆ ethash éªŒè¯ç¼“å­˜(ç”¨äºæµ‹è¯•)
makedagÂ Â Â Â ç”Ÿæˆ ethashÂ æŒ–çŸ¿ DAG(ç”¨äºæµ‹è¯•)
monitorÂ Â Â Â ç›‘æ§å’Œå¯è§†åŒ–èŠ‚ç‚¹æŒ‡æ ‡
removedbÂ Â Â åˆ é™¤åŒºå—é“¾å’ŒçŠ¶æ€æ•°æ®åº“
versionÂ Â Â Â æ‰“å°ç‰ˆæœ¬å·
walletÂ Â Â Â Â ç®¡ç† Ethereum é¢„å”®é’±åŒ…
help,hÂ Â Â Â Â æ˜¾ç¤ºä¸€ä¸ªå‘½ä»¤æˆ–å¸®åŠ©ä¸€ä¸ªå‘½ä»¤åˆ—è¡¨
ETHEREUM é€‰é¡¹:
--configÂ valueÂ Â Â Â Â Â Â Â Â Â TOMLÂ é…ç½®æ–‡ä»¶
--datadirÂ â€œxxxâ€Â Â Â Â Â Â Â Â Â æ•°æ®åº“å’Œ keystore å¯†é’¥çš„æ•°æ®ç›®å½•
--keystoreÂ Â Â Â Â Â Â Â Â Â Â Â Â Â keystore å­˜æ”¾ç›®å½•(é»˜è®¤åœ¨ datadir å†…)
--nousbÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ç¦ç”¨ç›‘æ§å’Œç®¡ç† USB ç¡¬ä»¶é’±åŒ…
--networkidÂ valueÂ Â Â Â Â Â Â ç½‘ç»œæ ‡è¯†ç¬¦(æ•´å‹,Â 1=Frontier,Â 2=MordenÂ (å¼ƒç”¨),Â 3=Ropsten,Â 4=Rinkeby)Â (é»˜è®¤:Â 1)
--testnetÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Ropsten ç½‘ç»œ:é¢„å…ˆé…ç½®çš„ POW(proof-of-work)æµ‹è¯•ç½‘ç»œ
--rinkebyÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Rinkeby ç½‘ç»œ:Â é¢„å…ˆé…ç½®çš„ POA(proof-of-authority)æµ‹è¯•ç½‘ç»œ
--syncmodeÂ "fast"Â Â Â Â Â Â Â åŒæ­¥æ¨¡å¼Â ("fast",Â "full",Â orÂ "light")
--ethstatsÂ valueÂ Â Â Â Â Â Â Â ä¸ŠæŠ¥ ethstatsÂ serviceÂ Â URLÂ (nodename:secret@host:port)
--identityÂ valueÂ Â Â Â Â Â Â Â è‡ªå®šä¹‰èŠ‚ç‚¹å
--lightservÂ valueÂ Â Â Â Â Â Â å…è®¸ LES è¯·æ±‚æ—¶é—´æœ€å¤§ç™¾åˆ†æ¯”(0Â â€“Â 90)(é»˜è®¤å€¼:0)Â 
--lightpeersÂ valueÂ Â Â Â Â Â æœ€å¤§ LESÂ clientÂ peers æ•°é‡(é»˜è®¤å€¼:20)
--lightkdfÂ Â Â Â Â Â Â Â Â Â Â Â Â Â åœ¨ KDF å¼ºåº¦æ¶ˆè´¹æ—¶é™ä½ key-derivationÂ RAM&CPU ä½¿ç”¨
å¼€å‘è€…ï¼ˆæ¨¡å¼ï¼‰é€‰é¡¹:
--devÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â ä½¿ç”¨ POA å…±è¯†ç½‘ç»œï¼Œé»˜è®¤é¢„åˆ†é…ä¸€ä¸ªå¼€å‘è€…è´¦æˆ·å¹¶ä¸”ä¼šè‡ªåŠ¨å¼€å¯æŒ–çŸ¿ã€‚
--dev.periodÂ valueÂ Â å¼€å‘è€…æ¨¡å¼ä¸‹æŒ–çŸ¿å‘¨æœŸÂ (0Â =Â ä»…åœ¨äº¤æ˜“æ—¶)Â (é»˜è®¤:Â 0)
ETHASHÂ é€‰é¡¹:
--ethash.cachedirÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ethash éªŒè¯ç¼“å­˜ç›®å½•(é»˜è®¤Â =Â datadir ç›®å½•å†…)
--ethash.cachesinmemÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â åœ¨å†…å­˜ä¿å­˜çš„æœ€è¿‘çš„ ethash ç¼“å­˜ä¸ªæ•°Â Â (æ¯ä¸ªç¼“å­˜ 16MBÂ )Â (é»˜è®¤:Â 2)
--ethash.cachesondiskÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â åœ¨ç£ç›˜ä¿å­˜çš„æœ€è¿‘çš„ ethash ç¼“å­˜ä¸ªæ•°Â (æ¯ä¸ªç¼“å­˜ 16MB)Â (é»˜è®¤:Â 3)
--ethash.dagdirÂ ""Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â å­˜ ethashÂ DAGs ç›®å½•Â (é»˜è®¤Â =Â ç”¨æˆ· hom ç›®å½•)
--ethash.dagsinmemÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â åœ¨å†…å­˜ä¿å­˜çš„æœ€è¿‘çš„ ethashÂ DAGsÂ ä¸ªæ•°Â (æ¯ä¸ª 1GB ä»¥ä¸Š)Â (é»˜è®¤:Â 1)
--ethash.dagsondiskÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â åœ¨ç£ç›˜ä¿å­˜çš„æœ€è¿‘çš„ ethashÂ DAGsÂ ä¸ªæ•°Â (æ¯ä¸ª 1GB ä»¥ä¸Š)Â (é»˜è®¤:Â 2)
äº¤æ˜“æ± é€‰é¡¹:
--txpool.nolocalsÂ Â Â Â Â Â Â Â Â Â Â Â ä¸ºæœ¬åœ°æäº¤äº¤æ˜“ç¦ç”¨ä»·æ ¼è±å…
--txpool.journalÂ valueÂ Â Â Â Â Â Â æœ¬åœ°äº¤æ˜“çš„ç£ç›˜æ—¥å¿—ï¼šç”¨äºèŠ‚ç‚¹é‡å¯Â (é»˜è®¤:Â "transactions.rlp")
--txpool.rejournalÂ valueÂ Â Â Â Â é‡æ–°ç”Ÿæˆæœ¬åœ°äº¤æ˜“æ—¥å¿—çš„æ—¶é—´é—´éš”Â (é»˜è®¤:Â 1 å°æ—¶)
--txpool.pricelimitÂ valueÂ Â Â Â åŠ å…¥äº¤æ˜“æ± çš„æœ€å°çš„ gas ä»·æ ¼é™åˆ¶(é»˜è®¤:Â 1)
--txpool.pricebumpÂ valueÂ Â Â Â Â ä»·æ ¼æ³¢åŠ¨ç™¾åˆ†æ¯”ï¼ˆç›¸å¯¹ä¹‹å‰å·²æœ‰äº¤æ˜“ï¼‰Â (é»˜è®¤:Â 10)
--txpool.accountslotsÂ valueÂ Â æ¯ä¸ªå¸æˆ·ä¿è¯å¯æ‰§è¡Œçš„æœ€å°‘äº¤æ˜“æ§½æ•°é‡Â Â (é»˜è®¤:Â 16)
--txpool.globalslotsÂ valueÂ Â Â æ‰€æœ‰å¸æˆ·å¯æ‰§è¡Œçš„æœ€å¤§äº¤æ˜“æ§½æ•°é‡Â (é»˜è®¤:Â 4096)
--txpool.accountqueueÂ valueÂ Â æ¯ä¸ªå¸æˆ·å…è®¸çš„æœ€å¤šéå¯æ‰§è¡Œäº¤æ˜“æ§½æ•°é‡Â (é»˜è®¤:Â 64)
--txpool.globalqueueÂ valueÂ Â Â æ‰€æœ‰å¸æˆ·éå¯æ‰§è¡Œäº¤æ˜“æœ€å¤§æ§½æ•°é‡Â Â (é»˜è®¤:Â 1024)
--txpool.lifetimeÂ valueÂ Â Â Â Â Â éå¯æ‰§è¡Œäº¤æ˜“æœ€å¤§å…¥é˜Ÿæ—¶é—´(é»˜è®¤:Â 3 å°æ—¶)
æ€§èƒ½è°ƒä¼˜çš„é€‰é¡¹:
--cacheÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â åˆ†é…ç»™å†…éƒ¨ç¼“å­˜çš„å†…å­˜ MB æ•°é‡ï¼Œç¼“å­˜å€¼(æœ€ä½ 16Â mbÂ /æ•°æ®åº“å¼ºåˆ¶è¦æ±‚)(é»˜è®¤:128)
--trie-cache-gensÂ valueÂ Â Â Â Â Â ä¿æŒåœ¨å†…å­˜ä¸­äº§ç”Ÿçš„ trieÂ node æ•°é‡(é»˜è®¤:120)
å¸æˆ·é€‰é¡¹:
--unlockÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â éœ€è§£é”è´¦æˆ·ç”¨é€—å·åˆ†éš”
--passwordÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â ç”¨äºéäº¤äº’å¼å¯†ç è¾“å…¥çš„å¯†ç æ–‡ä»¶
API å’Œæ§åˆ¶å°é€‰é¡¹:
--rpcÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â å¯ç”¨ HTTP-RPC æœåŠ¡å™¨
--rpcaddrÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â HTTP-RPC æœåŠ¡å™¨æ¥å£åœ°å€(é»˜è®¤å€¼:â€œlocalhostâ€)
--rpcportÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â HTTP-RPC æœåŠ¡å™¨ç›‘å¬ç«¯å£(é»˜è®¤å€¼:8545)
--rpcapiÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â åŸºäº HTTP-RPC æ¥å£æä¾›çš„ API
--wsÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â å¯ç”¨ WS-RPC æœåŠ¡å™¨
--wsaddrÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â WS-RPC æœåŠ¡å™¨ç›‘å¬æ¥å£åœ°å€(é»˜è®¤å€¼:â€œlocalhostâ€)
--wsportÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â WS-RPC æœåŠ¡å™¨ç›‘å¬ç«¯å£(é»˜è®¤å€¼:8546)
--wsapiÂ Â valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â åŸºäº WS-RPC çš„æ¥å£æä¾›çš„ API
--wsoriginsÂ valueÂ Â Â Â Â Â Â Â Â Â Â websockets è¯·æ±‚å…è®¸çš„æº
--ipcdisableÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ç¦ç”¨ IPC-RPC æœåŠ¡å™¨
--ipcpathÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â åŒ…å«åœ¨ datadir é‡Œçš„ IPCÂ socket/pipe æ–‡ä»¶å(è½¬ä¹‰è¿‡çš„æ˜¾å¼è·¯å¾„)
--rpccorsdomainÂ valueÂ Â Â Â Â Â Â å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸååˆ—è¡¨(é€—å·åˆ†éš”)(æµè§ˆå™¨å¼ºåˆ¶)
--jspathÂ loadScriptÂ Â Â Â Â Â Â Â Â JavaScript åŠ è½½è„šæœ¬çš„æ ¹è·¯å¾„(é»˜è®¤å€¼:â€œ.â€)
--execÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â æ‰§è¡Œ JavaScript è¯­å¥(åªèƒ½ç»“åˆ console/attach ä½¿ç”¨)
--preloadÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â é¢„åŠ è½½åˆ°æ§åˆ¶å°çš„ JavaScript æ–‡ä»¶åˆ—è¡¨(é€—å·åˆ†éš”)
ç½‘ç»œé€‰é¡¹:
--bootnodesÂ valueÂ Â Â Â ç”¨äº P2P å‘ç°å¼•å¯¼çš„ enodeÂ urls(é€—å·åˆ†éš”)(å¯¹äº lightÂ servers ç”¨ v4+v5 ä»£æ›¿)
--bootnodesv4Â valueÂ Â ç”¨äº P2PÂ v4 å‘ç°å¼•å¯¼çš„ enodeÂ urls(é€—å·åˆ†éš”)Â (lightÂ server,Â å…¨èŠ‚ç‚¹)
--bootnodesv5Â valueÂ Â ç”¨äº P2PÂ v5 å‘ç°å¼•å¯¼çš„ enodeÂ urls(é€—å·åˆ†éš”)Â (lightÂ server,Â è½»èŠ‚ç‚¹)
--portÂ valueÂ Â Â Â Â Â Â Â Â ç½‘å¡ç›‘å¬ç«¯å£(é»˜è®¤å€¼:30303)
--maxpeersÂ valueÂ Â Â Â Â æœ€å¤§çš„ç½‘ç»œèŠ‚ç‚¹æ•°é‡(å¦‚æœè®¾ç½®ä¸º 0ï¼Œç½‘ç»œå°†è¢«ç¦ç”¨)(é»˜è®¤å€¼:25)
--maxpendpeersÂ valueÂ Â Â Â æœ€å¤§å°è¯•è¿æ¥çš„æ•°é‡(å¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™å°†ä½¿ç”¨é»˜è®¤å€¼)(é»˜è®¤å€¼:0)
--natÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â NAT ç«¯å£æ˜ å°„æœºåˆ¶Â (any|none|upnp|pmp|extip:<IP>)Â (é»˜è®¤:Â â€œanyâ€)
--nodiscoverÂ Â Â Â Â Â Â Â Â Â Â Â ç¦ç”¨èŠ‚ç‚¹å‘ç°æœºåˆ¶(æ‰‹åŠ¨æ·»åŠ èŠ‚ç‚¹)
--v5discÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â å¯ç”¨å®éªŒæ€§çš„ RLPxÂ V5(Topic å‘ç°)æœºåˆ¶
--nodekeyÂ valueÂ Â Â Â Â Â Â Â Â P2P èŠ‚ç‚¹å¯†é’¥æ–‡ä»¶
--nodekeyhexÂ valueÂ Â Â Â Â Â åå…­è¿›åˆ¶çš„ P2P èŠ‚ç‚¹å¯†é’¥(ç”¨äºæµ‹è¯•)
çŸ¿å·¥é€‰é¡¹:
--mineÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â æ‰“å¼€æŒ–çŸ¿
--minerthreadsÂ valueÂ Â Â Â æŒ–çŸ¿ä½¿ç”¨çš„ CPU çº¿ç¨‹æ•°é‡(é»˜è®¤å€¼:8)
--etherbaseÂ valueÂ Â Â Â Â Â Â æŒ–çŸ¿å¥–åŠ±åœ°å€(é»˜è®¤=ç¬¬ä¸€ä¸ªåˆ›å»ºçš„å¸æˆ·)(é»˜è®¤å€¼:â€œ0â€)
--targetgaslimitÂ valueÂ Â ç›®æ ‡ gas é™åˆ¶ï¼šè®¾ç½®æœ€ä½ gas é™åˆ¶ï¼ˆä½äºè¿™ä¸ªä¸ä¼šè¢«æŒ–ï¼Ÿï¼‰Â (é»˜è®¤å€¼:â€œ4712388â€)
--gaspriceÂ valueÂ Â Â Â Â Â Â Â æŒ–çŸ¿æ¥å—äº¤æ˜“çš„æœ€ä½ gas ä»·æ ¼
--extradataÂ valueÂ Â Â Â Â Â Â çŸ¿å·¥è®¾ç½®çš„é¢å¤–å—æ•°æ®(é»˜è®¤=clientÂ version)
GAS ä»·æ ¼é€‰é¡¹:
--gpoblocksÂ valueÂ Â Â Â Â Â ç”¨äºæ£€æŸ¥ gas ä»·æ ¼çš„æœ€è¿‘å—çš„ä¸ªæ•°Â Â (é»˜è®¤:Â 10)
--gpopercentileÂ valueÂ Â å»ºè®® gas ä»·å‚è€ƒæœ€è¿‘äº¤æ˜“çš„ gas ä»·çš„ç™¾åˆ†ä½æ•°ï¼Œ(é»˜è®¤:Â 50)
è™šæ‹Ÿæœºçš„é€‰é¡¹:
--vmdebugÂ Â Â Â Â Â Â Â è®°å½• VM åŠåˆçº¦è°ƒè¯•ä¿¡æ¯
æ—¥å¿—å’Œè°ƒè¯•é€‰é¡¹:
--metricsÂ Â Â Â Â Â Â Â Â Â Â Â å¯ç”¨ metrics æ”¶é›†å’ŒæŠ¥å‘Š
--fakepowÂ Â Â Â Â Â Â Â Â Â Â Â ç¦ç”¨ proof-of-work éªŒè¯
--verbosityÂ valueÂ Â Â Â æ—¥å¿—è¯¦ç»†åº¦:0=silent,Â 1=error,Â 2=warn,Â 3=info,Â 4=debug,Â 5=detailÂ (default:Â 3)
--vmoduleÂ valueÂ Â Â Â Â Â æ¯ä¸ªæ¨¡å—è¯¦ç»†åº¦:ä»¥Â <pattern>=<level>çš„é€—å·åˆ†éš”åˆ—è¡¨Â (æ¯”å¦‚Â eth/*=6,p2p=5)
--backtraceÂ valueÂ Â Â Â è¯·æ±‚ç‰¹å®šæ—¥å¿—è®°å½•å †æ ˆè·Ÿè¸ªÂ (æ¯”å¦‚Â â€œblock.go:271â€)
--debugÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â çªå‡ºæ˜¾ç¤ºè°ƒç”¨ä½ç½®æ—¥å¿—(æ–‡ä»¶ååŠè¡Œå·)
--pprofÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â å¯ç”¨ pprofÂ HTTP æœåŠ¡å™¨
--pprofaddrÂ valueÂ Â Â Â Â Â Â Â Â Â Â pprofÂ HTTP æœåŠ¡å™¨ç›‘å¬æ¥å£(é»˜è®¤å€¼:127.0.0.1)
--pprofportÂ valueÂ Â Â Â Â Â Â Â Â Â Â pprofÂ HTTP æœåŠ¡å™¨ç›‘å¬ç«¯å£(é»˜è®¤å€¼:6060)
--memprofilerateÂ valueÂ Â Â Â Â Â æŒ‰æŒ‡å®šé¢‘ç‡æ‰“å¼€ memoryÂ profilingÂ Â Â Â (é»˜è®¤:524288)
--blockprofilerateÂ valueÂ Â Â Â æŒ‰æŒ‡å®šé¢‘ç‡æ‰“å¼€ blockÂ profilingÂ Â Â Â (é»˜è®¤å€¼:0)
--cpuprofileÂ valueÂ Â Â Â Â Â Â Â Â Â å°† CPUÂ profile å†™å…¥æŒ‡å®šæ–‡ä»¶
--traceÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â å°† executionÂ trace å†™å…¥æŒ‡å®šæ–‡ä»¶
WHISPER å®éªŒé€‰é¡¹:
--shhÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â å¯ç”¨ Whisper
--shh.maxmessagesizeÂ valueÂ Â Â å¯æ¥å—çš„æœ€å¤§çš„æ¶ˆæ¯å¤§å°Â (é»˜è®¤å€¼:Â 1048576)
--shh.powÂ valueÂ Â Â Â Â Â Â Â Â Â Â Â Â Â å¯æ¥å—çš„æœ€å°çš„ POWÂ (é»˜è®¤å€¼:Â 0.2)
å¼ƒç”¨é€‰é¡¹ï¼š
--fastÂ Â Â Â Â å¼€å¯å¿«é€ŸåŒæ­¥
--lightÂ Â Â Â å¯ç”¨è½»å®¢æˆ·ç«¯æ¨¡å¼
å…¶ä»–é€‰é¡¹:
â€“help,Â -hÂ Â Â Â æ˜¾ç¤ºå¸®åŠ©

## 1.Â api ç›¸å…³å‚æ•°

rpcapi å¯åŠ¨åå…è®¸è¿æ¥åˆ°ç³»ç»Ÿçš„ API åè®®

```

geth --networkid 100000 --rpc --rpcapi "db,eth,net,web3" --rpccorsdomain "*" --datadir "/app/chain" --port "30303" console	

```

ç³»ç»Ÿé»˜è®¤ç›‘å¬ 127.0.0.1 å¦‚æœå¸Œæœ›å¤–éƒ¨è®¿é—®æœ¬æœºï¼Œéœ€è¦é€šè¿‡--rpcaddr æŒ‡å®šç›‘å¬åœ°å€ã€‚

```

geth --networkid 123456 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" --nodiscover		

```

### 1.1.Â rpcapi

--rpcapi å¯ä»¥æ§åˆ¶è®¿é—®å†…å®¹

```

$ geth --rpc --rpcapi personal,db,eth,net,web3 --rinkeby	

```

### 1.2.Â rpcaddr

é»˜è®¤æ˜¯ 127.0.0.1

HTTP endpoint closed: http://127.0.0.1:8545

é€šè¿‡ --rpcaddr="0.0.0.0" æŒ‡å®šç›‘å¬åœ°å€

HTTP endpoint opened: http://0.0.0.0:8545

```

neo@netkiller ~/ethereum % geth --networkid 123456 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" --nodiscover console  
INFO [01-20|01:41:33] Starting peer-to-peer node               instance=Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9.1
INFO [01-20|01:41:33] Allocated cache and file handles         database=/home/neo/.ethereum/geth/chaindata cache=128 handles=1024
INFO [01-20|01:41:34] Initialised chain configuration          config="{ChainID: 15 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: <nil> EIP155: 0 EIP158: 0 Byzantium: <nil> Engine: unknown}"
INFO [01-20|01:41:34] Disk storage enabled for ethash caches   dir=/home/neo/.ethereum/geth/ethash count=3
INFO [01-20|01:41:34] Disk storage enabled for ethash DAGs     dir=/home/neo/.ethash               count=2
INFO [01-20|01:41:34] Initialising Ethereum protocol           versions="[63 62]" network=123456
INFO [01-20|01:41:34] Loaded most recent local header          number=531 hash=1a2707â€¦3a27bc td=79083846
INFO [01-20|01:41:34] Loaded most recent local full block      number=531 hash=1a2707â€¦3a27bc td=79083846
INFO [01-20|01:41:34] Loaded most recent local fast block      number=531 hash=1a2707â€¦3a27bc td=79083846
INFO [01-20|01:41:34] Loaded local transaction journal         transactions=0 dropped=0
INFO [01-20|01:41:34] Regenerated local transaction journal    transactions=0 accounts=0
WARN [01-20|01:41:34] Blockchain not empty, fast sync disabled 
INFO [01-20|01:41:34] Starting P2P networking 
INFO [01-20|01:41:34] RLPx listener up                         self="enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@[::]:30303?discport=0"
INFO [01-20|01:41:34] IPC endpoint opened: /home/neo/.ethereum/geth.ipc 
INFO [01-20|01:41:34] HTTP endpoint opened: http://0.0.0.0:8545 
Welcome to the Geth JavaScript console!

instance: Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9.1
coinbase: 0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6
at block: 531 (Tue, 14 Nov 2017 17:36:05 HST)
 datadir: /home/neo/.ethereum
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> INFO [01-20|01:41:40] Mapped network port                      proto=tcp extport=30303 intport=30303 interface="UPNP IGDv1-IP1"

```

## 2.Â å¯åŠ¨ Websocket ç«¯å£

```

geth --syncmode light --rpc --rpcaddr 0.0.0.0 --rpcapi web3,eth --ws --wsaddr 0.0.0.0 --wsapi web3,eth --wsorigins '*'

```

å®‰è£… websocket æµ‹è¯•å·¥å…· wscat

```

npm install -g wscat

```

æµ‹è¯• Websocket

```

wscat -c ws://127.0.0.1:8546

```

## 3.Â æ—¥å¿—

--verbosity æ—¥å¿—è¾“å‡ºçº§åˆ«æ§åˆ¶

```

geth --verbosity 0 console

```

æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚

```

geth --networkid 123456 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*"  2>> /tmp/geth.log			

```

åå°è¿è¡Œ

```

neo@netkiller ~ % geth --networkid 123456 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" 2>> /tmp/geth.log &     
[1] 30075

neo@netkiller ~ % tail -f /tmp/geth.log        
INFO [02-02|21:18:59] Got interrupt, shutting down... 
INFO [02-02|21:18:59] HTTP endpoint closed: http://0.0.0.0:8545 
INFO [02-02|21:18:59] IPC endpoint closed: /home/neo/.ethereum/geth.ipc 
INFO [02-02|21:18:59] Blockchain manager stopped 
INFO [02-02|21:18:59] Stopping Ethereum protocol 
INFO [02-02|21:18:59] Ethereum protocol stopped 
INFO [02-02|21:18:59] Transaction pool stopped 
INFO [02-02|21:18:59] Database closed                          database=/home/neo/.ethereum/geth/chaindata
INFO [02-02|21:18:59] Mapped network port                      proto=tcp extport=30303 intport=30303 interface="UPNP IGDv1-IP1"
WARN [02-02|21:19:00] Already shutting down, interrupt more to panic. times=9			

```

## 4.Â æ§åˆ¶å°

### Geth JavaScript console

```

neo@netkiller ~/ethereum % geth  --networkid 123456 console
INFO [01-19|22:14:52] Starting peer-to-peer node               instance=Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9.1
INFO [01-19|22:14:52] Allocated cache and file handles         database=/home/neo/.ethereum/geth/chaindata cache=128 handles=1024
INFO [01-19|22:14:52] Initialised chain configuration          config="{ChainID: 15 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: <nil> EIP155: 0 EIP158: 0 Byzantium: <nil> Engine: unknown}"
INFO [01-19|22:14:52] Disk storage enabled for ethash caches   dir=/home/neo/.ethereum/geth/ethash count=3
INFO [01-19|22:14:52] Disk storage enabled for ethash DAGs     dir=/home/neo/.ethash               count=2
INFO [01-19|22:14:52] Initialising Ethereum protocol           versions="[63 62]" network=123456
INFO [01-19|22:14:52] Loaded most recent local header          number=14 hash=70d7f1â€¦45850a td=1966848
INFO [01-19|22:14:52] Loaded most recent local full block      number=14 hash=70d7f1â€¦45850a td=1966848
INFO [01-19|22:14:52] Loaded most recent local fast block      number=14 hash=70d7f1â€¦45850a td=1966848
INFO [01-19|22:14:52] Loaded local transaction journal         transactions=0 dropped=0
INFO [01-19|22:14:52] Regenerated local transaction journal    transactions=0 accounts=0
WARN [01-19|22:14:52] Blockchain not empty, fast sync disabled 
INFO [01-19|22:14:52] Starting P2P networking 

INFO [01-19|22:14:56] UDP listener up                          self=enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@101.232.64.12:30303
INFO [01-19|22:14:56] RLPx listener up                         self=enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@101.232.64.12:30303
INFO [01-19|22:14:56] IPC endpoint opened: /home/neo/.ethereum/geth.ipc 
Welcome to the Geth JavaScript console!

instance: Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9.1
coinbase: 0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6
at block: 14 (Fri, 19 Jan 2018 21:27:16 HST)
 datadir: /home/neo/.ethereum
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> 
> INFO [01-19|22:14:56] Mapped network port                      proto=udp extport=30303 intport=30303 interface="UPNP IGDv1-IP1"			

```

## 5.Â è¿æ¥æ§åˆ¶å°

ä¸€èˆ¬æµ‹è¯•å¯åŠ¨æˆ‘ä»¬ä½¿ç”¨ consoleï¼Œå¦‚æœæ˜¯æ­£å¼å¯åŠ¨æ— éœ€ä½¿ç”¨ consoleã€‚åŒäº‹æˆ‘ä»¬ä½¿ç”¨&ç¬¦å·ä½¿å…¶è¿›å…¥åå°è¿è¡Œã€‚

```

neo@netkiller ~/ethereum % geth --networkid 123456 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" --nodiscover &			

```

è¿›å…¥æ§åˆ¶å°

```

neo@netkiller ~/ethereum % geth attach
Welcome to the Geth JavaScript console!

instance: Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9.1
coinbase: 0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6
at block: 531 (Tue, 14 Nov 2017 17:36:05 HST)
 datadir: /home/neo/.ethereum
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

```

é€€å‡ºæ§åˆ¶å°

```

> exit

```

### 5.1.Â æŒ‡å®š geth.ipc æ–‡ä»¶ä½ç½®

```

geth --ipcpath ~/.ethereum/geth.ipc attach				

```

### 5.2.Â IPC æ–¹å¼è¿æ¥

```

neo@netkiller ~ % geth attach ethereum/data1/geth.ipc 
Welcome to the Geth JavaScript console!

instance: Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9.1
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

>				

```

### 5.3.Â TCP è¿æ¥æ§åˆ¶å°

è¿æ¥è¿œç¨‹æ§åˆ¶å°

```

neo@netkiller ~/ethereum % geth --exec 'eth.coinbase' attach http://172.16.0.10:8545
"0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6"

```

### 5.4.Â WebSocket æ–¹å¼

```

$ geth attach ws://191.168.1.1:8546

```

## 6.Â è´¦å·ç®¡ç†

### 6.1.Â æ–°å»ºè´¦å·

æŸ¥çœ‹è´¦å·

```

neo@netkiller ~/ethereum % geth account list 
Account #0: {83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6} keystore:///home/neo/.ethereum/keystore/UTC--2018-01-20T04-04-06.786586541Z--83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6				

```

åˆ›å»ºè´¦å·

```

neo@netkiller ~/ethereum % geth account new
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase: 
Repeat passphrase: 
Address: {e8abf98484325fd6afc59b804ac15804b978e607}				

```

æŒ‡å®šå¯†ç 

```

$ echo "abc123" > password 
$ geth --password /path/to/password account new

```

è´¦å·åˆ›å»ºåœ¨ ~/.ethereum/keystore ç›®å½•ä¸‹

```

Mac: ~/Library/Ethereum/keystore
Linux: ~/.ethereum/keystore
Windows: %APPDATA%/Ethereum/keystore				

```

```

neo@netkiller ~/.ethereum/keystore % ll
total 8.0K
-rw------- 1 neo neo 491 Jan 19 18:04 UTC--2018-01-20T04-04-06.786586541Z--83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6
-rw------- 1 neo neo 491 Jan 19 20:11 UTC--2018-01-20T06-11-23.608902164Z--e8abf98484325fd6afc59b804ac15804b978e607				

```

### 6.2.Â æŸ¥çœ‹è´¦å·

```

neo@netkiller ~/ethereum % geth account list 
Account #0: {83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6} keystore:///home/neo/.ethereum/keystore/UTC--2018-01-20T04-04-06.786586541Z--83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6
Account #1: {e8abf98484325fd6afc59b804ac15804b978e607} keystore:///home/neo/.ethereum/keystore/UTC--2018-01-20T06-11-23.608902164Z--e8abf98484325fd6afc59b804ac15804b978e607				

```

### 6.3.Â ä»ç§é’¥å¯¼å…¥ä»¥å¤ªåŠåœ°å€

é¦–å…ˆå°†ç§é’¥å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå¯¼å…¥ï¼Œå¯¼å…¥åéœ€è¦è¾“å…¥å¯†ç ã€‚

```

[ethereum@netkiller ~]$ echo "f592b7bf06ca9fd7696ba95d6ed8e357de6a2379b6d5fe1ffd53c6b4b063cd4a" > privatekey
[ethereum@netkiller ~]$ geth account import privatekey
INFO [04-27|17:25:38] Maximum peer count                       ETH=25 LES=0 total=25
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase:
Repeat passphrase:
Address: {372fda02e8a1eca513f2ee5901dc55b8b5dd7411}

```

æŸ¥çœ‹å¯¼å…¥æ–‡ä»¶

```

[ethereum@netkiller ~]$ ls .ethereum/keystore/*372fda02e8a1eca513f2ee5901dc55b8b5dd7411
.ethereum/keystore/UTC--2018-04-27T09-25-48.189741023Z--372fda02e8a1eca513f2ee5901dc55b8b5dd7411

[ethereum@netkiller ~]$ cat .ethereum/keystore/UTC--2018-04-27T09-25-48.189741023Z--372fda02e8a1eca513f2ee5901dc55b8b5dd7411
{"address":"372fda02e8a1eca513f2ee5901dc55b8b5dd7411","crypto":{"cipher":"aes-128-ctr","ciphertext":"8e23a0274a4d91bea61273ee3ce2951c292698df13b2214e8afab5c9595a72c4","cipherparams":{"iv":"c5f4fd65e6b6da4f83d30f8d327905d1"},"kdf":"scrypt","kdfparams":{"dklen":32,"n":262144,"p":1,"r":8,"salt":"593eb041c4425723af7ef58a55c03fc875749cd0f7174ce011047e41205e6cdd"},"mac":"e1f3bebd85632db39aaa6ff03fa7641109c1fe46cfcc4251c32d27ad002343eb"},"id":"ca863875-0702-49a8-b5c5-c46a50b95375","version":3}

```

æœ€åä¸€å®šè®°å¾—åˆ é™¤ç§é’¥é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªç§é’¥æ²¡æœ‰åŠ å¯†è¿‡ï¼Œä¸€æ—¦æ³„éœ²åæœä¸å ªè®¾æƒ³ã€‚

```

[ethereum@netkiller ~]$ rm -rf privatekey

```

å¦‚æœä¸å­˜å‚¨æ–‡ä»¶å¯ä»¥å•è¡Œæ‰§è¡Œï¼Œç„¶ååˆ é™¤ history å†å²æ–‡ä»¶

```

[ethereum@netkiller ~]$ geth account import <(echo f592b7bf06ca9fd7696ba95d6ed8e357de6a2379b6d5fe1ffd53c6b4b063cd4a)
[ethereum@netkiller ~]$ >.bash_history

```

## 7.Â é…ç½®è‡ªåŠ¨è§£é”è´¦å·

åˆ›å»º password æ–‡ä»¶ï¼Œåœ¨é‡Œé¢è¾“å…¥å¯†ç ï¼Œæ¯ä¸ªè´¦å·ä¸€è¡Œå¯†ç å¦‚ï¼š

```

123456
123456
123456			

```

å¯åŠ¨å‚æ•°

```

geth --rpc --rpcaddr="0.0.0.0" --rpccorsdomain="*" --unlock '0,1,2' --password ~/.ethereum/password   --nodiscover --maxpeers '5' --networkid '12345' --datadir '~/.ethereum'  console			

```

```

neo@MacBook-Pro ~/ethereum % geth --networkid 123456 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" --mine --minerthreads 1 --unlock 0 --password ./password
INFO [02-28|22:51:25] Maximum peer count                       ETH=25 LES=0 total=25
INFO [02-28|22:51:25] Starting peer-to-peer node               instance=Geth/v1.8.1-stable/darwin-amd64/go1.10
INFO [02-28|22:51:25] Allocated cache and file handles         database=/Users/neo/Library/Ethereum/geth/chaindata cache=768 handles=128
INFO [02-28|22:51:25] Initialised chain configuration          config="{ChainID: 15 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: <nil> EIP155: 0 EIP158: 0 Byzantium: <nil> Engine: unknown}"
INFO [02-28|22:51:25] Disk storage enabled for ethash caches   dir=/Users/neo/Library/Ethereum/geth/ethash count=3
INFO [02-28|22:51:25] Disk storage enabled for ethash DAGs     dir=/Users/neo/.ethash                      count=2
INFO [02-28|22:51:25] Initialising Ethereum protocol           versions="[63 62]" network=123456
WARN [02-28|22:51:25] Head state missing, repairing chain      number=5373 hash=6a2b1bâ€¦9e3c38
INFO [02-28|22:51:25] Rewound blockchain to past state         number=5372 hash=f6900dâ€¦59872d
INFO [02-28|22:51:25] Loaded most recent local header          number=5373 hash=6a2b1bâ€¦9e3c38 td=2246785401
INFO [02-28|22:51:25] Loaded most recent local full block      number=5372 hash=f6900dâ€¦59872d td=2246064913
INFO [02-28|22:51:25] Loaded most recent local fast block      number=5373 hash=6a2b1bâ€¦9e3c38 td=2246785401
INFO [02-28|22:51:25] Loaded local transaction journal         transactions=0 dropped=0
INFO [02-28|22:51:25] Regenerated local transaction journal    transactions=0 accounts=0
WARN [02-28|22:51:25] Blockchain not empty, fast sync disabled 
INFO [02-28|22:51:25] Starting P2P networking 
INFO [02-28|22:51:28] UDP listener up                          self=enode://f4e5cee0be36c8823423d3115c488f29f82b5f95c02a796cd80c4f47078726e0b2dc5b95407469275fb52a24ff0fb95b2a32f38d6eb95f417a2f65268d4e3fa8@[::]:30303
INFO [02-28|22:51:28] RLPx listener up                         self=enode://f4e5cee0be36c8823423d3115c488f29f82b5f95c02a796cd80c4f47078726e0b2dc5b95407469275fb52a24ff0fb95b2a32f38d6eb95f417a2f65268d4e3fa8@[::]:30303
INFO [02-28|22:51:28] IPC endpoint opened                      url=/Users/neo/Library/Ethereum/geth.ipc
INFO [02-28|22:51:28] HTTP endpoint opened                     url=http://0.0.0.0:8545                  cors=* vhosts=localhost
WARN [02-28|22:51:28] ------------------------------------------------------------------- 
WARN [02-28|22:51:28] Referring to accounts by order in the keystore folder is dangerous! 
WARN [02-28|22:51:28] This functionality is deprecated and will be removed in the future! 
WARN [02-28|22:51:28] Please use explicit addresses! (can search via `geth account list`) 
WARN [02-28|22:51:28] ------------------------------------------------------------------- 
INFO [02-28|22:51:29] Unlocked account                         address=0x5c18a33DF2cc41a1bedDC91133b8422e89f041B7
INFO [02-28|22:51:29] Transaction pool price threshold updated price=18000000000
INFO [02-28|22:51:29] Etherbase automatically configured       address=0x5c18a33DF2cc41a1bedDC91133b8422e89f041B7
INFO [02-28|22:51:29] Starting mining operation 
INFO [02-28|22:51:29] Commit new mining work                   number=5373 txs=0 uncles=0 elapsed=403.127Âµs
INFO [02-28|22:51:38] Successfully sealed new block            number=5373 hash=f70a5dâ€¦fe9b7b
INFO [02-28|22:51:38] ğŸ”¨ mined potential block                  number=5373 hash=f70a5dâ€¦fe9b7b

```

## 8.Â è¿è¡Œ JS

```

neo@netkiller ~/ethereum % geth --exec "eth.blockNumber" attach
531

```

```

$ geth --exec 'loadScript("/tmp/checkbalances.js")' attach http://123.123.123.123:8545
$ geth --jspath "/tmp" --exec 'loadScript("checkbalances.js")' attach http://123.123.123.123:8545			

```

## 9.Â èŠ‚ç‚¹ç®¡ç†

```

geth --bootnodes enode://pubkey1@ip1:port1,enode://pubkey2@ip2:port2,enode://pubkey3@ip3:port3

```

## 10.Â å¯åŠ¨æŒ–çŸ¿

```

geth --mine

```

### 10.1.Â æŒ–çŸ¿çº¿ç¨‹æ•°

é»˜è®¤ä¸º 2

```

geth --mine --minerthreads=16

```

### 10.2.Â æŒ‡å®šæ—·å·¥è´¦å·

é»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªè´¦å·

```

geth --mine --minerthreads=16 --etherbase=0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6			

```

## 11.Â è¿è¡Œæ™ºèƒ½åˆçº¦

```

pragma solidity â°.4.18;

contract Netkiller {
    string name;
    int num;
    function Netkiller() public{
        name = "default";
        num = 1;
    }
    function setName(string _name) public{
        name = _name;
    }
    function getName() public view returns(string){
        return name;
    }
    function setNum(int n) public{
        num = n;
    }
    function addNum(int m) public view returns(int res){
        res = m + num;
    }
}

```

```

solc --bin --abi --optimize -o output Netkiller.sol

```

var abi = JSON.parse('å†…å®¹æ¥è‡ª Netkiller.abi')

var bytecode = "0x"+"å†…å®¹æ¥è‡ª Netkiller.bin"

```

var abi = JSON.parse('[{"constant":true,"inputs":[],"name":"getName","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"n","type":"int256"}],"name":"setNum","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"}],"name":"setName","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"m","type":"int256"}],"name":"addNum","outputs":[{"name":"res","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]');
var bytecode = "0x6060604052341561000f57600080fd5b6040805190810160405280600781526020017f64656661756c74000000000000000000000000000000000000000000000000008152506000908051906020019061005a929190610067565b506001808190555061010c565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a857805160ff19168380011785556100d6565b828001600101855582156100d6579182015b828111156100d55782518255916020019190600101906100ba565b5b5090506100e391906100e7565b5090565b61010991905b808211156101055760008160009055506001016100ed565b5090565b90565b61036b8061011b6000396000f300606060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806317d7de7c146100675780636a5aa5ec146100f5578063c47f002714610118578063cc13962a14610175575b600080fd5b341561007257600080fd5b61007a6101ac565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100ba57808201518184015260208101905061009f565b50505050905090810190601f1680156100e75780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561010057600080fd5b6101166004808035906020019091905050610254565b005b341561012357600080fd5b610173600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061025e565b005b341561018057600080fd5b6101966004808035906020019091905050610278565b6040518082815260200191505060405180910390f35b6101b4610286565b60008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561024a5780601f1061021f5761010080835404028352916020019161024a565b820191906000526020600020905b81548152906001019060200180831161022d57829003601f168201915b5050505050905090565b8060018190555050565b806000908051906020019061027492919061029a565b5050565b600060015482019050919050565b602060405190810160405280600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106102db57805160ff1916838001178555610309565b82800160010185558215610309579182015b828111156103085782518255916020019190600101906102ed565b5b509050610316919061031a565b5090565b61033c91905b80821115610338576000816000905550600101610320565b5090565b905600a165627a7a7230582002b42864089a104d4d80ba0190924e09e15f3c0d0aa107463f49e2689e159b480029";
var gas = web3.eth.estimateGas({data: bytecode})
var deploy = {from:eth.coinbase, data: bytecode, gas: gas};
var address  = eth.coinbase;

personal.unlockAccount(eth.accounts[0],"chen1980")

var mycontract = web3.eth.contract(abi)

var instance = mycontract.new({from:eth.coinbase, data:bytecode, gas:300000}, function(e, contract){
    if(!e) {

      if(!contract.address) {
        console.log("Contract transaction send: TransactionHash: " + contract.transactionHash + " waiting to be mined...");

      } else {
        console.log("Contract mined! Address: " + contract.address);
        console.log(contract);
      }

    }
}); 

var test = mycontract.at(eth.coinbase)

test.addNum(567);

```

## 12.Â Ropsten æµ‹è¯•ç½‘ç»œ

```

$ nohup geth --datadir $DATADIR \
             --unlock 0 \
             --password <(echo -n "SECRETPASSWORD") \
             --testnet \
             --fast \
             2>> $HOME/Desktop/ethereum/testnet/geth.log &		

```

## 13.Â é™æ€èŠ‚ç‚¹

```

$ vim ~/.ethereum/static-nodes.json		

```

```

[
	//ç”± EthFans ç»´æŠ¤çš„é•¿æœŸèŠ‚ç‚¹ï¼Œä½ç½®ï¼šå¹¿å·
	"enode://6427b7e7446bb05f22fe7ce9ea175ec05858953d75a5a6e4f99a6aec0779a8bd6276f1959a42fe5948acbe14bcd0652082dc546d3b37ae8f2aea41eba4eca43b@121.201.14.181:30303",
	//ç”±ç§˜çŒ¿ç»´æŠ¤çš„é•¿æœŸèŠ‚ç‚¹ï¼Œä½ç½®ï¼šæ­å·
	"enode://91922b12115c067005c574844c6bbdb114eb262f90b6355cec89e13b483c3e4669c6d63ec66b6e3ca7a3a462d28edb3c659e9fa05ed4c7234524e582a8816743@120.27.164.92:13333",
	//ç”±äº‘å¸ç½‘ç»´æŠ¤çš„åˆ†åˆ«ä½äºäºšå¤ªï¼Œå¹¿ä¸œå’ŒåŒ—äº¬çš„é•¿æœŸèŠ‚ç‚¹
	"enode://3dde41a994b3b99f938f75ddf6d48318c78ddd869c70b48d00b922190bb434fc5474f6250c143723f4387273d123e02f6a38f07d0311f240d2915f6140e09850@207.226.141.212:30303",
	"enode://7ab8fa90b204f2146c00939b8474549c544caa3598a0894fa639a5cdbd992cbc6135fd776f8bcf97ae95fdaa3afbfa2d107fea71549119afd7ea57356b899be5@121.201.24.236:30303",
	"enode://db81152a8296089b04a21ad9bf347df3ff0450ffc8215d9f50c400ccf8d18963118010cacf03c4b71981cf9cac5394438cab3039e98db4d2aae5859ab7d1793e@139.198.1.244:30303",
  	//ç”± ethfans ç¤¾åŒºæˆå‘˜ç‚¹å…¸ç»´æŠ¤çš„èŠ‚ç‚¹ï¼Œä½ç½®ï¼šæ·±åœ³
	"enode://68dd1360f0a4ac362b41124692e31652ffe26f6f06a284ca11f3b514b3968594ac1f4320d1aa1ca343b06327c18a2e40eded74edfb3086e1baaa27ca24226b21@113.106.85.172:30303",
	//ç”±é“¶é“¾ç§‘æŠ€ç»´æŠ¤çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«ä½äºé¦™æ¸¯ã€å¹¿å·
	"enode://58f6b6908286cefe43c166cfc4fed033c750caa1bc3f6e1e1e1507752c0b91248addb3122f8557c5f8912e702285a160ab3a10203ae1eff3807eda25d6ed6478@45.113.71.186:30303",
	"enode://87190a01c02cafb97e7f49672b4c3be2937cf79c3969e0b8e7b35cac28cebfbda52a13d56fd2113c726a1dd359c9476ccf7e60651439cef56e3a71039f6a4f5e@119.29.207.90:30303",
	//ç”±ä¸­é’ç ”ç©¶é™¢ç»´æŠ¤çš„èŠ‚ç‚¹ï¼Œä½äºæ­å·
	"enode://d1fdd05a62fd9544eeb455e4f4d4bd8bb574138d82d8f909f3041d0792e3401f8695133d39ad0a3aa5d217e3c5bed0511b531505a67b03607a909ae9096720d2@120.26.129.121:30303",
	//ç”± ethfans ç¤¾åŒºæˆå‘˜ fsword ç»´æŠ¤çš„èŠ‚ç‚¹ï¼Œä½äºä¸Šæµ·
	"enode://a1e9cf99eca94590ae776c8dd5c6c043a8c1f0375e9e391c9fb55133385bf453ac3d3fb3ead8e63415b2ef99d54a19e2a7bc830cd1fdbbb283818e3bcb0ea31e@182.254.209.254:30303",
	//äº‘è±¡ç§‘æŠ€ç»´æŠ¤çš„èŠ‚ç‚¹
	"enode://562796b19d43d79dfb6160abd2d7bb78a2f2efd9501a0a767c00677e0fb3a4407235f813c3003682c2a421a58709c52f595827bc15708cc5f534f55d0f8d03ad@121.40.199.54:30303",
	//å¸ç½‘ç»´æŠ¤çš„èŠ‚ç‚¹
	"enode://fa2c17dcc83a6e2825668210abf7480452de4b13d8bdea8f301c3b603701918bc4dade9e68d119d7a8214e90e7ea10a2782041c98951385d97bee73358fb08f4@120.26.124.58:30303",
	//æœå¤•ç½‘ç»œç»´æŠ¤çš„èŠ‚ç‚¹
	"enode://0b331b27e2976d797aed1d1464ac483a7f262860334cb5737a01a0188da08d79226a6973adc5f2a2c1a20192b399161eee23a0d56ecf472cbe4058d010ecc89f@47.89.49.61:30303",
	"enode://0639f20fdb5af1fecd2f2bc0ddb648885483a5945686530e6b046678635d3435dd7b92fe34209f81ec6f003482aa78e407e5e6eb1b10be4773a2adbcf1fc1ba6@118.192.161.147:30303",
	//å¸ƒé²å…‹ Brockex å¹¿ä¸œäºšå¤ª
	"enode://fd2a5d30e4f3917ee640876cc57d72a8bf5ecf049e9106c95e60cf306dd7a5dd68d1a295f3718af44a7083252686926d6e8a402f1abe6f805e10e7281967db28@121.201.29.82:30303",
	"enode://0d1b9eed7afe2d5878d5d8a4c2066b600a3bcac2e5730586421af224e93a58cd03cac75bf0b2a62fd8049cd3692a085758cc1e407c8b2c94bb069814a5e8d0f0@209.9.106.245:30303",
	//æˆéƒ½ä»¥å¤ªäº‘ç»´æŠ¤çš„èŠ‚ç‚¹
	"enode://ca087a651571d04953187753af969f7deb1582af2a06a3048b90adb3f87d4c41973aac4b5e80449efc97154dac769a5ea447b123c3aaf7a2c23825a1558804dc@[::]:30303",
	"enode://9b53b9d41d964f71db60d2198cfa9013fc7808d707c5e0a32da1e22d3cacd6adbae46901df6506a752d9d4e3791df29171315fbb86f7b09331a25458158fe65b@[::]:30303"
]

```

## 14.Â JavaScript Console

### 14.1.Â personal ç®¡ç†

#### 14.1.1.Â åˆ›å»ºè´¦å·

```

> personal.newAccount()
Passphrase: 
Repeat passphrase: 
"0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6"				

```

æŒ‡å®šå¯†ç åˆ›å»ºç”¨æˆ·

```

personal.newAccount("123")				

```

#### 14.1.2.Â åˆ—å‡ºè´¦å·

åˆ—å‡ºæ‰€æœ‰è´¦å·

```

> personal.listAccounts
["0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6", "0xe8abf98484325fd6afc59b804ac15804b978e607"]				

```

åˆ—å‡ºæŒ‡å®šè´¦å·

```

> personal.listAccounts[1]
"0xe8abf98484325fd6afc59b804ac15804b978e607"

> personal.listAccounts[0]
"0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6"				

```

#### 14.1.3.Â è§£é”è´¦å·

```

 > personal.unlockAccount(eth.accounts[0],"password")						

```

æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œä¸‹é¢ä¾‹å­æ˜¯ 20 åˆ†é’Ÿ

```

> personal.unlockAccount(eth.accounts[0],"password", 1000*60*20)				

```

### 14.2.Â eth ç®¡ç†

#### 14.2.1.Â çŸ¿å·¥è´¦å·

æŸ¥çœ‹é»˜è®¤æ—·å·¥è´¦å·ï¼Œç³»ç»Ÿä¸­çš„ç¬¬ä¸€ä¸ªè´¦å·ã€‚

```

> eth.coinbase
"0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6"				

```

æŸ¥çœ‹è´¦å·åˆ—è¡¨

```

> eth.accounts
["0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6", "0xe8abf98484325fd6afc59b804ac15804b978e607"]	

> eth.accounts[0]
"0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6"			

```

#### 14.2.2.Â ä½™é¢

```

> eth.getBalance(eth.accounts[0])
70000000000000000000

```

##### 14.2.2.1.Â å•ä½è½¬æ¢

eth.getBalance()è¿”å›çš„ä½™é¢æ˜¯ä»¥å¤ªå¸çš„æœ€å°é¢é¢ weiï¼Œå°† wei è½¬æ¢ä¸ºä»¥å¤ªå¸ etherã€‚

```

primary = eth.accounts[0]
balance = web3.fromWei(eth.getBalance(primary), "ether");	

```

æ¼”ç¤º

```

> primary = eth.accounts[0]
"0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6"
> balance = web3.fromWei(eth.getBalance(primary), "ether");
70			

```

##### 14.2.2.2.Â ä¸€æ¬¡æ£€æŸ¥æ‰€æœ‰è´¦å·ä½™é¢

å®šä¹‰å‡½æ•°

```

function checkAllBalances() {
  web3.eth.getAccounts(function(err, accounts) {
   accounts.forEach(function(id) {
    web3.eth.getBalance(id, function(err, balance) {
     console.log("" + id + ":\tbalance: " + web3.fromWei(balance, "ether") + " ether");
   });
  });
 });
};					

```

è¿è¡Œå‡½æ•°

```

checkAllBalances()					

```

è¾“å‡ºæ¼”ç¤º

```

> function checkAllBalances() {
...   web3.eth.getAccounts(function(err, accounts) {
.........    accounts.forEach(function(id) {
...............     web3.eth.getBalance(id, function(err, balance) {
.....................      console.log("" + id + ":\tbalance: " + web3.fromWei(balance, "ether") + " ether");
.....................    });
...............   });
.........  });
... };
undefined
> checkAllBalances()
0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6:	balance: 929 ether
0xe8abf98484325fd6afc59b804ac15804b978e607:	balance: 11 ether
undefined					

```

#### 14.2.3.Â è§£é”è´¦å·

```

> personal.unlockAccount(eth.accounts[0],"password",50000)
true

```

#### 14.2.4.Â è½¬è´¦

```

personal.unlockAccount("0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6", "", 300)	
eth.sendTransaction({from: '0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6', to: '0xe8abf98484325fd6afc59b804ac15804b978e607', value: web3.toWei(1, "ether")})

```

```

é»˜è®¤çŸ¿å·¥è´¦å·

> eth.coinbase
"0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6"

æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è´¦å·ï¼Œå¦‚æœæ²¡æœ‰è¯·å‚è€ƒä¸Šé¢ç« èŠ‚åˆ›å»º

> eth.accounts
["0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6", "0xe8abf98484325fd6afc59b804ac15804b978e607"]

è½¬å‡ºè´¦å·ä¸­åˆ 285 ä¸ªä»¥å¤ªå¸

> web3.fromWei(eth.getBalance(eth.accounts[0]))
285

è½¬å…¥è´¦å·ç›®å‰æ˜¯ 0 

> web3.fromWei(eth.getBalance(eth.accounts[1]))
0

è§£é”ä¼ å‡ºè´¦å·ï¼Œå¦åˆ™ä¸èƒ½è½¬å‡ºã€‚personal.unlockAccount(è´¦å·, å¯†ç , 300)

> personal.unlockAccount("0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6", "", 300)
true

è½¬è´¦æ“ä½œ

> eth.sendTransaction({from: '0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6', to: '0xe8abf98484325fd6afc59b804ac15804b978e607', value: web3.toWei(10, "ether")})
"0xb0674a7fee52555d8712f3a1f0f30fbbbf67ff7b5b4b53ab5d131262613215c6"

å¦‚æœä½ ç°åœ¨æŸ¥çœ‹è½¬å…¥è´¦å·ï¼Œä½ ä¼šå‘ç°ä½™é¢ä»ç„¶æ˜¯ 0 ï¼Œäº¤æ˜“è¿˜æœªæˆåŠŸå†™è¿›åŒºå—ï¼Œå†™è¿›åŒºå—çš„æ–¹å¼æ˜¯æŒ–çŸ¿ï¼Œæ‰€ä»¥ä½ å¿…é¡»æ‰§è¡ŒæŒ–çŸ¿

> miner.start(1)
null

ç¨åå‡ åˆ†é’Ÿï¼Œå†æ¬¡æŸ¥çœ‹è½¬å…¥è´¦å·ï¼Œå°†ä¼šçœ‹åˆ°æœ‰ 10 ä¸ªä»¥å¤ªå¸å…¥è´¦ã€‚ä¼ å‡ºè´¦å·ä¼šå‡å°‘ 10 ä¸ªä»¥å¤ªå¸ï¼ŒåŒæ—¶ä»ç„¶ç»§ç»­æŒ–çŸ¿ä¸­ã€‚

> web3.fromWei(eth.getBalance(eth.accounts[1]))
10

```

ä»è´¦å· 0 æƒ³è´¦å· 1 è½¬è´¦

```

> personal.unlockAccount(eth.accounts[0],"password",50000)
true
> eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[1], value: web3.toWei(1, "ether")})				

```

#### 14.2.5.Â æŸ¥çœ‹æŒ‚èµ·çš„äº¤æ˜“

```

> eth.pendingTransactions
[{
    blockHash: null,
    blockNumber: null,
    from: "0x5fba50fce50baf0b8a7314200ba46336958ac97e",
    gas: 90000,
    gasPrice: 20000000000,
    hash: "0x51a75422f79fa96e70a0c1481851bc9f827868c44203b68d74f9815ffb367d5f",
    input: "0x",
    nonce: 0,
    r: "0x5632a8ade4a767dbd949ba1042cb33f98dd0722ab999ba18e1454d19d8bd1f6d",
    s: "0x515dcfa3de297f0c956ad9a061a5561f47cc9ccbb0a547cda59193c77fcbe3f7",
    to: "0x0a8c35653d8b229c16f0c9ce6f63cffb877cfdcf",
    transactionIndex: 0,
    v: "0x42",
    value: 1000000000000000000
}]				

```

å¦‚æœè¿”å›ç©ºå€¼ï¼Œè¡¨ç¤ºäº¤æ˜“å…¨éƒ¨å®Œæˆã€‚

```

> eth.pendingTransactions
[]				

```

#### 14.2.6.Â æŸ¥çœ‹å½“å‰åŒºå—æ€»æ•°

```

> eth.blockNumber 
719			

```

#### 14.2.7.Â æŸ¥çœ‹å½“å‰ Gas ä»·æ ¼

```

> web3.eth.gasPrice
5000000000

> web3.fromWei(web3.eth.gasPrice.toString())
"0.000000018"

```

#### 14.2.8.Â è¯„ä¼°æ‰§è¡ŒèŠ±è´¹çš„ GAS

```

> eth.estimateGas({from:eth.accounts[1], to: eth.accounts[2], value:12340000000000000000})
21000

```

#### 14.2.9.Â æŸ¥çœ‹åŒºå—ä¿¡æ¯

```

> eth.getBlock(1) 
{
  difficulty: 131072,
  extraData: "0xd783010702846765746885676f312e398777696e646f7773",
  gasLimit: 4995119,
  gasUsed: 0,
  hash: "0x62bc2fc0fd647b43013ba75e65a3f16520cebb60cadc0995965c891d4266a88c",
  logsBloom: "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
  miner: "0xba1821227ebad7e88a51078f6219b392fd601822",
  mixHash: "0x80ad2e29d057e0f6bb9d03f12a252fdc65cb520248fa0023ae6624c997b5d5f2",
  nonce: "0x3d743ef28ba8c8c8",
  number: 1,
  parentHash: "0x611596e7979cd4e7ca1531260fa706093a5492ecbdf58f20a39545397e424d04",
  receiptsRoot: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
  sha3Uncles: "0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
  size: 535,
  stateRoot: "0x418d9f66e33cbd41fd524b87c10c5fc75f8a6360896967d827a2d56a0c8aadda",
  timestamp: 1510715249,
  totalDifficulty: 262144,
  transactions: [],
  transactionsRoot: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
  uncles: []
}
> eth.getBlock(2)
{
  difficulty: 131072,
  extraData: "0xd783010702846765746885676f312e398777696e646f7773",
  gasLimit: 4990242,
  gasUsed: 0,
  hash: "0x3323c566fd3501c29e8b026c4a9d2e83a8dd62d153a32b5f879120e999013d07",
  logsBloom: "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
  miner: "0xba1821227ebad7e88a51078f6219b392fd601822",
  mixHash: "0xc415fc64f1bc13842455f8289d33842260c1578a32b5befded5b4293e7a92276",
  nonce: "0x4f4a0e65412663db",
  number: 2,
  parentHash: "0x62bc2fc0fd647b43013ba75e65a3f16520cebb60cadc0995965c891d4266a88c",
  receiptsRoot: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
  sha3Uncles: "0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
  size: 535,
  stateRoot: "0x39ccb22ff5ca19a2340e137fa64acedb704d42827a753780b53a0aff8922e403",
  timestamp: 1510715341,
  totalDifficulty: 393216,
  transactions: [],
  transactionsRoot: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
  uncles: []
}

```

#### 14.2.10.Â è¿”å›äº¤æ˜“ä¿¡æ¯

```

> web3.eth.getTransaction("0x4e27a477e128b200239bc2ecd899077c6ae064da963a919fef41bcc7462aec8d")
{
  blockHash: "0x59a9905831e7ae3cb9e7c6f125cf48e2688ef4b39317838f6f6b6c8837d01404",
  blockNumber: 4367,
  from: "0x8efb99ec55bcfbe2cfe47918f2d9e55fa732111f",
  gas: 21000,
  gasPrice: 18000000000,
  hash: "0x4e27a477e128b200239bc2ecd899077c6ae064da963a919fef41bcc7462aec8d",
  input: "0x",
  nonce: 15,
  r: "0xa297401df3a1fb0298cbc1dd609deebe9ded319fadc55934ecef4d525198215",
  s: "0x780d8c46bc8d1bb89ae9d78055307d9d68a4f89ba699ef86d3f8ba88383139a6",
  to: "0xf0688330101d53bd0c6ede2ef04d33c2010e9a5d",
  transactionIndex: 0,
  v: "0x42",
  value: 999622000000000000
}

```

#### 14.2.11.Â è¿”å›äº¤æ˜“æ”¶æ®

```

> web3.eth.getTransactionReceipt("0x4e27a477e128b200239bc2ecd899077c6ae064da963a919fef41bcc7462aec8d")
{
  blockHash: "0x59a9905831e7ae3cb9e7c6f125cf48e2688ef4b39317838f6f6b6c8837d01404",
  blockNumber: 4367,
  contractAddress: null,
  cumulativeGasUsed: 21000,
  from: "0x8efb99ec55bcfbe2cfe47918f2d9e55fa732111f",
  gasUsed: 21000,
  logs: [],
  logsBloom: "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
  root: "0x69d278e7594e8a5affbebc84380516437f3e4b241b272e6eaebf752af9c76047",
  to: "0xf0688330101d53bd0c6ede2ef04d33c2010e9a5d",
  transactionHash: "0x4e27a477e128b200239bc2ecd899077c6ae064da963a919fef41bcc7462aec8d",
  transactionIndex: 0
}

```

è¿”å›å€¼ï¼š

ObjectÂ -Â äº¤æ˜“çš„æ”¶æ®å¯¹è±¡ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¿”å› nullÂ 
blockHash:Â StringÂ -Â 32 å­—èŠ‚ï¼Œè¿™ä¸ªäº¤æ˜“æ‰€åœ¨åŒºå—çš„å“ˆå¸Œã€‚
blockNumber:Â NumberÂ -Â äº¤æ˜“æ‰€åœ¨åŒºå—çš„å—å·ã€‚
transactionHash:Â StringÂ -Â 32 å­—èŠ‚ï¼Œäº¤æ˜“çš„å“ˆå¸Œå€¼ã€‚
transactionIndex:Â NumberÂ -Â äº¤æ˜“åœ¨åŒºå—é‡Œé¢çš„åºå·ï¼Œæ•´æ•°ã€‚
from:Â StringÂ -Â 20 å­—èŠ‚ï¼Œäº¤æ˜“å‘é€è€…çš„åœ°å€ã€‚
to:Â StringÂ -Â 20 å­—èŠ‚ï¼Œäº¤æ˜“æ¥æ”¶è€…çš„åœ°å€ã€‚å¦‚æœæ˜¯ä¸€ä¸ªåˆçº¦åˆ›å»ºçš„äº¤æ˜“ï¼Œè¿”å› nullã€‚
cumulativeGasUsed:Â NumberÂ -Â å½“å‰äº¤æ˜“æ‰§è¡Œåç´¯è®¡èŠ±è´¹çš„ gas æ€»å€¼ 10ã€‚
gasUsed:Â NumberÂ -Â æ‰§è¡Œå½“å‰è¿™ä¸ªäº¤æ˜“å•ç‹¬èŠ±è´¹çš„ gasã€‚
contractAddress:Â StringÂ -Â 20 å­—èŠ‚ï¼Œåˆ›å»ºçš„åˆçº¦åœ°å€ã€‚å¦‚æœæ˜¯ä¸€ä¸ªåˆçº¦åˆ›å»ºäº¤æ˜“ï¼Œè¿”å›åˆçº¦åœ°å€ï¼Œå…¶å®ƒæƒ…å†µè¿”å› nullã€‚
logs:Â ArrayÂ -Â è¿™ä¸ªäº¤æ˜“äº§ç”Ÿçš„æ—¥å¿—å¯¹è±¡æ•°ç»„ã€‚

#### 14.2.12.Â eth.syncing åŒæ­¥çŠ¶æ€

```

> eth.syncing
{
  currentBlock: 645835,
  highestBlock: 5439559,
  knownStates: 1090968,
  pulledStates: 1080746,
  startingBlock: 0
}			

```

æ˜¾ç¤ºç™¾åˆ†æ¯”

```

console.log(parseInt(eth.syncing.currentBlock/eth.syncing.highestBlock*100,10)+'%')		

```

å‰©ä½™å—æ•°

```

eth.syncing.highestBlock - eth.syncing.currentBlock

setInterval(function(){
	console.log(eth.syncing.highestBlock - eth.syncing.currentBlock)
},5000);

```

è¿›åº¦ç›‘æ§

```

var lastPercentage = 0;var lastBlocksToGo = 0;var timeInterval = 10000;
setInterval(function(){
    var percentage = eth.syncing.currentBlock/eth.syncing.highestBlock*100;
    var percentagePerTime = percentage - lastPercentage;
    var blocksToGo = eth.syncing.highestBlock - eth.syncing.currentBlock;
    var bps = (lastBlocksToGo - blocksToGo) / (timeInterval / 1000)
    var etas = 100 / percentagePerTime * (timeInterval / 1000)

    var etaM = parseInt(etas/60,10);
    console.log(parseInt(percentage,10)+'% ETA: '+etaM+' minutes @ '+bps+'bps');

    lastPercentage = percentage;lastBlocksToGo = blocksToGo;
},timeInterval);

```

#### 14.2.13.Â æŸ¥çœ‹æ™ºèƒ½åˆçº¦ç¼–è¯‘å™¨

```

> eth.compile
{
  lll: function(),
  serpent: function(),
  solidity: function()
}				

```

### 14.3.Â web3

#### 14.3.1.Â Ether å¸çš„åŸºæœ¬å•ä½

Ether å¸æœ€å°çš„å•ä½æ˜¯ Weiï¼Œä¹Ÿæ˜¯å‘½ä»¤è¡Œé»˜è®¤çš„å•ä½, ç„¶åæ¯ 1000 ä¸ªè¿›ä¸€ä¸ªå•ä½ï¼Œä¾æ¬¡æ˜¯

kweiÂ (1000Â Wei)
mweiÂ (1000Â KWei)
gweiÂ (1000Â mwei)
szaboÂ (1000Â gwei)
finneyÂ (1000Â szabo)
etherÂ (1000Â finney)

å¦‚ä½•è¿›è¡Œ ether å’Œ Wei ä¹‹é—´çš„è½¬æ¢ï¼Œç®€å•åœ°è¯´å°±æ˜¯å°±æ˜¯ 1 ä»¥å¤ªå¸ = 1000000000000000000 Wei ï¼ˆè¿™å°±æ˜¯ä¸Šä¸€ç«™ç« ä¸­ä¸ºä½•æˆ‘ä»¬è½¬ç§» 0.01 ä¸ªä»¥å¤ªå¸ï¼Œç»“æœå´æ˜¾ç¤ºå¾ˆé•¿çš„åŸå› ï¼‰

å•ä½è½¬æ¢

```

> web3.fromWei(10000000000000000,"ether")
"0.01"				

```

#### 14.3.2.Â web3.toWei

```

Etherâ€“> Wei

> web3.toWei(1)
"1000000000000000000"
> web3.toWei(1.3423423)
"1342342300000000000"
> web3.toWei(0.00034)
"340000000000000"						

```

#### 14.3.3.Â web3.fromWei

```

Wei â€“> Ether

> web3.fromWei(10000000000000000)
"0.01"
> web3.fromWei(1000000000000000000)
"1"
>

```

### 14.4.Â admin ç®¡ç†

```

> admin
{
  datadir: "/home/ethereum/.ethereum",
  nodeInfo: {
    enode: "enode://89a7bfd4472dff266ccdccc76bc75586a9005144df54d4575a9e07d9b2aee8aae6c8004cc98c6212d5f0f4d5e3a524617abd7e7d6f39d5df053f94b7250e5610@[::]:30303?discport=0",
    id: "89a7bfd4472dff266ccdccc76bc75586a9005144df54d4575a9e07d9b2aee8aae6c8004cc98c6212d5f0f4d5e3a524617abd7e7d6f39d5df053f94b7250e5610",
    ip: "::",
    listenAddr: "[::]:30303",
    name: "Geth/v1.8.2-stable/linux-amd64/go1.8.3",
    ports: {
      discovery: 0,
      listener: 30303
    },
    protocols: {
      les: {
        config: {...},
        difficulty: 17179869184,
        genesis: "0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3",
        head: "0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3",
        network: 1
      }
    }
  },
  peers: [],
  addPeer: function(),
  clearHistory: function(),
  exportChain: function(),
  getDatadir: function(callback),
  getNodeInfo: function(callback),
  getPeers: function(callback),
  importChain: function(),
  removePeer: function(),
  sleep: function github.com/ethereum/go-ethereum/console.(*bridge).Sleep-fm(),
  sleepBlocks: function github.com/ethereum/go-ethereum/console.(*bridge).SleepBlocks-fm(),
  startRPC: function(),
  startWS: function(),
  stopRPC: function(),
  stopWS: function()
}		

```

#### 14.4.1.Â çœ‹çœ‹ networkid

```

> admin.nodeInfo.protocols.eth.network
123456				

```

#### 14.4.2.Â èŠ‚ç‚¹ç®¡ç†

å¯ä»¥é€šè¿‡ admin.addPeer()æ–¹æ³•è¿æ¥åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œä¸¤ä¸ªèŠ‚ç‚¹è¦æƒ³è”é€šï¼Œå¿…é¡»ä¿è¯ç½‘ç»œæ˜¯ç›¸é€šçš„ï¼Œå¹¶ä¸”è¦æŒ‡å®šç›¸åŒçš„ networkid

### æç¤º

æ³¨æ„å»æ‰ --nodiscover å‚æ•°

ç¡®ä¿ç½‘ç»œå¯ç”¨

```

> net.listening
true

```

##### 14.4.2.1.Â æ˜¾ç¤ºèŠ‚ç‚¹

æ˜¾ç¤ºå½“å‰èŠ‚ç‚¹ä¿¡æ¯

```

> admin.nodeInfo
{
  enode: "enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@14.103.209.119:30303",
  id: "9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527",
  ip: "14.103.209.119",
  listenAddr: "[::]:30303",
  name: "Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9.1",
  ports: {
    discovery: 30303,
    listener: 30303
  },
  protocols: {
    eth: {
      difficulty: 108754979,
      genesis: "0x611596e7979cd4e7ca1531260fa706093a5492ecbdf58f20a39545397e424d04",
      head: "0x61330b27cfbfaecbb36bb8666cbe0564c1e0bdecfdcd153622d8c2ca2b82786e",
      network: 123456
    }
  }
}					

```

èŠ‚ç‚¹åœ°å€

```

> admin.nodeInfo.enode 
"enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@[::]:30303?discport=0"

```

[::] æ˜¯ ipv6 åœ°å€ï¼Œå¯ä»¥æ”¹ä¸º ipv4 åœ°å€ã€‚

##### 14.4.2.2.Â æ·»åŠ èŠ‚ç‚¹

```

> admin.addPeer('enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@172.16.0.1:30303')				

```

```

admin.addPeer('enode://6427b7e7446bb05f22fe7ce9ea175ec05858953d75a5a6e4f99a6aec0779a8bd6276f1959a42fe5948acbe14bcd0652082dc546d3b37ae8f2aea41eba4eca43b@121.201.14.181:30303');
admin.addPeer('enode://91922b12115c067005c574844c6bbdb114eb262f90b6355cec89e13b483c3e4669c6d63ec66b6e3ca7a3a462d28edb3c659e9fa05ed4c7234524e582a8816743@120.27.164.92:13333');
admin.addPeer('enode://3dde41a994b3b99f938f75ddf6d48318c78ddd869c70b48d00b922190bb434fc5474f6250c143723f4387273d123e02f6a38f07d0311f240d2915f6140e09850@207.226.141.212:30303');
admin.addPeer('enode://7ab8fa90b204f2146c00939b8474549c544caa3598a0894fa639a5cdbd992cbc6135fd776f8bcf97ae95fdaa3afbfa2d107fea71549119afd7ea57356b899be5@121.201.24.236:30303');
admin.addPeer('enode://db81152a8296089b04a21ad9bf347df3ff0450ffc8215d9f50c400ccf8d18963118010cacf03c4b71981cf9cac5394438cab3039e98db4d2aae5859ab7d1793e@139.198.1.244:30303');
admin.addPeer('enode://68dd1360f0a4ac362b41124692e31652ffe26f6f06a284ca11f3b514b3968594ac1f4320d1aa1ca343b06327c18a2e40eded74edfb3086e1baaa27ca24226b21@113.106.85.172:30303');
admin.addPeer('enode://58f6b6908286cefe43c166cfc4fed033c750caa1bc3f6e1e1e1507752c0b91248addb3122f8557c5f8912e702285a160ab3a10203ae1eff3807eda25d6ed6478@45.113.71.186:30303');
admin.addPeer('enode://87190a01c02cafb97e7f49672b4c3be2937cf79c3969e0b8e7b35cac28cebfbda52a13d56fd2113c726a1dd359c9476ccf7e60651439cef56e3a71039f6a4f5e@119.29.207.90:30303');
admin.addPeer('enode://d1fdd05a62fd9544eeb455e4f4d4bd8bb574138d82d8f909f3041d0792e3401f8695133d39ad0a3aa5d217e3c5bed0511b531505a67b03607a909ae9096720d2@120.26.129.121:30303');
admin.addPeer('enode://a1e9cf99eca94590ae776c8dd5c6c043a8c1f0375e9e391c9fb55133385bf453ac3d3fb3ead8e63415b2ef99d54a19e2a7bc830cd1fdbbb283818e3bcb0ea31e@182.254.209.254:30303');
admin.addPeer('enode://562796b19d43d79dfb6160abd2d7bb78a2f2efd9501a0a767c00677e0fb3a4407235f813c3003682c2a421a58709c52f595827bc15708cc5f534f55d0f8d03ad@121.40.199.54:30303');
admin.addPeer('enode://fa2c17dcc83a6e2825668210abf7480452de4b13d8bdea8f301c3b603701918bc4dade9e68d119d7a8214e90e7ea10a2782041c98951385d97bee73358fb08f4@120.26.124.58:30303');
admin.addPeer('enode://0b331b27e2976d797aed1d1464ac483a7f262860334cb5737a01a0188da08d79226a6973adc5f2a2c1a20192b399161eee23a0d56ecf472cbe4058d010ecc89f@47.89.49.61:30303');
admin.addPeer('enode://0639f20fdb5af1fecd2f2bc0ddb648885483a5945686530e6b046678635d3435dd7b92fe34209f81ec6f003482aa78e407e5e6eb1b10be4773a2adbcf1fc1ba6@118.192.161.147:30303');
admin.addPeer('enode://fd2a5d30e4f3917ee640876cc57d72a8bf5ecf049e9106c95e60cf306dd7a5dd68d1a295f3718af44a7083252686926d6e8a402f1abe6f805e10e7281967db28@121.201.29.82:30303');
admin.addPeer('enode://0d1b9eed7afe2d5878d5d8a4c2066b600a3bcac2e5730586421af224e93a58cd03cac75bf0b2a62fd8049cd3692a085758cc1e407c8b2c94bb069814a5e8d0f0@209.9.106.245:30303');
admin.addPeer('enode://ca087a651571d04953187753af969f7deb1582af2a06a3048b90adb3f87d4c41973aac4b5e80449efc97154dac769a5ea447b123c3aaf7a2c23825a1558804dc@182.150.37.23:30303');
admin.addPeer('enode://9b53b9d41d964f71db60d2198cfa9013fc7808d707c5e0a32da1e22d3cacd6adbae46901df6506a752d9d4e3791df29171315fbb86f7b09331a25458158fe65b@182.150.37.24:30303');			

```

##### 14.4.2.3.Â æŸ¥çœ‹èŠ‚ç‚¹

æŸ¥çœ‹èŠ‚ç‚¹æ•°é‡

```

> net.peerCount
1					

```

æŸ¥çœ‹èŠ‚ç‚¹åœ°å€

```

> admin.peers
[{
    caps: ["eth/62", "eth/63", "par/1", "par/2", "pip/1"],
    id: "a7bbd8fb72e02681b027908f14fd2dbd80e35a1477d7d9d4dc19ed34420be26fe9f991c83a83e4ab8aa371ffbb149494471f30216bc2f662d1ebc6d01811c7a2",
    name: "Parity/v1.7.12-stable-9b796e8-20180121/x86_64-linux-gnu/rustc1.21.0",
    network: {
      localAddress: "172.16.0.1:34092",
      remoteAddress: "52.67.171.152:30388"
    },
    protocols: {
      eth: "handshake"
    }
}]				

```

åˆ—å‡ºèŠ‚ç‚¹ IP åœ°å€

```

admin.peers.forEach(function(p) {console.log(p.network.remoteAddress);})	

```

```

> admin.peers.forEach(function(p) {console.log(p.network.remoteAddress);})
52.90.40.206:30303
120.79.161.22:30303
13.229.198.234:30303
169.0.182.34:30303
23.111.151.158:30304
120.27.196.141:30303
118.193.93.174:30303
35.229.242.1:30303
159.203.32.64:30303
undefined
>				

```

##### 14.4.2.4.Â networkid

```

> admin.nodeInfo.protocols.les.network
1			

```

### 14.5.Â miner æŒ–çŸ¿ç®¡ç†

#### 14.5.1.Â å¼€å§‹æŒ–çŸ¿

```

> miner.start(2)
null			

```

è¿‡å‡ åˆ†é’Ÿåè¿è¡Œ

```

> web3.fromWei(eth.getBalance(eth.coinbase), "ether")
30					

```

è¿™æ—¶æˆ‘ä»¬å·²ç»çœ‹åˆ°å·²ç»äº§ç”Ÿäº† 30 ä¸ªä»¥å¤ªå¸ã€‚

#### 14.5.2.Â åœæ­¢æŒ–çŸ¿

```

> miner.stop()
true
>

```

#### 14.5.3.Â è®¾ç½®é»˜è®¤çŸ¿å·¥è´¦å·

é»˜è®¤æŒ–çŸ¿ä½¿ç”¨ç³»ç»Ÿä¸­çš„ç¬¬ä¸€ä¸ªè´¦å·ï¼Œä½ å¯ä»¥ä½¿ç”¨ miner.setEtherbase() æŒ‡å®šè´¦å·ã€‚

```

> miner.setEtherbase("0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6")
true	

```

```

> eth.accounts
["0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6", "0xe8abf98484325fd6afc59b804ac15804b978e607", "0x013b5e735e1b48421dd3de3b931d6f03e769e22b"]

> eth.coinbase
"0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6"

> miner.setEtherbase("0xe8abf98484325fd6afc59b804ac15804b978e607")
true

> eth.coinbase
"0xe8abf98484325fd6afc59b804ac15804b978e607"	

```

### 14.6.Â txpool ç®¡ç†

#### 14.6.1.Â txpool.status

æŸ¥çœ‹çŠ¶æ€

```

> txpool.status 
{
  pending: 0,
  queued: 0
}

```

ä¾‹å¦‚åšä¸€ç¬”è½¬è´¦

```

> amount = web3.toWei(5,'ether')  
"5000000000000000000"  
> eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[1],value:amount})	

> txpool.status 
{
  pending: 1,
  queued: 0
}

> miner.start(1);admin.sleepBlocks(1);miner.stop(); 

> txpool.status 
{
  pending: 0,
  queued: 0
}

> web3.fromWei(eth.getBalance(eth.accounts[1]),'ether')  
5  

```

### 14.7.Â net

#### 14.7.1.Â ç›‘å¬çŠ¶æ€

```

> net.listening
true

```

## ç¬¬Â 12Â ç« Â Wallet

## 1.Â Ethereum Wallet(Mist)

å¼€å§‹å­¦ä¹ ä»¥å¤ªåŠæ—¶é˜…è¯»å¤§é‡æ–‡ç« å¸¸å¸¸ä¼šæåˆ° Mist ä¸€å¤´é›¾æ°´ï¼Œåæ¥æ‰çŸ¥é“ Mist å°±æ˜¯ Ethereum Walletã€‚ Ethereum Wallet æ˜¯è½¯ä»¶åå­—ï¼Œ Mist æ˜¯é¡¹ç›®åå­—ã€‚

Ethereum Wallet å¯ä»¥åœ¨ä»¥å¤ªåŠé¦–é¡µä¸‹è½½ï¼Œå¦‚æœä½ éœ€è¦å®‰è£…å†å²ç‰ˆæœ¬å¯ä»¥è®¿é—® [`github.com/ethereum/mist/releases`](https://github.com/ethereum/mist/releases)

å‚æ•°ï¼š

```

neo@MacBook-Pro ~ %  "/Applications/Ethereum Wallet.app/Contents/MacOS/Ethereum Wallet" --help
Usage: /Applications/Ethereum Wallet.app/Contents/MacOS/Ethereum Wallet --help
[Mist options] [Node options]

Mist options:
  --mode, -m              App UI mode: wallet, mist.[string] [default: "wallet"]
  --node                  Node to use: geth, eth        [string] [default: null]
  --network               Network to connect to: main, test
                                                        [string] [default: null]
  --rpc                   Path to node IPC socket file OR HTTP RPC hostport (if
                          IPC socket file then --node-ipcpath will be set with
                          this value).                                  [string]
  --swarmurl              URL serving the Swarm HTTP API. If null, Mist will
                          open a local node.
                                     [string] [default: "http://localhost:8500"]
  --gethpath              Path to Geth executable to use instead of default.
                                                                        [string]
  --ethpath               Path to Eth executable to use instead of default.
                                                                        [string]
  --ignore-gpu-blacklist  Ignores GPU blacklist (needed for some Linux
                          installations).                              [boolean]
  --reset-tabs            Reset Mist tabs to their default settings.   [boolean]
  --logfile               Logs will be written to this file in addition to the
                          console.                                      [string]
  --loglevel              Minimum logging threshold: info, debug, error, trace
                          (shows all logs, including possible passwords over
                          IPC!).                      [string] [default: "info"]
  --syncmode              Geth synchronization mode: [fast|light|full]  [string]
  --version, -v           Display Mist version.                        [boolean]
  --skiptimesynccheck     Disable checks for the presence of automatic time sync
                          on your OS.                                  [boolean]

Node options:
  -  To pass options to the underlying node (e.g. Geth) use the --node- prefix,
     e.g. --node-datadir

Options:
  -h, --help  Show help                                                [boolean]				

```

| ![](img/EthereumWallet.png) |

### 1.1.Â Ethereum Wallet å·¥ä½œåŸç†

Ethereum Wallet å·¥ä½œåŸç†éå¸¸ç®€å•ï¼Œå¯åŠ¨ Ethereum Wallet æ˜¯ï¼ŒEthereum Wallet ä¼šé¦–å…ˆå¯åŠ¨ gethï¼Œç„¶ååœ¨å¯åŠ¨ Ethereum Wallet åº”ç”¨ç¨‹åºã€‚

geth è´Ÿè´£ä¸ä»¥å¤ªåŠç½‘ç»œè¿æ¥ï¼ŒåŒ…æ‹¬ä¸»ç½‘ï¼ŒRopsten å’Œ Rinkeby ä¸¤ä¸ªæµ‹è¯•ç½‘ï¼ŒSolo æœ¬åœ°å¼€å‘æ¨¡å¼ã€‚geth

ä¾‹å¦‚ä¸»ç½‘çš„å¯åŠ¨ç›®å½•æ˜¯ /Users/neo/Library/Ethereum/geth.ipc å‚æ•°æ˜¯ï¼š

```

/Users/neo/Library/Application Support/Ethereum Wallet/binaries/Geth/unpacked/geth --syncmode light --cache 1024

```

#### 1.1.1.Â geth å¯åŠ¨ ropsten æµ‹è¯•ç½‘

```

/Users/neo/Library/Application Support/Ethereum Wallet/binaries/Geth/unpacked/geth --testnet --syncmode light --cache 1024 --ipcpath /Users/neo/Library/Ethereum/geth.ipc

```

#### 1.1.2.Â è¿æ¥åˆ°æœ¬åœ°æµ‹è¯•ç½‘ç»œ

é¦–å…ˆå¯åŠ¨ geth

##### 1.1.2.1.Â IPC

é’±åŒ…é»˜è®¤æ˜¯è¿æ¥åˆ°ä¸‹é¢åœ°å€ã€‚

```

IPC endpoint opened: /Users/neo/Library/Ethereum/geth.ipc

```

è¿æ¥åˆ°å…¶ä»– ipc åœ°å€

```

"/Applications/Ethereum Wallet.app/Contents/MacOS/Ethereum Wallet" --rpc /Users/other/Library/Ethereum/geth.ipc

```

##### 1.1.2.2.Â TCP

å¦‚æœéœ€è¦è¿æ¥åˆ°è¿œç¨‹èŠ‚ç‚¹ä¸Šï¼Œéœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œï¼Œæ–¹æ³•å¦‚ä¸‹ã€‚å¯åŠ¨é’±åŒ…å¹¶è¿æ¥åˆ°è¿œç¨‹å¼€å‘ç¯å¢ƒï¼Œlocalhost æ”¹ä¸ºä½ çš„ IP åœ°å€å³å¯ã€‚

```

"/Applications/Ethereum Wallet.app/Contents/MacOS/Ethereum Wallet" --rpc http://localhost:8545				

```

| ![](img/EthereumWalletTcp.png) |

#### 1.1.3.Â æ§åˆ¶å°

åœ¨ Ethereum Wallet å¯åŠ¨æœŸé—´ï¼Œéšæ—¶å¯ä»¥è¿›å…¥ Javascript æ§åˆ¶å°ã€‚

```

neo@MacBook-Pro ~/Library/Ethereum/geth % geth attach      
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.1-stable-1e67410e/darwin-amd64/go1.9.4
 modules: admin:1.0 debug:1.0 eth:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> eth.accounts
["0xb94054c174995ae2a9e7fcf6c7924635fba8ecf7", "0xf56b81a2bcb964d2806071e9be4289a5559bb0fa", "0x997e5ca600e19447d0b82afbf9c7f00de2b39b16"]
> 				

```

### 1.2.Â ä¸»ç½‘ç»œ

#### 1.2.1.Â ä¸»ç½‘å¯åŠ¨å‚æ•°

```

/Users/neo/Library/Application Support/Ethereum Wallet/binaries/Geth/unpacked/geth --syncmode light --cache 1024				

```

#### 1.2.2.Â è¿›å…¥ä¸»ç½‘

ç‚¹å‡»æŒ‰é’® "USE THE MAIN NETWORK" è¿›å…¥ä»¥å¤ªåŠä¸»ç½‘ã€‚

| ![](img/EthereumWalletNetwork.png) |

#### 1.2.3.Â ä»¥å¤ªåŠåŒºå—æµè§ˆå™¨

[`etherscan.io`](https://etherscan.io)

### 1.3.Â Ropsten æµ‹è¯•ç½‘ç»œ

#### 1.3.1.Â å¯åŠ¨å‚æ•°

```

/Users/neo/Library/Application Support/Ethereum Wallet/binaries/Geth/unpacked/geth --testnet --syncmode light --cache 1024 --ipcpath /Users/neo/Library/Ethereum/geth.ipc				

```

#### 1.3.2.Â è·å¾—æµ‹è¯•å¸

[`faucet.ropsten.be:3001`](http://faucet.ropsten.be:3001)

| ![](img/faucet.png) |

è¾“å…¥è´¦å·ç„¶åç‚¹å‡» â€œSend me 1 test etherâ€ æŒ‰é’®

| ![](img/send.png) |

å½“ç°å® â€œYour request was acceptedâ€ æ—¶ï¼Œè¡¨ç¤ºä½ çš„è¯·æ±‚å·²ç»æ¥å—ï¼Œæ¥ä¸‹æ¥è€å¿ƒç­‰å¾…ã€‚

#### 1.3.3.Â Etherscan

[`ropsten.etherscan.io`](https://ropsten.etherscan.io)

### 1.4.Â Rinkeby æµ‹è¯•ç½‘ç»œ

[`www.rinkeby.io/`](https://www.rinkeby.io/)

#### 1.4.1.Â æµ‹è¯•ç½‘ç»œ

è¿æ¥æµ‹è¯•ç½‘ç»œï¼Œå¯åŠ¨ "Ethereum Wallet"ï¼Œä¸»èœå•-Develop-Networkï¼Œé€‰æ‹© "Rinkeby - Test network"ã€‚

å¦‚æœè¿™ä¸ªèœå•æ˜¯ç°è‰²çš„ï¼Œå¯ä»¥ä½ åœ¨æœ¬åœ°è¿è¡Œè¿‡ gethï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š

```

mkdir ~/ethereum/rinkeby			
geth --datadir ~/ethereum/rinkeby --rinkeby --rpc console

```

åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£æ‰§è¡Œ

```

neo@MacBook-Pro ~/ethereum/rinkeby % "/Applications/Ethereum Wallet.app/Contents/MacOS/Ethereum Wallet" ~/ethereum/rinkeby/geth.ipc	

```

æˆ–è€…ä½¿ç”¨ TCP æ–¹å¼è¿æ¥

```

"/Applications/Ethereum Wallet.app/Contents/MacOS/Ethereum Wallet" --rpc http://localhost:8545				

```

å¦‚æœä½ æ²¡æœ‰å®‰è£… gethï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•

```

neo@MacBook-Pro ~/ethereum/truffle % "/Users/neo/Library/Application Support/Ethereum Wallet/binaries/Geth/unpacked/geth" --rinkeby --syncmode light --cache 1024 --ipcpath /Users/neo/Library/Ethereum/geth.ipc
INFO [02-22|11:43:23] Maximum peer count                       ETH=0 LES=100 total=25
INFO [02-22|11:43:23] Starting peer-to-peer node               instance=Geth/v1.8.1-stable-1e67410e/darwin-amd64/go1.9.4
INFO [02-22|11:43:23] Allocated cache and file handles         database=/Users/neo/Library/Ethereum/rinkeby/geth/lightchaindata cache=768 handles=128
INFO [02-22|11:43:27] Persisted trie from memory database      nodes=355 size=65.27kB time=399.41Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
INFO [02-22|11:43:27] Initialised chain configuration          config="{ChainID: 4 Homestead: 1 DAO: <nil> DAOSupport: true EIP150: 2 EIP155: 3 EIP158: 3 Byzantium: 1035301 Engine: clique}"
INFO [02-22|11:43:27] Loaded most recent local header          number=1813389 hash=d58d6bâ€¦a489d9 td=3366103
INFO [02-22|11:43:27] Starting P2P networking 
INFO [02-22|11:43:29] UDP listener up                          net=enode://e84fbdb5d1b75d18fe45fdd13fdad9d5a8ff6d54b82cc8383525870054b91108010ccf8776ac8a50146c9abf9d43c0117af2bbe0cc2668874d269c3817dec47e@[::]:30303
WARN [02-22|11:43:29] Light client mode is an experimental feature 
INFO [02-22|11:43:29] RLPx listener up                         self="enode://e84fbdb5d1b75d18fe45fdd13fdad9d5a8ff6d54b82cc8383525870054b91108010ccf8776ac8a50146c9abf9d43c0117af2bbe0cc2668874d269c3817dec47e@[::]:30303?discport=0"
INFO [02-22|11:43:29] IPC endpoint opened                      url=/Users/neo/Library/Ethereum/geth.ipc
INFO [02-22|11:43:30] Mapped network port                      proto=udp extport=30303 intport=30303 interface="UPNP IGDv1-IP1"
INFO [02-22|11:43:31] Mapped network port                      proto=tcp extport=30303 intport=30303 interface="UPNP IGDv1-IP1"
INFO [02-22|11:43:32] Block synchronisation started 
INFO [02-22|11:43:33] Imported new block headers               count=13 elapsed=245.507ms number=1813402 hash=08317câ€¦fd1806 ignored=0
INFO [02-22|11:43:48] Imported new block headers               count=1  elapsed=898.705Âµs number=1813403 hash=8a7c1bâ€¦5e1652 ignored=0
INFO [02-22|11:44:03] Imported new block headers               count=1  elapsed=892.924Âµs number=1813404 hash=511a30â€¦561d32 ignored=0			

```

ç„¶åæ­£å¸¸å¯åŠ¨é’±åŒ…ç¨‹åº Launchpad - Ethereum Wallet

å¯åŠ¨è¿‡ç¨‹æ¯”è¾ƒç¼“æ…¢ï¼Œå¯åŠ¨åä¼šåŒæ­¥åŒºå—ä¿¡æ¯

å¼¹å‡ºç¬¬ä¸€ä¸ªç•Œé¢ï¼Œè®©ä½ é€‰æ‹©ç½‘ç»œï¼Œè¿™é‡Œé€‰æ‹© Rinkeby æµ‹è¯•ç½‘ç»œ

| ![](img/EthereumWalletNetwork.png) |

è¾“å…¥å¯†ç ï¼Œè¦æ±‚å…«ä½å­—æ¯å’Œæ•°å­—ç»„åˆ

| ![](img/EthereumWalletPassword.png) |

æç¤ºä½ å¤‡ä»½é’±åŒ…

| ![](img/EthereumWalletBackup.png) |

ç”Ÿæˆè´¦å· 0x36ccB50B007D3D409E69841905DEf1D77D114Ddc

| ![](img/EthereumWalletAccount.png) |

è¿™æ—¶ä½ ä¼šçœ‹åˆ°å³ä¸‹è§’çš„æ•°å­—ä¸æ–­åœ°å˜åŒ–ï¼Œè¡¨ç¤ºæ­£åœ¨åŒæ­¥åŒºå—ä¿¡æ¯ã€‚åŒæ­¥è¿‡ç¨‹æ¯”è¾ƒæ¼«é•¿ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

| ![](img/EthereumWallet.png) |

#### 1.4.2.Â è·å–æµ‹è¯•ç½‘ç»œä¸Šçš„ä»¥å¤ªå¸

æƒ³è·å– Rinkeby æµ‹è¯•ç½‘ç»œä¸­çš„ä»¥å¤ªå¸ï¼Œéœ€è¦å»ç”³è¯·ï¼Œåœ°å€ï¼š

[`faucet.rinkeby.io`](https://faucet.rinkeby.io)

| ![](img/home.png) |

è¾“å…¥ä½ çš„é’±åŒ…åœ°å€ï¼Œå¹¶ç‚¹å‡»â€œGive me Etherâ€ï¼Œæœ‰ä¸‰ç§é€‰é¡¹ï¼Œå‰é¢æ˜¯è·å¾—çš„ä»¥å¤ªå¸æ•°é‡ï¼Œåé¢æ˜¯å†·å´æ—¶é—´ï¼Œåœ¨å†·å´æ—¶é—´è¿‡åæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡ä»¥å¤ªå¸ç”³è¯·ã€‚ä¾‹å¦‚ç¬¬ä¸€é¡¹æ˜¯ç”Ÿæˆ 3 ä¸ªä»¥å¤ªå¸ï¼Œ8 å°æ—¶åæ‰èƒ½å†æ¬¡ç”³è¯·ã€‚

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ ä¼šçœ‹åˆ°ä½ çš„é’±åŒ…åœ°å€å·²ç»å¤šå‡ºäº†ç”³è¯·æ•°é‡çš„ä»¥å¤ªå¸ã€‚

æ³¨æ„ï¼šå¦‚æœç”³è¯·çš„äººæ•°å¾ˆå¤šï¼Œéœ€è¦æ’é˜Ÿç­‰å¾…

#### 1.4.3.Â è¿æ¥èŠ‚ç‚¹ï¼ˆLight nodeï¼‰

ä¸‹è½½åˆ›ä¸–åŒºå—

```

mkdir ~/.rinkeby
cd ~/.rinkeby
wget https://www.rinkeby.io/rinkeby.json		

```

åˆå§‹åŒ–åŒºå—

```

geth --datadir=$HOME/.rinkeby init rinkeby.json			

```

å¯åŠ¨ä»¥å¤ªåŠï¼Œè¿™é‡Œé‡‡ç”¨ Light node æ¨¡å¼ï¼Œä»…ä»…ä¸‹è½½åŒºå—ä¿¡æ¯ï¼Œä¸ä¼šè¿è¡Œäº¤æ˜“ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«ã€‚

```

geth --networkid=4 --datadir=$HOME/.rinkeby --syncmode=light --ethstats='yournode:Respect my authoritah!@stats.rinkeby.io' --bootnodes=enode://a24ac7c5484ef4ed0c5eb2d36620ba4e4aa13b8c84684e1b4aab0cebea2ae45cb4d375b77eab56516d34bfbd3c1a833fc51296ff084b770b94fb9028c4d25ccf@52.169.42.101:30303			

```

#### 1.4.4.Â åŒºå—é“¾æµè§ˆå™¨

[`rinkeby.etherscan.io`](https://rinkeby.etherscan.io)

### 1.5.Â Solo Network

solo å®é™…ä¸Šå°±æ˜¯ geth çš„ --dev å‚æ•°

å¼€å‘æ¨¡å¼ä¼šåˆ›å»ºä¸€ä¸ªè´¦å·ï¼ŒåŒæ—¶å¯åŠ¨æŒ–çŸ¿ï¼ŒETH å¤šçš„ä½ ç”¨ä¸å®Œã€‚

```

/Users/neo/Library/Application Support/Ethereum Wallet/binaries/Geth/unpacked/geth --dev --minerthreads 1 --ipcpath /Users/neo/Library/Ethereum/geth.ipc			

```

### 1.6.Â ç§ç½‘

```

"/Users/neo/Library/Application Support/Ethereum Wallet/binaries/Geth/unpacked/geth" --datadir=$HOME/ethereum/private init $HOME/ethereum/genesis.json			
"/Users/neo/Library/Application Support/Ethereum Wallet/binaries/Geth/unpacked/geth" --networkid=4444 --datadir=$HOME/ethereum/private --ipcpath /Users/neo/Library/Ethereum/geth.ipc

```

### 1.7.Â åˆ é™¤åºŸå¼ƒçš„åˆçº¦

åœ¨ Ethereum Wallet é’±åŒ…ä¸Šä¼šæ˜¾ç¤ºæ‰€æœ‰è‡ªå·±åˆ›å»ºæˆ–è€… Watch çš„åˆçº¦ï¼Œæœ‰äº›åˆçº¦ä»…ä»…æ˜¯æµ‹è¯•ç”¨çš„ï¼Œç”¨è¿‡å³åºŸå¼ƒï¼Œåˆçº¦åˆ—è¡¨ä¾ç„¶ä¼šæ˜¾ç¤ºåœ¨é‚£é‡Œï¼Œåªæ˜¯å˜æˆç°è‰²å¹¶ä¸”æ— æ³•é€‰æ‹©

æ€æ ·æŠŠæ— ç”¨çš„åˆçº¦ä»åˆ—è¡¨åˆ é™¤å‘¢ï¼Ÿ

```

1\. Ethereum Wallet ä¸Šæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆä»çª—å£é€‰æ‹©å¼€å‘->åˆ‡æ¢å¼€å‘å·¥å…·->é’±åŒ…ç•Œé¢ï¼Œæˆ–è€…è¾“å…¥å¿«æ·é”® Alt+Ctrl+Iï¼‰ï¼Œæ˜¾ç¤ºå‡ºæ§åˆ¶å°ç•Œé¢
2\. æŸ¥è¯¢ Watch Contract åˆ—è¡¨ - åœ¨æ§åˆ¶å°è¾“å…¥å‘½ä»¤: CustomContracts.find().fetch();
3\. åœ¨åˆçº¦åˆ—è¡¨ä¸­æ‰¾åˆ°éœ€è¦åˆ é™¤çš„åˆçº¦ï¼Œå¹¶ä¸”å¤åˆ¶ ContractID
4\. åˆ é™¤åˆçº¦ï¼Œåœ¨æ§åˆ¶å°è¾“å…¥å‘½ä»¤ï¼šCustomContracts.remove('<ContractID>')

```

### 1.8.Â å…å®‰è£…ï¼Œåœ¨çº¿ä½¿ç”¨

[`wallet.ethereum.org`](https://wallet.ethereum.org)

### 1.9.Â è·å¾—ç©ºæŠ•å¸

## 2.Â MetaMask

MetaMask æ˜¯ Chrome æµè§ˆå™¨æ’ä»¶ [`metamask.io`](https://metamask.io)

| ![](img/metamask.png) |

### 2.1.Â æµ‹è¯•ç½‘ç»œ

| ![](img/network.png) |

#### 2.1.1.Â è·å–æµ‹è¯•ç½‘ç»œä¸Šçš„ä»¥å¤ªå¸

ç‚¹å‡» Buy æŒ‰é’®ï¼Œç„¶åå†ç‚¹å‡» ROPSTEN TEST FAUCET æŒ‰é’®ã€‚

| ![](img/ropsten-test-faucet.png) |

ç‚¹å‡» request 1 ether from faucet

| ![](img/faucet.png) |

### 2.2.Â mnemonic - Reveal seed words

ç‚¹å‡»å¤´åƒè¿›å…¥ Settings èœå•

| ![](img/settings.png) |

å•æœº Reveal seed words æŒ‰é’®

| ![](img/reveal-seed-words.png) |

è¾“å…¥è´¦å·å¯†ç è§£é”

| ![](img/seed-words-password.png) |

æŸ¥çœ‹ mnemonic å­—ç¬¦ä¸²

| ![](img/save-seed-words.png) |

### 2.3.Â æ·»åŠ  Token å¸ç§

æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ·»åŠ æ–°å¸ç§ï¼Œè¿˜æœ‰ä¸€ä¸ªç›®çš„æ˜¯ä¸ºäº†æ¥æ”¶ç©ºæŠ•å¸ã€‚

åªéœ€è¾“å…¥åˆçº¦åœ°å€å³å¯ï¼Œå…¶ä»–é€‰é¡¹ä¼šè‡ªåŠ¨å¡«å……ã€‚

| ![](img/add-token.png) |

æ˜¾ç¤ºä»£å¸æ•°é‡

| ![](img/add-token-balance.png) |

å®Œæˆä»£å¸æ·»åŠ 

| ![](img/add-token-done.png) |

### 2.4.Â MetaMask Vault Decryptor

MetaMask å°†é’±åŒ…æ•°æ®å­˜å‚¨åœ¨æµè§ˆä¸­ Local Storage ä¸­ï¼Œè¿™æ˜¯ Chrome è°·æ­Œæµè§ˆå™¨ç‰¹æœ‰çš„ Key,Value æ•°æ®åº“ã€‚

Key çš„åå­—æ˜¯ metamask-config å°†å®ƒå¤åˆ¶åˆ° [`metamask.github.io/vault-decryptor/`](https://metamask.github.io/vault-decryptor/) ä¸­å¯ä»¥è§£å¯†ã€‚

è§£å¯†ç¨‹åºçš„ Github åœ°å€ https://github.com/MetaMask/vault-decryptor

### 2.5.Â éƒ¨ç½²åˆçº¦

è¿™é‡Œå‡è®¾ä½ å·²ç»å®‰è£… MetaMask é’±åŒ…ï¼Œå¹¶ä¸”åˆ›å»ºäº†è´¦å·ï¼Œè´¦å·æœ‰è¶³å¤Ÿçš„ ETH ç”¨æ¥åˆ›å»ºåˆçº¦ã€‚

æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªåˆçº¦

```

pragma solidity â°.4.24;

/******************************************/
/*       Netkiller ADVANCED TOKEN         */
/******************************************/
/* Author netkiller <netkiller@msn.com>   */
/* Home http://www.netkiller.cn           */
/* Version 2018-05-23                     */
/******************************************/

contract NetkillerMiniToken {
    address public owner;
    // Public variables of the token
    string public name;
    string public symbol;
    uint public decimals;
    // 18 decimals is the strongly suggested default, avoid changing it
    uint256 public totalSupply;

    // This creates an array with all balances
    mapping (address => uint256) public balanceOf;
    mapping (address => mapping (address => uint256)) public allowance;

    // This generates a public event on the blockchain that will notify clients
    event Transfer(address indexed from, address indexed to, uint256 value);
    event Approval(address indexed owner, address indexed spender, uint256 value);

    /**
     * Constrctor function
     *
     * Initializes contract with initial supply tokens to the creator of the contract
     */
    constructor(
        uint256 initialSupply,
        string tokenName,
        string tokenSymbol,
        uint decimalUnits
    ) public {
        owner = msg.sender;
        name = tokenName;                                   // Set the name for display purposes
        symbol = tokenSymbol; 
        decimals = decimalUnits;
        totalSupply = initialSupply * 10 ** uint256(decimals);  // Update total supply with the decimal amount
        balanceOf[msg.sender] = totalSupply;                // Give the creator all initial token
    }

    modifier onlyOwner {
        require(msg.sender == owner);
        _;
    }

    function transferOwnership(address newOwner) onlyOwner public {
        if (newOwner != address(0)) {
            owner = newOwner;
        }
    }

    /* Internal transfer, only can be called by this contract */
    function _transfer(address _from, address _to, uint _value) internal {
        require (_to != 0x0);                               // Prevent transfer to 0x0 address. Use burn() instead
        require (balanceOf[_from] >= _value);               // Check if the sender has enough
        require (balanceOf[_to] + _value > balanceOf[_to]); // Check for overflows
        balanceOf[_from] -= _value;                         // Subtract from the sender
        balanceOf[_to] += _value;                           // Add the same to the recipient
        emit Transfer(_from, _to, _value);
    }

    /**
     * Transfer tokens
     *
     * Send `_value` tokens to `_to` from your account
     *
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transfer(address _to, uint256 _value) public {
        _transfer(msg.sender, _to, _value);
    }

    /**
     * Transfer tokens from other address
     *
     * Send `_value` tokens to `_to` in behalf of `_from`
     *
     * @param _from The address of the sender
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) {
        require(_value <= allowance[_from][msg.sender]);     // Check allowance
        allowance[_from][msg.sender] -= _value;
        _transfer(_from, _to, _value);
        return true;
    }

    /**
     * Set allowance for other address
     *
     * Allows `_spender` to spend no more than `_value` tokens in your behalf
     *
     * @param _spender The address authorized to spend
     * @param _value the max amount they can spend
     */
    function approve(address _spender, uint256 _value) public returns (bool success) {
        allowance[msg.sender][_spender] = _value;
        emit Approval(msg.sender, _spender, _value);
        return true;
    }
}

```

ç°åœ¨æ‰“å¼€ https://remix.ethereum.org/

| ![](img/remix.png) |

ç‚¹å‡»â€œ+â€åŠ å·åˆ›å»ºåˆçº¦ï¼Œåˆçº¦åç§° NetkillerToken, ç¼–è¯‘åˆçº¦ã€‚è¿›å…¥ â€œRunâ€ é€‰é¡¹å¡è¿è¡Œåˆçº¦

| ![](img/remix-transact.png) |

Environment è®¾ç½®ä¸º Injected Web3 è¿™æ—¶å¯ä»¥çœ‹åˆ° MetaMask ä¸­çš„è´¦å·ä»¥åŠä½™é¢, ç„¶åè®¾ç½®æ„é€ æ–¹æ³•ï¼Œæœ€åç‚¹å‡»â€œtransactâ€æŒ‰é’®å¼€å§‹éƒ¨ç½²åˆçº¦ã€‚

| ![](img/remix-metamask.png) |

ç¡®è®¤æ‰‹ç»­è´¹

| ![](img/remix-console.png) |

remix æ˜¾ç¤ºå‡º TX Hash è¡¨ç¤ºå®Œæˆã€‚

## 3.Â MyEtherWallet

[`www.myetherwallet.com/`](https://www.myetherwallet.com/)

### 3.1.Â æ‰§è¡Œ ERC20 æ™ºèƒ½åˆçº¦å‡½æ•°

é¦–å…ˆé€‰æ‹©ç½‘ç»œï¼Œä¾‹å¦‚ä¸»ç½‘ï¼Œæµ‹è¯•ç½‘ï¼Œç„¶åå¡«å†™åˆçº¦åœ°å€ï¼Œç²˜è´´ ABIï¼Œç‚¹å‡» ACCESS æŒ‰é’®

| ![](img/contact.png) |

#### 3.1.1.Â æŸ¥è¯¢ä½™é¢

é€‰æ‹©åˆçº¦æ–¹æ³•ï¼Œè¾“å…¥å‚æ•°ï¼Œæ‰§è¡Œåå¯ä»¥çœ‹åˆ°ç»“æœï¼Œè¿™é‡Œä»…ä»…æ¼”ç¤ºæŸ¥è¯¢ä½™é¢çš„æ–¹æ³•ã€‚

| ![](img/balanceOf.png) |

#### 3.1.2.Â é”€æ¯ä»£å¸

ä»åˆçº¦çš„ Owner è´¦å·ä¸­é”€æ¯ä¸€å®šæ•°é¢çš„ä»£å¸

| ![](img/burn.png) |

ä»æŒ‡å®šè´¦å·ä¸­é”€æ¯ä¸€å®šæ•°é¢çš„ä»£å¸

| ![](img/burnFrom.png) |

#### 3.1.3.Â å†»ç»“è´¦å·

å†»ç»“è´¦å·,è¾“å…¥åœ°å€ï¼Œç„¶åé€‰æ‹© True æœ€åç‚¹å‡»æŒ‰é’® Write

| ![](img/freezeAccount.png) |

è§£å†»è´¦å·ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œé€‰æ‹© False ç„¶åç‚¹å‡» Write æŒ‰é’®ã€‚

æŸ¥è¯¢è´¦å·çŠ¶æ€ï¼Œè¾“å…¥åœ°å€ï¼Œç‚¹å‡» Write æŒ‰é’®ï¼Œè¿”å› True è¡¨ç¤ºè´¦å·è¢«å†»ç»“ï¼Œè¿”å› False æˆ– ç©ºå€¼ï¼Œè¡¨ç¤ºæ²¡æœ‰å†»ç»“ã€‚

| ![](img/frozenAccount.png) |

#### 3.1.4.Â å¢å‘ä»£å¸

è¾“å…¥éœ€è¦å¢å‘åˆ°é‚£ä¸ªåœ°å€ï¼Œç„¶åè¾“å…¥å¢å‘æ•°é‡

| ![](img/mintToken.png) |

#### 3.1.5.Â é”ä»“

å†»ç»“æ˜¯é’ˆå¯¹å•ä¸ªç”¨æˆ·çš„ï¼Œå¦‚æœä½ éœ€è¦åœæ­¢ä¸€åˆ‡äº¤æ˜“ï¼ˆä»»ä½•è´¦å·éƒ½ä¸èƒ½è½¬å…¥ï¼Œè½¬å‡ºï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥é‡‡ç”¨é”ä»“æ–¹æ¡ˆã€‚

| ![](img/setLock.png) |

True è¡¨ç¤ºå¼€å¯é”ä»“ï¼Œ False è¡¨ç¤ºå…³é—­é”ä»“ã€‚

#### 3.1.6.Â æ‰¹é‡æ‰“å¸

ä¸€æ¬¡æ€§å¯¹å¤šä¸ªè´¦å·æ‰“å¸ï¼Œè¾“å…¥è´¦å·ä½¿ç”¨é€—å·åˆ†éš”ï¼ˆåŠè§’ï¼‰ï¼Œç„¶åè¾“å…¥æ•°é‡ã€‚

| ![](img/transferBatch.png) |

#### 3.1.7.Â ä¿®æ”¹åˆçº¦ç®¡ç†è€…

åˆçº¦çš„ç®¡ç†è€…æ‹¥æœ‰ä¸Šé¢æ‰€æœ‰æƒé™ï¼Œå¦‚æœä½ æƒ³è½¬ç§»ç»™å…¶ä»–è´¦å·ï¼Œä½¿ç”¨ä¸‹é¢æ–¹æ³•æ“ä½œå³å¯ã€‚

| ![](img/transferOwnership.png) |

#### 3.1.8.Â è®¾ç½®å…‘æ¢æ¯”ä¾‹

å°† ETH å‘é€åˆ°åˆçº¦çŸ¥é“ï¼Œè¿”å› ETH * buyPrice æ•°é‡çš„ Token

| ![](img/setPrices.png) |

#### 3.1.9.Â ç©ºæŠ•è®¾ç½®

è®¾ç½®ç©ºæŠ•æ€»é‡

| ![](img/setAirdropTotalSupply.png) |

æ¢ç®— ETH åˆ° WEI [`etherconverter.online/`](https://etherconverter.online/) ä¾‹å¦‚ä½ éœ€è¦ç©ºæŠ• 1.5 ä¸ª Tokenï¼Œè¯·åœ¨ä¸‹é¢å¡«å†™ 1500000000000000000

| ![](img/eth2wei.png) |

è®¾ç½®ç©ºæŠ•æ•°é‡

| ![](img/setAirdropAmount.png) |

## 4.Â MyCrypto

[`www.mycrypto.com/`](https://www.mycrypto.com/)

## 5.Â imToken

[`token.im`](https://token.im)

### 5.1.Â æ·»åŠ  Token

å…·ä½“æ•™ç¨‹è¯·å‚è€ƒ: [`github.com/consenlabs/token-profile/blob/master/README.md`](https://github.com/consenlabs/token-profile/blob/master/README.md)

åˆ›å»ºæ–‡ä»¶ token-profile/erc20/0x4488ed050cd13ccfe0b0fcf3d168216830142775.json

```

{
  "symbol": "NBRC",
  "address": "0x4488ed050cd13ccfe0b0fcf3d168216830142775",
  "overview":{
        "en":"Netkiller eBook Reader Coin."
  },
  "email": "netkiller@msn.com",
  "website": "https://www.netkiller.cn/",
  "whitepaper": "https://www.netkiller.cn/file.pdf",
  "state": "LOCKED",
  "published_on": "2018-06-01",
  "initial_price":{
        "ETH":"0.00166666 ETH",
        "USD":"0.7 USD",
        "BTC":"0.00004137 BTC"
  },
  "links": {
    "blog": "https://my.oschina.net/neochen/blog",
    "telegram": "https://t.me/joinchat/netkiller",
    "github": "https://github.com/netkiller/netkiller.github.io",
    "facebook": "https://www.facebook.com/bg7nyt",
  }
}

```

## ç¬¬Â 13Â ç« Â Token

### *ERC ä»£å¸æ ‡å‡†*

## 1.Â Ethereum Wallet åˆ›å»º ERC20 ä»£å¸åˆçº¦

[`ethereum.org/token`](https://ethereum.org/token)

### 1.1.Â åˆçº¦æ–‡ä»¶

```

pragma solidity â°.4.16;

interface tokenRecipient { function receiveApproval(address _from, uint256 _value, address _token, bytes _extraData) public; }

contract TokenERC20 {
    // Public variables of the token
    string public name;
    string public symbol;
    uint8 public decimals = 18;
    // 18 decimals is the strongly suggested default, avoid changing it
    uint256 public totalSupply;

    // This creates an array with all balances
    mapping (address => uint256) public balanceOf;
    mapping (address => mapping (address => uint256)) public allowance;

    // This generates a public event on the blockchain that will notify clients
    event Transfer(address indexed from, address indexed to, uint256 value);

    // This notifies clients about the amount burnt
    event Burn(address indexed from, uint256 value);

    /**
     * Constrctor function
     *
     * Initializes contract with initial supply tokens to the creator of the contract
     */
    function TokenERC20(
        uint256 initialSupply,
        string tokenName,
        string tokenSymbol
    ) public {
        totalSupply = initialSupply * 10 ** uint256(decimals);  // Update total supply with the decimal amount
        balanceOf[msg.sender] = totalSupply;                // Give the creator all initial tokens
        name = tokenName;                                   // Set the name for display purposes
        symbol = tokenSymbol;                               // Set the symbol for display purposes
    }

    /**
     * Internal transfer, only can be called by this contract
     */
    function _transfer(address _from, address _to, uint _value) internal {
        // Prevent transfer to 0x0 address. Use burn() instead
        require(_to != 0x0);
        // Check if the sender has enough
        require(balanceOf[_from] >= _value);
        // Check for overflows
        require(balanceOf[_to] + _value > balanceOf[_to]);
        // Save this for an assertion in the future
        uint previousBalances = balanceOf[_from] + balanceOf[_to];
        // Subtract from the sender
        balanceOf[_from] -= _value;
        // Add the same to the recipient
        balanceOf[_to] += _value;
        Transfer(_from, _to, _value);
        // Asserts are used to use static analysis to find bugs in your code. They should never fail
        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);
    }

    /**
     * Transfer tokens
     *
     * Send `_value` tokens to `_to` from your account
     *
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transfer(address _to, uint256 _value) public {
        _transfer(msg.sender, _to, _value);
    }

    /**
     * Transfer tokens from other address
     *
     * Send `_value` tokens to `_to` on behalf of `_from`
     *
     * @param _from The address of the sender
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) {
        require(_value <= allowance[_from][msg.sender]);     // Check allowance
        allowance[_from][msg.sender] -= _value;
        _transfer(_from, _to, _value);
        return true;
    }

    /**
     * Set allowance for other address
     *
     * Allows `_spender` to spend no more than `_value` tokens on your behalf
     *
     * @param _spender The address authorized to spend
     * @param _value the max amount they can spend
     */
    function approve(address _spender, uint256 _value) public
        returns (bool success) {
        allowance[msg.sender][_spender] = _value;
        return true;
    }

    /**
     * Set allowance for other address and notify
     *
     * Allows `_spender` to spend no more than `_value` tokens on your behalf, and then ping the contract about it
     *
     * @param _spender The address authorized to spend
     * @param _value the max amount they can spend
     * @param _extraData some extra information to send to the approved contract
     */
    function approveAndCall(address _spender, uint256 _value, bytes _extraData)
        public
        returns (bool success) {
        tokenRecipient spender = tokenRecipient(_spender);
        if (approve(_spender, _value)) {
            spender.receiveApproval(msg.sender, _value, this, _extraData);
            return true;
        }
    }

    /**
     * Destroy tokens
     *
     * Remove `_value` tokens from the system irreversibly
     *
     * @param _value the amount of money to burn
     */
    function burn(uint256 _value) public returns (bool success) {
        require(balanceOf[msg.sender] >= _value);   // Check if the sender has enough
        balanceOf[msg.sender] -= _value;            // Subtract from the sender
        totalSupply -= _value;                      // Updates totalSupply
        Burn(msg.sender, _value);
        return true;
    }

    /**
     * Destroy tokens from other account
     *
     * Remove `_value` tokens from the system irreversibly on behalf of `_from`.
     *
     * @param _from the address of the sender
     * @param _value the amount of money to burn
     */
    function burnFrom(address _from, uint256 _value) public returns (bool success) {
        require(balanceOf[_from] >= _value);                // Check if the targeted balance is enough
        require(_value <= allowance[_from][msg.sender]);    // Check allowance
        balanceOf[_from] -= _value;                         // Subtract from the targeted balance
        allowance[_from][msg.sender] -= _value;             // Subtract from the sender's allowance
        totalSupply -= _value;                              // Update totalSupply
        Burn(_from, _value);
        return true;
    }
}

```

### 1.2.Â éƒ¨ç½²åˆçº¦

å¯åŠ¨ Ethereum Walletï¼Œç‚¹å‡» CONTRACTS æŒ‰é’®ï¼Œè¿›å…¥åˆçº¦ç®¡ç†ç•Œé¢

| ![](img/coin1.png) |

ç‚¹å‡» DEPLOY NEW CONTRACT æŒ‰é’®ï¼Œéƒ¨ç½²ä¸€ä¸ªæ–°åˆçº¦

| ![](img/coin2.png) |

å¤åˆ¶ç²˜è´´åˆçº¦æ–‡ä»¶åˆ° SOLIDITY CONTRACT SOURCE CODE ä¸‹æ–¹

SELECT CONTRACT TO DEPLOY åˆ—è¡¨é€‰æ‹© â€œToken ERC 20â€

Initial supply æ˜¯åˆå§‹å‘è¡Œè´§å¸é‡

Token name æ˜¯ä»£å¸åç§°

Token symbol æ˜¯ä»£å¸ç¬¦å·

| ![](img/coin3.png) |

æ‹‰åŠ¨æ»šåŠ¨è°ƒï¼Œæ‰¾åˆ°ä¸‹æ–¹ â€œDEPLOYâ€æŒ‰é’®ï¼Œç‚¹å‡»è¯¥æŒ‰é’®ã€‚

| ![](img/coin4.png) |

è¾“å…¥è´¦å·å¯†ç ï¼Œå¹¶ç‚¹å‡»â€œSEND TRANSACTIONâ€ æŒ‰é’®ã€‚

| ![](img/coin5.png) |

ERC20 ä»£å¸åˆ›å»ºå®Œæˆ

### 1.3.Â ä»£å¸è½¬è´¦

è¿›å…¥é’±åŒ…å¯ä»¥çœ‹åˆ°å½“å‰è´¦å·çš„ä»¥å¤ªå¸æ•°é‡ï¼Œåœ¨ä¸‹æ–¹è¿˜èƒ½çœ‹åˆ° ERC20 ä»£å¸ã€‚

| ![](img/coin6.png) |

ç‚¹å‡» SEND æŒ‰é’®

| ![](img/coin7.png) |

å¡«å†™ TO åœ°å€ å’Œ ä»£å¸ 500 ä¸ªï¼Œç‚¹å‡» SEND æŒ‰é’®

| ![](img/coin8.png) |

è¿›å…¥ç›®æ ‡è´¦å·æŸ¥çœ‹ä½™é¢ã€‚

| ![](img/coin9.png) |

### 1.4.Â Verify And Publish

æŸ¥çœ‹åˆçº¦æ‰§è¡ŒçŠ¶æ€ç­‰å¾…æ‰§è¡Œå®Œæˆ TxReceipt Status:Success

| ![](img/transaction.png) |

ç‚¹å‡»åˆçº¦åœ°å€ï¼ŒæŸ¥çœ‹åˆçº¦

| ![](img/contract.png) |

è¿›å…¥ Code é€‰é¡¹å¡ï¼Œç‚¹å‡» Verify And Publish æŒ‰é’®

| ![](img/code.png) |

è¾“å…¥åˆçº¦åç§° Contract Nameï¼Œé€‰æ‹©ç¼–è¯‘å™¨ç‰ˆæœ¬ Compilerï¼Œç‚¹å‡» Fetch From Gist æŒ‰é’®è¾“å…¥ Gist ä¸Šçš„åˆçº¦åœ°å€ã€‚

| ![](img/gist.png) |

Optimization é€‰æ‹© Yes

| ![](img/verify-and-publish.png) |

å‹¾é€‰éªŒè¯ç , ç„¶åç‚¹å‡» Verify And Publish æŒ‰é’®

| ![](img/captcha.png) |

åˆçº¦æ ¡éªŒæˆåŠŸ

| ![](img/done.png) |

### 1.5.Â Links é“¾æ¥æ›´æ–°

| ![](img/update.png) |

| ![](img/submit.png) |

| ![](img/sign_message.png) |

å¤åˆ¶ç­¾åä¿¡æ¯

è¿›å…¥ MyEtherWallet ç­¾åé¡µé¢ [`www.myetherwallet.com/signmsg.html`](https://www.myetherwallet.com/signmsg.html)

ç²˜è´´ç­¾åä¿¡æ¯

| ![](img/verify_message.png) |

é€‰æ‹©ç§é’¥ç­¾å

| ![](img/private_key.png) |

è§£é”è´¦å·

| ![](img/unlock.png) |

ç­¾åï¼Œå¤åˆ¶ sig çš„å€¼

| ![](img/signature.png) |

ç²˜è´´ sigï¼Œç„¶åç‚¹å‡» Verify æŒ‰é’®

| ![](img/signature_hash.png) |

| ![](img/fill_in_form.png) |

| ![](img/fill_in_form1.png) |

ä¿¡æ¯å¡«å†™å®Œæˆåç‚¹å‡»â€œSend Messageâ€ ä¿å­˜

| ![](img/done.png) |

## 2.Â ERC20 Token Solidity 0.4.24

[`theethereum.wiki/w/index.php/ERC20_Token_Standard`](https://theethereum.wiki/w/index.php/ERC20_Token_Standard)

ERC20 â€œæè¿°äº†å®ç°ä»£å¸åˆçº¦çš„æ ‡å‡†åŠŸèƒ½â€ï¼ŒERC20 æ˜¯å„ä¸ªä»£å¸çš„æ ‡å‡†æ¥å£ã€‚ERC20 ä»£å¸ä»…ä»…æ˜¯ä»¥å¤ªåŠä»£å¸çš„å­é›†ã€‚ä¸ºäº†å……åˆ†å…¼å®¹ ERC20ï¼Œå¼€å‘è€…éœ€è¦å°†ä¸€ç»„ç‰¹å®šçš„å‡½æ•°é›†æˆåˆ°ä»–ä»¬çš„æ™ºèƒ½åˆçº¦ä¸­ï¼Œä»¥ä¾¿åœ¨é«˜å±‚é¢èƒ½å¤Ÿæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

ERC20 æä¾›çš„æ–¹æ³•

*   è·å¾—ä»£å¸æ€»ä¾›åº”é‡

*   è·å¾—è´¦æˆ·ä½™é¢

*   è½¬è®©ä»£å¸

*   æ‰¹å‡†èŠ±è´¹ä»£å¸

### 2.1.Â æ„é€ æ–¹æ³•

åŸåˆçº¦

```

pragma solidity â°.4.21;

contract NetkillerToken {
  address public owner;
  string public name;
  string public symbol;
  uint public decimals;
  uint256 public totalSupply;

  event Transfer(address indexed from, address indexed to, uint256 value);

  /* This creates an array with all balances */
  mapping (address => uint256) public balanceOf;

  function NetkillerToken(uint256 initialSupply, string tokenName, string tokenSymbol, uint decimalUnits) public {
    owner = msg.sender;
    name = tokenName;
    symbol = tokenSymbol;
    decimals = decimalUnits;
    totalSupply = initialSupply * 10 ** uint256(decimals);
    balanceOf[msg.sender] = totalSupply;
  }

  /* Send coins */
  function transfer(address _to, uint256 _value) public {
    /* Check if the sender has balance and for overflows */
    require(balanceOf[msg.sender] >= _value && balanceOf[_to] + _value >= balanceOf[_to]);

    /* Add and subtract new balances */
    balanceOf[msg.sender] -= _value;
    balanceOf[_to] += _value;

    /* Notify anyone listening that this transfer took place */
    emit Transfer(msg.sender, _to, _value);
  }
}

```

æ–°ç‰ˆåˆçº¦

```

pragma solidity â°.4.24;

contract NetkillerToken {
  address public owner;
  string public name;
  string public symbol;
  uint public decimals;
  uint256 public totalSupply;

  event Transfer(address indexed from, address indexed to, uint256 value);

  /* This creates an array with all balances */
  mapping (address => uint256) public balanceOf;

  constructor(uint256 initialSupply, string tokenName, string tokenSymbol, uint decimalUnits) public {
    owner = msg.sender;
    name = tokenName;
    symbol = tokenSymbol;
    decimals = decimalUnits;
    totalSupply = initialSupply * 10 ** uint256(decimals);
    balanceOf[msg.sender] = totalSupply;
  }

  /* Send coins */
  function transfer(address _to, uint256 _value) public {
    /* Check if the sender has balance and for overflows */
    require(balanceOf[msg.sender] >= _value && balanceOf[_to] + _value >= balanceOf[_to]);

    /* Add and subtract new balances */
    balanceOf[msg.sender] -= _value;
    balanceOf[_to] += _value;

    /* Notify anyone listening that this transfer took place */
    emit Transfer(msg.sender, _to, _value);
  }
}

```

### 2.2.Â å®˜æ–¹è§„å®š Method æ–¹æ³•

æ‰€æœ‰çš„ ERC20 ä»£å¸éƒ½æ˜¯æŒ‰ç…§ä¸‹é¢è¿™äº›æ–¹æ³•æ¥å®šä¹‰çš„ã€‚ä¸‹é¢æˆ‘ä»¬è®²è§£ä¸€ä¸‹æ¯ä¸ªæ–¹æ³•çš„ä½œç”¨ã€‚

#### 2.2.1.Â name

function name() view public returns (string name)

è¿”å› string ç±»å‹çš„ ERC20 ä»£å¸çš„åå­—ï¼Œä¾‹å¦‚ï¼šNetkiller Reader Coin

#### 2.2.2.Â symbol

function symbol() view public returns (string symbol)

è¿”å› string ç±»å‹çš„ ERC20 ä»£å¸çš„ç¬¦å·ï¼Œä¹Ÿå°±æ˜¯ä»£å¸çš„ç®€ç§°ï¼Œä¾‹å¦‚ï¼šNRCã€‚

#### 2.2.3.Â decimals

function decimals() view public returns (uint decimals)

æ”¯æŒå‡ ä½å°æ•°ç‚¹åå‡ ä½ã€‚å¦‚æœè®¾ç½®ä¸º 3ã€‚ä¹Ÿå°±æ˜¯æ”¯æŒ 0.001 è¡¨ç¤ºã€‚

#### 2.2.4.Â totalSupply

function totalSupply() view public returns (uint256 totalSupply)

å‘è¡Œä»£å¸çš„æ€»é‡ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥è·å–ã€‚æ‰€æœ‰æ™ºèƒ½åˆçº¦å‘è¡Œçš„ä»£å¸æ€»é‡æ˜¯ä¸€å®šçš„ï¼ŒtotalSupply å¿…é¡»è®¾ç½®åˆå§‹å€¼ã€‚

#### 2.2.5.Â balanceOf

function balanceOf(address _owner) public returns (uint256 balance)

è¾“å…¥åœ°å€ï¼Œå¯ä»¥è·å–è¯¥åœ°å€ä»£å¸çš„ä½™é¢ã€‚

#### 2.2.6.Â transfer

function transfer(address _to, uint256 _value) public returns (bool success)

è°ƒç”¨ transfer å‡½æ•°å°†è‡ªå·±çš„ token è½¬è´¦ç»™ _to åœ°å€ï¼Œ_value ä¸ºè½¬è´¦é‡‘é¢

#### 2.2.7.Â approve

function approve(address _spender, uint256 _value) public returns (bool success)

æ‰¹å‡† _spender è´¦æˆ·ä»è‡ªå·±çš„è´¦æˆ·è½¬ç§» _value ä¸ª tokenã€‚å¯ä»¥åˆ†å¤šæ¬¡è½¬ç§»ã€‚

#### 2.2.8.Â transferFrom

function transferFrom(address _from, address _to, uint256 _value) public returns (bool success)

ä¸ approve æ­é…ä½¿ç”¨ï¼Œapprove æ‰¹å‡†ä¹‹åï¼Œè°ƒç”¨ transferFrom å‡½æ•°æ¥è½¬ç§» tokenã€‚

#### 2.2.9.Â allowance

function allowance(address _owner, address _spender) public returns (uint256 remaining)

è¿”å› _spender è¿˜èƒ½æå– token çš„ä¸ªæ•°ã€‚

approveã€transferFrom åŠ allowance è§£é‡Šï¼šè´¦æˆ· A æœ‰ 1000 ä¸ªä»£å¸ï¼Œæƒ³å…è®¸ B è´¦æˆ·éšæ„è°ƒç”¨ 100 ä¸ªä»£å¸ã€‚A è´¦æˆ·æŒ‰ç…§ä»¥ä¸‹å½¢å¼è°ƒç”¨ approve å‡½æ•° approve(B,100)ã€‚å½“ B è´¦æˆ·æƒ³ç”¨è¿™ 100 ä¸ªä»£å¸ä¸­çš„ 10 ä¸ªä»£å¸ç»™ C è´¦æˆ·æ—¶ï¼Œåˆ™è°ƒç”¨ transferFrom(A, C, 10)ã€‚è¿™æ—¶è°ƒç”¨ allowance(A, B)å¯ä»¥æŸ¥çœ‹ B è´¦æˆ·è¿˜èƒ½å¤Ÿè°ƒç”¨ A è´¦æˆ·å¤šå°‘ä¸ª tokenã€‚

### 2.3.Â äº‹ä»¶

#### 2.3.1.Â Transfer

event Transfer(address indexed _from, address indexed _to, uint256 _value)

å½“æˆåŠŸè½¬ç§» token æ—¶ï¼Œä¸€å®šè¦è§¦å‘ Transfer äº‹ä»¶

#### 2.3.2.Â Approval

event Approval(address indexed _owner, address indexed _spender, uint256 _value)

å½“è°ƒç”¨ approval å‡½æ•°æˆåŠŸæ—¶ï¼Œä¸€å®šè¦è§¦å‘ Approval äº‹ä»¶

## 3.Â Netkiller Crowdsale Contract

### 3.1.Â Solidity 0.4.24

```

pragma solidity â°.4.24;

/******************************************/
/*      Netkiller Crowdsale Contract      */
/******************************************/
/* Author netkiller <netkiller@msn.com>   */
/* Home http://www.netkiller.cn           */
/* Version 2018-06-07 - Solc ver: 0.4.24  */
/******************************************/

interface token {
    function transfer(address receiver, uint amount) external;
}

contract Crowdsale {
    address public beneficiary;
    uint public fundingGoal;
    uint public amountRaised;
    uint public deadline;
    uint public price;
    token public tokenReward;
    mapping(address => uint256) public balanceOf;
    bool fundingGoalReached = false;
    bool crowdsaleClosed = false;

    event GoalReached(address recipient, uint totalAmountRaised);
    event FundTransfer(address backer, uint amount, bool isContribution);

    /**
     * Constructor function
     *
     * Setup the owner
     */
    constructor(
        address ifSuccessfulSendTo,
        uint fundingGoalInEthers,
        uint durationInMinutes,
        uint etherCostOfEachToken,
        address addressOfTokenUsedAsReward
    ) public {
        beneficiary = ifSuccessfulSendTo;
        fundingGoal = fundingGoalInEthers * 1 ether;
        deadline = now + durationInMinutes * 1 minutes;
        price = etherCostOfEachToken * 1 ether;
        tokenReward = token(addressOfTokenUsedAsReward);
    }

    /**
     * Fallback function
     *
     * The function without name is the default function that is called whenever anyone sends funds to a contract
     */
    function () payable public{
        require(!crowdsaleClosed);
        uint amount = msg.value;
        balanceOf[msg.sender] += amount;
        amountRaised += amount;
        tokenReward.transfer(msg.sender, amount / price);
        emit FundTransfer(msg.sender, amount, true);
    }

    modifier afterDeadline() { if (now >= deadline) _; }

    /**
     * Check if goal was reached
     *
     * Checks if the goal or time limit has been reached and ends the campaign
     */
    function checkGoalReached() afterDeadline public{
        if (amountRaised >= fundingGoal){
            fundingGoalReached = true;
            emit GoalReached(beneficiary, amountRaised);
        }
        crowdsaleClosed = true;
    }

    /**
     * Withdraw the funds
     *
     * Checks to see if goal or time limit has been reached, and if so, and the funding goal was reached,
     * sends the entire amount to the beneficiary. If goal was not reached, each contributor can withdraw
     * the amount they contributed.
     */
    function safeWithdrawal() afterDeadline public{
        if (!fundingGoalReached) {
            uint amount = balanceOf[msg.sender];
            balanceOf[msg.sender] = 0;
            if (amount > 0) {
                if (msg.sender.send(amount)) {
                    emit FundTransfer(msg.sender, amount, false);
                } else {
                    balanceOf[msg.sender] = amount;
                }
            }
        }

        if (fundingGoalReached && beneficiary == msg.sender) {
            if (beneficiary.send(amountRaised)) {
                emit FundTransfer(beneficiary, amountRaised, false);
            } else {
                //If we fail to send the funds to beneficiary, unlock funders balance
                fundingGoalReached = false;
            }
        }
    }
}

```

### 3.2.Â Solidity 0.4.21

```

pragma solidity â°.4.21;

interface token {
    function transfer(address receiver, uint amount) external;
}

contract Crowdsale {
    address public beneficiary; // å‹Ÿèµ„æˆåŠŸåçš„æ”¶æ¬¾åœ°å€
    uint public fundingGoal;    // å‹Ÿèµ„é¢åº¦
    uint public amountRaised;   // å‚ä¸æ•°é‡
    uint public deadline;       // å‹Ÿèµ„æˆªæ­¢æœŸ

    uint public price;          // token ä¸ä»¥å¤ªåŠçš„æ±‡ç‡, token å–å¤šå°‘é’±
    token public tokenReward;   // è¦å–çš„ token

    mapping(address => uint256) public balanceOf;

    bool fundingGoalReached = false;    // ä¼—ç­¹æ˜¯å¦è¾¾åˆ°ç›®æ ‡
    bool crowdsaleClosed = false;       // ä¼—ç­¹æ˜¯å¦ç»“æŸ

    /**
    * äº‹ä»¶å¯ä»¥ç”¨æ¥è·Ÿè¸ªä¿¡æ¯
    **/
    event GoalReached(address recipient, uint totalAmountRaised);
    event FundTransfer(address backer, uint amount, bool isContribution);

    /**
     * æ„é€ å‡½æ•°, è®¾ç½®ç›¸å…³å±æ€§
     */
    function Crowdsale(
        address ifSuccessfulSendTo,
        uint fundingGoalInEthers,
        uint durationInMinutes,
        uint finneyCostOfEachToken,
        address addressOfTokenUsedAsReward) public {
            beneficiary = ifSuccessfulSendTo;					//å‹Ÿèµ„æˆåŠŸåçš„æ”¶æ¬¾è´¦å·
            fundingGoal = fundingGoalInEthers * 1 ether;		//å‹Ÿèµ„é¢åº¦
            deadline = now + durationInMinutes * 1 minutes;		//å‹Ÿèµ„æ—¶é—´
            price = finneyCostOfEachToken * 1 finney;			//æ¯ä¸ªä»£å¸çš„ä»·æ ¼, è¿™é‡Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨äº†å•ä½ finney åŠå€¼ä¸ºï¼š1 ï¼ˆ1 ether = 1000 finneyï¼‰
            tokenReward = token(addressOfTokenUsedAsReward);   	// ä»£å¸åˆçº¦åœ°å€ã€‚ä¼ å…¥å·²å‘å¸ƒçš„ token åˆçº¦çš„åœ°å€æ¥åˆ›å»ºå®ä¾‹
    }

    /**
     * æ— å‡½æ•°åçš„ Fallback å‡½æ•°ï¼Œ
     * åœ¨å‘åˆçº¦è½¬è´¦æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨
     */
    function () payable public {
        require(!crowdsaleClosed);
        uint amount = msg.value;
        balanceOf[msg.sender] += amount;
        amountRaised += amount;
        tokenReward.transfer(msg.sender, amount / price);
        emit FundTransfer(msg.sender, amount, true);
    }

    /**
    *  å®šä¹‰å‡½æ•°ä¿®æ”¹å™¨ modifier
    * ç”¨äºåœ¨å‡½æ•°æ‰§è¡Œå‰æ£€æŸ¥æŸç§å‰ç½®æ¡ä»¶ï¼ˆåˆ¤æ–­é€šè¿‡ä¹‹åæ‰ä¼šç»§ç»­æ‰§è¡Œè¯¥æ–¹æ³•ï¼‰
    * _ è¡¨ç¤ºç»§ç»­æ‰§è¡Œä¹‹åçš„ä»£ç 
    **/
    modifier afterDeadline() { if (now >= deadline) _; }

    /**
     * åˆ¤æ–­ä¼—ç­¹æ˜¯å¦å®Œæˆèèµ„ç›®æ ‡ï¼Œ è¿™ä¸ªæ–¹æ³•ä½¿ç”¨äº† afterDeadline å‡½æ•°ä¿®æ”¹å™¨
     *
     */
    function checkGoalReached() afterDeadline public{
        if (amountRaised >= fundingGoal) {
            fundingGoalReached = true;
            emit GoalReached(beneficiary, amountRaised);
        }
        crowdsaleClosed = true;
    }

    /**
     * å®Œæˆèèµ„ç›®æ ‡æ—¶ï¼Œèèµ„æ¬¾å‘é€åˆ°æ”¶æ¬¾æ–¹
     * æœªå®Œæˆèèµ„ç›®æ ‡æ—¶ï¼Œæ‰§è¡Œé€€æ¬¾
     *
     */
    function safeWithdrawal() afterDeadline public{
        if (!fundingGoalReached) {
            uint amount = balanceOf[msg.sender];
            balanceOf[msg.sender] = 0;
            if (amount > 0) {
                if (msg.sender.send(amount)) {
                    emit FundTransfer(msg.sender, amount, false);
                } else {
                    balanceOf[msg.sender] = amount;
                }
            }
        }

        if (fundingGoalReached && beneficiary == msg.sender) {
            if (beneficiary.send(amountRaised)) {
                emit FundTransfer(beneficiary, amountRaised, false);
            } else {
                //If we fail to send the funds to beneficiary, unlock funders balance
                fundingGoalReached = false;
            }
        }
    }
}			

```

## 4.Â ERC721 - Non-Fungible Tokens

### 4.1.Â 

```

interface ERC721 {

    event Transfer(address indexed _from, address indexed _to, uint256 indexed _tokenId);
    event Approval(address indexed _owner, address indexed _approved, uint256 indexed _tokenId);
    event ApprovalForAll(address indexed _owner, address indexed _operator, bool _approved);
    function balanceOf(address _owner) external view returns (uint256);
    function ownerOf(uint256 _tokenId) external view returns (address);
    function safeTransferFrom(address _from, address _to, uint256 _tokenId, bytes data) external payable;
    function safeTransferFrom(address _from, address _to, uint256 _tokenId) external payable;
    function transferFrom(address _from, address _to, uint256 _tokenId) external payable;
    function approve(address _approved, uint256 _tokenId) external payable;
    function setApprovalForAll(address _operator, bool _approved) external;
    function getApproved(uint256 _tokenId) external view returns (address);
    function isApprovedForAll(address _owner, address _operator) external view returns (bool);
}

interface ERC165 {
    function supportsInterface(bytes4 interfaceID) external view returns (bool);
}

interface ERC721TokenReceiver {
    function onERC721Received(address _operator, address _from, uint256 _tokenId, bytes _data) external returns(bytes4);
}			

```

### 4.2.Â ERC721Metadata (å¯é€‰)

å¯é€‰å®ç°æ¥å£ï¼ŒERC721Metadata æ¥å£ç”¨äºæä¾›åˆçº¦çš„å…ƒæ•°æ®ï¼šname , symbol åŠ URIï¼ˆNFT æ‰€å¯¹åº”çš„èµ„æºï¼‰ã€‚

```

å…¶æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š

interface ERC721Metadata /* is ERC721 */ {
    function name() external pure returns (string _name);
    function symbol() external pure returns (string _symbol);
    function tokenURI(uint256 _tokenId) external view returns (string);
}

æ¥å£è¯´æ˜ï¼š
name(): è¿”å›åˆçº¦åå­—ï¼Œå°½ç®¡æ˜¯å¯é€‰ï¼Œä½†å¼ºçƒˆå»ºè®®å®ç°ï¼Œå³ä¾¿æ˜¯è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚
symbol(): è¿”å›åˆçº¦ä»£å¸ç¬¦å·ï¼Œå°½ç®¡æ˜¯å¯é€‰ï¼Œä½†å¼ºçƒˆå»ºè®®å®ç°ï¼Œå³ä¾¿æ˜¯è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚
tokenURI(): è¿”å› _tokenId æ‰€å¯¹åº”çš„å¤–éƒ¨èµ„æºæ–‡ä»¶çš„ URIï¼ˆé€šå¸¸æ˜¯ IPFS æˆ– HTTP(S)è·¯å¾„ï¼‰ã€‚å¤–éƒ¨èµ„æºæ–‡ä»¶éœ€è¦åŒ…å«åå­—ã€æè¿°ã€å›¾ç‰‡ï¼Œå…¶æ ¼å¼çš„è¦æ±‚å¦‚ä¸‹ï¼š			

```

### 4.3.Â ERC721Enumerable ï¼ˆå¯é€‰ï¼‰

å¯é€‰å®ç°æ¥å£ï¼ŒERC721Enumerable çš„ä¸»è¦ç›®çš„æ˜¯æé«˜åˆçº¦ä¸­ NTF çš„å¯è®¿é—®æ€§ï¼Œå…¶æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š

```

interface ERC721Enumerable /* is ERC721 */ {
    function totalSupply() external view returns (uint256);
    function tokenByIndex(uint256 _index) external view returns (uint256);
    function tokenOfOwnerByIndex(address _owner, uint256 _index) external view returns (uint256);
}
æ¥å£è¯´æ˜ï¼š

totalSupply(): è¿”å› NFT æ€»é‡
tokenByIndex(): é€šè¿‡ç´¢å¼•è¿”å›å¯¹åº”çš„ tokenIdã€‚
tokenOfOwnerByIndex(): æ‰€æœ‰è€…å¯ä»¥ä¸€æ¬¡æ‹¥æœ‰å¤šä¸ªçš„ NFT, æ­¤å‡½æ•°è¿”å› _owner æ‹¥æœ‰çš„ NFT åˆ—è¡¨ä¸­å¯¹åº”ç´¢å¼•çš„ tokenIdã€‚			

```

## 5.Â ç»å…¸å‚è€ƒæ¡ˆä¾‹

ä¸€ä¸‹æ˜¯ä½œè€…å‘å¸ƒçš„åˆçº¦ï¼Œä¾›è¯»è€…å‚è€ƒ

### 5.1.Â Enterprise Token Ecosystem (ETE)

åˆçº¦åœ°å€ [`etherscan.io/address/0x6333050c7a025027b51a8039cbafd2584933299d#code`](https://etherscan.io/address/0x6333050c7a025027b51a8039cbafd2584933299d#code)

### 5.2.Â ç§¯åˆ†é“¾ (PE Chain)

åˆçº¦åœ°å€ [`etherscan.io/address/0x9bcf2ea3a9e18e550eba88c97a8bb6b7ea4f58b7#code`](https://etherscan.io/address/0x9bcf2ea3a9e18e550eba88c97a8bb6b7ea4f58b7#code)

### 5.3.Â Global star league chain (GSLC)

åˆçº¦åœ°å€ [`etherscan.io/token/0x7ffdcccc3e7e33c6163393195a947a6d45f25814`](https://etherscan.io/token/0x7ffdcccc3e7e33c6163393195a947a6d45f25814)

### 5.4.Â Kyber Network

åˆçº¦åœ°å€ [`etherscan.io/address/0xC14f34233071543E979F6A79AA272b0AB1B4947D#code`](https://etherscan.io/address/0xC14f34233071543E979F6A79AA272b0AB1B4947D#code)

è¯¥åˆçº¦å¯ä»¥å®ç°å¸å¸å…‘æ¢

## 6.Â ä»£å¸åˆçº¦å®˜æ–¹æ–‡æ¡£

### 6.1.Â ERC20

https://github.com/ethereum/EIPs/issues/20

https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md

åˆçº¦æºç ï¼šhttps://github.com/ConsenSys/Tokens/tree/master/contracts/eip20

[`theethereum.wiki/w/index.php/ERC20_Token_Standard`](https://theethereum.wiki/w/index.php/ERC20_Token_Standard)

```

 // ----------------------------------------------------------------------------
 // ERC20 Token Standard Interface
 // https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20-token-standard.md
 // ----------------------------------------------------------------------------
contract ERC20 {
      function name() constant returns (string name)
      function symbol() constant returns (string symbol)
      function decimals() constant returns (uint8 decimals)
      function totalSupply() constant returns (uint totalSupply);
      function balanceOf(address _owner) constant returns (uint balance);
      function transfer(address _to, uint _value) returns (bool success);
      function transferFrom(address _from, address _to, uint _value) returns (bool success);
      function approve(address _spender, uint _value) returns (bool success);
      function allowance(address _owner, address _spender) constant returns (uint remaining);
      event Transfer(address indexed _from, address indexed _to, uint _value);
      event Approval(address indexed _owner, address indexed _spender, uint _value);
}			

```

#### 6.1.1.Â åŸºæœ¬ Token å®˜æ–¹æä¾›çš„ä¾‹å­

è¿™ä¸ªä¾‹å­ä»…ä»…ç”¨æ¥åˆå­¦ä½¿ç”¨ï¼Œè¯·ä¸ç”¨ä½¿ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒã€‚

æä¾›ä¾‹å­çš„åœ°å€ï¼š [`ethereum.org/token`](https://ethereum.org/token)

è¿™ä¸ªä¾‹å­ä¸­æ²¡æœ‰æ¶‰åŠåˆçº¦ç®¡ç†è€…ï¼Œæ‰€ä»¥ä»»ä½•äººéƒ½å¯ä»¥æ“ä½œè¿™ä¸ªåˆçº¦ã€‚ä¾‹å¦‚è¿™ä¸ªå‡æŒçš„å‡½æ•° burn() äººäººéƒ½å¯ä»¥è°ƒç”¨ã€‚æ‰€ä»¥è¿™ä¸ªä¾‹å­åªèƒ½ç”¨æ¥å­¦ä¹  ERC20 åˆçº¦å¼€å‘ï¼Œç›¸å½“äº Helloword ç¨‹åºã€‚

```

pragma solidity â°.4.16;

interface tokenRecipient { function receiveApproval(address _from, uint256 _value, address _token, bytes _extraData) public; }

contract TokenERC20 {
    // Public variables of the token
    string public name;
    string public symbol;
    uint8 public decimals = 18;
    // 18 decimals is the strongly suggested default, avoid changing it
    uint256 public totalSupply;

    // This creates an array with all balances
    mapping (address => uint256) public balanceOf;
    mapping (address => mapping (address => uint256)) public allowance;

    // This generates a public event on the blockchain that will notify clients
    event Transfer(address indexed from, address indexed to, uint256 value);

    // This notifies clients about the amount burnt
    event Burn(address indexed from, uint256 value);

    /**
     * Constructor function
     *
     * Initializes contract with initial supply tokens to the creator of the contract
     */
    function TokenERC20(
        uint256 initialSupply,
        string tokenName,
        string tokenSymbol
    ) public {
        totalSupply = initialSupply * 10 ** uint256(decimals);  // Update total supply with the decimal amount
        balanceOf[msg.sender] = totalSupply;                // Give the creator all initial tokens
        name = tokenName;                                   // Set the name for display purposes
        symbol = tokenSymbol;                               // Set the symbol for display purposes
    }

    /**
     * Internal transfer, only can be called by this contract
     */
    function _transfer(address _from, address _to, uint _value) internal {
        // Prevent transfer to 0x0 address. Use burn() instead
        require(_to != 0x0);
        // Check if the sender has enough
        require(balanceOf[_from] >= _value);
        // Check for overflows
        require(balanceOf[_to] + _value > balanceOf[_to]);
        // Save this for an assertion in the future
        uint previousBalances = balanceOf[_from] + balanceOf[_to];
        // Subtract from the sender
        balanceOf[_from] -= _value;
        // Add the same to the recipient
        balanceOf[_to] += _value;
        Transfer(_from, _to, _value);
        // Asserts are used to use static analysis to find bugs in your code. They should never fail
        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);
    }

    /**
     * Transfer tokens
     *
     * Send `_value` tokens to `_to` from your account
     *
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transfer(address _to, uint256 _value) public {
        _transfer(msg.sender, _to, _value);
    }

    /**
     * Transfer tokens from other address
     *
     * Send `_value` tokens to `_to` on behalf of `_from`
     *
     * @param _from The address of the sender
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) {
        require(_value <= allowance[_from][msg.sender]);     // Check allowance
        allowance[_from][msg.sender] -= _value;
        _transfer(_from, _to, _value);
        return true;
    }

    /**
     * Set allowance for other address
     *
     * Allows `_spender` to spend no more than `_value` tokens on your behalf
     *
     * @param _spender The address authorized to spend
     * @param _value the max amount they can spend
     */
    function approve(address _spender, uint256 _value) public
        returns (bool success) {
        allowance[msg.sender][_spender] = _value;
        return true;
    }

    /**
     * Set allowance for other address and notify
     *
     * Allows `_spender` to spend no more than `_value` tokens on your behalf, and then ping the contract about it
     *
     * @param _spender The address authorized to spend
     * @param _value the max amount they can spend
     * @param _extraData some extra information to send to the approved contract
     */
    function approveAndCall(address _spender, uint256 _value, bytes _extraData)
        public
        returns (bool success) {
        tokenRecipient spender = tokenRecipient(_spender);
        if (approve(_spender, _value)) {
            spender.receiveApproval(msg.sender, _value, this, _extraData);
            return true;
        }
    }

    /**
     * Destroy tokens
     *
     * Remove `_value` tokens from the system irreversibly
     *
     * @param _value the amount of money to burn
     */
    function burn(uint256 _value) public returns (bool success) {
        require(balanceOf[msg.sender] >= _value);   // Check if the sender has enough
        balanceOf[msg.sender] -= _value;            // Subtract from the sender
        totalSupply -= _value;                      // Updates totalSupply
        Burn(msg.sender, _value);
        return true;
    }

    /**
     * Destroy tokens from other account
     *
     * Remove `_value` tokens from the system irreversibly on behalf of `_from`.
     *
     * @param _from the address of the sender
     * @param _value the amount of money to burn
     */
    function burnFrom(address _from, uint256 _value) public returns (bool success) {
        require(balanceOf[_from] >= _value);                // Check if the targeted balance is enough
        require(_value <= allowance[_from][msg.sender]);    // Check allowance
        balanceOf[_from] -= _value;                         // Subtract from the targeted balance
        allowance[_from][msg.sender] -= _value;             // Subtract from the sender's allowance
        totalSupply -= _value;                              // Update totalSupply
        Burn(_from, _value);
        return true;
    }
}

```

#### 6.1.2.Â å®˜æ–¹æä¾›çš„ä¾‹å­ ADVANCED TOKEN

æä¾›ä¾‹å­çš„åœ°å€ï¼š [`ethereum.org/token`](https://ethereum.org/token) ç½‘é¡µçš„ä¸‹æ–¹

è¿™ä¸ªä¾‹å­å·²ç»æ¯”è¾ƒå®Œå–„ï¼Œä½†ä»ä¸èƒ½å¤Ÿç”¨åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œå› ä¸º function burn(uint256 _value) public returns (bool success) ä»ç„¶æ²¡æœ‰æ§åˆ¶è®¿é—®æƒé™ã€‚

å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¿™ä¸ªåˆçº¦ä½ éœ€è¦ä¿®æ”¹ä¸¤å¤„

```

function burn(uint256 _value) public returns (bool success)
æ”¹ä¸º
function burn(uint256 _value) onlyOwner public returns (bool success)

function burnFrom(address _from, uint256 _value) public returns (bool success)
æ”¹ä¸º
function burnFrom(address _from, uint256 _value) onlyOwner public returns (bool success)

```

è¿™æ ·åˆçº¦å°±å¾ˆå®‰å…¨äº†ã€‚åªèƒ½åˆ›å»ºè€…å¯ä»¥å‡æŒä»£å¸ã€‚

```

pragma solidity â°.4.16;

contract owned {
    address public owner;

    function owned() public {
        owner = msg.sender;
    }

    modifier onlyOwner {
        require(msg.sender == owner);
        _;
    }

    function transferOwnership(address newOwner) onlyOwner public {
        owner = newOwner;
    }
}

interface tokenRecipient { function receiveApproval(address _from, uint256 _value, address _token, bytes _extraData) public; }

contract TokenERC20 {
    // Public variables of the token
    string public name;
    string public symbol;
    uint8 public decimals = 18;
    // 18 decimals is the strongly suggested default, avoid changing it
    uint256 public totalSupply;

    // This creates an array with all balances
    mapping (address => uint256) public balanceOf;
    mapping (address => mapping (address => uint256)) public allowance;

    // This generates a public event on the blockchain that will notify clients
    event Transfer(address indexed from, address indexed to, uint256 value);

    // This notifies clients about the amount burnt
    event Burn(address indexed from, uint256 value);

    /**
     * Constrctor function
     *
     * Initializes contract with initial supply tokens to the creator of the contract
     */
    function TokenERC20(
        uint256 initialSupply,
        string tokenName,
        string tokenSymbol
    ) public {
        totalSupply = initialSupply * 10 ** uint256(decimals);  // Update total supply with the decimal amount
        balanceOf[msg.sender] = totalSupply;                // Give the creator all initial tokens
        name = tokenName;                                   // Set the name for display purposes
        symbol = tokenSymbol;                               // Set the symbol for display purposes
    }

    /**
     * Internal transfer, only can be called by this contract
     */
    function _transfer(address _from, address _to, uint _value) internal {
        // Prevent transfer to 0x0 address. Use burn() instead
        require(_to != 0x0);
        // Check if the sender has enough
        require(balanceOf[_from] >= _value);
        // Check for overflows
        require(balanceOf[_to] + _value > balanceOf[_to]);
        // Save this for an assertion in the future
        uint previousBalances = balanceOf[_from] + balanceOf[_to];
        // Subtract from the sender
        balanceOf[_from] -= _value;
        // Add the same to the recipient
        balanceOf[_to] += _value;
        Transfer(_from, _to, _value);
        // Asserts are used to use static analysis to find bugs in your code. They should never fail
        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);
    }

    /**
     * Transfer tokens
     *
     * Send `_value` tokens to `_to` from your account
     *
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transfer(address _to, uint256 _value) public {
        _transfer(msg.sender, _to, _value);
    }

    /**
     * Transfer tokens from other address
     *
     * Send `_value` tokens to `_to` in behalf of `_from`
     *
     * @param _from The address of the sender
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) {
        require(_value <= allowance[_from][msg.sender]);     // Check allowance
        allowance[_from][msg.sender] -= _value;
        _transfer(_from, _to, _value);
        return true;
    }

    /**
     * Set allowance for other address
     *
     * Allows `_spender` to spend no more than `_value` tokens in your behalf
     *
     * @param _spender The address authorized to spend
     * @param _value the max amount they can spend
     */
    function approve(address _spender, uint256 _value) public
        returns (bool success) {
        allowance[msg.sender][_spender] = _value;
        return true;
    }

    /**
     * Set allowance for other address and notify
     *
     * Allows `_spender` to spend no more than `_value` tokens in your behalf, and then ping the contract about it
     *
     * @param _spender The address authorized to spend
     * @param _value the max amount they can spend
     * @param _extraData some extra information to send to the approved contract
     */
    function approveAndCall(address _spender, uint256 _value, bytes _extraData)
        public
        returns (bool success) {
        tokenRecipient spender = tokenRecipient(_spender);
        if (approve(_spender, _value)) {
            spender.receiveApproval(msg.sender, _value, this, _extraData);
            return true;
        }
    }

    /**
     * Destroy tokens
     *
     * Remove `_value` tokens from the system irreversibly
     *
     * @param _value the amount of money to burn
     */
    function burn(uint256 _value) public returns (bool success) {
        require(balanceOf[msg.sender] >= _value);   // Check if the sender has enough
        balanceOf[msg.sender] -= _value;            // Subtract from the sender
        totalSupply -= _value;                      // Updates totalSupply
        Burn(msg.sender, _value);
        return true;
    }

    /**
     * Destroy tokens from other account
     *
     * Remove `_value` tokens from the system irreversibly on behalf of `_from`.
     *
     * @param _from the address of the sender
     * @param _value the amount of money to burn
     */
    function burnFrom(address _from, uint256 _value) public returns (bool success) {
        require(balanceOf[_from] >= _value);                // Check if the targeted balance is enough
        require(_value <= allowance[_from][msg.sender]);    // Check allowance
        balanceOf[_from] -= _value;                         // Subtract from the targeted balance
        allowance[_from][msg.sender] -= _value;             // Subtract from the sender's allowance
        totalSupply -= _value;                              // Update totalSupply
        Burn(_from, _value);
        return true;
    }
}

/******************************************/
/*       ADVANCED TOKEN STARTS HERE       */
/******************************************/

contract MyAdvancedToken is owned, TokenERC20 {

    uint256 public sellPrice;
    uint256 public buyPrice;

    mapping (address => bool) public frozenAccount;

    /* This generates a public event on the blockchain that will notify clients */
    event FrozenFunds(address target, bool frozen);

    /* Initializes contract with initial supply tokens to the creator of the contract */
    function MyAdvancedToken(
        uint256 initialSupply,
        string tokenName,
        string tokenSymbol
    ) TokenERC20(initialSupply, tokenName, tokenSymbol) public {}

    /* Internal transfer, only can be called by this contract */
    function _transfer(address _from, address _to, uint _value) internal {
        require (_to != 0x0);                               // Prevent transfer to 0x0 address. Use burn() instead
        require (balanceOf[_from] >= _value);               // Check if the sender has enough
        require (balanceOf[_to] + _value > balanceOf[_to]); // Check for overflows
        require(!frozenAccount[_from]);                     // Check if sender is frozen
        require(!frozenAccount[_to]);                       // Check if recipient is frozen
        balanceOf[_from] -= _value;                         // Subtract from the sender
        balanceOf[_to] += _value;                           // Add the same to the recipient
        Transfer(_from, _to, _value);
    }

    /// @notice Create `mintedAmount` tokens and send it to `target`
    /// @param target Address to receive the tokens
    /// @param mintedAmount the amount of tokens it will receive
    function mintToken(address target, uint256 mintedAmount) onlyOwner public {
        balanceOf[target] += mintedAmount;
        totalSupply += mintedAmount;
        Transfer(0, this, mintedAmount);
        Transfer(this, target, mintedAmount);
    }

    /// @notice `freeze? Prevent | Allow` `target` from sending & receiving tokens
    /// @param target Address to be frozen
    /// @param freeze either to freeze it or not
    function freezeAccount(address target, bool freeze) onlyOwner public {
        frozenAccount[target] = freeze;
        FrozenFunds(target, freeze);
    }

    /// @notice Allow users to buy tokens for `newBuyPrice` eth and sell tokens for `newSellPrice` eth
    /// @param newSellPrice Price the users can sell to the contract
    /// @param newBuyPrice Price users can buy from the contract
    function setPrices(uint256 newSellPrice, uint256 newBuyPrice) onlyOwner public {
        sellPrice = newSellPrice;
        buyPrice = newBuyPrice;
    }

    /// @notice Buy tokens from contract by sending ether
    function buy() payable public {
        uint amount = msg.value / buyPrice;               // calculates the amount
        _transfer(this, msg.sender, amount);              // makes the transfers
    }

    /// @notice Sell `amount` tokens to contract
    /// @param amount amount of tokens to be sold
    function sell(uint256 amount) public {
        require(this.balance >= amount * sellPrice);      // checks if the contract has enough ether to buy
        _transfer(msg.sender, this, amount);              // makes the transfers
        msg.sender.transfer(amount * sellPrice);          // sends ether to the seller. It's important to do this last to avoid recursion attacks
    }
}			

```

ä¸‹é¢å°±åˆ†æä¸€ä¸‹è¿™ä¸ªåˆçº¦

åœ¨è®¸å¤šåº”ç”¨åœºæ™¯ä¸­ï¼Œéœ€è¦ç®¡ç†å‘è¡Œçš„ä»£å¸ï¼Œä¸ºäº†å¯¹ä»£å¸è¿›è¡Œç®¡ç†ï¼Œéœ€è¦ç»™åˆçº¦æ·»åŠ ä¸€ä¸ªç®¡ç†è€…ï¼Œä¸ºæ­¤åˆ›å»ºäº† owned åˆçº¦ã€‚

contractÂ ownedÂ {
Â Â Â Â addressÂ publicÂ owner;

Â Â Â Â functionÂ owned()Â {
Â Â Â Â Â Â Â Â ownerÂ =Â msg.sender;
Â Â Â Â }

Â Â Â Â modifierÂ onlyOwnerÂ {
Â Â Â Â Â Â Â Â require(msg.senderÂ ==Â owner);
Â Â Â Â Â Â Â Â _;
Â Â Â Â }

Â Â Â Â //Â å®ç°æ‰€æœ‰æƒè½¬ç§»
Â Â Â Â functionÂ transferOwnership(addressÂ newOwner)Â onlyOwnerÂ {
Â Â Â Â Â Â Â Â ownerÂ =Â newOwner;
Â Â Â Â }
}
è¿™ä¸ªåˆçº¦é‡è¦çš„æ˜¯åŠ å…¥äº†ä¸€ä¸ªå‡½æ•°ä¿®æ”¹å™¨ï¼ˆFunctionÂ Modifiersï¼‰onlyOwnerï¼Œå‡½æ•°ä¿®æ”¹å™¨æ˜¯ä¸€ä¸ªåˆçº¦å±æ€§ï¼Œå¯ä»¥è¢«ç»§æ‰¿ï¼Œè¿˜èƒ½è¢«é‡å†™ã€‚å®ƒç”¨äºåœ¨å‡½æ•°æ‰§è¡Œå‰æ£€æŸ¥æŸç§å‰ç½®æ¡ä»¶ã€‚

ä»£å¸å¢å‘, å®ç°ä»£å¸å¢å‘ï¼Œä»£å¸å¢å‘å°±å¦‚åŒå¤®è¡Œå°é’ç¥¨ä¸€æ ·ï¼Œæƒ³å¿…å¾ˆå¤šäººéƒ½éœ€è¦è¿™æ ·çš„åŠŸèƒ½ã€‚ç»™åˆçº¦æ·»åŠ ä»¥ä¸‹çš„æ–¹æ³•ï¼š

```

function mintToken(address target, uint256 mintedAmount) onlyOwner {
        balanceOf[target] += mintedAmount;
        totalSupply += mintedAmount;
        Transfer(0, owner, mintedAmount);
        Transfer(owner, target, mintedAmount);
    }
æ³¨æ„ onlyOwner ä¿®æ”¹å™¨æ·»åŠ åœ¨å‡½æ•°æœ«å°¾ï¼Œè¿™è¡¨ç¤ºåªæœ‰ owner æ‰èƒ½è°ƒç”¨è¿™ç”¨å‡½æ•°ã€‚
ä»–çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯ç»™æŒ‡å®šçš„è´¦æˆ·å¢åŠ ä»£å¸ï¼ŒåŒæ—¶å¢åŠ æ€»ä¾›åº”é‡ã€‚

```

èµ„äº§å†»ç»“

æœ‰æ—¶ä¸ºäº†ç›‘ç®¡çš„éœ€è¦ï¼Œéœ€è¦å®ç°å†»ç»“æŸäº›è´¦æˆ·ï¼Œå†»ç»“åï¼Œå…¶èµ„äº§ä»åœ¨è´¦æˆ·ï¼Œä½†æ˜¯ä¸å…è®¸äº¤æ˜“ï¼Œä¹‹é“è§£é™¤å†»ç»“ã€‚

```

ç»™åˆçº¦æ·»åŠ ä»¥ä¸‹çš„å˜é‡å’Œæ–¹æ³•ï¼ˆå¯ä»¥æ·»åŠ åˆ°åˆçº¦çš„ä»»ä½•åœ°æ–¹ï¼Œä½†æ˜¯å»ºè®®æŠŠ mapping åŠ åˆ°å’Œå…¶ä»– mapping ä¸€èµ·ï¼Œevent ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ï¼š

mapping (address => bool) public frozenAccount;
event FrozenFunds(address target, bool frozen);

function freezeAccount(address target, bool freeze) onlyOwner {
    frozenAccount[target] = freeze;
    FrozenFunds(target, freeze);
}
å•å•ä»¥ä¸Šçš„ä»£ç è¿˜æ— æ³•å†»ç»“ï¼Œéœ€è¦æŠŠä»–åŠ å…¥åˆ° transfer å‡½æ•°ä¸­æ‰èƒ½çœŸæ­£ç”Ÿæ•ˆï¼Œå› æ­¤ä¿®æ”¹ transfer å‡½æ•°

function transfer(address _to, uint256 _value) {
        require(!frozenAccount[msg.sender]);
        ...
}
è¿™æ ·åœ¨è½¬è´¦å‰ï¼Œå¯¹å‘èµ·äº¤æ˜“çš„è´¦å·åšä¸€æ¬¡æ£€æŸ¥ï¼Œåªæœ‰ä¸æ˜¯è¢«å†»ç»“çš„è´¦å·æ‰èƒ½è½¬è´¦ã€‚

```

ä»£å¸ä¹°å–ï¼ˆå…‘æ¢ï¼‰

```

å¯ä»¥è‡ªå·±çš„è´§å¸ä¸­å®ç°ä»£å¸ä¸å…¶ä»–æ•°å­—è´§å¸ï¼ˆether æˆ–å…¶ä»– tokensï¼‰çš„å…‘æ¢æœºåˆ¶ã€‚æœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬çš„åˆçº¦å°±å¯ä»¥åœ¨ä¸€ä¹°ä¸€å–ä¸­èµšåˆ©æ¶¦äº†ã€‚

å…ˆæ¥è®¾ç½®ä¸‹ä¹°å–ä»·æ ¼

uint256 public sellPrice;
uint256 public buyPrice;

function setPrices(uint256 newSellPrice, uint256 newBuyPrice) onlyOwner {
    sellPrice = newSellPrice;
    buyPrice = newBuyPrice;
}
setPrices()æ·»åŠ äº† onlyOwner ä¿®æ”¹å™¨ï¼Œæ³¨æ„ä¹°å–çš„ä»·æ ¼å•ä½æ˜¯ weiï¼ˆæœ€å°çš„è´§å¸å•ä½ï¼š 1 eth = 1000000000000000000 wei)

æ·»åŠ æ¥æ·»åŠ ä¹°å–å‡½æ•°:

function buy() payable returns (uint amount){
    amount = msg.value / buyPrice;                    // calculates the amount
    require(balanceOf[this] >= amount);               // checks if it has enough to sell
    balanceOf[msg.sender] += amount;                  // adds the amount to buyer's balance
    balanceOf[this] -= amount;                        // subtracts amount from seller's balance
    Transfer(this, msg.sender, amount);               // execute an event reflecting the change
    return amount;                                    // ends function and returns
}

function sell(uint amount) returns (uint revenue){
    require(balanceOf[msg.sender] >= amount);         // checks if the sender has enough to sell
    balanceOf[this] += amount;                        // adds the amount to owner's balance
    balanceOf[msg.sender] -= amount;                  // subtracts the amount from seller's balance
    revenue = amount * sellPrice;
    msg.sender.transfer(revenue);                     // sends ether to the seller: it's important to do this last to prevent recursion attacks
    Transfer(msg.sender, this, amount);               // executes an event reflecting on the change
    return revenue;                                   // ends function and returns
}
åŠ å…¥äº†ä¹°å–åŠŸèƒ½åï¼Œè¦æ±‚æˆ‘ä»¬åœ¨åˆ›å»ºåˆçº¦æ—¶å‘é€è¶³å¤Ÿçš„ä»¥å¤ªå¸ï¼Œä»¥ä¾¿åˆçº¦æœ‰èƒ½åŠ›å›è´­å¸‚é¢ä¸Šçš„ä»£å¸ï¼Œå¦åˆ™åˆçº¦å°†ç ´äº§ï¼Œç”¨æˆ·æ²¡æ³•å…ˆåˆçº¦å–ä»£å¸ã€‚

```

å®ç° Gas çš„è‡ªåŠ¨è¡¥å……

```

ä»¥å¤ªåŠä¸­çš„äº¤æ˜“æ—¶éœ€è¦ gasï¼ˆæ”¯ä»˜ç»™çŸ¿å·¥çš„è´¹ç”¨ï¼Œè´¹ç”¨ä»¥ ether æ¥æ”¯ä»˜ï¼‰ã€‚è€Œå¦‚æœç”¨æˆ·æ²¡æœ‰ä»¥å¤ªå¸ï¼Œåªæœ‰ä»£å¸çš„æƒ…å†µï¼ˆæˆ–è€…æˆ‘ä»¬æƒ³å‘ç”¨æˆ·éšè—ä»¥å¤ªåŠçš„ç»†èŠ‚ï¼‰ï¼Œå°±éœ€è¦è‡ªåŠ¨è¡¥å…… gas çš„åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½å°†ä½¿æˆ‘ä»¬ä»£å¸æ›´åŠ å¥½ç”¨ã€‚

è‡ªåŠ¨è¡¥å……çš„é€»è¾‘æ˜¯è¿™æ ·äº†ï¼Œåœ¨æ‰§è¡Œäº¤æ˜“ä¹‹å‰ï¼Œæˆ‘ä»¬åˆ¤æ–­ç”¨æˆ·çš„ä½™é¢ï¼ˆç”¨æ¥æ”¯ä»˜çŸ¿å·¥çš„è´¹ç”¨ï¼‰ï¼Œå¦‚æœç”¨æˆ·çš„ä½™é¢éå¸¸å°‘ï¼ˆä½äºæŸä¸ªé˜ˆå€¼æ—¶ï¼‰å¯èƒ½å½±å“åˆ°äº¤æ˜“è¿›è¡Œï¼Œåˆçº¦è‡ªåŠ¨å”®å‡ºä¸€éƒ¨åˆ†ä»£å¸æ¥è¡¥å……ä½™é¢ï¼Œä»¥å¸®åŠ©ç”¨æˆ·é¡ºåˆ©å®Œæˆäº¤æ˜“ã€‚

å…ˆæ¥è®¾å®šä½™é¢é˜ˆå€¼ï¼š

uint minBalanceForAccounts;

    function setMinBalance(uint minimumBalanceInFinney) onlyOwner {
         minBalanceForAccounts = minimumBalanceInFinney * 1 finney;
    }
finney æ˜¯è´§å¸å•ä½ 1 finney = 0.001eth
ç„¶åäº¤æ˜“ä¸­åŠ å…¥å¯¹ç”¨æˆ·çš„ä½™é¢çš„åˆ¤æ–­ã€‚

function transfer(address _to, uint256 _value) {
    ...
    if(msg.sender.balance < minBalanceForAccounts)
        sell((minBalanceForAccounts - msg.sender.balance) / sellPrice);
    if(_to.balance<minBalanceForAccounts)   // å¯é€‰ï¼Œè®©æ¥å—è€…ä¹Ÿè¡¥å……ä½™é¢ï¼Œä»¥ä¾¿æ¥å—è€…ä½¿ç”¨ä»£å¸ã€‚
        _to.send(sell((minBalanceForAccounts - _to.balance) / sellPrice));
}			

```

#### 6.1.3.Â Netkiller Basic Token çš„ä¾‹å­

ä¸‹é¢æ˜¯æˆ‘ä¸€ä¸ªåˆçº¦ä¾‹å­ä»…ä¾›å‚è€ƒï¼Œä¸ºäº†éƒ¨ç½²æ–¹ä¾¿æˆ‘å°†æ‰€æœ‰å†…å®¹éƒ½å†™å…¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

åˆçº¦ä¸‹è½½åœ°å€ï¼š [`github.com/ibook/TokenERC20/blob/master/contracts/TokenERC20.sol`](https://github.com/ibook/TokenERC20/blob/master/contracts/TokenERC20.sol)

æœ‰äº›åœºæ™¯æˆ‘ä»¬éœ€è¦è®°å½•ä¸€äº›æ•°æ®åœ¨åŒºå—é“¾ä¸Šï¼Œè¿™ä¸ªåˆçº¦å¢åŠ äº† data æ•°æ®æ”¯æŒ

```

  function transfer(address _to, uint256 _value, bytes _data) public returns (bool) {
    require(_to != address(this));
    transfer(_to, _value);
    require(_to.call(_data));
    return true;
  }			

```

å®Œæ•´çš„ä¾‹å­å¦‚ä¸‹

```

pragma solidity â°.4.20;

// Author: netkiller <netkiller@msn.com>
// Homepage: http://www.netkiller.cn

interface tokenRecipient { function receiveApproval(address _from, uint256 _value, address _token, bytes _extraData) public; }

contract TokenERC20 {
    address public owner;
    // Public variables of the token
    string public name;
    string public symbol;
    uint8 public decimals = 18;
    // 18 decimals is the strongly suggested default, avoid changing it
    uint256 public totalSupply;

    // This creates an array with all balances
    mapping (address => uint256) public balanceOf;
    mapping (address => mapping (address => uint256)) public allowance;

    // This generates a public event on the blockchain that will notify clients
    event Transfer(address indexed from, address indexed to, uint256 value);

    // This notifies clients about the amount burnt
    event Burn(address indexed from, uint256 value);

    mapping (address => bool) public frozenAccount;
    event FrozenFunds(address target, bool frozen);

    /**
     * Constrctor function
     *
     * Initializes contract with initial supply tokens to the creator of the contract
     */
    function TokenERC20(
        uint256 initialSupply,
        string tokenName,
        string tokenSymbol
    ) public {
        owner = msg.sender;

        totalSupply = initialSupply * 10 ** uint256(decimals);  // Update total supply with the decimal amount
        balanceOf[msg.sender] = totalSupply;                // Give the creator all initial tokens
        name = tokenName;                                   // Set the name for display purposes
        symbol = tokenSymbol;                               // Set the symbol for display purposes
    }

    modifier onlyOwner {
        require(msg.sender == owner);
        _;
    }

    /**
     * Internal transfer, only can be called by this contract
     */
    function _transfer(address _from, address _to, uint _value) internal {
        // Prevent transfer to 0x0 address. Use burn() instead
        require(_to != 0x0);
        // Check if the sender has enough
        require(balanceOf[_from] >= _value);
        // Check for overflows
        require(balanceOf[_to] + _value > balanceOf[_to]);
        // Save this for an assertion in the future
        uint previousBalances = balanceOf[_from] + balanceOf[_to];
        // Subtract from the sender
        balanceOf[_from] -= _value;
        // Add the same to the recipient
        balanceOf[_to] += _value;
        Transfer(_from, _to, _value);
        // Asserts are used to use static analysis to find bugs in your code. They should never fail
        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);
    }

    function transfer(address _to, uint256 _value) public {
        require(!frozenAccount[msg.sender]);
        _transfer(msg.sender, _to, _value);
    }

    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) {
        require(!frozenAccount[msg.sender]);
        require(_value <= allowance[_from][msg.sender]);     // Check allowance
        allowance[_from][msg.sender] -= _value;
        _transfer(_from, _to, _value);
        return true;
    }

    function approve(address _spender, uint256 _value) public
        returns (bool success) {
        allowance[msg.sender][_spender] = _value;
        return true;
    }

    function approveAndCall(address _spender, uint256 _value, bytes _extraData)
        public
        returns (bool success) {
        tokenRecipient spender = tokenRecipient(_spender);
        if (approve(_spender, _value)) {
            spender.receiveApproval(msg.sender, _value, this, _extraData);
            return true;
        }
    }

    function burn(uint256 _value) onlyOwner public returns (bool success) {
        require(balanceOf[msg.sender] >= _value);   // Check if the sender has enough
        balanceOf[msg.sender] -= _value;            // Subtract from the sender
        totalSupply -= _value;                      // Updates totalSupply
        Burn(msg.sender, _value);
        return true;
    }

    function burnFrom(address _from, uint256 _value) onlyOwner public returns (bool success) {
        require(balanceOf[_from] >= _value);                // Check if the targeted balance is enough
        require(_value <= allowance[_from][msg.sender]);    // Check allowance
        balanceOf[_from] -= _value;                         // Subtract from the targeted balance
        allowance[_from][msg.sender] -= _value;             // Subtract from the sender's allowance
        totalSupply -= _value;                              // Update totalSupply
        Burn(_from, _value);
        return true;
    }

  function transfer(address _to, uint256 _value, bytes _data) public returns (bool) {
    require(_to != address(this));
    transfer(_to, _value);
    require(_to.call(_data));
    return true;
  }

  function transferFrom(address _from, address _to, uint256 _value, bytes _data) public returns (bool) {
    require(_to != address(this));

    transferFrom(_from, _to, _value);

    require(_to.call(_data));
    return true;
  }

  function approve(address _spender, uint256 _value, bytes _data) public returns (bool) {
    require(_spender != address(this));

    approve(_spender, _value);

    require(_spender.call(_data));

    return true;
  }

    function transferOwnership(address _owner) onlyOwner public {
        owner = _owner;
    }
    function mintToken(address target, uint256 mintedAmount) public onlyOwner {
        balanceOf[target] += mintedAmount;
        totalSupply += mintedAmount;
        Transfer(0, owner, mintedAmount);
        Transfer(owner, target, mintedAmount);
    }

    function freezeAccount(address target, bool freeze) public onlyOwner {
        frozenAccount[target] = freeze;
        FrozenFunds(target, freeze);
    }
}

```

#### 6.1.4.Â Netkiller ADVANCED TOKEN

```

pragma solidity â°.4.20;

/******************************************/
/*       Netkiller ADVANCED TOKEN         */
/******************************************/
/* Author netkiller <netkiller@msn.com>   */
/* Home http://www.netkiller.cn           */
/* Version 2018-03-05                     */
/******************************************/

interface tokenRecipient { function receiveApproval(address _from, uint256 _value, address _token, bytes _extraData) public; }

contract NetkillerAdvancedToken {
    address public owner;
    // Public variables of the token
    string public name;
    string public symbol;
    uint8 public decimals = 18;
    // 18 decimals is the strongly suggested default, avoid changing it
    uint256 public totalSupply;

    uint256 public sellPrice;
    uint256 public buyPrice;

    // This creates an array with all balances
    mapping (address => uint256) public balanceOf;
    mapping (address => mapping (address => uint256)) public allowance;

    // This generates a public event on the blockchain that will notify clients
    event Transfer(address indexed from, address indexed to, uint256 value);

    // This notifies clients about the amount burnt
    event Burn(address indexed from, uint256 value);
    event Approval(address indexed owner, address indexed spender, uint256 value);

    mapping (address => bool) public frozenAccount;

    /* This generates a public event on the blockchain that will notify clients */
    event FrozenFunds(address target, bool frozen);

    /**
     * Constrctor function
     *
     * Initializes contract with initial supply tokens to the creator of the contract
     */
    function NetkillerAdvancedToken(
        uint256 initialSupply,
        string tokenName,
        string tokenSymbol
    ) public {
        owner = msg.sender;
        totalSupply = initialSupply * 10 ** uint256(decimals);  // Update total supply with the decimal amount
        balanceOf[msg.sender] = totalSupply;                // Give the creator all initial tokens
        name = tokenName;                                   // Set the name for display purposes
        symbol = tokenSymbol;                               // Set the symbol for display purposes
    }

    modifier onlyOwner {
        require(msg.sender == owner);
        _;
    }
    function transferOwnership(address newOwner) onlyOwner public {
        owner = newOwner;
    }

    /* Internal transfer, only can be called by this contract */
    function _transfer(address _from, address _to, uint _value) internal {
        require (_to != 0x0);                               // Prevent transfer to 0x0 address. Use burn() instead
        require (balanceOf[_from] >= _value);               // Check if the sender has enough
        require (balanceOf[_to] + _value > balanceOf[_to]); // Check for overflows
        require(!frozenAccount[_from]);                     // Check if sender is frozen
        require(!frozenAccount[_to]);                       // Check if recipient is frozen
        balanceOf[_from] -= _value;                         // Subtract from the sender
        balanceOf[_to] += _value;                           // Add the same to the recipient
        Transfer(_from, _to, _value);
    }

    /**
     * Transfer tokens
     *
     * Send `_value` tokens to `_to` from your account
     *
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transfer(address _to, uint256 _value) public {
        _transfer(msg.sender, _to, _value);
    }

    /**
     * Transfer tokens from other address
     *
     * Send `_value` tokens to `_to` in behalf of `_from`
     *
     * @param _from The address of the sender
     * @param _to The address of the recipient
     * @param _value the amount to send
     */
    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) {
        require(_value <= allowance[_from][msg.sender]);     // Check allowance
        allowance[_from][msg.sender] -= _value;
        _transfer(_from, _to, _value);
        return true;
    }

    /**
     * Set allowance for other address
     *
     * Allows `_spender` to spend no more than `_value` tokens in your behalf
     *
     * @param _spender The address authorized to spend
     * @param _value the max amount they can spend
     */
    function approve(address _spender, uint256 _value) public
        returns (bool success) {
        allowance[msg.sender][_spender] = _value;
        Approval(msg.sender, _spender, _value);
        return true;
    }

    /**
     * Set allowance for other address and notify
     *
     * Allows `_spender` to spend no more than `_value` tokens in your behalf, and then ping the contract about it
     *
     * @param _spender The address authorized to spend
     * @param _value the max amount they can spend
     * @param _extraData some extra information to send to the approved contract
     */
    function approveAndCall(address _spender, uint256 _value, bytes _extraData)
        public
        returns (bool success) {
        tokenRecipient spender = tokenRecipient(_spender);
        if (approve(_spender, _value)) {
            spender.receiveApproval(msg.sender, _value, this, _extraData);
            return true;
        }
    }

    /**
     * Destroy tokens
     *
     * Remove `_value` tokens from the system irreversibly
     *
     * @param _value the amount of money to burn
     */
    function burn(uint256 _value) onlyOwner public returns (bool success) {
        require(balanceOf[msg.sender] >= _value);   // Check if the sender has enough
        balanceOf[msg.sender] -= _value;            // Subtract from the sender
        totalSupply -= _value;                      // Updates totalSupply
        Burn(msg.sender, _value);
        return true;
    }

    /**
     * Destroy tokens from other account
     *
     * Remove `_value` tokens from the system irreversibly on behalf of `_from`.
     *
     * @param _from the address of the sender
     * @param _value the amount of money to burn
     */
    function burnFrom(address _from, uint256 _value) onlyOwner public returns (bool success) {
        require(balanceOf[_from] >= _value);                // Check if the targeted balance is enough
        require(_value <= allowance[_from][msg.sender]);    // Check allowance
        balanceOf[_from] -= _value;                         // Subtract from the targeted balance
        allowance[_from][msg.sender] -= _value;             // Subtract from the sender's allowance
        totalSupply -= _value;                              // Update totalSupply
        Burn(_from, _value);
        return true;
    }

    /// @notice Create `mintedAmount` tokens and send it to `target`
    /// @param target Address to receive the tokens
    /// @param mintedAmount the amount of tokens it will receive
    function mintToken(address target, uint256 mintedAmount) onlyOwner public {
        balanceOf[target] += mintedAmount;
        totalSupply += mintedAmount;
        Transfer(0, this, mintedAmount);
        Transfer(this, target, mintedAmount);
    }

    /// @notice `freeze? Prevent | Allow` `target` from sending & receiving tokens
    /// @param target Address to be frozen
    /// @param freeze either to freeze it or not
    function freezeAccount(address target, bool freeze) onlyOwner public {
        frozenAccount[target] = freeze;
        FrozenFunds(target, freeze);
    }

    /// @notice Allow users to buy tokens for `newBuyPrice` eth and sell tokens for `newSellPrice` eth
    /// @param newSellPrice Price the users can sell to the contract
    /// @param newBuyPrice Price users can buy from the contract
    function setPrices(uint256 newSellPrice, uint256 newBuyPrice) onlyOwner public {
        sellPrice = newSellPrice;
        buyPrice = newBuyPrice;
    }

    /// @notice Buy tokens from contract by sending ether
    function buy() payable public {
        uint amount = msg.value / buyPrice;               // calculates the amount
        _transfer(this, msg.sender, amount);              // makes the transfers
    }

    /// @notice Sell `amount` tokens to contract
    /// @param amount amount of tokens to be sold
    function sell(uint256 amount) public {
        require(this.balance >= amount * sellPrice);      // checks if the contract has enough ether to buy
        _transfer(msg.sender, this, amount);              // makes the transfers
        msg.sender.transfer(amount * sellPrice);          // sends ether to the seller. It's important to do this last to avoid recursion attacks
    }

  function transfer(address _to, uint256 _value, bytes _data) public returns (bool) {
    require(_to != address(this));
    transfer(_to, _value);
    require(_to.call(_data));
    return true;
  }

  function transferFrom(address _from, address _to, uint256 _value, bytes _data) public returns (bool) {
    require(_to != address(this));

    transferFrom(_from, _to, _value);

    require(_to.call(_data));
    return true;
  }

  function approve(address _spender, uint256 _value, bytes _data) public returns (bool) {
    require(_spender != address(this));

    approve(_spender, _value);

    require(_spender.call(_data));

    return true;
  }

}			

```

#### 6.1.5.Â ç©ºæŠ•ä»£å¸

```

uint totalSupply = 100000000 ether; 	// æ€»å‘è¡Œé‡
uint currentTotalAirdrop = 0;    		// å·²ç»ç©ºæŠ•æ•°é‡
uint airdrop = 1 ether;        		// å•ä¸ªè´¦æˆ·ç©ºæŠ•æ•°é‡

// å­˜å‚¨æ˜¯å¦ç©ºæŠ•è¿‡
mapping(address => bool) touched;

// ä¿®æ”¹åçš„ balanceOf æ–¹æ³•
function balanceOf(address _owner) public view returns (uint256 balance) {    
    if (!touched[_owner] && currentTotalAirdrop < totalSupply) {
        touched[_owner] = true;
        currentTotalAirdrop += airdrop;
        balances[_owner] += airdrop;
    }    
    return balances[_owner];
}

```

##### 6.1.5.1.Â æ¡ˆä¾‹ä¸€

```

pragma solidity â°.4.8;

contract ERC20Interface {
    function totalSupply() public constant returns (uint256 supply);
    function balance() public constant returns (uint256);
    function balanceOf(address _owner) public constant returns (uint256);
    function transfer(address _to, uint256 _value) public returns (bool success);
    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success);
    function approve(address _spender, uint256 _value) public returns (bool success);
    function allowance(address _owner, address _spender) public constant returns (uint256 remaining);

    event Transfer(address indexed _from, address indexed _to, uint256 _value);
    event Approval(address indexed _owner, address indexed _spender, uint256 _value);
}

// penispenispenispenis
// YOU get a penis, and YOU get a penis, and YOU get a penis!
contract Penis is ERC20Interface {
    string public constant symbol = "PNS";
    string public constant name = "Penis";
    uint8 public constant decimals = 2;

    uint256 _totalSupply = 0;
    uint256 _airdropAmount = 8008135;
    uint256 _cutoff = _airdropAmount * 80085;

    mapping(address => uint256) balances;
    mapping(address => bool) initialized;

    // Penis accepts request to tip-touch another Penis
    mapping(address => mapping (address => uint256)) allowed;

    function Penis() {
        initialized[msg.sender] = true;
        balances[msg.sender] = _airdropAmount * 8008;
        _totalSupply = balances[msg.sender];
    }

    function totalSupply() constant returns (uint256 supply) {
        return _totalSupply;
    }

    // What's my girth?
    function balance() constant returns (uint256) {
        return getBalance(msg.sender);
    }

    // What is the length of a particular Penis?
    function balanceOf(address _address) constant returns (uint256) {
        return getBalance(_address);
    }

    // Tenderly remove hand from Penis and place on another Penis
    function transfer(address _to, uint256 _amount) returns (bool success) {
        initialize(msg.sender);

        if (balances[msg.sender] >= _amount
            && _amount > 0) {
            initialize(_to);
            if (balances[_to] + _amount > balances[_to]) {

                balances[msg.sender] -= _amount;
                balances[_to] += _amount;

                Transfer(msg.sender, _to, _amount);

                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    // Perform the inevitable actions which cause release of that which each Penis
    // is built to deliver. In EtherPenisLand there are only Penises, so this 
    // allows the transmission of one Penis's payload (or partial payload but that
    // is not as much fun) INTO another Penis. This causes the Penisae to change 
    // form such that all may see the glory they each represent. Erections.
    function transferFrom(address _from, address _to, uint256 _amount) returns (bool success) {
        initialize(_from);

        if (balances[_from] >= _amount
            && allowed[_from][msg.sender] >= _amount
            && _amount > 0) {
            initialize(_to);
            if (balances[_to] + _amount > balances[_to]) {

                balances[_from] -= _amount;
                allowed[_from][msg.sender] -= _amount;
                balances[_to] += _amount;

                Transfer(_from, _to, _amount);

                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    // Allow splooger to cause a payload release from your Penis, multiple times, up to 
    // the point at which no further release is possible..
    function approve(address _spender, uint256 _amount) returns (bool success) {
        allowed[msg.sender][_spender] = _amount;
        Approval(msg.sender, _spender, _amount);
        return true;
    }

    function allowance(address _owner, address _spender) constant returns (uint256 remaining) {
        return allowed[_owner][_spender];
    }

    // internal privats
    function initialize(address _address) internal returns (bool success) {
        if (_totalSupply < _cutoff && !initialized[_address]) {
            initialized[_address] = true;
            balances[_address] = _airdropAmount;
            _totalSupply += _airdropAmount;
        }
        return true;
    }

    function getBalance(address _address) internal returns (uint256) {
        if (_totalSupply < _cutoff && !initialized[_address]) {
            return balances[_address] + _airdropAmount;
        }
        else {
            return balances[_address];
        }
    }
}				

```

##### 6.1.5.2.Â æ¡ˆä¾‹äºŒ

```

pragma solidity â°.4.8;

contract ERC20Interface {
    function totalSupply() public constant returns (uint256 supply);
    function balance() public constant returns (uint256);
    function balanceOf(address _owner) public constant returns (uint256);
    function transfer(address _to, uint256 _value) public returns (bool success);
    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success);
    function approve(address _spender, uint256 _value) public returns (bool success);
    function allowance(address _owner, address _spender) public constant returns (uint256 remaining);

    event Transfer(address indexed _from, address indexed _to, uint256 _value);
    event Approval(address indexed _owner, address indexed _spender, uint256 _value);
}

contract Simoleon is ERC20Interface {
    string public constant symbol = "SIM";
    string public constant name = "Simoleon";
    uint8 public constant decimals = 2;

    uint256 _totalSupply = 0;
    uint256 _airdropAmount = 1000000;
    uint256 _cutoff = _airdropAmount * 10000;

    mapping(address => uint256) balances;
    mapping(address => bool) initialized;

    // Owner of account approves the transfer of an amount to another account
    mapping(address => mapping (address => uint256)) allowed;

    function Simoleon() {
        initialized[msg.sender] = true;
        balances[msg.sender] = _airdropAmount * 1000;
        _totalSupply = balances[msg.sender];
    }

    function totalSupply() constant returns (uint256 supply) {
        return _totalSupply;
    }

    // What's my balance?
    function balance() constant returns (uint256) {
        return getBalance(msg.sender);
    }

    // What is the balance of a particular account?
    function balanceOf(address _address) constant returns (uint256) {
        return getBalance(_address);
    }

    // Transfer the balance from owner's account to another account
    function transfer(address _to, uint256 _amount) returns (bool success) {
        initialize(msg.sender);

        if (balances[msg.sender] >= _amount
            && _amount > 0) {
            initialize(_to);
            if (balances[_to] + _amount > balances[_to]) {

                balances[msg.sender] -= _amount;
                balances[_to] += _amount;

                Transfer(msg.sender, _to, _amount);

                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    // Send _value amount of tokens from address _from to address _to
    // The transferFrom method is used for a withdraw workflow, allowing contracts to send
    // tokens on your behalf, for example to "deposit" to a contract address and/or to charge
    // fees in sub-currencies; the command should fail unless the _from account has
    // deliberately authorized the sender of the message via some mechanism; we propose
    // these standardized APIs for approval:
    function transferFrom(address _from, address _to, uint256 _amount) returns (bool success) {
        initialize(_from);

        if (balances[_from] >= _amount
            && allowed[_from][msg.sender] >= _amount
            && _amount > 0) {
            initialize(_to);
            if (balances[_to] + _amount > balances[_to]) {

                balances[_from] -= _amount;
                allowed[_from][msg.sender] -= _amount;
                balances[_to] += _amount;

                Transfer(_from, _to, _amount);

                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    // Allow _spender to withdraw from your account, multiple times, up to the _value amount.
    // If this function is called again it overwrites the current allowance with _value.
    function approve(address _spender, uint256 _amount) returns (bool success) {
        allowed[msg.sender][_spender] = _amount;
        Approval(msg.sender, _spender, _amount);
        return true;
    }

    function allowance(address _owner, address _spender) constant returns (uint256 remaining) {
        return allowed[_owner][_spender];
    }

    // internal private functions
    function initialize(address _address) internal returns (bool success) {
        if (_totalSupply < _cutoff && !initialized[_address]) {
            initialized[_address] = true;
            balances[_address] = _airdropAmount;
            _totalSupply += _airdropAmount;
        }
        return true;
    }

    function getBalance(address _address) internal returns (uint256) {
        if (_totalSupply < _cutoff && !initialized[_address]) {
            return balances[_address] + _airdropAmount;
        }
        else {
            return balances[_address];
        }
    }
}			

```

##### 6.1.5.3.Â æ¡ˆä¾‹ä¸‰

```

pragma solidity â°.4.18;

library SafeMath {
  function mul(uint256 a, uint256 b) internal pure returns (uint256) {
    if (a == 0) {
      return 0;
    }
    uint256 c = a * b;
    require(c / a == b);
    return c;
  }

  function div(uint256 a, uint256 b) internal pure returns (uint256) {
    uint256 c = a / b;
    return c;
  }

  function sub(uint256 a, uint256 b) internal pure returns (uint256) {
    require(b <= a);
    return a - b;
  }

  function add(uint256 a, uint256 b) internal pure returns (uint256) {
    uint256 c = a + b;
    require(c >= a);
    return c;
  }
}

contract Ownable {
  address public owner;

  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);

  function Ownable() public {
    owner = msg.sender;
  }

  modifier onlyOwner() {
    require(msg.sender == owner);
    _;
  }

  function transferOwnership(address newOwner) public onlyOwner {
    require(newOwner != address(0));
    OwnershipTransferred(owner, newOwner);
    owner = newOwner;
  }

}

contract SurpriseToken is Ownable{

    using SafeMath for uint256;

    string public constant name       = "SURPRISE";
    string public constant symbol     = "SPS";
    uint32 public constant decimals   = 18;
    uint256 public totalSupply        = 208932000 ether;
    uint256 public currentTotalSupply = 0;
    uint256 startBalance              = 276 ether;

    mapping(address => bool) touched;
    mapping(address => uint256) balances;
    mapping (address => mapping (address => uint256)) internal allowed;

    event Transfer(address indexed from, address indexed to, uint256 value);
    event Approval(address indexed owner, address indexed spender, uint256 value);

    function transfer(address _to, uint256 _value) public returns (bool) {
        require(_to != address(0));

        if( !touched[msg.sender] && currentTotalSupply < totalSupply ){
            balances[msg.sender] = balances[msg.sender].add( startBalance );
            touched[msg.sender] = true;
            currentTotalSupply = currentTotalSupply.add( startBalance );
        }

        require(_value <= balances[msg.sender]);

        balances[msg.sender] = balances[msg.sender].sub(_value);
        balances[_to] = balances[_to].add(_value);

        Transfer(msg.sender, _to, _value);
        return true;
    }

    function transferFrom(address _from, address _to, uint256 _value) public returns (bool) {
        require(_to != address(0));

        require(_value <= allowed[_from][msg.sender]);

        if( !touched[_from] && currentTotalSupply < totalSupply ){
            touched[_from] = true;
            balances[_from] = balances[_from].add( startBalance );
            currentTotalSupply = currentTotalSupply.add( startBalance );
        }

        require(_value <= balances[_from]);

        balances[_from] = balances[_from].sub(_value);
        balances[_to] = balances[_to].add(_value);
        allowed[_from][msg.sender] = allowed[_from][msg.sender].sub(_value);
        Transfer(_from, _to, _value);
        return true;
    }

    function approve(address _spender, uint256 _value) public returns (bool) {
        allowed[msg.sender][_spender] = _value;
        Approval(msg.sender, _spender, _value);
        return true;
    }

    function allowance(address _owner, address _spender) public view returns (uint256) {
        return allowed[_owner][_spender];
     }

    function increaseApproval(address _spender, uint _addedValue) public returns (bool) {
        allowed[msg.sender][_spender] = allowed[msg.sender][_spender].add(_addedValue);
        Approval(msg.sender, _spender, allowed[msg.sender][_spender]);
        return true;
    }

    function decreaseApproval(address _spender, uint _subtractedValue) public returns (bool) {
        uint oldValue = allowed[msg.sender][_spender];
        if (_subtractedValue > oldValue) {
          allowed[msg.sender][_spender] = 0;
        } else {
          allowed[msg.sender][_spender] = oldValue.sub(_subtractedValue);
        }
        Approval(msg.sender, _spender, allowed[msg.sender][_spender]);
        return true;
     }

    function getBalance(address _a) internal constant returns(uint256)
    {
        if( currentTotalSupply < totalSupply ){
            if( touched[_a] )
                return balances[_a];
            else
                return balances[_a].add( startBalance );
        } else {
            return balances[_a];
        }
    }

    function balanceOf(address _owner) public view returns (uint256 balance) {
        return getBalance( _owner );
    }
}				

```

### 6.2.Â ERC223 token standard reference implementation.

[`github.com/Dexaran/ERC223-token-standard`](https://github.com/Dexaran/ERC223-token-standard)

ERC223 æ˜¯ä»¥å¤ªåŠä¸Šæœ€æ–°çš„ä»£å¸(token)æ¥å£æ ‡å‡†,ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ ERC220 ä»£å¸è½¬è´¦ä¸¢å¤±é—®é¢˜

ERC220 æ¥å£ä»¥ transfer ä¸ºä¾‹:

```

// @notice send `_value` token to `_to` from `msg.sender` 
// @param _to The address of the recipient 
// @param _value The amount of token to be transferred 
// @return Whether the transfer was successful or not 
function transfer(address _to, uint256 _value) public returns (bool success);

```

transfer çš„åŠŸèƒ½éå¸¸ç®€å•ï¼Œç»™ä¸€ä¸ªæŒ‡å®šåœ°å€è½¬å¤šå°‘ä»£å¸ã€‚

ä½†æ˜¯å½“åˆè®¾è®¡çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚æœæ¥æ”¶è€…æ˜¯ä¸€ä¸ªæ™ºèƒ½åˆçº¦,é‚£ä¹ˆåˆçº¦æ˜¯æ²¡æ³•æ„ŸçŸ¥è‡ªå·±æ”¶åˆ°äº†å¤šå°‘ token çš„.

ERC223 ä¸­çš„æ–¹æ³•å®šä¹‰

```

function transfer(address _to, uint _value) public returns (bool ok);
function transfer(address _to, uint _value, bytes _data) public returns (bool ok);
function transfer(address _to, uint _value, bytes _data, string _custom_fallback)		

```

é™¤æ­¤ä¹‹å¤– ERC223 è¿˜æä¾›äº†å®‰å…¨çš„æ•°å­¦è¿ç®—æ–¹æ³•ã€‚

```

pragma solidity â°.4.11;

/**
 * Math operations with safety checks
 */
library SafeMath {
  function mul(uint a, uint b) internal returns (uint) {
    uint c = a * b;
    assert(a == 0 || c / a == b);
    return c;
  }

  function div(uint a, uint b) internal returns (uint) {
    // assert(b > 0); // Solidity automatically throws when dividing by 0
    uint c = a / b;
    // assert(a == b * c + a % b); // There is no case in which this doesn't hold
    return c;
  }

  function sub(uint a, uint b) internal returns (uint) {
    assert(b <= a);
    return a - b;
  }

  function add(uint a, uint b) internal returns (uint) {
    uint c = a + b;
    assert(c >= a);
    return c;
  }

  function max64(uint64 a, uint64 b) internal constant returns (uint64) {
    return a >= b ? a : b;
  }

  function min64(uint64 a, uint64 b) internal constant returns (uint64) {
    return a < b ? a : b;
  }

  function max256(uint256 a, uint256 b) internal constant returns (uint256) {
    return a >= b ? a : b;
  }

  function min256(uint256 a, uint256 b) internal constant returns (uint256) {
    return a < b ? a : b;
  }

  function assert(bool assertion) internal {
    if (!assertion) {
      throw;
    }
  }
}		

```

ERC223 æ¥å£

```

pragma solidity â°.4.11;

contract ERC223Interface {
    uint public totalSupply;
    function balanceOf(address who) constant returns (uint);
    function transfer(address to, uint value);
    function transfer(address to, uint value, bytes data);
    event Transfer(address indexed from, address indexed to, uint value, bytes data);
}

```

```

pragma solidity â°.4.11;

 /**
 * @title Contract that will work with ERC223 tokens.
 */

contract ERC223ReceivingContract { 
/**
 * @dev Standard ERC223 function that will handle incoming token transfers.
 *
 * @param _from  Token sender address.
 * @param _value Amount of tokens.
 * @param _data  Transaction metadata.
 */
    function tokenFallback(address _from, uint _value, bytes _data);
}		

```

```

pragma solidity â°.4.11;

import './ERC223_interface.sol';
import './ERC223_receiving_contract.sol';
import '././SafeMath.sol';

/**
 * @title Reference implementation of the ERC223 standard token.
 */
contract ERC223Token is ERC223Interface {
    using SafeMath for uint;

    mapping(address => uint) balances; // List of user balances.

    /**
     * @dev Transfer the specified amount of tokens to the specified address.
     *      Invokes the `tokenFallback` function if the recipient is a contract.
     *      The token transfer fails if the recipient is a contract
     *      but does not implement the `tokenFallback` function
     *      or the fallback function to receive funds.
     *
     * @param _to    Receiver address.
     * @param _value Amount of tokens that will be transferred.
     * @param _data  Transaction metadata.
     */
    function transfer(address _to, uint _value, bytes _data) {
        // Standard function transfer similar to ERC20 transfer with no _data .
        // Added due to backwards compatibility reasons .
        uint codeLength;

        assembly {
            // Retrieve the size of the code on target address, this needs assembly .
            codeLength := extcodesize(_to)
        }

        balances[msg.sender] = balances[msg.sender].sub(_value);
        balances[_to] = balances[_to].add(_value);
        if(codeLength>0) {
            ERC223ReceivingContract receiver = ERC223ReceivingContract(_to);
            receiver.tokenFallback(msg.sender, _value, _data);
        }
        Transfer(msg.sender, _to, _value, _data);
    }

    /**
     * @dev Transfer the specified amount of tokens to the specified address.
     *      This function works the same with the previous one
     *      but doesn't contain `_data` param.
     *      Added due to backwards compatibility reasons.
     *
     * @param _to    Receiver address.
     * @param _value Amount of tokens that will be transferred.
     */
    function transfer(address _to, uint _value) {
        uint codeLength;
        bytes memory empty;

        assembly {
            // Retrieve the size of the code on target address, this needs assembly .
            codeLength := extcodesize(_to)
        }

        balances[msg.sender] = balances[msg.sender].sub(_value);
        balances[_to] = balances[_to].add(_value);
        if(codeLength>0) {
            ERC223ReceivingContract receiver = ERC223ReceivingContract(_to);
            receiver.tokenFallback(msg.sender, _value, empty);
        }
        Transfer(msg.sender, _to, _value, empty);
    }

    /**
     * @dev Returns balance of the `_owner`.
     *
     * @param _owner   The address whose balance will be returned.
     * @return balance Balance of the `_owner`.
     */
    function balanceOf(address _owner) constant returns (uint balance) {
        return balances[_owner];
    }
}

```

### 6.3.Â ERC721 - Non-fungible Token Standard

[`eips.ethereum.org/EIPS/eip-721`](https://eips.ethereum.org/EIPS/eip-721)

[`github.com/OpenZeppelin/zeppelin-solidity/tree/master/contracts/token/ERC721`](https://github.com/OpenZeppelin/zeppelin-solidity/tree/master/contracts/token/ERC721)

ERC721 æ˜¯ä»¥å¤ªçŒ«é¡¹ç›®é‡‡ç”¨çš„åˆçº¦æ ‡å‡†ã€‚

### 6.4.Â ERC827 Token Standard (ERC20 Extension)

[`github.com/ethereum/EIPs/issues/827`](https://github.com/ethereum/EIPs/issues/827)

[`github.com/OpenZeppelin/zeppelin-solidity/tree/master/contracts/token/ERC827`](https://github.com/OpenZeppelin/zeppelin-solidity/tree/master/contracts/token/ERC827)

### 6.5.Â ERC875 for non fungible tokens and simple atomic swaps

[`github.com/ethereum/EIPs/issues/875`](https://github.com/ethereum/EIPs/issues/875)

[`github.com/alpha-wallet/ERC875-Example`](https://github.com/alpha-wallet/ERC875-Example)

### 6.6.Â ERC: Standard URI scheme with metadata, value and byte code

[`gist.github.com/netkiller/427c196eb256ed43c7be08ac875d34a7`](https://gist.github.com/netkiller/427c196eb256ed43c7be08ac875d34a7)

## ç¬¬Â 14Â ç« Â æ™ºèƒ½åˆçº¦è¯­è¨€ Solidity v0.5.0

### *æœ¬æ–‡ä½œè€…æœ€è¿‘åœ¨æ‰¾å·¥ä½œï¼Œæœ‰æ„å‘è‡´ç”µ 13113668890*

Solidity æ˜¯ä»€ä¹ˆï¼ŸSolidity æ˜¯ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦çš„ç¼–ç¨‹è¯­è¨€ã€‚

## 1.Â Remix - browser-solidity

åœ¨çº¿ä½¿ç”¨ browser-solidity

[`ethereum.github.io/browser-solidity/`](https://ethereum.github.io/browser-solidity/) [`remix.ethereum.org/`](https://remix.ethereum.org/)

å›½å†…ç½‘ç»œæœ‰æ—¶ä¸ç»™åŠ›ï¼Œå»ºè®®å°† Remix å®‰è£…åˆ°æœ¬åœ°ç›®å½•ã€‚

### 1.1.Â å°† Remix(browser-solidity) å®‰è£…åˆ°æœ¬åœ°

å…±äº«åˆçº¦ç›®å½•

```

npm install -g remixd
remixd -S "/home/ethereum/codebase/blocks/contracts"		

```

å®‰è£… browser-solidity

```

git clone https://github.com/ethereum/browser-solidity 
cd browser-solidity 
npm install 
npm run prepublish

sudo chown -R $USER:$(id -gn $USER) /home/neo/.config

npm start

```

å¯åŠ¨åæµè§ˆå™¨ä¸­è¾“å…¥ [`localhost:8080`](http://localhost:8080) å¯ä»¥çœ‹åˆ° Remix ç•Œé¢

### Web3 Provider

Remix æä¾›ä¸‰ç§è¿è¡Œç¯å¢ƒ,å¸¸ç”¨çš„æœ‰ JavaScript VM å’Œ Web3 Provider (è¿æ¥åˆ° --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" --rpcport 8545)

Web3 Provider æ–¹å¼éœ€è¦è§£é”è´¦å·å’Œå¯åŠ¨æŒ–çŸ¿

```

> personal.unlockAccount(eth.accounts[0],"");
> miner.start(2); admin.sleepBlocks(1); miner.stop();			

```

### 1.2.Â è¾“å…¥æ•°ç»„

```

	function mint(address[] _to, uint256 _value) public returns (bool success) {
        for (uint i=0; i<_to.length; i++) {
            balanceOf[_to[i]] = _value;
        }
        return true;
    }

```

åœ¨ Remix ä¸­è¾“å…¥æ•°ç»„çš„æ–¹æ³•

```

["0x6F56648fbD2306f843442f8dC61d5C8861Fac7C9","0x81b7E08F65Bdf5648606c89998A9CC8164397647"]			

```

## 2.Â solc å‘½ä»¤

### 2.1.Â ä½¿ç”¨ solc ç¼–è¯‘ *.sol ä»£ç 

```

neo@netkiller ~/ethereum/solidity % solc --bin --abi --optimize -o ./output helloworld.sol
neo@netkiller ~/ethereum/solidity % find output         
output
output/HelloWorld.bin
output/HelloWorld.abi			

```

## 3.Â æ™ºèƒ½åˆçº¦å…¥é—¨æ¼”ç¤º

è¿™é‡Œæˆ‘ä»¬å…ˆåšä¸€ä¸ª Helloword æ¼”ç¤ºï¼Œè®©ä½ åˆæ­¥å¯¹æ™ºèƒ½åˆçº¦æœ‰ä¸€ä¸ªå¤§æ¦‚çš„è®¤è¯†ã€‚

### æç¤º

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ åœ¨ç½‘ä¸Šä¼šçœ‹åˆ°å¾ˆå¤šä¾‹å­ï¼Œå¯¹ç…§è¿™ä¾‹å­ä¸€æ­¥ä¸€æ­¥æ“ä½œï¼Œå§‹ç»ˆæ— æ³•æˆåŠŸï¼Œè¿™æ ¹ Solidity çš„ç‰ˆæœ¬æœ‰å¾ˆå¤§å…³ç³»ã€‚

å°†ä¸‹é¢ä»£ç ç²˜è´´åˆ°

```

pragma solidity â°.4.25;

contract HelloWorld
{
    string tmp;

    function HelloWorld() public
    {

    }

    function get() public constant returns (string)
    {
        return tmp;
    }

    function set(string _tmp) public
    {
        tmp = _tmp;
    }

}

```

Compile - Details - WEB3DEPLOY

```

var helloworldContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"_tmp","type":"string"}],"name":"set","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"get","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);
var helloworld = helloworldContract.new(
   {
     from: web3.eth.accounts[0], 
     data: '0x6060604052341561000f57600080fd5b6102e38061001e6000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680634ed3885e146100515780636d4ce63c146100ae575b600080fd5b341561005c57600080fd5b6100ac600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061013c565b005b34156100b957600080fd5b6100c1610156565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101015780820151818401526020810190506100e6565b50505050905090810190601f16801561012e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b80600090805190602001906101529291906101fe565b5050565b61015e61027e565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101f45780601f106101c9576101008083540402835291602001916101f4565b820191906000526020600020905b8154815290600101906020018083116101d757829003601f168201915b5050505050905090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061023f57805160ff191683800117855561026d565b8280016001018555821561026d579182015b8281111561026c578251825591602001919060010190610251565b5b50905061027a9190610292565b5090565b602060405190810160405280600081525090565b6102b491905b808211156102b0576000816000905550600101610298565b5090565b905600a165627a7a72305820ea826c30d131f20a4d3a8e3fb059ffa95f4c222a5b099029750e4c1937b46e5b0029', 
     gas: '4700000'
   }, function (e, contract){
    console.log(e, contract);
    if (typeof contract.address !== 'undefined') {
         console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
    }
 })

```

éƒ¨ç½²æ™ºèƒ½åˆçº¦éœ€è¦æ¶ˆè€— gas æ‰€ä»¥ä½ è¦å…ˆè§£é”è´¦å·ã€‚

```

> personal.unlockAccount("0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6", "", 300)
true			

```

```

> var helloworldContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"_tmp","type":"string"}],"name":"set","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"get","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);
undefined
> var helloworld = helloworldContract.new(
...    {
......      from: web3.eth.accounts[0], 
......      data: '0x6060604052341561000f57600080fd5b6102e38061001e6000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680634ed3885e146100515780636d4ce63c146100ae575b600080fd5b341561005c57600080fd5b6100ac600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061013c565b005b34156100b957600080fd5b6100c1610156565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101015780820151818401526020810190506100e6565b50505050905090810190601f16801561012e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b80600090805190602001906101529291906101fe565b5050565b61015e61027e565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101f45780601f106101c9576101008083540402835291602001916101f4565b820191906000526020600020905b8154815290600101906020018083116101d757829003601f168201915b5050505050905090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061023f57805160ff191683800117855561026d565b8280016001018555821561026d579182015b8281111561026c578251825591602001919060010190610251565b5b50905061027a9190610292565b5090565b602060405190810160405280600081525090565b6102b491905b808211156102b0576000816000905550600101610298565b5090565b905600a165627a7a72305820ea826c30d131f20a4d3a8e3fb059ffa95f4c222a5b099029750e4c1937b46e5b0029', 
......      gas: '4700000'
......    }, function (e, contract){
......     console.log(e, contract);
......     if (typeof contract.address !== 'undefined') {
.........          console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
.........     }
......  })
null [object Object]
undefined

```

helloworld æ™ºèƒ½åˆçº¦å·²ç»åˆ›å»ºå®Œæ¯•

```

> helloworld
{
  abi: [{
      constant: false,
      inputs: [{...}],
      name: "set",
      outputs: [],
      payable: false,
      stateMutability: "nonpayable",
      type: "function"
  }, {
      constant: true,
      inputs: [],
      name: "get",
      outputs: [{...}],
      payable: false,
      stateMutability: "view",
      type: "function"
  }, {
      inputs: [],
      payable: false,
      stateMutability: "nonpayable",
      type: "constructor"
  }],
  address: undefined,
  transactionHash: "0x466c9ad9db8f37ed5b65bc261210da92f51364ebab1dcbd3759bfc3e16ad6502"
}

```

## 4.Â æ•°æ®ç±»å‹

### 4.1.Â æ•°å€¼å‹

int/uintï¼šå˜é•¿çš„æœ‰ç¬¦å·æˆ–æ— ç¬¦å·æ•´å‹ã€‚å˜é‡æ”¯æŒçš„æ­¥é•¿ä»¥ 8 é€’å¢ï¼Œæ”¯æŒä» uint8 åˆ° uint256ï¼Œä»¥åŠ int8 åˆ° int256ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œuint å’Œ int é»˜è®¤ä»£è¡¨çš„æ˜¯ uint256 å’Œ int256ã€‚

æœ‰ç¬¦å·æ•´å‹èƒ½å¤Ÿè¡¨ç¤ºè´Ÿæ•°çš„ä»£ä»·æ˜¯å…¶èƒ½å¤Ÿå­˜å‚¨æ­£æ•°çš„èŒƒå›´çš„ç¼©å°ï¼Œå› ä¸ºå…¶çº¦ä¸€åŠçš„æ•°å€¼èŒƒå›´è¦ç”¨æ¥è¡¨ç¤ºè´Ÿæ•°ã€‚å¦‚ï¼šuint8 çš„å­˜å‚¨èŒƒå›´ä¸º 0 ~ 255ï¼Œè€Œ int8 çš„èŒƒå›´ä¸º-127 ~ 127

æ”¯æŒçš„è¿ç®—ç¬¦:

æ¯”è¾ƒï¼š<=ï¼Œ<ï¼Œ==ï¼Œ!=ï¼Œ>=ï¼Œ>ï¼Œè¿”å›å€¼ä¸º bool ç±»å‹ã€‚

ä½è¿ç®—ç¬¦ï¼š&ï¼Œ|ï¼Œï¼ˆ^å¼‚æˆ–ï¼‰ï¼Œï¼ˆ~éï¼‰ã€‚

æ•°å­¦è¿ç®—ï¼š+ï¼Œ-ï¼Œä¸€å…ƒè¿ç®—+ï¼Œ*ï¼Œ/ï¼Œï¼ˆ%æ±‚ä½™ï¼‰ï¼Œï¼ˆ**æ¬¡æ–¹ï¼‰ï¼Œï¼ˆ<<å·¦ç§»ï¼‰ï¼Œï¼ˆ>>å³ç§»ï¼‰ã€‚

å°æ•°ç”±"."ç»„æˆï¼Œåœ¨ä»–çš„å·¦è¾¹æˆ–å³è¾¹è‡³å°‘è¦åŒ…å«ä¸€ä¸ªæ•°å­—ã€‚å¦‚"1."ï¼Œ".1"ï¼Œ"1.3"å‡æ˜¯æœ‰æ•ˆçš„å°æ•°ã€‚

#### 4.1.1.Â åŠ  +ï¼Œå‡ -ï¼Œä¹˜ *ï¼Œé™¤ ï¼ è¿ç®—æ¼”ç¤º

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract Math {

  function mul(int a, int b) public pure returns (int) {

      int c = a * b;
      return c;
  }

  function div(int a, int b) public pure  returns (int) {

      int c = a / b;
      return c;
  }

  function sub(int a, int b) public pure  returns (int) {

      return a - b;
  }

  function add(int a, int b) public pure  returns (int) {

      int c = a + b;
      return c;
  }
}				

```

#### 4.1.2.Â æ±‚ä½™ % è¿ç®—æ¼”ç¤º

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract Math {

  function m(int a, int b) public pure returns (int) {

      int c = a % b;
      return c;
  }
}				

```

#### 4.1.3.Â å¹‚è¿ç®—æ¼”ç¤º

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract Math {

  function m(uint a, uint b) public pure returns (uint) {

      uint c = a**b;
      return c;
  }

}				

```

#### 4.1.4.Â ä¸ &ï¼Œ| æˆ–ï¼Œé ï½ï¼Œå¼‚æˆ– ^ æ¼”ç¤º

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract Math {

  function yu() public pure returns (uint) {

      uint a = 3; // 0b0011
      uint b = 4; // 0b0100

      uint c = a & b; // 0b0000
      return c; // 0
  }

  function huo() public pure returns (uint) {

      uint a = 3; // 0b0011
      uint b = 4; // 0b0100

      uint c = a | b; // 0b0111
      return c; // 7
  }

  function fei() public pure returns (uint8) {

      uint8 a = 3; // 0b00000011
      uint8 c = ~a; // 0b11111100
      return c; // 0
  }

  function yihuo() public pure returns (uint) {

      uint a = 3; // 0b0011
      uint b = 4; // 0b0100

      uint c = a ^ b; // 0b0111
      return c; // 252
  }
}

```

#### 4.1.5.Â ä½ç§»æ¼”ç¤º

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn

contract Math {

  function leftShift() public pure returns (uint8) {

      uint8 a = 8; // 0b00001000
      uint8 c = a << 2; // 0b00100000
      return c; // 32
  }

  function rightShift() public pure returns (uint8) {

      uint8 a = 8; // 0b00001000
      uint8 c = a >> 2; // 0b00000010
      return c; // 2
  }

}

```

aÂ <<Â nÂ è¡¨ç¤º a çš„äºŒè¿›åˆ¶ä½å‘å·¦ç§»åŠ¨ n ä½ï¼Œåœ¨ä¿è¯ä½æ•°æ²¡æœ‰æº¢å‡ºçš„æƒ…å†µä¸‹ç­‰ä»·äºÂ a ä¹˜ä»¥ 2 çš„ n æ¬¡æ–¹ã€‚
aÂ >>Â nÂ è¡¨ç¤º a çš„äºŒè¿›åˆ¶ä½å‘å³ç§»åŠ¨ n ä½ï¼Œåœ¨ä¿è¯ä½æ•°æ²¡æœ‰æº¢å‡ºçš„æƒ…å†µä¸‹ç­‰ä»·äºÂ a é™¤ä»¥ 2 çš„ n æ¬¡æ–¹ã€‚

### 4.2.Â å­—ç¬¦ä¸²

string å­—ç¬¦ä¸²ç±»å‹ï¼Œå­—ç¬¦ä¸²å¯ä»¥é€šè¿‡""æˆ–è€…''æ¥å®šä¹‰å­—ç¬¦ä¸²çš„å€¼

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract StringTest {

    string name;

    function StringTest() public{
        name = "default";
    }
    function setName(string _name) public{
        name = _name;
    }
    function getName() public view returns(string){
        return name;
    }
}			

```

#### 4.2.1.Â è·å–å­—ç¬¦ä¸²é•¿åº¦

åœ¨ Solidity ä¸­æƒ³è·å¾—å­—ç¬¦ä¸²é•¿åº¦å¿…é¡»è½¬æˆ bytes ç±»å‹ç„¶åä½¿ç”¨ length å±æ€§è·å¾—ã€‚bytes(string).length

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract StringTest {

    string public name = "http://www.netkiller.cn";

    function nameBytes() public constant returns (bytes) {

        return bytes(name);
    }

    function nameLength() public constant returns (uint) {

        return bytes(name).length;
    }

    function length(string _name) public pure returns (uint) {

        return bytes(_name).length;
    }

}

```

### æç¤º

æ³¨æ„ï¼šæ±‰å­—é‡‡ç”¨ UTF8 ç¼–ç ï¼Œä¸€ä¸ªæ±‰å­—ç­‰äº 3 ä¸ªå­—èŠ‚ï¼Œå½“ä½ ä½¿ç”¨ length("æ™¯å³¯") æµ‹è¯•æ—¶ä¼šè¿”å›é•¿åº¦ 6ã€‚

### 4.3.Â å¸ƒå°”(Booleans)

bool: å¯èƒ½çš„å–å€¼ä¸ºå¸¸é‡å€¼ true å’Œ falseã€‚æ”¯æŒçš„è¿ç®—ç¬¦ï¼š

```

! é€»è¾‘é

&& é€»è¾‘ä¸

|| é€»è¾‘æˆ–

== ç­‰äº

!= ä¸ç­‰äº

bool a = true;
bool b = !a;

// a == b -> false
// a != b -> true
// a || b -> true
// a && b -> false			

```

### 4.4.Â å­—èŠ‚ç±»å‹

```

bytes names = "netkiller"
bytes9 _names = "netkiller";
bytes(name)[0] = 0xFF;

bytes memory _tmp = new bytes(3);
_tmp[0] = 0x4e;
_tmp[1] = 0x65;
_tmp[2] = 0x6f;

```

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract BytesTest {

    bytes names = "netkiller";

    function get() public view returns (bytes) {

        return names;
    }
    function getBytes2() public pure returns (bytes2) {
        bytes9 _names = "netkiller";
        return bytes2(_names);
    }
    function bytesToString() public constant returns (string) {

        return string(names);
    }

    function copyBytes(bytes b) public pure returns (bytes) {

       bytes memory tmp = new bytes(b.length);

       for(uint i = 0; i < b.length; i++) {

           tmp[i] = b[i];
       }

       return tmp;
    }

    function bytesToString2() public pure returns (string) {
        bytes memory _tmp = new bytes(3);
        _tmp[0] = 0x4e;
        _tmp[1] = 0x65;
        _tmp[2] = 0x6f;
        return string(_tmp);
    }

}			

```

.length å¯ä»¥åŠ¨æ€ä¿®æ”¹å­—èŠ‚æ•°ç»„çš„é•¿åº¦

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract BytesTest2 {

    // åˆå§‹åŒ–ä¸€ä¸ªä¸¤ä¸ªå­—èŠ‚ç©ºé—´çš„å­—èŠ‚æ•°ç»„
    bytes public array = new bytes(2);

    // è®¾ç½®ä¿®æ”¹å­—èŠ‚æ•°ç»„çš„é•¿åº¦
    function setLength(uint _len) public {
        array.length = _len;
    }

    // è¿”å›å­—èŠ‚æ•°ç»„çš„é•¿åº¦
    function getLength() constant public returns (uint) {
        return array.length;
    }

    // å¾€å­—èŠ‚æ•°ç»„ä¸­æ·»åŠ å­—èŠ‚
    function pushArray(byte _tmp) public{
        array.push(_tmp);
    }

}			

```

### 4.5.Â æ•°ç»„

```

	//åˆ›å»ºä¸€ä¸ª memory çš„æ•°ç»„
	uint[] memory a = new uint[](7);

	uint[] x = [uint(1), 3, 4];

    bytes memory b = new bytes(10);

```

äºŒç»´æ•°ç»„

```

uint [2][3] T = [[1,2],[3,4],[5,6]];			

```

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract ArrayTest {

    uint [] array = [1,2,3,4,5];

    // é€šè¿‡ for å¾ªç¯è®¡ç®—æ•°ç»„å†…éƒ¨çš„å€¼çš„æ€»å’Œ
    function sum() constant public returns (uint) {
        uint num = 0;
        for(uint i = 0; i < array.length; i++) {
            num = num + array[i];
        }
        return num;
    }

    function sumNumbers(uint[] _numbers) public pure returns (uint) {
        uint num = 0;
        for(uint i = 0; i < _numbers.length; i++) {
            num = num + _numbers[i];
        }
        return num;
    }

}

```

#### 4.5.1.Â length

.length å±æ€§æ˜¯æ´»åŠ¨æ•°ç»„çš„å°ºå¯¸

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract ArrayLength {

    uint [] array = [1,2,3,4,5];

    function getLength() public constant returns (uint) {

        return array.length;
    }

}				

```

#### 4.5.2.Â push() æ–¹æ³•

é€šè¿‡ push å¯ä»¥å‘æ•°ç»„ä¸­æ·»åŠ æ•°æ®

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract ArrayLength {

    uint [] array = [1,2,3,4,5];

    function pushArray() public {

        array.push(6);
    }

    function getLength() public constant returns (uint) {

        return array.length;
    }

}				

```

### 4.6.Â æšä¸¾ç±»å‹

State å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ•´å‹ï¼Œå½“æšä¸¾æ•°ä¸å¤Ÿå¤šæ—¶ï¼Œå®ƒé»˜è®¤çš„ç±»å‹ä¸º uint8ï¼Œå½“æšä¸¾æ•°è¶³å¤Ÿå¤šæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å˜æˆ uint16ï¼Œæšä¸¾ä¸‹æ ‡å®šä¹‰ä»å·¦è‡³å³ä»é›¶å¼€å§‹ã€‚

New=0, Pending=1, Done=2, Deleted=3

è®¿é—®æšä¸¾æ–¹å¼ State.New å®é™…ç­‰äºæ•°å­— 0

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract EnumTest {
    enum State { New, Pending, Done, Deleted }
    State state = State.New;

    function set(State _state) public {
        state = _state;
    }

    function get() constant public returns (State) {
        return state;
    }

}			

```

æšä¸¾ç”¨æ¥å®šä¹‰çŠ¶æ€

```

pragma solidity â°.4.0;

contract Purchase {
    enum State { Created, Locked, Inactive } // Enum
}				

```

### 4.7.Â ç»“æ„ä½“

å®šä¹‰ç»“æ„ä½“

```

	struct Voter {
        uint weight; // weight is accumulated by delegation
        bool voted;  // if true, that person already voted
        address delegate; // person delegated to
        uint vote;   // index of the voted proposal
    }

    // This is a type for a single proposal.
    struct Proposal {
        bytes32 name;   // short name (up to 32 bytes)
        uint voteCount; // number of accumulated votes
    }			

```

æ¼”ç¤ºä¾‹å­

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract Students {

    struct Person {
        string name;
        uint age;
        uint class;

    }

    Person person = Person("Neo",18,1);

    function getPerson() public view returns(string){
        return person.name;
    }
}				

```

#### 4.7.1.Â å‡½æ•°è¿”å› Struct

Struct ä¸çŸ¥ç›´æ¥è¿”å›ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹

```

pragma solidity â°.4.19;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract Netkiller {
    struct JobStruct {
      uint a;
      uint b;
      uint c;
    }

    function getValues () public pure returns (uint, uint, uint) {
      JobStruct memory js = JobStruct(1, 2, 3);
      return (js.a, js.b, js.c);
    }
}				

```

### 4.8.Â address

```

address public minter;

```

ä¸‹é¢æ˜¯ä¸€ä¸ªè·å¾—è´¦å·ä½™é¢çš„ä¾‹å­ã€‚

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract AddressTest{

    function getBalance(address _addr) public constant returns (uint){
        return _addr.balance;
    }

}			

```

#### 4.8.1.Â payable

#### 4.8.2.Â .value()

#### 4.8.3.Â .gas()

### 4.9.Â mapping

mapping å°±æ˜¯å›¾æ•°æ®ç»“æ„ï¼Œç”± key å’Œ value ç»„æˆã€‚

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract MappingExample {

    mapping(uint => string) map;

    function put(uint key, string value) public {
        map[key] = value;
    }

    function get(uint key) constant public returns (string) {
        return map[key];
    }
}			

```

## 5.Â å•ä½

### 5.1.Â è´§å¸å•ä½ï¼ˆEther Unitsï¼‰

kweiÂ (1000Â Wei)
mweiÂ (1000Â KWei)
gweiÂ (1000Â mwei)
szaboÂ (1000Â gwei)
finneyÂ (1000Â szabo)
etherÂ (1000Â finney)

ä»¥å¤ªå¸å•ä½å…¶å®æ˜¯å¯†ç å­¦å®¶çš„åå­—ï¼Œæ˜¯ä»¥å¤ªåŠåˆ›å§‹äººä¸ºäº†çºªå¿µä»–ä»¬åœ¨æ•°å­—è´§å¸çš„é¢†åŸŸçš„è´¡çŒ®ã€‚ä»–ä»¬åˆ†åˆ«æ˜¯ï¼š
wei:Â WeiÂ DaiÂ æˆ´ä¼ŸÂ å¯†ç å­¦å®¶Â ï¼Œå‘è¡¨Â B-money
finney:Â HalÂ FinneyÂ èŠ¬å°¼Â å¯†ç å­¦å®¶ã€å·¥ä½œé‡è¯æ˜æœºåˆ¶ï¼ˆPOWï¼‰æå‡º
szabo:Â NickÂ SzaboÂ å°¼å…‹è¨åšÂ å¯†ç å­¦å®¶ã€æ™ºèƒ½åˆçº¦çš„æå‡ºè€…

```

pragma solidity â°.4.25;
//Author: netkiller <netkiller@msn.com>
//Home: http://www.netkiller.cn
contract UnitTest {
    function tf() public pure returns (bool) {
      if (1 ether == 1000 finney){
          return true;
      }
      return false;
    }

    function ts() public pure returns (bool) {
      if (1 ether == 1000000 szabo){
          return true;
      }
      return false;
    }

    function tgw() public pure returns (bool) {
      if (1 ether == 1000000000000000000 wei){
          return true;
      }
      return false;
    }
}			

```

### 5.2.Â æ—¶é—´å•ä½ï¼ˆTime Unitsï¼‰

æ—¶é—´å•ä½: seconds, minutes, hours, days, weeks, years å‡å¯åšä¸ºåç¼€ï¼Œå¹¶è¿›è¡Œç›¸äº’è½¬æ¢ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š

1Â ==Â 1Â secondsÂ (é»˜è®¤æ˜¯ seconds ä¸ºå•ä½)
1Â minutesÂ ==Â 60Â seconds
1Â hoursÂ ==Â 60Â minutes
1Â daysÂ ==Â 24Â hours
1Â weeksÂ =Â 7Â days
1Â yearsÂ =Â 365Â days

ç”±äºæ— æ³•é¢„æµ‹é—°ç§’ï¼Œå¿…é¡»ç”±å¤–éƒ¨çš„é¢„è¨€ï¼ˆoracleï¼‰æ¥æ›´æ–°ä»è€Œå¾—åˆ°ä¸€ä¸ªç²¾ç¡®çš„æ—¥å†åº“ã€‚
æ‰€ä»¥ä½¿ç”¨è¿™äº›å•ä½è¿›è¡Œæ—¥æœŸè®¡ç®—éœ€è¦ç‰¹åˆ«å°å¿ƒï¼Œå› ä¸ºä¸æ˜¯æ¯å¹´éƒ½æ˜¯ 365 å¤©ï¼Œä¸”å¹¶ä¸æ˜¯æ¯å¤©éƒ½æœ‰ 24 å°æ—¶ï¼Œå› ä¸ºè¿˜æœ‰é—°ç§’ã€‚

## 6.Â å˜é‡

```

address public minter;
string name;
int num;	

    uint constant x = 32**22 + 8;
    string constant text = "abc";
    bytes32 constant myHash = keccak256("abc");

    uint256 ticket = 1 ether;

```

å˜é‡èµ‹å€¼

```

pragma solidity â°.4.25;

contract C {
    uint[] data;

    function f() public view returns (uint, bool, uint) {
        return (7, true, 2);
    }

    function g() public {
        // å£°æ˜å’Œåˆ†é…å˜é‡ã€‚ æ˜ç¡®æŒ‡å®šç±»å‹æ˜¯ä¸å¯èƒ½çš„ã€‚
        var (x, b, y) = f();
        // åˆ†é…ç»™ä¸€ä¸ªé¢„å…ˆå­˜åœ¨çš„å˜é‡ã€‚
        (x, y) = (2, 7);
        // äº’æ¢å€¼çš„å¸¸ç”¨æŠ€å·§å¯¹äºéä»·å€¼å­˜å‚¨ç±»å‹ä¸èµ·ä½œç”¨ã€‚
        (x, y) = (y, x);
        // ç»„ä»¶å¯ä»¥çœç•¥ï¼ˆä¹Ÿå¯ä»¥ç”¨äºå˜é‡å£°æ˜ï¼‰ã€‚
        // å¦‚æœå…ƒç»„ä»¥ç©ºç»„ä»¶ç»“æŸï¼Œå…¶ä½™çš„å€¼å°†è¢«ä¸¢å¼ƒã€‚
        (data.length,) = f(); // è®¾ç½®é•¿åº¦ä¸º 7
        // åœ¨å·¦è¾¹ä¹Ÿå¯ä»¥åšåŒæ ·çš„äº‹æƒ…ã€‚
        (,data[3]) = f(); // Sets data[3] to 2
        // ç»„ä»¶åªèƒ½åœ¨ä½œä¸šçš„å·¦ä¾§æ’é™¤ï¼Œä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼š
        (x,) = (1,);
        // (1,) æ˜¯æŒ‡å®š 1 å…ƒç»„å…ƒçš„å”¯ä¸€æ–¹æ³•ï¼Œå› ä¸ºï¼ˆ1ï¼‰ç­‰äº 1ã€‚
    }
}			

```

### 6.1.Â å…¨å±€å˜é‡

```

block.blockhash(uint blockNumber) returns (bytes32): hash of the given block - only
works for 256 most recent blocks
block.coinbase (address): current block minerâ€™s address
block.difficulty (uint): current block difficulty
block.gaslimit (uint): current block gaslimit
block.number (uint): current block number
block.timestamp (uint): current block timestamp
msg.data (bytes): complete calldata
msg.gas (uint): remaining gas
msg.sender (address): sender of the message (current call)
msg.value (uint): number of wei sent with the message
now (uint): current block timestamp (alias for block.timestamp)
tx.gasprice (uint): gas price of the transaction
6.4\. Solidity in Depth 99Solidity Documentation, 0.4.10
tx.origin (address): sender of the transaction (full call chain)
revert(): abort execution and revert state changes
keccak256(...) returns (bytes32): compute the Ethereum-SHA-3 (Keccak-256) hash of the
(tightly packed) arguments
sha3(...) returns (bytes32): an alias to keccak256()
sha256(...) returns (bytes32): compute the SHA-256 hash of the (tightly packed) arguments
ripemd160(...) returns (bytes20): compute the RIPEMD-160 hash of the (tightly packed) arguments
ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s) returns (address):
recover address associated with the public key from elliptic curve signature, return zero on error
addmod(uint x, uint y, uint k) returns (uint): compute (x + y) % k where the addition is performed with arbitrary precision and does not wrap around at 2**256
mulmod(uint x, uint y, uint k) returns (uint): compute (x * y) % k where the multiplication is performed with arbitrary precision and does not wrap around at 2**256
this (current contractâ€™s type): the current contract, explicitly convertible to address
super: the contract one level higher in the inheritance hierarchy
selfdestruct(address recipient): destroy the current contract, sending its funds to the given address
.balance (uint256): balance of the Address in Wei
.send(uint256 amount) returns (bool): send given amount of Wei to Address, returns false on failure
.transfer(uint256 amount): send given amount of Wei to Address, throws on failure			

```

block.blockhash(uintÂ blockNumber)Â returnsÂ (bytes32):Â æŸä¸ªåŒºå—çš„åŒºå—é“¾ hash å€¼
block.coinbaseÂ (address):Â å½“å‰åŒºå—çš„æŒ–çŸ¿åœ°å€
block.difficultyÂ (uint):Â å½“å‰åŒºå—çš„éš¾åº¦
block.gaslimitÂ (uint):Â å½“å‰åŒºå—çš„ gaslimit
block.numberÂ (uint):Â å½“å‰åŒºå—ç¼–å·
block.timestampÂ (uint):Â å½“å‰åŒºå—æ—¶é—´æˆ³
msg.dataÂ (bytes):Â å‚æ•°æ•°æ®
msg.gasÂ (uint):Â å‰©ä½™çš„ gas
msg.senderÂ (address):Â å½“å‰å‘é€æ¶ˆæ¯çš„åœ°å€ï¼Œæ‰§è¡Œåˆçº¦çš„åœ°å€ã€‚
msg.sigÂ (bytes4):Â æ–¹æ³• ID
msg.valueÂ (uint):Â æ‰§è¡Œåˆçº¦æ—¶ï¼Œè½¬è´¦çš„ eth æ•°é‡ï¼Œä»¥ wei ä¸ºå•ä½ã€‚
nowÂ (uint):Â æ—¶é—´æˆ³ï¼Œç­‰ä»·äº block.timestampÂ (uint)
tx.gaspriceÂ (uint):Â äº¤æ˜“çš„ gas å•ä»·
tx.originÂ (address):äº¤æ˜“å‘é€åœ°å€

### 6.2.Â storage

ä½¿ç”¨ storage è¿™ä¸ªå…³é”®å­—æ—¶ï¼Œå½“å‰çš„å‡½æ•°å¿…é¡»æ˜¯ internal æˆ–è€… private ç±»å‹ã€‚

### 6.3.Â memory

## 7.Â å‡½æ•°

### 7.1.Â æ„é€ æ–¹æ³•

æ„é€ æ–¹æ³•çš„å®šä¹‰æ˜¯ contract ä¸ function ç›¸åŒ

```

pragma solidity â°.4.18;

contract MyContractByNetkiller {
    /* Constructor */

    function MyContractByNetkiller() public{

    }
}

```

### 7.2.Â å®šä¹‰å‡½æ•°

æ²¡æœ‰è¿”å›å€¼

```

	function setName(string _name) public{
        name = _name;
    }			

```

### 7.3.Â å‡½æ•°è¿”å›å€¼

æœ‰è¿”å›å€¼

```

	function getName() public view returns(string){
        return name;
    }

```

### 7.4.Â å‚æ•°ä¼ é€’

é™¤äº† f(2,3) è¿™æ ·ä¼ é€’å‚æ•°ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç±»ä¼¼å­—å…¸æˆ– Map çš„æ–¹å¼ f({value: 2, key: 3});

```

pragma solidity â°.4.0;

contract C {
    function f(uint key, uint value) {
        // ...
    }

    function g() {
        // named arguments
        f({value: 2, key: 3});
    }
}				

```

### 7.5.Â å‡½æ•°çš„ä¾‹å­

å®Œæ•´çš„ä¾‹å­

```

pragma solidity â°.4.18;

contract MyContractByNetkiller {
    /* Constructor */
    string name;
    int num;
    function MyContractByNetkiller() public{
        name = "default";
        num = 1;
    }
    function setName(string _name) public{
        name = _name;
    }
    function getName() public view returns(string){
        return name;
    }
    function setNum(int n) public{
        num = n;
    }
    function addNum(int m) public view returns(int res){
        res = m + num;
    }
}

```

### 7.6.Â Fallback function

### 7.7.Â modifier

modifier å¯ä»¥ç†è§£ä¸º function çš„è§¦å‘å™¨ï¼Œæˆ–è€…ç†è§£ä¸º hookã€‚æ‰§è¡Œ function çš„æ—¶å€™ä¼šé¦–å…ˆè¿è¡Œ modifier

_; è¡¨ç¤ºæ‰§è¡Œ modifier å®Œæˆæ‰€æœ‰å‘½ä»¤åï¼Œç»§ç»­è¿è¡Œ function å†…çš„é€»è¾‘ã€‚

```

pragma solidity â°.4.11;  

contract owned {  
    function owned() { owner = msg.sender; }  
    address owner;    
    uint price;
    mapping (address => bool) registeredAddresses;

    modifier onlyOwner {  
        require(msg.sender == owner);  
        _;  
    } 
    function changePrice(uint _price) onlyOwner {  
        price = _price;  
    } 
    function close() onlyOwner {  
        selfdestruct(owner);  
    }  
}

```

## 8.Â äº‹ä»¶

ä»€ä¹ˆæ˜¯ event å‘¢ï¼Ÿ åœ¨ Solidity ä¸­ event ç±»ä¼¼è§¦å‘å™¨ï¼Œæ˜¯åˆçº¦ä¸å¤–éƒ¨ç¨‹åºè¿æ¥æ¥å£ã€‚

å¤–éƒ¨ç¨‹åºç›‘å¬äº‹ä»¶ï¼Œæ™ºèƒ½åˆçº¦ä¸­çš„äº‹ä»¶ä¸€æ—¦è§¦å‘ï¼Œå°±å°†æ•°æ®äº¤ç»™ç›‘å¬ç¨‹åºå¤„ç†ã€‚

æ¢ä¸ªè§’åº¦ï¼Œå¦‚æœä½ æ‡‚å¾—æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé‚£ä¹ˆåªèƒ½åˆçº¦ä¸­çš„ event æ˜¯æ¶ˆæ¯å‘å¸ƒè€…ï¼Œå¤–éƒ¨çš„ event ç›‘å¬ç¨‹åºæ˜¯æ¶ˆæ¯çš„æ¶ˆè´¹è€…ã€‚

ä½¿ç”¨ event æ¥åˆ›å»º,ä¸‹é¢æ˜¯ ERC20 çš„æ ‡å‡† event.

```

event Transfer(address indexed from, address indexed to, uint256 value);

```

äº‹ä»¶åç§°ä½ å¯ä»¥éšæ„å®šä¹‰ï¼Œå¼€å¤´å­—æ¯å¤§å†™å³å¯ï¼Œå‚æ•°ä¼ é€’æ ¹æ®ä½ çš„å®é™…éœ€è¦å¢åŠ ã€‚

```

event Sent(address from, address to, uint amount);		

```

## 9.Â é¢å‘å¯¹è±¡ç¼–ç¨‹

### 9.1.Â å¯è§æ€§ä¿®é¥°ç¬¦

Solidity å¯¹å‡½æ•°å’ŒçŠ¶æ€å˜é‡æä¾›äº†å››ç§å¯è§æ€§ã€‚åˆ†åˆ«æ˜¯ external,public,internal,privateã€‚å…¶ä¸­å‡½æ•°é»˜è®¤æ˜¯ publicã€‚çŠ¶æ€å˜é‡é»˜è®¤çš„å¯è§æ€§æ˜¯ internalã€‚

```

internal - çŠ¶æ€å˜é‡é»˜è®¤ä¸º internal ç±»å‹ï¼Œå‡½æ•°åªèƒ½é€šè¿‡å†…éƒ¨è®¿é—®ï¼ˆå½“å‰åˆçº¦æˆ–è€…ç»§æ‰¿çš„åˆçº¦ï¼‰ï¼Œå¯åœ¨å½“å‰åˆçº¦æˆ–ç»§æ‰¿åˆçº¦ä¸­è°ƒç”¨ã€‚ç±»ä¼¼äº Java çš„ protected
public - public æ ‡è¯†çš„å‡½æ•°æ˜¯åˆçº¦æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚å¯ä»¥é€šè¿‡å†…éƒ¨ï¼Œæˆ–è€…æ¶ˆæ¯æ¥è¿›è¡Œè°ƒç”¨ã€‚ä¸ Java çš„ public å«ä¹‰ä¸€è‡´ã€‚
external - external æ ‡è¯†çš„å‡½æ•°æ˜¯åˆçº¦æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚å‡½æ•°åªèƒ½é€šè¿‡å¤–éƒ¨çš„æ–¹å¼è°ƒç”¨ã€‚å¤–éƒ¨å‡½æ•°åœ¨æ¥æ”¶å¤§çš„æ•°ç»„æ—¶æ›´æœ‰æ•ˆã€‚Java ä¸­æ— ä¸æ­¤å¯¹åº”çš„å…³é”®å­—ã€‚
private - åªèƒ½åœ¨å½“å‰åˆçº¦å†…è®¿é—®ï¼Œåœ¨ç»§æ‰¿åˆçº¦ä¸­éƒ½ä¸å¯è®¿é—®ã€‚ä¸ Java ä¸­çš„ private å«ä¹‰ä¸€è‡´ã€‚

payable ï¼šå¯æ”¯ä»˜çš„å‡½æ•°ä¿®é¥°ç¬¦ï¼Œæ²¡æœ‰è¯¥ä¿®é¥°ç¬¦æ— æ³•æ¥å—è½¬è´¦æ“ä½œã€‚

```

### 9.2.Â é”™è¯¯å¤„ç†

assert(boolÂ condition)ï¼šä¸æ»¡è¶³æ¡ä»¶ï¼Œå°†æŠ›å‡ºå¼‚å¸¸

require(boolÂ condition)ï¼šä¸æ»¡è¶³æ¡ä»¶ï¼Œå°†æŠ›å‡ºå¼‚å¸¸

revert()Â æŠ›å‡ºå¼‚å¸¸

```

if(msg.sender != owner) { revert(); }
assert(msg.sender == owner);
require(msg.sender == owner);			

```

### 9.3.Â interface æ¥å£

æ¥å£æ˜¯æŠ½è±¡çš„åˆçº¦ï¼Œæ¥å£ä¸­ä¸èƒ½å®ç°æ–¹æ³•ã€‚

æ¥å£ï¼š

*   ä¸èƒ½ç»§æ‰¿å…¶ä»–åˆçº¦æˆ–æ¥å£

*   ä¸èƒ½å®šä¹‰æ„é€ æ–¹æ³•

*   ä¸èƒ½å®šä¹‰å˜é‡

*   ä¸èƒ½å®šä¹‰ç»“æ„ä½“

*   ä¸èƒ½å®šä¹‰æšä¸¾

```

pragma solidity â°.4.11;

interface Token {
    function transfer(address recipient, uint amount) public;
}

```

### 9.4.Â library åº“

å®šä¹‰ library

```

pragma solidity â°.4.25;

// This is the same code as before, just without comments
library Set {
  struct Data { mapping(uint => bool) flags; }

  function insert(Data storage self, uint value)
      public
      returns (bool)
  {
      if (self.flags[value])
        return false; // already there
      self.flags[value] = true;
      return true;
  }

  function remove(Data storage self, uint value)
      public
      returns (bool)
  {
      if (!self.flags[value])
          return false; // not there
      self.flags[value] = false;
      return true;
  }

  function contains(Data storage self, uint value)
      public
      view
      returns (bool)
  {
      return self.flags[value];
  }
}

```

è°ƒç”¨åº“ä¸­çš„å‡½æ•°

```

contract C {
    using Set for Set.Data; // this is the crucial change
    Set.Data knownValues;

    function register(uint value) public {
        // Here, all variables of type Set.Data have
        // corresponding member functions.
        // The following function call is identical to
        // `Set.insert(knownValues, value)`
        require(knownValues.insert(value));
    }
}

```

#### 9.4.1.Â ä½¿ç”¨åº“æ¥æ‰©å±•æ•°æ®ç±»å‹

```

pragma solidity â°.4.25;

library Search {
    function indexOf(uint[] storage self, uint value)
        public
        view
        returns (uint)
    {
        for (uint i = 0; i < self.length; i++)
            if (self[i] == value) return i;
        return uint(-1);
    }
}

contract C {
    using Search for uint[];
    uint[] data;

    function append(uint value) public {
        data.push(value);
    }

    function replace(uint _old, uint _new) public {
        // This performs the library function call
        uint index = data.indexOf(_old);
        if (index == uint(-1))
            data.push(_new);
        else
            data[index] = _new;
    }
}			

```

### 9.5.Â ç»§æ‰¿

ä¾‹å­ mortal ç»§æ‰¿ owned

```

pragma solidity â°.4.11;  

contract owned {  
    function owned() { owner = msg.sender; }  
    address owner;  

    modifier onlyOwner {  
        require(msg.sender == owner);  
        _;  
    }  
}  

contract mortal is owned {  
    function close() onlyOwner {  
        selfdestruct(owner);  
    }  
}

```

## 10.Â åˆçº¦è°ƒç”¨

```

address token = 0xdC7c2ab64Bc6861852C0Cd60B79564164eD890CF;
token.call(bytes4(sha3("fun(uint256)")), a);		

```

```

Function: transfer(address _to, uint256 _value)
MethodID: 0xa9059cbb		

token.call('0xa9059cbb', _to, _value);

pragma solidity â°.4.24;

contract Test{
    address public token;

    constructor(address _contractAddress) public {
        token = _contractAddress; 
    }
    function transfer(address _to, uint256 _value) public returns (bool success){
        if(token.call(bytes4(keccak256("fun(address, uint256)")), _to, _value)){
            return false;
        }
        return true;
    }
}

```

## 11.Â åˆçº¦æ¥æ”¶ ETH

é¦–å…ˆä½ éœ€è¦åœ¨æ™ºèƒ½åˆçº¦ä¸­å®šä¹‰è¿™ä¸ªå‡½æ•° function () payable public {}ï¼Œè¿™æ—¶è¿™ä¸ªåˆçº¦åœ°å€å°±å¯ä»¥æ¥æ”¶ ETH äº†ã€‚

æµ‹è¯•æ–¹æ³•ï¼Œå‘åˆçº¦åœ°å€å‘é€ ETH å³å¯ã€‚

### 11.1.Â è°ƒç”¨ selfdestruct(msg.sender); å–å‡ºåˆçº¦ä¸­çš„ ETH

```

pragma solidity â°.4.24;

contract NetkillerCashier {

    function () payable public {}

    function claim() public {
        selfdestruct(msg.sender);
    }
}

```

https://ropsten.etherscan.io/tx/0x6504df0e18416c3c319f1f11f84ffa40a752b47c257faee58a7ef2c8ef78cc45

```

 Contract 0x0896827f5e3d2683763321bdf780bde1824f6137  
 TRANSFER  0.03 Ether from 0x0896827f5e3d2683763321bdf780bde1824f6137 to  0x22c57f0537414fd95b9f0f08f1e51d8b96f14029
 SELF-DESTRUCT Contract 0x0896827f5e3d2683763321bdf780bde1824f6137			

```

æŸ¥çœ‹ Code https://ropsten.etherscan.io/address/0x0896827f5e3d2683763321bdf780bde1824f6137#code æ˜¾ç¤º

```

Contract SelfDestruct called at TxHash 0x6504df0e18416c3c319f1f11f84ffa40a752b47c257faee58a7ef2c8ef78cc45			

```

### 11.2.Â è‡ªåŠ¨é€€æ¬¾åˆçº¦

æœ¬åˆçº¦åªæ”¶å– 1 ETH å¤šä½™ ETH å°†é€€ç»™ç”¨æˆ·

```

pragma solidity â°.4.24;

// Author: netkiller@msn.com
// Website: http://www.netkiller.cn

contract Refund {

    address owner = 0x0;

    uint256 ticket = 1 ether;

    constructor() public payable {
        owner = msg.sender;
    }

    function () public payable {
        require(msg.value >= ticket);
        if (msg.value > ticket) {
            uint refundFee = msg.value - ticket;
            msg.sender.transfer(refundFee);
        }
    }
}

```

### 11.3.Â æ”¶æ¬¾åˆçº¦è‡ªåŠ¨è½¬è´¦

åˆçº¦æ”¶åˆ° ETH åè‡ªåŠ¨è½¬åˆ° owner è´¦å·ä¸­ã€‚

```

pragma solidity â°.4.24;

contract NetkillerCashier {

    address public owner;

    constructor() public payable {
        owner = msg.sender;
    }
    function () payable public {
        owner.transfer(msg.value);
    }

}			

```

### 11.4.Â æŒ‡å®šè´¦å·æå– ETH

```

pragma solidity â°.4.24;

contract NetkillerCashier {

    address public owner;
    uint public amount;

    modifier onlyOwner {
        require(msg.sender == owner);
        _;
    }

    constructor() public {
        owner = msg.sender;
    }

    function () public payable {
        amount += msg.value;
    }

	function transferOwnership(address newOwner) onlyOwner public {
        if (newOwner != address(0)) {
            owner = newOwner;
        }
    }

    function withdraw() onlyOwner public {
        msg.sender.transfer(amount);
        amount = 0;
    }

}			

```

```

function transferOwnership(address newOwner) å¯ä»¥ä¿®æ”¹æŒ‡å®šè´¦å·æå– ETH
function withdraw()	æå– ETH çš„å‡½æ•°

```

https://ropsten.etherscan.io/tx/0xadad8c4cd7649d825fb8c362e97f80c4821b07c97d423050289986bd75703b78

```

 Contract 0xb31fb5297340a06e1af3e21c1780b7001db6890a  
 TRANSFER  0.05 Ether from 0xb31fb5297340a06e1af3e21c1780b7001db6890a to  0x22c57f0537414fd95b9f0f08f1e51d8b96f14029			

```

## 12.Â åˆçº¦ä¸­å®ä¾‹åŒ–ä¸€ä¸ªæ¥å£

åœ¨åˆçº¦ä¸­è°ƒç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„åˆçº¦ã€‚

```

pragma solidity â°.4.24;

/******************************************/
/*      Netkiller Crowdsale Contract      */
/******************************************/
/* Author netkiller <netkiller@msn.com>   */
/* Home http://www.netkiller.cn           */
/* Version 2018-06-07 - Solc ver: 0.4.24  */
/******************************************/

interface token {
	function balanceOf(address _address) constant external returns (uint256);
    function transfer(address receiver, uint amount) external;
}

contract Netkiller {

    token public tokenContract;

    constructor(address addressOfToken) public {
        tokenContract = token(addressOfToken);
    }
	function getBalance(address _address) view public returns (uint256){
        return tokenContract.balanceOf(_address);
    }
    function transfer(address _to, uint256 _value) payable public{
        tokenContract.transfer(_to, _value);
    }

}

```

## 13.Â åˆçº¦ä¸­å®ä¾‹åŒ–å¦ä¸€ä¸ªåˆçº¦

å½“åˆçº¦å·²ç»éƒ¨ç½²åˆ°é“¾ä¸Šï¼Œå¦‚éœ€æ‰©å±•åˆçº¦çš„åŠŸèƒ½å¯ä»¥é‡‡ç”¨æ­¤ç§æ–¹æ³•ã€‚

```

pragma solidity â°.4.24;

contract ERC20 {
    uint256 public totalSupply;
    uint public decimals;
    function balanceOf(address _address) constant public returns (uint256);
    function transfer(address _to, uint256 _value) public returns (bool success);
}
contract NetkillerBatchTransfer {

    ERC20 public token;

    constructor(address _contractAddress) public {
        token = ERC20(_contractAddress);
    }
    function getBalance(address _address) view public returns (uint256){
        return token.balanceOf(_address);
    }
}		

```

### 13.1.Â msg.sender ä¸ this çš„åŒºåˆ«

å½“ä¸€ä¸ªåˆçº¦è®¿é—®å¦ä¸€ä¸ªåˆçº¦æ˜¯ï¼Œmsg.sender ä¸ this çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

```

pragma solidity â°.4.24;

/******************************************/
/*       Netkiller Mini TOKEN             */
/******************************************/
/* Author netkiller <netkiller@msn.com>   */
/* Home http://www.netkiller.cn           */
/* Version 2018-05-31 Fixed transfer bool */
/******************************************/

contract NetkillerMiniToken {

    constructor() public { }

    function test1() public view returns (address addr){
        return msg.sender;
    }
    function test2() public view returns (address addr){
        return this;
    }
}			

```

ä¾‹å­

```

Contract A: 0xf328c11c4df88d18fcbd30ad38d8b4714f4b33bf
Contract B: 0xb9b7e0cb2edf5ea031c8b297a5a1fa20379b6a0a

```

Contract A è°ƒç”¨ Contract B

```

msg.sender 	= 0xF328c11c4dF88d18FcBd30ad38d8B4714F4b33bF
this		= 0xB9B7e0cb2EDF5Ea031C8B297A5A1Fa20379b6A0a			

```

### 13.2.Â åœ°å€æ ¼å¼

åœ¨åˆçº¦ä¸­å‡ºç°åœ°å€ï¼Œä¾‹å¦‚ä¸‹é¢ï¼š

```

pragma solidity â°.4.24;
contract ERC20 {
    function totalSupply() public constant returns (uint);
    function balanceOf(address tokenOwner) public constant returns (uint balance);
    function allowance(address tokenOwner, address spender) public constant returns (uint remaining);
    function transfer(address to, uint tokens) public returns (bool success);
    function approve(address spender, uint tokens) public returns (bool success);
    function transferFrom(address from, address to, uint tokens) public returns (bool success);

    event Transfer(address indexed from, address indexed to, uint tokens);
    event Approval(address indexed tokenOwner, address indexed spender, uint tokens);
}

contract TestContract{
    ERC20 public token = ERC20(0xAeeD5A0C200efA0670330d0C7509C854c52AF859);

    function tot() public view returns (uint){
        return token.totalSupply();
    }

    function balance(address _address) public view returns (uint){
        return token.balanceOf(_address);
    }

}			

```

åˆçº¦ä¸­ä¸æ”¯æŒå…¨å°å†™çš„åœ°å€ã€‚

```

æ­£ç¡®çš„ï¼š0xAeeD5A0C200efA0670330d0C7509C854c52AF859
é”™è¯¯çš„ï¼š0xaeed5a0c200efa0670330d0c7509c854c52af859			

```

## 14.Â Solidity å®‰å…¨é—®é¢˜

### 14.1.Â æ•´å‹æº¢å‡º

ä»€ä¹ˆæ˜¯æ•´å‹æº¢å‡ºå‘¢ï¼Ÿåœ¨ solidity ç¼–å†™åˆçº¦æ—¶ï¼Œå®šä¹‰æ•´å‹ä¸€èˆ¬æ˜¯ç”¨ uint8, uint256ã€‚ä¸€ä¸ªå˜é‡å¦‚æœå®šä¹‰ä¸º uint8 è¡¨ç¤ºçš„æ— ç¬¦å·çš„ 8 ä½æ•´å‹ï¼Œå³å–å€¼èŒƒå›´ä¸º 0-255ã€‚å½“ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ 256 æ—¶ï¼Œå³æ•´å‹æº¢å‡ºå˜æˆäº† 0ï¼Œä»¥æ­¤ç±»æ¨ 257 å˜æˆäº† 1ã€‚

```

pragma solidity â°.4.24;

//author: netkiller <netkiller@msn.com>
//homepage: http://www.netkiller.cn

contract NetkillerOverflowTest{

    function add(uint8 a, uint8 b) pure public returns (uint8){

        uint8 result = a + b;

        return result;

    }

    function sub(uint8 a, uint8 b) pure public returns (uint8){

        uint8 result = a - b;

        return result;

    }

    function mul(uint8 a, uint8 b) pure public returns (uint8){

        uint8 result = a * b;

        return result;

    }

    function div(uint8 a, uint8 b) pure public returns (uint8){

        uint8 result = a / b;

        return result;

    }

}		

```

è°ƒç”¨ä¸Šé¢åˆçº¦ï¼Œè¿è¡Œç»“æœ

```

254 + 1 = 255
254 + 2 = 0
254 + 3 = 1

```

å‡æ³•è¿è¡Œç»“æœ

```

10 - 20 = 246

```

ä¹˜æ³•è¿è¡Œç»“æœ

```

51 * 5 = 255
51 * 6 = 50

```

å†æ¥æµ‹è¯•ä¹˜æ³•

```

255 / 10 = 25			

```

è¿™æœ‰ç‚¹æƒ³åƒå¹´è™«é—®é¢˜ï¼Œå³ 99 å¹´å˜æˆ 00 å¹´åï¼Œä½ æ— æ³•åŒºåˆ† 1900 å¹´è¿˜æ˜¯ 2000 å¹´ã€‚

ç°åœ¨æµ‹è¯•ä¸€ä¸‹ uint256ï¼Œuint256 æ”¯æŒçš„å–å€¼èŒƒå›´æ˜¯ 0 åˆ° 2Â²âµâ¶-1

```

pragma solidity â°.4.24;

//author: netkiller <netkiller@msn.com>
//homepage: http://www.netkiller.cn

contract TestUint256Overflow {
    // (2**256 â€“ 1) + 1 = 0 å‘ä¸Šæº¢å‡ºæµ‹è¯•
    function overflow() pure public returns (uint256 _overflow) {
        uint256 max = 2 ** 256 - 1;
        return max + 1;
    }

    // 0 â€“ 1 = 2**256 â€“ 1 å‘ä¸‹æº¢å‡ºæµ‹è¯•
    function underflow() pure public returns (uint256 _underflow) {
        uint256 min = 0;
        return min - 1;
    }
}

```

è¿è¡Œç»“æœ

```

_overflow : 0
_underflow : 115792089237316195423570985008687907853269984665640564039457584007913129639935

```

ç¬¬ä¸€ä¸ªå‡½æ•°æº¢å‡ºä¸º 0ï¼Œç¬¬äºŒä¸ªå‡½æ•° 0 - 1 = 115792089237316195423570985008687907853269984665640564039457584007913129639935

è§£å†³æº¢å‡ºé—®é¢˜ä½¿ç”¨ SafeMath åº“

```

pragma solidity â°.4.24;

//author: netkiller <netkiller@msn.com>
//homepage: http://www.netkiller.cn

library SafeMath {

  function mul(uint256 a, uint256 b) internal pure returns (uint256 c) {
    if (a == 0) {
      return 0;
    }

    c = a * b;
    assert(c / a == b);
    return c;
  }

  function div(uint256 a, uint256 b) internal pure returns (uint256) {
    return a / b;
  }

  function sub(uint256 a, uint256 b) internal pure returns (uint256) {
    assert(b <= a);
    return a - b;
  }

  function add(uint256 a, uint256 b) internal pure returns (uint256 c) {
    c = a + b;
    assert(c >= a);
    return c;
  }
}

contract NetkillerSafeMath {

    using SafeMath for uint256;    

    function add(uint256 a, uint256 b) pure public returns (uint256){
        uint256 result = a.add(b);
        return result;
    }
    function sub(uint256 a, uint256 b) pure public returns (uint256){
        uint256 result = a.sub(b);
        return result;
    }
    function mul(uint256 a, uint256 b) pure public returns (uint256){
        uint256 result = a.mul(b);
        return result;
    }
    function div(uint256 a, uint256 b) pure public returns (uint256){
        uint256 result = a.div(b);
        return result;
    }
}			

```

æµ‹è¯• SafeMath

```

add(115792089237316195423570985008687907853269984665640564039457584007913129639934,1)  => 115792089237316195423570985008687907853269984665640564039457584007913129639935
add(115792089237316195423570985008687907853269984665640564039457584007913129639935,1)  => æŠ›å‡ºå¼‚å¸¸

```

## 15.Â solidity example

### 15.1.Â Voting

```

pragma solidity â°.4.25;
//author: netkiller <netkiller@msn.com>
//homepage: http://www.netkiller.cn
contract Voting {

  mapping (bytes32 => uint8) public votesReceived;

  // å­˜å‚¨å€™é€‰äººåå­—çš„æ•°ç»„
  bytes32[] public candidateList;

  // æ„é€ å‡½æ•° åˆå§‹åŒ–å€™é€‰äººåå•
  function Voting(bytes32[] candidateNames) public {

    candidateList = candidateNames;
  }

  // æŸ¥è¯¢æŸä¸ªå€™é€‰äººçš„æ€»ç¥¨æ•°
  function totalVotesFor(bytes32 candidate) public constant returns (uint8) {
    require(validCandidate(candidate) == true);
    // æˆ–è€…
    // assert(validCandidate(candidate) == true);
    return votesReceived[candidate];
  }

  // ä¸ºæŸä¸ªå€™é€‰äººæŠ•ç¥¨
  function voteForCandidate(bytes32 candidate) public{
    assert(validCandidate(candidate) == true);
    votesReceived[candidate] += 1;
  }

  // æ£€ç´¢æŠ•ç¥¨çš„å§“åæ˜¯ä¸æ˜¯å€™é€‰äººçš„åå­—
  function validCandidate(bytes32 candidate) public constant returns (bool) {
    for(uint i = 0; i < candidateList.length; i++) {
      if (candidateList[i] == candidate) {
        return true;
      }
    }
    return false;
  }

}

```

### 15.2.Â MetaCoin

```

pragma solidity â°.4.25;
contract MetaCoin {
	mapping (address => uint) balances;
	event Transfer(address indexed _from, address indexed _to, uint256 _value);
	function MetaCoin() public {
		balances[tx.origin] = 10000;
	}
	function sendCoin(address receiver, uint amount) public returns(bool sufficient) {
		if (balances[msg.sender] < amount) return false;
		balances[msg.sender] -= amount;
		balances[receiver] += amount;
		Transfer(msg.sender, receiver, amount);
		return true;
	}
	function getBalance(address addr) public view returns(uint) {
		return balances[addr];
	}
}

```

### 15.3.Â Anonymous voting on Ethereum without a tally authority. Protocol from this paper

[`github.com/stonecoldpat/anonymousvoting`](https://github.com/stonecoldpat/anonymousvoting)

### 15.4.Â Ballot

```

pragma solidity â°.4.0;
contract Ballot {

    struct Voter {
        uint weight;
        bool voted;
        uint8 vote;
        address delegate;
    }
    struct Proposal {
        uint voteCount;
    }

    address chairperson;
    mapping(address => Voter) voters;
    Proposal[] proposals;

    /// Create a new ballot with $(_numProposals) different proposals.
    function Ballot(uint8 _numProposals) public {
        chairperson = msg.sender;
        voters[chairperson].weight = 1;
        proposals.length = _numProposals;
    }

    /// Give $(toVoter) the right to vote on this ballot.
    /// May only be called by $(chairperson).
    function giveRightToVote(address toVoter) public {
        if (msg.sender != chairperson || voters[toVoter].voted) return;
        voters[toVoter].weight = 1;
    }

    /// Delegate your vote to the voter $(to).
    function delegate(address to) public {
        Voter storage sender = voters[msg.sender]; // assigns reference
        if (sender.voted) return;
        while (voters[to].delegate != address(0) && voters[to].delegate != msg.sender)
            to = voters[to].delegate;
        if (to == msg.sender) return;
        sender.voted = true;
        sender.delegate = to;
        Voter storage delegateTo = voters[to];
        if (delegateTo.voted)
            proposals[delegateTo.vote].voteCount += sender.weight;
        else
            delegateTo.weight += sender.weight;
    }

    /// Give a single vote to proposal $(toProposal).
    function vote(uint8 toProposal) public {
        Voter storage sender = voters[msg.sender];
        if (sender.voted || toProposal >= proposals.length) return;
        sender.voted = true;
        sender.vote = toProposal;
        proposals[toProposal].voteCount += sender.weight;
    }

    function winningProposal() public constant returns (uint8 _winningProposal) {
        uint256 winningVoteCount = 0;
        for (uint8 prop = 0; prop < proposals.length; prop++)
            if (proposals[prop].voteCount > winningVoteCount) {
                winningVoteCount = proposals[prop].voteCount;
                _winningProposal = prop;
            }
    }
}			

```

### 15.5.Â Conference

```

pragma solidity â°.4.25;

contract Conference {
  address public organizer;
  mapping (address => uint) public registrantsPaid;
  uint public numRegistrants;
  uint public quota;

  event Deposit(address _from, uint _amount);  // so you can log these events
  event Refund(address _to, uint _amount); 

  function Conference() public{ // Constructor
    organizer = msg.sender;
    quota = 500;
    numRegistrants = 0;
  }
  function buyTicket() public payable returns (bool success) {
    if (numRegistrants >= quota) { return false; }
    registrantsPaid[msg.sender] = msg.value;
    numRegistrants++;
    Deposit(msg.sender, msg.value);
    return true;
  }
  function changeQuota(uint newquota) public {
    if (msg.sender != organizer) { return; }
    quota = newquota;
  }
  function refundTicket(address recipient, uint amount) public {
    if (msg.sender != organizer) { return; }
    if (registrantsPaid[recipient] == amount) { 
      address myAddress = this;
      if (myAddress.balance >= amount) { 
        recipient.transfer(amount);
        registrantsPaid[recipient] = 0;
        numRegistrants--;
        Refund(recipient, amount);
      }
    }
  }
  function destroy() public{ // so funds not locked in contract forever
    if (msg.sender == organizer) { 
      selfdestruct(organizer); // send funds to organizer
    }
  }
}

```

æ§åˆ¶å°è°ƒè¯•

```

var contract;
Conference.deployed().then(function(instance){contract=instance;});
contract.buyTicket();

```

æµ‹è¯•ç¨‹åº

```

neo@MacBook-Pro ~/ethereum/Conference % cat test/conference.js 
var Conference = artifacts.require("./Conference.sol");

contract('Conference', function(accounts) {
	console.log(accounts);
	var owner_account = accounts[0];
    var sender_account = accounts[1];

  it("Initial conference settings should match", function(done) {

  	Conference.deployed({from: owner_account}).then(function(conference) {
        conference.quota.call().then(function(quota) { 
                assert.equal(quota, 100, "Quota doesn't match!"); 
        }).then(function() { 
                return conference.numRegistrants.call(); 
        }).then(function(num) { 
                assert.equal(num, 0, "Registrants doesn't match!");
                return conference.organizer.call();
        }).then(function(organizer) { 
                assert.equal(organizer, owner_account, "Owner doesn't match!");
                done();
        }).catch(done);
  	}).catch(done);
  });

  it("Should update quota", function(done) {

  	Conference.deployed({from: owner_account}).then(function(conference) {
        conference.quota.call().then(
            function(quota) { 
                assert.equal(quota, 100, "Quota doesn't match!"); 
        }).then(
            function() { 
                return conference.changeQuota(300);
        }).then(
            function() { 
                return conference.quota.call()
        }).then(
            function(quota) { 
                assert.equal(quota, 300, "New quota is not correct!");
                done();
        }).catch(done);
  	}).catch(done);
  });

  it("Should let you buy a ticket", function(done) {

  	Conference.deployed({ from: accounts[0] }).then(function(conference) {

        var ticketPrice = web3.toWei(.05, 'ether');
        var initialBalance = web3.eth.getBalance(conference.address).toNumber();  

  			conference.buyTicket({ from: accounts[1], value: ticketPrice }).then(
          function() {
  					var newBalance = web3.eth.getBalance(conference.address).toNumber();
            var difference = newBalance - initialBalance;
  					assert.equal(difference, ticketPrice, "Difference should be what was sent");
  					return conference.numRegistrants.call(); 
  			}).then(
  				function(num) { 
  					assert.equal(num, 1, "there should be 1 registrant");
  					return conference.registrantsPaid.call(sender_account);
  			}).then(
  				function(amount) {
  					assert.equal(amount.toNumber(), ticketPrice, "Sender's paid but is not listed as paying");	
  					return web3.eth.getBalance(conference.address);
  			}).then(
  				function(bal) {
            assert.equal(bal.toNumber(), ticketPrice, "Final balance mismatch");
  					done();
  			}).catch(done);
  	}).catch(done);
  });

  it("Should issue a refund by owner only", function(done) {

    Conference.deployed({ from: accounts[0] }).then(function(conference) {

        var ticketPrice = web3.toWei(.05, 'ether');
        var initialBalance = web3.eth.getBalance(conference.address).toNumber(); 

        conference.buyTicket({ from: accounts[1], value: ticketPrice }).then(
          function() {
            var newBalance = web3.eth.getBalance(conference.address).toNumber();
            var difference = newBalance - initialBalance;
            assert.equal(difference, ticketPrice, "Difference should be what was sent");

            // Now try to issue refund as second user - should fail
            return conference.refundTicket(accounts[1], ticketPrice, {from: accounts[1]});
        }).then(
          function() {  
            var balance = web3.eth.getBalance(conference.address);
            assert.equal(balance, ticketPrice, "Balance should be unchanged");
            // Now try to issue refund as organizer/owner
            return conference.refundTicket(accounts[1], ticketPrice, {from: accounts[0]});
        }).then(
          function() {
            var postRefundBalance = web3.eth.getBalance(conference.address).toNumber();
            assert.equal(postRefundBalance, initialBalance, "Balance should be initial balance");
            done();
        }).catch(done);
      }).catch(done);
    });

});			

```

## ç¬¬Â 15Â ç« Â Truffle v4.1.8 å¼€å‘æ¡†æ¶

Truffle æ˜¯ solidity å¼€å‘æ¡†æ¶ï¼Œ [`truffleframework.com`](http://truffleframework.com)

## 1.Â å®‰è£… Truffle

å®‰è£… truffle

```

sudo npm install -g truffle

```

å‡çº§

```

npm update -g truffle		

```

## 2.Â å¼€å‘ç¯å¢ƒ

### 2.1.Â truffle develop

truffle develop æ˜¯ truffle è‡ªå¸¦çš„å¼€å‘ç¯å¢ƒã€‚

### 2.2.Â Ganache

truffle develop ä½¿ç”¨èµ·æ¥å¹¶ä¸ç›´è§‚ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªå¼€å‘ç¯å¢ƒæ˜¯ Ganacheï¼ŒGanache æœ‰å‘½ä»¤è¡Œç‰ˆæœ¬å’Œå›¾å½¢ç•Œé¢ç‰ˆæœ¬ã€‚ä¸‹é¢æ˜¯å‘½ä»¤è¡Œç‰ˆæœ¬å®‰è£…æ–¹æ³•ï¼š

```

sudo npm install -g ganache-cli

```

å›¾å½¢ç•Œé¢ç‰ˆæœ¬è¿™é‡Œä¸‹è½½ [`truffleframework.com/ganache/`](http://truffleframework.com/ganache/)

å›¾å½¢ç•Œé¢äº¤äº’æ€§ç›¸æ¯”å‘½ä»¤è¡Œæ¯”è¾ƒå¥½ï¼Œæ¨èä½¿ç”¨ã€‚ä½ èƒ½åœ¨ç•Œé¢ä¸Šç›´æ¥æŸ¥çœ‹è´¦å·ï¼ŒåŒºå—ï¼Œäº¤æ˜“ï¼Œæ—¥å¿—ç­‰ç­‰ã€‚

### 2.3.Â testrpc

ç”±äº truffle 4.0 è‡ªå¸¦å¼€å‘ç¯å¢ƒ(truffle develop)ï¼Œæ‰€ä»¥æœ¬ç« ä¸åœ¨ä½¿ç”¨ testrpc(ä¸å»ºè®®ä½¿ç”¨)ï¼Œå¦‚æœä»éœ€è¦ testrpc è¯·å‚è€ƒä¸‹é¢å®‰è£…æ–¹æ³•ï¼š

```

# å®‰è£… testrpc
sudo npm install -g ethereumjs-testrpc

```

## 3.Â Truffle å¿«é€Ÿå…¥é—¨

### 3.1.Â Ubuntu ç¯å¢ƒ

#### 3.1.1.Â å¯åŠ¨å¼€å‘ç¯å¢ƒ

truffle è‡ªå¸¦ä¸€ä¸ªå¼€å‘ç¯å¢ƒ

```

neo@netkiller ~/ethereum/truffle-project %  truffle develop
Truffle Develop started at http://localhost:9545/

Accounts:
(0) 0x627306090abab3a6e1400e9345bc60c78a8bef57
(1) 0xf17f52151ebef6c7334fad080c5704d77216b732
(2) 0xc5fdf4076b8f3a5357c5e395ab970b5b54098fef
(3) 0x821aea9a577a9b44299b9c15c88cf3087f3b5544
(4) 0x0d1d4e623d10f9fba5db95830f7d3839406c6af2
(5) 0x2932b7a2355d6fecc4b5c0b6bd44cc31df247a2e
(6) 0x2191ef87e392377ec08e7c08eb105ef5448eced5
(7) 0x0f4f2ac550a1b4e2280d04c21cea7ebd822934b5
(8) 0x6330a553fc93768f612722bb8c2ec78ac90b3bbc
(9) 0x5aeda56215b167893e80b4fe645ba6d5bab767de

Private Keys:
(0) c87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3
(1) ae6ae8e5ccbfb04590405997ee2d52d2b330726137b875053c36d94e974d162f
(2) 0dbbe8e4ae425a6d2687f1a7e3ba17bc98c673636790f1b8ad91193c05875ef1
(3) c88b703fb08cbea894b6aeff5a544fb92e78a18e19814cd85da83b71f772aa6c
(4) 388c684f0ba1ef5017716adb5d21a053ea8e90277d0868337519f97bede61418
(5) 659cbb0e2411a44db63778987b1e22153c086a95eb6b18bdf89de078917abc63
(6) 82d052c865f5763aad42add438569276c00d3d88a2d062d36b2bae914d58b8c8
(7) aa3680d5d48a8283413f7a108367c7299ca73f553735860a87b08f39395618b7
(8) 0f62d96d6675f32685bbdb8ac13cda7c23436f63efbb9d07700d8669ff12b7c4
(9) 8d5366123cb560bb606379f90a0bfd4769eecc0557f1b362dcae9012b548b1e5

Mnemonic: candy maple cake sugar pudding cream honey rich smooth crumble sweet treat

truffle(develop)> 

```

truffle develop çš„ä½œç”¨äº testrpc ç±»ä¼¼ã€‚

```

neo@netkiller ~/ethereum/truffle-project % testrpc 
EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2)

Available Accounts
==================
(0) 0xb5fd43ee8fa5ce1db9a30a25ba385ee3bfc72966
(1) 0xf5a732345734e1f0f49cbadb145a20d1e1a44b95
(2) 0x834fcd8c55fdf21fd14c82e9a1ef5d3636a2fed6
(3) 0x5aa4d047d85727309d3ca653c83c3bb0ecd18903
(4) 0xb4db2dede86f4539e56ac4438f6e36f09c307e46
(5) 0x8da382b1a10ab2f1dc149e19fda228a07c78935c
(6) 0xb290297e89b52713548ff93e5fc23bc3c4183dde
(7) 0x546183289bd4d9d33a3aee0ee663c0729926e583
(8) 0xca58321e442533b7f827e6e8976e1905acd15214
(9) 0xe2c0b336bbb03564204e15a2cb7744564a53efcc

Private Keys
==================
(0) ff32f7a06e2fb26b51a745c1e428c60df92c0f9bb3301b19a5b7e0cdfaae521a
(1) cdbfe40321b6ade8a246748df1c48a738b8a531aee4d1f60a45bfd7f941e0064
(2) 7092117c2d7832980945e18645a60a1ed0e59261d040749f8b5202c2fc653d74
(3) f329657c9ad808e9f794a7462a1a9c276266343d5ced263ab618b6a19d6857c1
(4) 1221766592618add3a57ab109f00efcc70867dd8a9b10a0f7ea75c2b619edfc3
(5) c27005d6c3581193124c84766cc0b1cc318cb201b7d00b1035f4a4c7767ba790
(6) 6b7f43dca1dcc00203b751191096bb0602e17a9a94dcee8b846329efa703cea9
(7) 41be5971d71935bc88c3cf8aefd78ed3188c8721b7134cda3b25d353faf05d4f
(8) bd4c9d512a4f2da2cdcd9e4f89c049e3e7ac81bf57a05369997c2f13e793bebb
(9) 04196d803f743cc1fd021e7d02d5a552f14ab9826ccd4d4b265ff96c45169d2c

HD Wallet
==================
Mnemonic:      confirm shift cable melody caught swing erode language spend victory conduct van
Base HD Path:  m/44'/60'/0'/0/{account_index}

Listening on localhost:8545			

```

#### 3.1.2.Â åˆ›å»ºé¡¹ç›®

```

cd ~/ethereum
mkdir truffle-project
cd truffle-project 
truffle init			

```

æ“ä½œæ¼”ç¤º

```

neo@netkiller ~/ethereum/truffle-project % truffle init
Downloading...
Unpacking...
Setting up...
Unbox successful. Sweet!

Commands:

  Compile:        truffle compile
  Migrate:        truffle migrate
  Test contracts: truffle test

neo@netkiller ~/ethereum/truffle-project % tree 
.
|-- contracts
|   `-- Migrations.sol
|-- migrations
|   `-- 1_initial_migration.js
|-- test
|-- truffle-config.js
`-- truffle.js

3 directories, 4 files			

```

ç›®å½•ç»“æ„ç®€å•è¯´æ˜å¦‚ä¸‹ï¼š

contract/Â -Â Truffle é»˜è®¤çš„åˆçº¦æ–‡ä»¶å­˜æ”¾åœ°å€ã€‚
migrations/Â -Â å­˜æ”¾å‘å¸ƒè„šæœ¬æ–‡ä»¶
test/Â -Â ç”¨æ¥æµ‹è¯•åº”ç”¨å’Œåˆçº¦çš„æµ‹è¯•æ–‡ä»¶
truffle.jsÂ -Â Truffle çš„é…ç½®æ–‡ä»¶

app/Â -Â éœ€è¦ç”¨æˆ·åˆ›å»ºï¼Œåº”ç”¨æ–‡ä»¶è¿è¡Œçš„é»˜è®¤ç›®å½•ã€‚

#### 3.1.3.Â åˆ›å»ºåˆçº¦

```

pragma solidity â°.4.18;

contract Netkiller {
    string name;
    int num;
    function Netkiller() public{
        name = "default";
        num = 1;
    }
    function setName(string _name) public{
        name = _name;
    }
    function getName() public view returns(string){
        return name;
    }
    function setNum(int n) public{
        num = n;
    }
    function addNum(int m) public view returns(int res){
        res = m + num;
    }
}

```

```

neo@netkiller ~/ethereum/truffle-project % vim migrations/2_initial_migration.js

var Netkiller = artifacts.require("./Netkiller.sol");

module.exports = function(deployer) {
  deployer.deploy(Netkiller);
};

```

#### 3.1.4.Â é…ç½® Truffle

æ‰“å¼€æ–‡ä»¶ truffle.js

```

module.exports = {
  // See <http://truffleframework.com/docs/advanced/configuration>
  // to customize your Truffle configuration!
};			

```

ä¿®æ”¹ä¸º

```

module.exports = {
  // See <http://truffleframework.com/docs/advanced/configuration>
  // to customize your Truffle configuration!

  networks: {
    development: {
      host: "localhost",
      port: 9545,
      network_id: "*" // Match any network id
    }
  }	

};	

```

#### 3.1.5.Â ç¼–è¯‘æ™ºèƒ½åˆçº¦

```

neo@netkiller ~/ethereum/truffle-project % truffle compile
Compiling ./contracts/Migrations.sol...
Compiling ./contracts/Netkiller.sol...
Writing artifacts to ./build/contracts

```

truffle é»˜è®¤åªä¼šç¼–è¯‘æœ€åä¸€æ¬¡ä¿®æ”¹è¿‡çš„åˆçº¦æ–‡ä»¶, è¿™æ˜¯ä¸ºäº†å‡å°‘æ¯”é‡å¤ç¼–è¯‘ã€‚"--all"é€‰é¡¹,å¯ä»¥å¼ºåˆ¶ç¼–è¯‘æ‰€æœ‰æ–‡ä»¶ã€‚

ç¼–è¯‘ç»“æœ

```

neo@netkiller ~/ethereum/truffle-project % find build 
build
build/contracts
build/contracts/Migrations.json
build/contracts/Netkiller.json

```

#### 3.1.6.Â migrate

```

neo@netkiller ~/ethereum/truffle-project % truffle migrate      
Using network 'development'.

Network up to date.			

```

### 3.2.Â Mac ç¯å¢ƒ

Mac ç¯å¢ƒ

```

neo@MacBook-Pro ~/ethereum/truffle % node --version
v9.5.0

neo@MacBook-Pro ~/ethereum/truffle % npm version
{ npm: '5.6.0',
  ares: '1.13.0',
  cldr: '32.0.1',
  http_parser: '2.7.0',
  icu: '60.2',
  modules: '59',
  napi: '2',
  nghttp2: '1.29.0',
  node: '9.5.0',
  openssl: '1.0.2n',
  tz: '2017c',
  unicode: '10.0',
  uv: '1.19.1',
  v8: '6.2.414.46-node.18',
  zlib: '1.2.11' }		

neo@MacBook-Pro ~/ethereum/truffle % truffle version
Truffle v4.0.6 (core: 4.0.6)
Solidity v0.4.19 (solc-js)		

```

åˆ›å»ºé¡¹ç›®å¹¶åˆå§‹åŒ–

```

mkdir -p ~/ethereum/truffle
cd 	ethereum/truffle
truffle init	

```

truffle è‡ªå¸¦ä¸€ä¸ªå¼€å‘ç¯å¢ƒ

```

neo@netkiller ~/ethereum/truffle-project %  truffle develop
Truffle Develop started at http://localhost:9545/

Accounts:
(0) 0x627306090abab3a6e1400e9345bc60c78a8bef57
(1) 0xf17f52151ebef6c7334fad080c5704d77216b732
(2) 0xc5fdf4076b8f3a5357c5e395ab970b5b54098fef
(3) 0x821aea9a577a9b44299b9c15c88cf3087f3b5544
(4) 0x0d1d4e623d10f9fba5db95830f7d3839406c6af2
(5) 0x2932b7a2355d6fecc4b5c0b6bd44cc31df247a2e
(6) 0x2191ef87e392377ec08e7c08eb105ef5448eced5
(7) 0x0f4f2ac550a1b4e2280d04c21cea7ebd822934b5
(8) 0x6330a553fc93768f612722bb8c2ec78ac90b3bbc
(9) 0x5aeda56215b167893e80b4fe645ba6d5bab767de

Private Keys:
(0) c87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3
(1) ae6ae8e5ccbfb04590405997ee2d52d2b330726137b875053c36d94e974d162f
(2) 0dbbe8e4ae425a6d2687f1a7e3ba17bc98c673636790f1b8ad91193c05875ef1
(3) c88b703fb08cbea894b6aeff5a544fb92e78a18e19814cd85da83b71f772aa6c
(4) 388c684f0ba1ef5017716adb5d21a053ea8e90277d0868337519f97bede61418
(5) 659cbb0e2411a44db63778987b1e22153c086a95eb6b18bdf89de078917abc63
(6) 82d052c865f5763aad42add438569276c00d3d88a2d062d36b2bae914d58b8c8
(7) aa3680d5d48a8283413f7a108367c7299ca73f553735860a87b08f39395618b7
(8) 0f62d96d6675f32685bbdb8ac13cda7c23436f63efbb9d07700d8669ff12b7c4
(9) 8d5366123cb560bb606379f90a0bfd4769eecc0557f1b362dcae9012b548b1e5

Mnemonic: candy maple cake sugar pudding cream honey rich smooth crumble sweet treat

truffle(develop)> 

```

åˆ›å»ºåˆçº¦æ–‡ä»¶ contracts/Greeter.sol

```

pragma solidity â°.4.20;

contract Greeter         
{
    address creator;     
    string greeting;     

    function Greeter() public   
    {
        creator = msg.sender;
        greeting = "default";
    }

    function greet() constant public returns (string)          
    {
        return greeting;
    }

    function setGreeting(string _newgreeting) public 
    {
        greeting = _newgreeting;
    }

    function kill() public
    { 
        if (msg.sender == creator)
            selfdestruct(creator);

    }

}		

```

åˆ›å»ºéƒ¨ç½²æ–‡ä»¶ migrations/2_initial_migration.js

```

var Greeter = artifacts.require("./Greeter.sol");

module.exports = function(deployer) {
  deployer.deploy(Greeter);
};

```

æ‰“å¼€æ–‡ä»¶ truffle.js

```

module.exports = {
  // See <http://truffleframework.com/docs/advanced/configuration>
  // to customize your Truffle configuration!
};			

```

ä¿®æ”¹ä¸º

```

module.exports = {
  // See <http://truffleframework.com/docs/advanced/configuration>
  // to customize your Truffle configuration!

  networks: {
    development: {
      host: "localhost",
      port: 9545,
      network_id: "*" // Match any network id
    }
  }	

};	

```

ç¼–è¯‘å¹¶éƒ¨ç½²åˆçº¦

```

neo@MacBook-Pro ~/ethereum/truffle % truffle compile          
Compiling ./contracts/Greeter.sol...
Writing artifacts to ./build/contracts

neo@MacBook-Pro ~/ethereum/truffle % truffle migrate --reset     
Using network 'development'.

Running migration: 1_initial_migration.js
  Replacing Migrations...
  ... 0xddeac9a1c57772df50064f11227fcb5515e54a3e88e15843f5c0bc1b55a0dad7
  Migrations: 0x2c2b9c9a4a25e24b174f26114e8926a9f2128fe4
Saving successful migration to network...
  ... 0x9b51540f5a7d75a8fc920e3e5e4ec66792ba31fd006bd176901f0e6347af2dba
Saving artifacts...
Running migration: 2_initial_migration.js
  Deploying Greeter...
  ... 0x312ead931bbe4b288315317bdf6735ba4fe4f30c20382f085ca27be345819983
  Greeter: 0xfb88de099e13c3ed21f80a7a1e49f8caecf10df6
Saving successful migration to network...
  ... 0x69eaa7ed49cc72426706d54c4f52ba70b742ed6910f1223eb0df5f250b4b8ec3
Saving artifacts...

```

æµ‹è¯•è„šæœ¬

```

Greeter.deployed().then(instance => console.log(instance.address))

var contract;
Greeter.deployed().then(function(instance){contract= instance;});
contract.greet();
contract.setGreeting("http://www.netkiller.cn")
contract.greet();		

```

è¿›å…¥æ§åˆ¶å°ï¼Œäº¤äº’æ‰§è¡Œä¸Šé¢ç¨‹åº

```

neo@MacBook-Pro ~/ethereum/truffle % truffle console
truffle(development)>

truffle(development)> Greeter.deployed().then(instance => console.log(instance.address))
0x82d50ad3c1091866e258fd0f1a7cc9674609d254
undefined
truffle(development)> var contract;
undefined
truffle(development)> Greeter.deployed().then(function(instance){contract= instance;});
undefined
truffle(development)> contract.greet();
'default'
truffle(development)> contract.setGreeting("http://www.netkiller.cn")
{ tx: '0xa5cbfba78c84415517740a482c2bf2208da0c6b0ecabcd5c22db2c85749041c8',
  receipt: 
   { transactionHash: '0xa5cbfba78c84415517740a482c2bf2208da0c6b0ecabcd5c22db2c85749041c8',
     transactionIndex: 0,
     blockHash: '0x557758e0d9b1ef81f41728cb92f43041d009751d5ce5e2e4424f7fb90f52041a',
     blockNumber: 16,
     gasUsed: 34206,
     cumulativeGasUsed: 34206,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)> contract.greet();
'http://www.netkiller.cn'

```

### 3.3.Â ERC20 ä»£å¸éƒ¨ç½²

#### 3.3.1.Â åˆçº¦æ–‡ä»¶

```

[ethereum@netkiller truffle]$ cat contracts/TokenERC20.sol
pragma solidity â°.4.20;

contract TokenERC20 {
    address public owner;
    // Public variables of the token
    string public name;
    string public symbol;
    uint8 public decimals = 2;
    // 18 decimals is the strongly suggested default, avoid changing it
    uint256 public totalSupply;

    // This creates an array with all balances
    mapping (address => uint256) public balanceOf;
    mapping (address => mapping (address => uint256)) public allowance;

    // This generates a public event on the blockchain that will notify clients
    event Transfer(address indexed from, address indexed to, uint256 value);

    // This notifies clients about the amount burnt
    event Burn(address indexed from, uint256 value);

    mapping (address => bool) public frozenAccount;
    event FrozenFunds(address target, bool frozen);

    /**
     * Constrctor function
     *
     * Initializes contract with initial supply tokens to the creator of the contract
     */
    function TokenERC20(
        uint256 initialSupply,
        string tokenName,
        string tokenSymbol
    ) public {
        owner = msg.sender;

        totalSupply = initialSupply * 10 ** uint256(decimals);  // Update total supply with the decimal amount
        balanceOf[msg.sender] = totalSupply;                // Give the creator all initial tokens
        name = tokenName;                                   // Set the name for display purposes
        symbol = tokenSymbol;                               // Set the symbol for display purposes
    }

    modifier onlyOwner {
        require(msg.sender == owner);
        _;
    }

    /**
     * Internal transfer, only can be called by this contract
     */
    function _transfer(address _from, address _to, uint _value) internal {
        // Prevent transfer to 0x0 address. Use burn() instead
        require(_to != 0x0);
        // Check if the sender has enough
        require(balanceOf[_from] >= _value);
        // Check for overflows
        require(balanceOf[_to] + _value > balanceOf[_to]);
        // Save this for an assertion in the future
        uint previousBalances = balanceOf[_from] + balanceOf[_to];
        // Subtract from the sender
        balanceOf[_from] -= _value;
        // Add the same to the recipient
        balanceOf[_to] += _value;
        // Asserts are used to use static analysis to find bugs in your code. They should never fail
        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);
    }

    function transfer(address _to, uint256 _value) public {
        require(!frozenAccount[msg.sender]);
        _transfer(msg.sender, _to, _value);
    }

    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) {
        require(!frozenAccount[msg.sender]);
        require(_value <= allowance[_from][msg.sender]);     // Check allowance
        allowance[_from][msg.sender] -= _value;
        _transfer(_from, _to, _value);
        return true;
    }

    function approve(address _spender, uint256 _value) public
        returns (bool success) {
        allowance[msg.sender][_spender] = _value;
        return true;
    }

    function approveAndCall(address _spender, uint256 _value)
        public
        returns (bool success) {
        if (approve(_spender, _value)) {
            return true;
        }
    }

    function burn(uint256 _value) onlyOwner public returns (bool success) {
        require(balanceOf[msg.sender] >= _value);   // Check if the sender has enough
        balanceOf[msg.sender] -= _value;            // Subtract from the sender
        totalSupply -= _value;                      // Updates totalSupply
        return true;
    }

    function burnFrom(address _from, uint256 _value) onlyOwner public returns (bool success) {
        require(balanceOf[_from] >= _value);                // Check if the targeted balance is enough
        require(_value <= allowance[_from][msg.sender]);    // Check allowance
        balanceOf[_from] -= _value;                         // Subtract from the targeted balance
        allowance[_from][msg.sender] -= _value;             // Subtract from the sender's allowance
        totalSupply -= _value;                              // Update totalSupply
        return true;
    }

  function transfer(address _to, uint256 _value, bytes _data) public returns (bool) {
    require(_to != address(this));
    transfer(_to, _value);
    require(_to.call(_data));
    return true;
  }

  function transferFrom(address _from, address _to, uint256 _value, bytes _data) public returns (bool) {
    require(_to != address(this));
    transferFrom(_from, _to, _value);
    require(_to.call(_data));
    return true;
  }

  function approve(address _spender, uint256 _value, bytes _data) public returns (bool) {
    require(_spender != address(this));
    approve(_spender, _value);
    require(_spender.call(_data));
    return true;
  }

    function transferOwnership(address _owner) onlyOwner public {
        owner = _owner;
    }
    function mintToken(address target, uint256 mintedAmount) public onlyOwner {
        balanceOf[target] += mintedAmount;
        totalSupply += mintedAmount;
    }

    function freezeAccount(address target, bool freeze) public onlyOwner {
        frozenAccount[target] = freeze;
    }
}

```

#### 3.3.2.Â éƒ¨ç½²æ–‡ä»¶

```

[ethereum@netkiller truffle]$ cat migrations/2_initial_token.js
var TokenERC20 = artifacts.require("./TokenERC20.sol");

module.exports = function(deployer) {
  deployer.deploy(TokenERC20,1200000000,"Netkiller Coin","NKC");
};

```

#### 3.3.3.Â ç¼–è¯‘éƒ¨ç½²

```

[ethereum@netkiller truffle]$ truffle compile
Compiling ./contracts/Migrations.sol...
Compiling ./contracts/TokenERC20.sol...
Writing artifacts to ./build/contracts

[ethereum@netkiller truffle]$ truffle migrate
Using network 'development'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0x80746c040d6c6ed8178f90d74356a994fea81516bdd6579d003c433d7a0a0116
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_initial_token.js
  Deploying TokenERC20...
  ... 0xb375b52fe6df9f298828672f3ba3560d7a6f6806ce344e964439d0febc13cb97
  TokenERC20: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

```

#### 3.3.4.Â åˆçº¦è°ƒç”¨

```

[ethereum@netkiller truffle]$ truffle console
truffle(development)> var contract;
undefined
truffle(development)> TokenERC20.deployed().then(function(instance){contract=instance;});
undefined
truffle(development)> contract.symbol.call().then(console.log);
NKC
truffle(development)> contract.name.call().then(console.log);
Netkiller Coin

```

### 3.4.Â é«˜çº§ ERC20 ä»£å¸åˆçº¦

#### 3.4.1.Â éƒ¨ç½²åˆçº¦

è§£é”è´¦å·ï¼ŒæŸ¥çœ‹ gas limit ä»·æ ¼

```

[ethereum@netkiller ~]$ geth attach
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.7-stable/linux-amd64/go1.10.2
coinbase: 0x8232ef29d29f46d3621350ab7097604247ed4830
at block: 2863 (Fri, 11 May 2018 17:16:01 CST)
 datadir: /home/ethereum/.ethereum
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> personal.unlockAccount(eth.accounts[0],"12345678",50000)
true
> web3.eth.getBlock("pending").gasLimit
4712388
> exit

```

é…ç½® truffle.js

```

[ethereum@netkiller truffle]$ cat truffle.js
module.exports = {
  // See <http://truffleframework.com/docs/advanced/configuration>
  // to customize your Truffle configuration!

  networks: {
    development: {
      host: "localhost",
      port: 8545,
	  gas: 4712388,
      network_id: "*" // Match any network id
    }
  }

};

```

```

[ethereum@netkiller truffle]$ truffle compile
(node:23256) ExperimentalWarning: The fs.promises API is experimental
Compiling ./contracts/NetkillerAdvancedToken.sol...
Writing artifacts to ./build/contracts

```

```

[ethereum@netkiller truffle]$ truffle migrate
(node:23456) ExperimentalWarning: The fs.promises API is experimental
Using network 'development'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xa5937808d9d42dba231738d79d5989e160a2bbc02aa7e8938d0ee71a11eab9a7
  Migrations: 0x0f6d790c0ce6453161ead810246602c601f836e7
Saving successful migration to network...
  ... 0xabd2d76488caa48eac5b9ad5d662b34a8b41acacb5657ff4f78c5c4530913d2b
Saving artifacts...
Running migration: 2_initial_token.js
  Deploying NetkillerAdvancedToken...
  ... 0x190239e85c54aa407ba8dd98357ebabbe2dcab65811f3c4aab7486af27436a09
  NetkillerAdvancedToken: 0xb45bd60c48ea18991a5f25a644682d8cf7572ccf
Saving successful migration to network...
  ... 0x97b9fffef368b2411341d9fed31bd771d0beebe02bde8c19c61a9e0dde0cc773
Saving artifacts...

```

#### 3.4.2.Â æ§åˆ¶å°æ£€æŸ¥åˆçº¦

```

var contract;
NetkillerAdvancedTokenAirDrop.deployed().then(function(instance){contract=instance;});
contract.symbol.call().then(console.log);
contract.name.call().then(console.log);
contract.totalSupply.call().then(console.log);
contract.balanceOf.call(web3.eth.accounts[0]).then(console.log);

```

#### 3.4.3.Â æµ‹è¯•è½¬è´¦

```

contract.transfer(web3.eth.accounts[1],100).then(function(){contract.balanceOf.call(web3.eth.accounts[1]).then(console.log);});

```

```

contract.transferFrom(web3.eth.accounts[0],web3.eth.accounts[1],100).then(function(){contract.balanceOf.call(web3.eth.accounts[1]).then(console.log);});

```

#### 3.4.4.Â é”ä»“

```

contract.setLock(true);
contract.transfer(web3.eth.accounts[2],100).then(function(){contract.balanceOf.call(web3.eth.accounts[2]).then(console.log);});

```

æ¼”ç¤º

```

truffle(development)> contract.setLock(true);
{ tx: '0x6a603ca9456b574224aa97b8bf1d66280fc8509c94253c0037bc5bb71135a667',
  receipt: 
   { transactionHash: '0x6a603ca9456b574224aa97b8bf1d66280fc8509c94253c0037bc5bb71135a667',
     transactionIndex: 0,
     blockHash: '0x4e0893b5ff6b1d85182dca0ceb3c0c2cb750183ff856b7ad2e323ad2a3b55fdc',
     blockNumber: 13,
     gasUsed: 42424,
     cumulativeGasUsed: 42424,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)> contract.transfer(web3.eth.accounts[2],100).then(function(){contract.balanceOf.call(web3.eth.accounts[2]).then(console.log);});
Error: VM Exception while processing transaction: revert
    at XMLHttpRequest._onHttpResponseEnd (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:509:1)
    at XMLHttpRequest._setReadyState (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:354:1)
    at XMLHttpRequestEventTarget.dispatchEvent (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:64:1)
    at XMLHttpRequest.request.onreadystatechange (/usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/httpprovider.js:128:1)
    at /usr/local/lib/node_modules/truffle/build/webpack:/~/truffle-provider/wrapper.js:134:1
    at /usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/requestmanager.js:86:1
    at Object.InvalidResponse (/usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/errors.js:38:1)

```

è§£é”åå†æµ‹è¯•

```

contract.setLock(false);
contract.transfer(web3.eth.accounts[2],100).then(function(){contract.balanceOf.call(web3.eth.accounts[2]).then(console.log);});

```

```

truffle(development)> contract.setLock(false);
{ tx: '0x3d4b8d49626c1171ab7160274a9f573bb06999fa7bc33240704199c7905f62fd',
  receipt: 
   { transactionHash: '0x3d4b8d49626c1171ab7160274a9f573bb06999fa7bc33240704199c7905f62fd',
     transactionIndex: 0,
     blockHash: '0x0c78b27d817449b6a3727a13041f1880cbf5466a8b81719f2541c08d59ca5fb3',
     blockNumber: 15,
     gasUsed: 13680,
     cumulativeGasUsed: 13680,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)> contract.transfer(web3.eth.accounts[2],100).then(function(){contract.balanceOf.call(web3.eth.accounts[2]).then(console.log);});
undefined
truffle(development)> BigNumber { s: 1, e: 2, c: [ 100 ] }

```

#### 3.4.5.Â æµ‹è¯•ç©ºæŠ•

```

[ethereum@netkiller ~]$ geth account new
INFO [05-11|17:25:49] Maximum peer count                       ETH=25 LES=0 total=25
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase:
Repeat passphrase:
Address: {3c1ba8b80b9a8697f2e34194c2a73a93105be23d}

```

```

contract.mintAirdropToken(1000000);
contract.totalAirdropSupply.call().then(console.log);
contract.totalSupply.call().then(console.log);
contract.setAirdrop(10);
contract.setAirdropLock(true);
contract.balanceOf.call(web3.eth.accounts[3]).then(console.log);

contract.currentTotalAirdrop.call().then(console.log);

```

æ“ä½œæ¼”ç¤º

```

[ethereum@netkiller ~]$  truffle console      
truffle(development)> var contract;
NetkillerAdvancedTokenAirDrop.deployed().then(function(instance){contract=instance;});undefined
truffle(development)> NetkillerAdvancedTokenAirDrop.deployed().then(function(instance){contract=instance;});
undefined
truffle(development)> contract.mintAirdropToken(1000000);
{ tx: '0xab251fafc30724273259442fc02bfa429235ff14535f4fb25e29bed7de09ea11',
  receipt: 
   { transactionHash: '0xab251fafc30724273259442fc02bfa429235ff14535f4fb25e29bed7de09ea11',
     transactionIndex: 0,
     blockHash: '0x5498eb579a08e8da1ca2d5ad3d6dd5b0a5c21cc9a630809783d09b65e26929b9',
     blockNumber: 28,
     gasUsed: 47701,
     cumulativeGasUsed: 47701,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)> contract.setAirdrop(10);
{ tx: '0xd8a3a16328373858e3cc30c7947b3c3c00db447bb3306f2cf2af58fd0215aef8',
  receipt: 
   { transactionHash: '0xd8a3a16328373858e3cc30c7947b3c3c00db447bb3306f2cf2af58fd0215aef8',
     transactionIndex: 0,
     blockHash: '0x5be96cfd95031a132fc643b06d01dba0b14f736fa9fa3f16dd5bbd9c7f030700',
     blockNumber: 29,
     gasUsed: 42209,
     cumulativeGasUsed: 42209,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)> contract.setAirdropLock(true);
{ tx: '0x7b8b5747a64111a500cce22371d78b2c3c4ce0b5a2b585b26c0278876044e231',
  receipt: 
   { transactionHash: '0x7b8b5747a64111a500cce22371d78b2c3c4ce0b5a2b585b26c0278876044e231',
     transactionIndex: 0,
     blockHash: '0xd6960add791b36afac1126a00af16f2833043dcb3416d68bb4056db64313dc93',
     blockNumber: 30,
     gasUsed: 42408,
     cumulativeGasUsed: 42408,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)> contract.balanceOf.call(web3.eth.accounts[5]).then(console.log);
BigNumber { s: 1, e: 1, c: [ 10 ] }
undefined				

```

## 4.Â Truffle å‘½ä»¤è¯¦è§£

neo@MacBook-ProÂ ~/ethereum/truffleÂ %Â truffleÂ help
TruffleÂ v4.0.6Â -Â aÂ developmentÂ frameworkÂ forÂ Ethereum

Usage:Â truffleÂ <command>Â [options]

Commands:
Â Â initÂ Â Â Â Â Â InitializeÂ newÂ andÂ emptyÂ EthereumÂ project
Â Â compileÂ Â Â CompileÂ contractÂ sourceÂ files
Â Â migrateÂ Â Â RunÂ migrationsÂ toÂ deployÂ contracts
Â Â deployÂ Â Â Â (aliasÂ forÂ migrate)
Â Â buildÂ Â Â Â Â ExecuteÂ buildÂ pipelineÂ (ifÂ configurationÂ present)
Â Â testÂ Â Â Â Â Â RunÂ JavaScriptÂ andÂ SolidityÂ tests
Â Â debugÂ Â Â Â Â InteractivelyÂ debugÂ anyÂ transactionÂ onÂ theÂ blockchainÂ (experimental)
Â Â opcodeÂ Â Â Â PrintÂ theÂ compiledÂ opcodesÂ forÂ aÂ givenÂ contract
Â Â consoleÂ Â Â RunÂ aÂ consoleÂ withÂ contractÂ abstractionsÂ andÂ commandsÂ available
Â Â developÂ Â Â OpenÂ aÂ consoleÂ withÂ aÂ localÂ developmentÂ blockchain
Â Â createÂ Â Â Â HelperÂ toÂ createÂ newÂ contracts,Â migrationsÂ andÂ tests
Â Â installÂ Â Â InstallÂ aÂ packageÂ fromÂ theÂ EthereumÂ PackageÂ Registry
Â Â publishÂ Â Â PublishÂ aÂ packageÂ toÂ theÂ EthereumÂ PackageÂ Registry
Â Â networksÂ Â ShowÂ addressesÂ forÂ deployedÂ contractsÂ onÂ eachÂ network
Â Â watchÂ Â Â Â Â WatchÂ filesystemÂ forÂ changesÂ andÂ rebuildÂ theÂ projectÂ automatically
Â Â serveÂ Â Â Â Â ServeÂ theÂ buildÂ directoryÂ onÂ localhostÂ andÂ watchÂ forÂ changes
Â Â execÂ Â Â Â Â Â ExecuteÂ aÂ JSÂ moduleÂ withinÂ thisÂ TruffleÂ environment
Â Â unboxÂ Â Â Â Â DownloadÂ aÂ TruffleÂ Box,Â aÂ pre-builtÂ TruffleÂ project
Â Â versionÂ Â Â ShowÂ versionÂ numberÂ andÂ exit

SeeÂ moreÂ atÂ http://truffleframework.com/docs

### 4.1.Â version

è¾“å‡ºç‰ˆæœ¬å·ç„¶åé€€å‡ºã€‚

```

neo@MacBook-Pro ~/ethereum/truffle % truffle version
Truffle v4.0.6 (core: 4.0.6)
Solidity v0.4.19 (solc-js)

```

### 4.2.Â Truffle console æ§åˆ¶å°

```

neo@MacBook-Pro ~/ethereum/truffle % truffle console
truffle(development)>		

```

### 4.3.Â create

#### 4.3.1.Â contract åˆ›å»ºåˆçº¦

```

neo@MacBook-Pro ~/ethereum/truffle % truffle create contract MyContract
neo@MacBook-Pro ~/ethereum/truffle % cat contracts/MyContract.sol 
pragma solidity â°.4.4;

contract MyContract {
  function MyContract() {
    // constructor
  }
}				

```

#### 4.3.2.Â test åˆ›å»ºå•å…ƒæµ‹è¯•

```

neo@MacBook-Pro ~/ethereum/truffle % truffle create test MyTest
neo@MacBook-Pro ~/ethereum/truffle % cat test/my_test.js
contract('MyTest', function(accounts) {
  it("should assert true", function(done) {
    var my_test = MyTest.deployed();
    assert.isTrue(true);
    done();
  });
});

```

### 4.4.Â migrate

```

% truffle migrate --reset			

```

### 4.5.Â compile

```

% truffle compile --all

```

### 4.6.Â test

è¿è¡Œæµ‹è¯•

```

neo@MacBook-Pro ~/ethereum/truffle % truffle test          
Using network 'development'.

  Contract: Migrations
    1) should assert true
    > No events were emitted

  0 passing (31ms)
  1 failing

  1) Contract: Migrations should assert true:
     ReferenceError: Migrations is not defined
      at Context.<anonymous> (test/migrations.js:3:22)

```

è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶

```

neo@MacBook-Pro ~/ethereum/truffle % truffle test test/migrations.js			

```

### 4.7.Â watch

å¯åŠ¨åç›‘æ§æ–‡ä»¶ç³»ç»Ÿçš„è¾¹é¾™å¹¶è‡ªåŠ¨æ„å»ºé¡¹ç›®ã€‚

```

truffle watch			

```

## 5.Â åˆçº¦å¼€å‘

### 5.1.Â æ„é€ æ–¹æ³•

åœ¨ Truffer ä¸­éƒ¨ç½²æ„é€ æ–¹æ³•éœ€è¦å‚æ•°ä¼ é€’ä¾‹å­å¦‚ä¸‹ï¼ŒMyContract éœ€è¦ä¼ é€’å‚æ•° _nameï¼š

```

pragma solidity â°.4.19;

contract MyContract {

    string name;

    function MyContract(string _name) public{
        name = _name;
    }

    function getName() public view returns (string) {
        return name;
    }
}

```

migrations/3_initial_migration.js

```

var MyContract = artifacts.require("./MyContract.sol");

module.exports = function(deployer) {
  deployer.deploy(MyContract,"Netkiller");
};			

```

ç»™æ„é€ æ–¹æ³•ä¼ é€’å˜é‡çš„æ–¹æ³•æ˜¯ deployer.deploy(MyContract,arg1, arg2, ...); arg1 æ˜¯ä¼ é€’çš„å‚æ•°ã€‚

å¤šä¸ªåˆçº¦ä¼ é€’æ–¹æ³•æ˜¯ï¼š

```

deployer.deploy([
  [ContractA, arg1, arg2, ...],
  ContractB,
  [ContractC, arg1]
]);			

```

## 6.Â truffle console

### 6.1.Â è·å–è´¦å·åˆ—è¡¨

```

truffle(development)> web3.eth.accounts
[ '0x8232ef29d29f46d3621350ab7097604247ed4830',
  '0x3c1ba8b80b9a8697f2e34194c2a73a93105be23d' ]

truffle(development)> web3.eth.getAccounts(function(err,res) { accounts = res; });
undefined
truffle(development)> accounts[0]
'0x8232ef29d29f46d3621350ab7097604247ed4830'

```

### 6.2.Â ä½™é¢

```

truffle(development)> web3.eth.getBalance(web3.eth.accounts[0])
BigNumber { s: 1, e: 22, c: [ 206250000 ] }

```

### 6.3.Â å®ä¾‹åŒ–åˆçº¦

```

var contract;
Conference.deployed().then(function(instance){contract=instance;});

```

### 6.4.Â è®¿é—® public å˜é‡

```

truffle(development)> contract.quota.call().then(console.log);
BigNumber { s: 1, e: 1, c: [ 50 ] }
undefined			

```

### 6.5.Â è°ƒç”¨ public å‡½æ•°

```

var contract;
Conference.deployed().then(function(instance){contract=instance;});
contract.buyTicket();

```

å‡½æ•°å‚æ•° call(param1, param2 ......)

```

truffle(development)> contract.balanceOf.call(web3.eth.accounts[0]).then(console.log);
BigNumber { s: 1, e: 27, c: [ 12000000000000 ] }
undefined

```

## 7.Â æµ‹è¯•

### 7.1.Â balanceOf

```

it("should return the balance of token owner", function() {
  var token;
  return Token.deployed().then(function(instance){
    token = instance;
    return token.balanceOf.call(accounts[0]);
  }).then(function(result){
    assert.equal(result.toNumber(), 1000000, 'balance is wrong');
  })
});

```

### 7.2.Â transfer

```

it("should transfer right token", function() {
  var token;
  return Token.deployed().then(function(instance){
    token = instance;
    return token.transfer(accounts[1], 500000);
  }).then(function(){
    return token.balanceOf.call(accounts[0]);
  }).then(function(result){
    assert.equal(result.toNumber(), 500000, 'accounts[0] balance is wrong');
    return token.balanceOf.call(accounts[1]);
  }).then(function(result){
    assert.equal(result.toNumber(), 500000, 'accounts[1] balance is wrong');
  })
});			

```

transferFrom

```

it("should give accounts[1] authority to spend account[0]'s token", function() {
  var token;
  return Token.deployed().then(function(instance){
   token = instance;
   return token.approve(accounts[1], 200000);
  }).then(function(){
   return token.allowance.call(accounts[0], accounts[1]);
  }).then(function(result){
   assert.equal(result.toNumber(), 200000, 'allowance is wrong');
   return token.transferFrom(accounts[0], accounts[2], 200000, {from: accounts[1]});
  }).then(function(){
   return token.balanceOf.call(accounts[0]);
  }).then(function(result){
   assert.equal(result.toNumber(), 300000, 'accounts[0] balance is wrong');
   return token.balanceOf.call(accounts[1]);
  }).then(function(result){
   assert.equal(result.toNumber(), 500000, 'accounts[1] balance is wrong');
   return token.balanceOf.call(accounts[2]);
  }).then(function(result){
   assert.equal(result.toNumber(), 200000, 'accounts[2] balance is wrong');
  })
});

```

Transfer Event

```

it("should show the transfer event", function() {
  var token;
  return Token.deployed().then(function(instance){
    token = instance;
    return token.transfer(accounts[1], 100000);
  }).then(function(result){
    console.log(result.logs[0].event)
  })
});

```

## 8.Â TRUFFLE BOXES

Truffle Boxes [`truffleframework.com/boxes/`](http://truffleframework.com/boxes/) æ˜¯ä¸€äº›æœ‰ç”¨çš„å®ä¾‹ï¼Œå­¦ä¹  truffle å¼€å‘æ˜¯ä¾›å¼€å‘è€…å‚è€ƒå­¦ä¹ ã€‚

ä½¿ç”¨ä¸‹é¢å‘½ä»¤ä¸‹è½½ä¾‹å­

```

truffle unbox webpack

```

## 9.Â Zeppelin Solidity - OpenZeppelin is a library for writing secure Smart Contracts on Ethereum.

OpenZeppelin is an open framework of reusable and secure smart contracts in the Solidity language.

ç½‘ç«™ï¼š [`openzeppelin.org`](https://openzeppelin.org)

Github: [`github.com/OpenZeppelin/zeppelin-solidity`](https://github.com/OpenZeppelin/zeppelin-solidity)

### 9.1.Â ERC20

```

pragma solidity â°.4.19;
import "zeppelin-solidity/contracts/token/StandardToken.sol";

contract NeoCoin is StandardToken {
  string public name = "NeoCoin";
  string public symbol = "BLC";
  uint8 public decimals = 4;
  uint256 public INITIAL_SUPPLY = 666666;
  function NeoCoin() {
    totalSupply = INITIAL_SUPPLY;
    balances[msg.sender] = INITIAL_SUPPLY;
  }
}			

```

### 9.2.Â ERC872

åˆ›å»ºé¡¹ç›®ç›®å½•

```

neo@MacBook-Pro ~/ethereum/truffle % mkdir TokenERC827
neo@MacBook-Pro ~/ethereum/truffle % cd TokenERC827 
neo@MacBook-Pro ~/ethereum/truffle/TokenERC827 % truffle init
Downloading...
Unpacking...
Setting up...
Unbox successful. Sweet!

Commands:

  Compile:        truffle compile
  Migrate:        truffle migrate
  Test contracts: truffle test

```

å®‰è£… zeppelin-solidity

```

neo@MacBook-Pro ~/ethereum/truffle/TokenERC827 % npm init -y
Wrote to /Users/neo/ethereum/truffle/TokenERC827/package.json:

{
  "name": "TokenERC827",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}

neo@MacBook-Pro ~/ethereum/truffle/TokenERC827 % npm install -E zeppelin-solidity
npm notice created a lockfile as package-lock.json. You should commit this file.
npm WARN TokenERC827@1.0.0 No description
npm WARN TokenERC827@1.0.0 No repository field.

+ zeppelin-solidity@1.7.0
added 8 packages in 2.591s

   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
   â”‚                                     â”‚
   â”‚   Update available 5.6.0 â†’ 5.7.1    â”‚
   â”‚       Run npm i npm to update       â”‚
   â”‚                                     â”‚
   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯			

```

åˆçº¦è¢«å®‰è£…åœ¨ node_modules/zeppelin-solidity/contracts ç›®å½•

åˆ›å»ºåˆçº¦å’Œæµ‹è¯•æ–‡ä»¶

```

neo@MacBook-Pro ~/ethereum/truffle/TokenERC827 % truffle create contract TokenERC827
neo@MacBook-Pro ~/ethereum/truffle/TokenERC827 % truffle create test TokenERC827

```

ç¼–è¾‘åˆçº¦æ–‡ä»¶

```

pragma solidity â°.4.19;

import "zeppelin-solidity/contracts/token/ERC827/ERC827Token.sol";

contract TokenERC827 is ERC827Token {

  string public name = "NetkillerCoin";
  string public symbol = "NKC";
  uint8 public decimals = 4;
  uint256 public INITIAL_SUPPLY = 1000000;

  function TokenERC827() public {
    // constructor
    totalSupply = INITIAL_SUPPLY;
    balances[msg.sender] = INITIAL_SUPPLY;
  }
}

```

## ç¬¬Â 16Â ç« Â web3.js - 1.0.0

æ³¨æ„æœ¬ç« é‡‡ç”¨ web3.js v1.0.0 ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ä»åœ¨ beta é˜¶æ®µï¼Œè¿˜æ²¡æœ‰ releaseã€‚

ä½ çœ‹åˆ°ç½‘ä¸Šå¾ˆå¤šå®ä¾‹ï¼Œå®‰ç…§ä¾‹å­çš„æ­¥éª¤æ“ä½œï¼Œå‘ç°æ— æ³•æˆåŠŸï¼Œå¾ˆå¯èƒ½è·Ÿç‰ˆæœ¬æœ‰å…³ã€‚v1.0.0 ä¸ä¹‹å‰çš„ç‰ˆæœ¬è¿˜æ˜¯æœ‰å¾ˆå¤§å·®å¼‚ï¼Œæ‰€ä»¥é€‰æ‹©ç‰ˆæœ¬å¾ˆé‡è¦ã€‚å› ä¸º v1.0.0 å¾ˆå¿«å°±ä¼š release æ‰€ä»¥æœ¬ç« ä¸ä¼šåœ¨ç”¨æ—©èµ·ç‰ˆæœ¬ä¸¾ä¾‹ã€‚

| ![](img/devel.png) |

## 1.Â å¼€å‘ç¯å¢ƒ

```

npm init
npm install web3 --save
npm install solc

```

### 1.1.Â Ropsten æµ‹è¯•ç½‘

```

geth --testnet --syncmode light --cache 1024 --ipcpath /Users/neo/Library/Ethereum/geth.ipc

```

Ropsten æµ‹è¯•ç½‘ä¸Šè½¬è´¦çš„ä¾‹å­

```

fs = require('fs');
var net = require('net');
var Web3 = require('web3');
var web3 = new Web3('/Users/neo/Library/Ethereum/geth.ipc', net);

console.log(web3.version)
const abi = fs.readFileSync('output/TokenERC20.abi', 'utf-8');

const contractAddress = "0x70682386d0dE84B1e549DC3c4305CCB2D261b2a8";
const coinbase = "0xB94054c174995AE2A9E7fcf6c7924635FBa8ECF7";
const toAddress = "0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA";

balanceWei = web3.eth.getBalance(coinbase);
console.log(balanceWei);

const contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000});

web3.eth.personal.unlockAccount(coinbase, "netkiller").then(function(result){
	console.log(result)
	contract.methods.balanceOf(coinbase).call().then(console.log).catch(console.error);
	contract.methods.balanceOf(toAddress).call().then(console.log).catch(console.error);
});

contract.methods.transfer(toAddress, 10000).send().then(function(receipt){

	console.log(receipt);

}).catch(console.error);

contract.methods.balanceOf(coinbase).call().then(console.log).catch(console.error);
contract.methods.balanceOf(toAddress).call().then(console.log).catch(console.error);			

```

## 2.Â truffle-contract

```

neo@MacBook-Pro ~/ethereum/web3 % npm install truffle-contract		

```

## 3.Â è¿æ¥åˆ°ä»¥å¤ªåŠå®¢æˆ·ç«¯

### 3.1.Â http æ–¹å¼

```

var Web3 = require('web3');
var web3 = new Web3('http://localhost:8545');

```

æŸ¥çœ‹è¿æ¥çŠ¶æ€

```

> web3.currentProvider
HttpProvider {
  host: 'http://localhost:8545',
  timeout: 0,
  connected: true,
  headers: undefined }			

```

connected: true è¡¨ç¤ºè¿æ¥æˆåŠŸã€‚

### 3.2.Â WebSocket æ–¹å¼

```

var Web3 = require('web3');
var web3 = new Web3(Web3.givenProvider || 'ws://remotenode.com:8546');

```

### 3.3.Â IPC æ–¹å¼

```

// Using the IPC provider in node.js
var net = require('net');
var Web3 = require('web3');
var web3 = new Web3('/Users/myuser/Library/Ethereum/geth.ipc', net); // mac os path

```

## 4.Â web3

### 4.1.Â version æ˜¾ç¤º web3 ç‰ˆæœ¬å·

```

> web3.version
'1.0.0-beta.30'			

```

## 5.Â web3.eth

### 5.1.Â æŸ¥çœ‹è´¦å·åˆ—è¡¨

```

var Web3 = require('web3');
var web3 = new Web3('http://localhost:8545');

web3.eth.getAccounts().then(console.log);		

```

### 5.2.Â æŸ¥è¯¢çŸ¿å·¥è´¦å·

```

var Web3 = require('web3');
var web3 = new Web3('http://localhost:8545');

web3.eth.getCoinbase().then(console.log);			

```

Callback æ–¹å¼

```

web3.eth.getCoinbase(
    function(error, result){ 
    if (error) {
        console.error(error);
    } else {
        console.log(result); 
    }
 })			

```

### 5.3.Â è·å¾—ä½™é¢

```

web3.eth.getBalance(req.query.address).then(function(balance){
      res.json({"status": true, "code":0, "data":{"account":req.query.address, "balance": web3.utils.fromWei(balance)}}); 
});

```

Callback æ–¹å¼

```

web3.eth.getBalance(req.query.address, function (error, wei) {
    if (!error) {
        var balance = web3.utils.fromWei(wei, 'ether');
        res.json({"status": true, "code":0, "data":{"account":req.query.address, "balance": balance}});
    }else{
        console.log(error);
        res.json({"status": false, "code":1, "data":{"error":error.message}});
    }
});

```

æ•æ‰é”™è¯¯

```

router.get('/balance.json', function(req, res) {

	try {
		web3.eth.getBalance(req.query.address, function (error, wei) {
		    if (!error) {
		        var balance = web3.utils.fromWei(wei, 'ether');
		        res.json({"status": true, "code":0, "data":{"account":req.query.address, "balance": balance}});
		    }else{
		        console.log(error);
		        res.json({"status": false, "code":1, "data":{"error":error.message}})
	       }
		});
	}
	catch(error){
		res.json({"status": false, "code":1, "data":{"error":error.message}});
	};

});				

```

### 5.4.Â web3.eth.sendTransaction()

```

web3.eth.sendTransaction({
    from: coinbase,
    to: '0x2C687bfF93677D69bd20808a36E4BC2999B4767C',
    value: web3.utils.toWei('2','ether')
},
function(error, result){
    if(!error) {
        console.log("#" + result + "#")
    } else {
        console.error(error);
    }
});

var code = "0x603d80600c6000396000f3007c01000000000000000000000000000000000000000000000000000000006000350463c6888fa18114602d57005b6007600435028060005260206000f3";

web3.eth.sendTransaction({from: coinbase, data: code}, function(err, transactionHash) {
  if (!err)
    console.log(transactionHash); // "0x7f9fade1c0d57a7af66ab4ead7c2eb7b11a91385"
});

web3.eth.sendTransaction({from: coinbase, data: code}).then(function(receipt){
        console.log(receipt);
});			

```

### 5.5.Â web3.eth.sendSignedTransaction() ç§é’¥ç­¾åè½¬è´¦

#### 5.5.1.Â ä¾‹å­ 1

```

var account = web3.eth.accounts.privateKeyToAccount(privateKey);

web3.eth.accounts.signTransaction({
  from: account.address,
  to: "0x0013a861865d74b13ba94713d4e84d97c57e7081",
  gas: "3000000",
  value: '100000000000000000',
  gasPrice: '0x09184e72a000',
  data: "0x00"
}, account.privateKey)
.then(function(result) {
  console.log("Results: ", result)

  web3.eth.sendSignedTransaction(result.rawTransaction)
    .on('receipt', console.log);
})			

```

#### 5.5.2.Â ä¾‹å­ 2

è·å– pending çŠ¶æ€çš„åŒºå—

```

[ethereum@netkiller web3.example]$ vim test.js
[ethereum@netkiller web3.example]$ export PRIVATE_KEY=585a219fd6a5583b325e96770a88e69660f404efc06e56be71d82beedb7a989e
[ethereum@netkiller web3.example]$ echo $PRIVATE_KEY
585a219fd6a5583b325e96770a88e69660f404efc06e56be71d82beedb7a989e
[ethereum@netkiller web3.example]$ node
> process.env["PRIVATE_KEY"]
'585a219fd6a5583b325e96770a88e69660f404efc06e56be71d82beedb7a989e'

```

```

[ethereum@netkiller web3.example]$ cat transfer.js
fs = require('fs');
const Web3 = require('web3');
var Tx = require('ethereumjs-tx');
const web3 = new Web3('http://localhost:8545');
console.log(web3.version)

coinbase 	= "0xaa96686a050e4916afbe9f6d8c5107062fa646dd";
address 	= "0x372fda02e8a1eca513f2ee5901dc55b8b5dd7411"
contractAddress = "0x9ABcF16f6685fE1F79168534b1D30056c90B8A8A"

const main = async () => {
	var balance = await web3.eth.getBalance(coinbase);
	console.log(`Balance ETH: ${balance} \n`);

	const abi = fs.readFileSync('output/NetkillerToken.abi', 'utf-8');
	const contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: address});

	var balance = await contract.methods.balanceOf(address).call();
	console.log(`Balance before send: ${balance} \n`);

	var count = await web3.eth.getTransactionCount(coinbase);
	const gasPrice = await web3.eth.getGasPrice();
	console.log(`gasPrice: ${gasPrice}\n`)
    	var gasLimit = 1000000;
	var transferAmount = 1000;
    // Chain ID of Ropsten Test Net is 3, replace it to 1 for Main Net
    var chainId = 1;

    var rawTransaction = {
        "from": coinbase,
        /* "nonce": "0x" + count.toString(16),*/
        "nonce":  web3.utils.toHex(count),
        "gasPrice": web3.utils.toHex(gasPrice),
        "gasLimit": web3.utils.toHex(gasLimit),
        "to": contractAddress,
        "value": "0x0",
        "data": contract.methods.transfer(address, transferAmount).encodeABI(),
        "chainId": web3.utils.toHex(chainId)
    };

    console.log(`Raw of Transaction: \n${JSON.stringify(rawTransaction, null, '\t')}\n`);

    // The private key for myAddress in .env
    var privateKey = new Buffer(process.env["PRIVATE_KEY"], 'hex');
    var tx = new Tx(rawTransaction);
    tx.sign(privateKey);
    var serializedTx = tx.serialize();

    // Comment out these four lines if you don't really want to send the TX right now
    console.log(`Attempting to send signed tx:  ${serializedTx.toString('hex')}\n`);

    var receipt = await web3.eth.sendSignedTransaction('0x' + serializedTx.toString('hex'));

    // The receipt info of transaction, Uncomment for debug
    console.log(`Receipt info: \n${JSON.stringify(receipt, null, '\t')}\n`);

    // The balance may not be updated yet, but let's check
	var balance = await contract.methods.balanceOf(address).call();
	console.log(`Balance after send: ${balance}`);
}

main();

```

```

[ethereum@netkiller web3.example]$ node test.js
1.0.0-beta.34
Balance ETH: 8695480352861952

Balance before send: 100

gasPrice: 3000000000

Raw of Transaction:
{
	"from": "0xaa96686a050e4916afbe9f6d8c5107062fa646dd",
	"nonce": "0x20",
	"gasPrice": "0xb2d05e00",
	"gasLimit": "0xf4240",
	"to": "0x9ABcF16f6685fE1F79168534b1D30056c90B8A8A",
	"value": "0x0",
	"data": "0xa9059cbb000000000000000000000000372fda02e8a1eca513f2ee5901dc55b8b5dd741100000000000000000000000000000000000000000000000000000000000003e8",
	"chainId": "0x1"
}

Attempting to send signed tx:  f8a92084b2d05e00830f4240949abcf16f6685fe1f79168534b1d30056c90b8a8a80b844a9059cbb000000000000000000000000372fda02e8a1eca513f2ee5901dc55b8b5dd741100000000000000000000000000000000000000000000000000000000000003e825a05017058348d8f751cc40e71c13a63b8d8e21683841bd002c9f6bf691d34b6a4ba07df3fa8792aa66cc272ff89373509f6335272a4298e98177536a79c8ab7c947c

Receipt info:
{
	"blockHash": "0x32f45f27040b1df616ff4efd25557416793782541b995a6d4ecbd66f8441783f",
	"blockNumber": 5518045,
	"contractAddress": null,
	"cumulativeGasUsed": 5054117,
	"from": "0xaa96686a050e4916afbe9f6d8c5107062fa646dd",
	"gasUsed": 36184,
	"logs": [
		{
			"address": "0x9ABcF16f6685fE1F79168534b1D30056c90B8A8A",
			"topics": [
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
				"0x000000000000000000000000aa96686a050e4916afbe9f6d8c5107062fa646dd",
				"0x000000000000000000000000372fda02e8a1eca513f2ee5901dc55b8b5dd7411"
			],
			"data": "0x00000000000000000000000000000000000000000000000000000000000003e8",
			"blockNumber": 5518045,
			"transactionHash": "0x203ebcbe1cc8340c4b5a13f4e6c36a4f63142754437e0f43b0ff5e5c0bf512cc",
			"transactionIndex": 104,
			"blockHash": "0x32f45f27040b1df616ff4efd25557416793782541b995a6d4ecbd66f8441783f",
			"logIndex": 94,
			"removed": false,
			"id": "log_7ef3f104"
		}
	],
	"logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000100000000040000000000000000000000000000000008000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000002000000000000000000000000000000001200000000000000000000200000000000000000000000000000100000000000000000000000000000000000",
	"status": true,
	"to": "0x9abcf16f6685fe1f79168534b1d30056c90b8a8a",
	"transactionHash": "0x203ebcbe1cc8340c4b5a13f4e6c36a4f63142754437e0f43b0ff5e5c0bf512cc",
	"transactionIndex": 104
}

Balance after send: 1100

```

### 5.6.Â web3.eth.getBlock() è·å–åŒºå—

è·å– pending çŠ¶æ€çš„åŒºå—

```

web3.eth.getBlock(
    "pending",
function (error, block) {
    if (error) {
        console.error(error);
    } else {
        console.log(block.transactions.length); 
    }
})			

```

## 6.Â è´¦å·ç®¡ç†

### 6.1.Â web3.eth.personal.unlockAccount()

```

var coinbase = "0x5c18a33DF2cc41a1bedDC91133b8422e89f041B7";
//console.log(coinbase)
web3.eth.personal.unlockAccount(coinbase, "your password").then(console.log);

```

## 7.Â æ™ºèƒ½åˆçº¦

### 7.1.Â éƒ¨ç½²åˆçº¦

è§£é”è´¦å·

```

> personal.unlockAccount(eth.accounts[0], "netkiller",5000)
true
> miner.stop()
true
> miner.start(2)			

```

ç¼–è¯‘åªèƒ½åˆçº¦

```

solc --bin --abi --optimize -o ./output helloworld.sol		

```

```

var Web3 = require("web3");
var fs = require ('fs');

var web3 = new Web3("http://localhost:8545");

var abi = JSON.parse(fs.readFileSync('output/Netkiller.abi'));
var bin = '0x'+fs.readFileSync('output/Netkiller.bin').toString();

var myContract = new web3.eth.Contract(abi, null, {
    from: '0x5c18a33DF2cc41a1bedDC91133b8422e89f041B7'
});

myContract.deploy({ data: bin }).send({
    from: '0x5c18a33DF2cc41a1bedDC91133b8422e89f041B7',
    gas: 1500000,
    gasPrice: '30000000000000'
}).then(function(newContractInstance){
    console.log(newContractInstance.options.address) 
});			

```

### 7.2.Â ä½¿ç”¨æœ€ä½³æ‰‹ç»­è´¹åˆ›å»ºåˆçº¦

```

var fs = require('fs');
var net = require('net');
var Web3 = require("web3");
var fs = require ('fs');

var web3 = new Web3("http://localhost:8545");

var abi = JSON.parse(fs.readFileSync('NetkillerAdvancedToken.abi'));
var bin = '0x'+fs.readFileSync('NetkillerAdvancedToken.bin').toString();
var address = '0x22c57F0537414FD95b9f0f08f1E51d8b96F14029';
var myContract = new web3.eth.Contract(abi, null, {from: address});

var options = { data: bin, arguments: [100000000, 'Netkiller Test Coin', 'NTC', 18] };

web3.eth.getGasPrice().then(function(gasPrice){
    myContract.deploy(options).estimateGas(function(err, gas){
        console.log(gas);
        web3.eth.personal.unlockAccount(req.body.from, req.body.password).then(function(error){
            myContract.deploy(options).send({
                from: address,
                gas: gas,
                gasPrice: gasPrice
            }).then(function(newContractInstance){
                console.log(newContractInstance.options.address) 
            });
        });
    });
});			

```

### 7.3.Â è°ƒç”¨åˆçº¦

éƒ¨ç½²æ™ºèƒ½åˆçº¦ï¼Œä½ å¯ä»¥ä½¿ç”¨é’±åŒ…éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Truffer éƒ¨ç½²ï¼Œä¸ç®¡ä½ é‡‡ç”¨ä»€ä¹ˆæ–¹å¼ï¼Œæœ€ç»ˆæˆ‘ä»¬éœ€è¦åˆçº¦åœ°å€ã€‚

```

pragma solidity â°.4.18;

contract MetaCoin {
	mapping (address => uint) balances;

	event Transfer(address indexed _from, address indexed _to, uint256 _value);

	function MetaCoin() public {
		balances[tx.origin] = 10000;
	}

	function sendCoin(address receiver, uint amount) public returns(bool sufficient) {
		if (balances[msg.sender] < amount) return false;
		balances[msg.sender] -= amount;
		balances[receiver] += amount;
		Transfer(msg.sender, receiver, amount);
		return true;
	}

	function getBalanceInEth(address addr) public view returns(uint){
		return convert(getBalance(addr),2);
	}

	function getBalance(address addr) public view returns(uint) {
		return balances[addr];
	}

	function convert(uint amount,uint conversionRate) public pure returns (uint convertedAmount)
	{
		return amount * conversionRate;
	}

}

```

è¿™é‡Œä½¿ç”¨ Truffle éƒ¨ç½²

```

neo@MacBook-Pro ~/ethereum/truffle % truffle compile --all
Compiling ./contracts/MetaCoin.sol...
Writing artifacts to ./build/contracts

neo@MacBook-Pro ~/ethereum/truffle % truffle migrate --reset
Using network 'development'.

Running migration: 5_initial_migration.js
  Deploying MetaCoin...
  ... 0x9c006b398733a1d8679cbb00493ca75ff063f51c34521ae67a70523deeebf9c4
  MetaCoin: 0xfb88de099e13c3ed21f80a7a1e49f8caecf10df6
Saving successful migration to network...
  ... 0x755a48ef99e488d7cf8460d718773a5afe73f760fb87697e51c40f3e6086f10b
Saving artifacts...

```

å¾—åˆ°åˆçº¦åœ°å€ MetaCoin: 0xfb88de099e13c3ed21f80a7a1e49f8caecf10df6

ç¼–è¯‘åˆçº¦è·å¾— abi æ¥å£

```

neo@MacBook-Pro ~/ethereum/truffle % solc --bin --abi --optimize -o ./output contracts/MetaCoin.sol 
neo@MacBook-Pro ~/ethereum/truffle % cat output/MetaCoin.abi 
[{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getBalanceInEth","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"sendCoin","outputs":[{"name":"sufficient","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"amount","type":"uint256"},{"name":"conversionRate","type":"uint256"}],"name":"convert","outputs":[{"name":"convertedAmount","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Transfer","type":"event"}]			

```

```

var Web3 = require("web3");
// åˆ›å»º web3 å¯¹è±¡
var web3 = new Web3("http://localhost:9545");
// åˆçº¦ ABI
var abi = [{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getBalanceInEth","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"sendCoin","outputs":[{"name":"sufficient","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"amount","type":"uint256"},{"name":"conversionRate","type":"uint256"}],"name":"convert","outputs":[{"name":"convertedAmount","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Transfer","type":"event"}];
// åˆçº¦åœ°å€
var address = "0xfb88de099e13c3ed21f80a7a1e49f8caecf10df6";
var tokenContract = new web3.eth.Contract(abi, address);
// è°ƒç”¨å‡½æ•°
tokenContract.methods.getBalance("0x627306090abab3a6e1400e9345bc60c78a8bef57").call(null,function(error,result){
        console.log("getBalance "+result);
});
tokenContract.methods.getBalanceInEth("0x627306090abab3a6e1400e9345bc60c78a8bef57").call(null,function(error,result){
        console.log("getBalanceInEth "+result);
});	
tokenContract.methods.getBalance("0xf17f52151ebef6c7334fad080c5704d77216b732").call(null,function(error,result){
        console.log("getBalance 2 "+result);
});	
tokenContract.methods.sendCoin("0xf17f52151ebef6c7334fad080c5704d77216b732",387).send({from: '0x627306090abab3a6e1400e9345bc60c78a8bef57'})
.on('transactionHash', function(hash){
}).on('confirmation', function(confirmationNumber, receipt){
}).on('receipt', function(receipt){
    // receipt example
    console.log(receipt); //æŸ¥è¯¢è¿™é‡Œå¯ä»¥å¾—åˆ°ç»“æœ
}).on('error', console.error); // If a out of gas error, the second parameter is the receipt.

```

è¿è¡Œç»“æœ

```

getBalance 10000
getBalanceInEth 20000
getBalance 2 0
{ transactionHash: '0x0f7514413865219d70873634c00d1b4746c5faa436283786f5414b483b6d6333',
  transactionIndex: 0,
  blockHash: '0x5a7662d14f78b6b4d64b05c0ec1e1e641bd39440467f0476409f4e49c21f287a',
  blockNumber: 11,
  gasUsed: 51024,
  cumulativeGasUsed: 51024,
  contractAddress: null,
  status: 1,
  events: 
   { Transfer: 
      { logIndex: 0,
        transactionIndex: 0,
        transactionHash: '0x0f7514413865219d70873634c00d1b4746c5faa436283786f5414b483b6d6333',
        blockHash: '0x5a7662d14f78b6b4d64b05c0ec1e1e641bd39440467f0476409f4e49c21f287a',
        blockNumber: 11,
        address: '0xFB88dE099e13c3ED21F80a7a1E49f8CAEcF10df6',
        type: 'mined',
        id: 'log_8b567824',
        returnValues: [Result],
        event: 'Transfer',
        signature: '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',
        raw: [Object] } } }

```

å†æ¬¡è¿è¡Œ

```

getBalance 9613
getBalanceInEth 19226
getBalance 2 387
{ transactionHash: '0x6d33487d9067494288190f7a64b3118c20560479e01afe8d53e37ca46a6001e4',
  transactionIndex: 0,
  blockHash: '0x28f6d416c68dbbd698d1a0b0fdc4ce842694d82318a38ea6395413fd15397642',
  blockNumber: 12,
  gasUsed: 36024,
  cumulativeGasUsed: 36024,
  contractAddress: null,
  status: 1,
  events: 
   { Transfer: 
      { logIndex: 0,
        transactionIndex: 0,
        transactionHash: '0x6d33487d9067494288190f7a64b3118c20560479e01afe8d53e37ca46a6001e4',
        blockHash: '0x28f6d416c68dbbd698d1a0b0fdc4ce842694d82318a38ea6395413fd15397642',
        blockNumber: 12,
        address: '0xFB88dE099e13c3ED21F80a7a1E49f8CAEcF10df6',
        type: 'mined',
        id: 'log_e5cfee46',
        returnValues: [Result],
        event: 'Transfer',
        signature: '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',
        raw: [Object] } } }

```

ç¬¬äºŒæ¬¡è¿è¡Œä¼šæ‰“å°å‡ºè´¦å· 2 çš„ä½™é¢

ä»£ç ä¼˜åŒ–ï¼Œç”±äºå¼€å‘é˜¶æ®µ abi æ¥å£ç»å¸¸å˜åŒ–ï¼Œä» solc ç¼–è¯‘çš„ abi æ–‡ä»¶ä¸­ç›´æ¥è¯»å–æœ€ä¸ºæ–¹ä¾¿ã€‚

```

const fs = require ('fs');
var Web3 = require("web3");
var web3 = new Web3("http://localhost:9545");
var abi = JSON.parse(fs.readFileSync('MetaCoin.abi'));
var address = "0xfb88de099e13c3ed21f80a7a1e49f8caecf10df6";
var tokenContract = new web3.eth.Contract(abi, address);
tokenContract.methods.getBalance("0x627306090abab3a6e1400e9345bc60c78a8bef57").call(null,function(error,result){
        console.log("getBalance "+result);
});	

```

### 7.4.Â event

ä¸‹é¢ä»¥ ERC20 ä»£å¸ä¸ºä¾‹æ¼”ç¤ºäº‹ä»¶å¦‚ä½•å·¥ä½œ

```

neo@MacBook-Pro ~/ethereum/web3 % cat event.js 

fs = require('fs');
var net = require('net');
var Web3 = require('web3');
var web3 = new Web3('/Users/neo/Library/Ethereum/geth.ipc', net);

console.log(web3.version)
const abi = fs.readFileSync('output/TokenERC20.abi', 'utf-8');

const contractAddress = "0x70682386d0dE84B1e549DC3c4305CCB2D261b2a8";
const coinbase = "0xB94054c174995AE2A9E7fcf6c7924635FBa8ECF7";
const toAddress = "0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA";

balanceWei = web3.eth.getBalance(coinbase);
console.log(balanceWei);

const contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000});

contract.events.Transfer({
    fromBlock: 0,
    toBlock:'latest'
}, function(error, event){ console.log(event); })
.on('data', function(event){
    console.log(event); // same results as the optional callback above
})
.on('changed', function(event){
    // remove event from local database
})
.on('error', console.error);

```

è¿è¡Œåç¨‹åºä¸ä¼šé€€å‡ºï¼Œä¼šæºæºä¸æ–­çš„æ‰“å°å‡ºæ¯ç¬”äº¤æ˜“

```

neo@MacBook-Pro ~/ethereum/web3 % node event.js 

{ address: '0x70682386d0dE84B1e549DC3c4305CCB2D261b2a8',
  blockNumber: 0,
  transactionHash: '0x0000000000000000000000000000000000000000000000000000000000000000',
  transactionIndex: 0,
  blockHash: '0x0000000000000000000000000000000000000000000000000000000000000000',
  logIndex: 0,
  removed: false,
  id: 'log_247b1779',
  returnValues: 
   Result {
     '0': '0xB94054c174995AE2A9E7fcf6c7924635FBa8ECF7',
     '1': '0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA',
     '2': '10000000',
     from: '0xB94054c174995AE2A9E7fcf6c7924635FBa8ECF7',
     to: '0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA',
     value: '10000000' },
  event: 'Transfer',
  signature: '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',
  raw: 
   { data: '0x0000000000000000000000000000000000000000000000000000000000989680',
     topics: 
      [ '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',
        '0x000000000000000000000000b94054c174995ae2a9e7fcf6c7924635fba8ecf7',
        '0x000000000000000000000000f56b81a2bcb964d2806071e9be4289a5559bb0fa' ] } }

```

## 8.Â 

### 8.1.Â 

```

const Web3 = require('web3');

const web3 = new Web3(new Web3.providers.WebsocketProvider('wss://mainnet.infura.io/ws'));

var subscription = web3.eth.subscribe('pendingTransactions', function(error, result){
    if (!error)
        console.log(result);
})
.on("data", function(transaction){
    console.log(transaction);
});

// unsubscribes the subscription
subscription.unsubscribe(function(error, success){
    if(success)
        console.log('Successfully unsubscribed!');
});

```

```

const Web3 = require('web3');

const web3wss = new Web3(new Web3.providers.WebsocketProvider('wss://mainnet.infura.io/ws'));
const web3 = new Web3("https://mainnet.infura.io/CsS9shwaAab0z7B4LP2d");

var subscription = web3wss.eth.subscribe('pendingTransactions', function(error, result){
    if (!error){
        console.log("--------------------" + result +"--------------------");
        var receipt = web3.eth.getTransactionReceipt(result).then(console.log);
     }
})
.on("data", function(transaction){
    console.log(transaction);
});

// unsubscribes the subscription
subscription.unsubscribe(function(error, success){
    if(success)
        console.log('Successfully unsubscribed!');
});

```

### 8.2.Â è®¢é˜… newBlockHeaders

```

#!/usr/bin/env node
const Web3 = require('web3');

const web3 = new Web3(new Web3.providers.WebsocketProvider('wss://mainnet.infura.io/ws'));

const subscription = web3.eth.subscribe('newBlockHeaders', (error, blockHeader) => {
  if (error) return console.error(error);

  console.log('Successfully subscribed!', blockHeader);
}).on('data', (blockHeader) => {
  console.log('data: ', blockHeader);
});

// unsubscribes the subscription
subscription.unsubscribe((error, success) => {
  if (error) return console.error(error);

  console.log('Successfully unsubscribed!');
});			

```

### 8.3.Â è®¢é˜… log

```

#!/usr/bin/env node
const Web3 = require('web3');

const web3 = new Web3(new Web3.providers.WebsocketProvider('wss://mainnet.infura.io/ws'));

var subscription = web3.eth.subscribe('logs', {
	fromBlock: 5709426,
    address: '0x7fFdCccC3E7e33C6163393195A947A6d45f25814'
}, function(error, result){
    if (!error)
        console.log(result);
})
.on("data", function(log){
    console.log(log);
})
.on("changed", function(log){
});

// unsubscribes the subscription
subscription.unsubscribe(function(error, success){
    if(success)
        console.log('Successfully unsubscribed!');
});

```

### 8.4.Â è®¢é˜…åŒæ­¥çŠ¶æ€

```

const Web3 = require('web3');

const web3 = new Web3(new Web3.providers.WebsocketProvider('wss://mainnet.infura.io/ws'));

var subscription = web3.eth.subscribe('syncing', function(error, sync){
    if (!error)
        console.log(sync);
})
.on("data", function(sync){
    // show some syncing stats
})
.on("changed", function(isSyncing){
    if(isSyncing) {
        // stop app operation
    } else {
        // regain app operation
    }
});

// unsubscribes the subscription
subscription.unsubscribe(function(error, success){
    if(success)
        console.log('Successfully unsubscribed!');
});

```

## 9.Â utils

### 9.1.Â web3.utils.toWei()

```

web3.utils.toWei('1', 'ether');
> "1000000000000000000"

web3.utils.toWei('1', 'finney');
> "1000000000000000"

web3.utils.toWei('1', 'szabo');
> "1000000000000"

web3.utils.toWei('1', 'shannon');
> "1000000000"			

```

### 9.2.Â å°† Wei è½¬æ¢åˆ°æŒ‡å®šå•ä½

```

web3.utils.fromWei('1', 'ether');
> "0.000000000000000001"

web3.utils.fromWei('1', 'finney');
> "0.000000000000001"

web3.utils.fromWei('1', 'szabo');
> "0.000000000001"

web3.utils.fromWei('1', 'shannon');
> "0.000000001"

```

## 10.Â web3 ç¼–è¯‘åˆçº¦

### 10.1.Â solc.compile

```

pragma solidity â°.4.0;
contract HelloWorldContract {
  function sayHi() constant returns (string){
    return 'Hello World';
  }
}			

```

```

const fs = require ('fs');
const solc = require ('solc');
const input = fs.readFileSync('HelloWorldContract.sol');
const output = solc.compile(input.toString(), 1);
for (var contractName in output.contracts){
 console.log(contractName + ': ' + output.contracts[contractName].bytecode)
}

```

```

> const fs = require ('fs');
undefined
> const solc = require ('solc');

undefined
> const input = fs.readFileSync('HelloWorldContract.sol');
undefined
> const output = solc.compile(input.toString(), 1);

undefined
> for (var contractName in output.contracts){
...  console.log(contractName + ': ' + output.contracts[contractName].bytecode)
... }
:HelloWorldContract: 6060604052341561000f57600080fd5b61014e8061001e6000396000f3006060604052600436106100405763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630c49c36c8114610045575b600080fd5b341561005057600080fd5b6100586100cf565b60405160208082528190810183818151815260200191508051906020019080838360005b8381101561009457808201518382015260200161007c565b50505050905090810190601f1680156100c15780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6100d7610110565b60408051908101604052600b81527f48656c6c6f20576f726c640000000000000000000000000000000000000000006020820152905090565b602060405190810160405260008152905600a165627a7a723058206dc75b1be2caa91f056c3682d24390fcb090a96bbf1b2b4c11cdd807518dc03c0029
undefined

```

## 11.Â web3admin

[`github.com/DecentricCorp/web3admin`](https://github.com/DecentricCorp/web3admin)

```

npm install web3admin

```

```

const Web3 = require('web3')
var web3 = new Web3('http://localhost:8545')
const web3Admin = require('web3admin')
setTimeout(function(){
    web3Admin.extend(web3)
    console.log("turning on mining", web3.miner.start())
    console.log("isMining?", web3.eth.mining)
    console.log("isMining?", web3.eth.mining)
}, 1000)

```

## 12.Â ABI-encoded

ABI-encoded å®é™…ä¸Šå°±æ˜¯æ„é€ æ–¹æ³•å˜é‡æ•°æ®

```

var abi = require('ethereumjs-abi')

var parameterTypes = ["address", "uint256", "bool"];
var parameterValues = ["0x1234567812345678", "0x314159268", true];

var encoded = abi.rawEncode(parameterTypes, parameterValues);

console.log(encoded.toString('hex'));

```

åœ¨çº¿ç”Ÿæˆå·¥å…· https://abi.sonnguyen.ws/ï¼Œ https://abi.hashex.org/

è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥æ‰¾åˆ° ABI æ•°æ® https://etherscan.io/tx/0xc53f52b287ec1c71e9d203dd08cc68035ef40bf5155f8b0711da227c01d84d70 æŸ¥çœ‹ Input Data: 0029 ä¹‹åæ‰€æœ‰çš„æ•°æ®å°±æ˜¯ ABI

## 13.Â å®ç”¨ä¾‹å­

### 13.1.Â æ•°æ®å†™å…¥åˆ°åŒºå—é“¾ä¸­

åšä¸€ç¬”äº¤æ˜“ï¼Œå¹¶å†™å…¥æ•°æ®åˆ°åŒºå—é“¾ä¸­

```

let Web3 = require("web3");
let fs = require("fs");
let web3 = new Web3("http://localhost:8545");

let log = {
    time:(new Date).getTime(),
    type:"info",
    msg:"Web3 Test!!!"
};
let str = JSON.stringify(log);
console.log(str);
let data = Buffer.from(str).toString('hex');
data = '0x'+data;
console.log(data);

//å°†æ•°æ®å†™å…¥åˆ°äº¤æ˜“ä¸­
let coinbase = "0x5c18a33df2cc41a1beddc91133b8422e89f041b7"
console.log(coinbase)
let user1 = "0xc2b9e316f246d35052118e51b55c75bfe99d247e";
web3.eth.personal.unlockAccount(coinbase, "coinbase");
let address = web3.eth.sendTransaction({
    from:coinbase,
    to:user1,
    value:'0x00',
    data:data
},function(error, hash){
    console.log(hash);
});

```

è¿è¡Œä¸Šé¢ç¨‹åºï¼Œä¼šäº§ç”Ÿä¸€ä¸ªäº¤æ˜“ï¼Œè®°ä¸‹ hash å€¼ï¼Œç„¶åå¯åŠ¨æŒ–çŸ¿ã€‚

```

> miner.start();
null
# è¿‡ä¸€æ®µæ—¶é—´ååœæ­¢
> miner.stop();
true

```

ç„¶åæŸ¥çœ‹è¿™æ¯”äº¤æ˜“

```

let Web3 = require("web3");
let fs = require("fs");
let web3 = new Web3("http://localhost:8545");
let address ="0xb15681eb4bdb6b9670d305fb341ebbc95d45c2ede0ea5034ef432b74f30b1b4f";
//ä»äº¤æ˜“åœ°å€è·å–æ•°æ®
web3.eth.getTransaction(address).then(console.log);

web3.eth.getTransaction(address,function(error, result){
    //console.log(result);
    inputData = result.input;
    res_str = Buffer.from(inputData.replace('0x',''),'hex').toString();
    res_json = JSON.parse(res_str);
    console.log(res_json);
});			

```

ç»“æœè¾“å‡º

```

{ blockHash: '0x78dacc2af60900d2e4cae90b71e27446e6e883df36c53f21cbc9e071f7a586f4',
  blockNumber: 1258,
  from: '0x5c18a33DF2cc41a1bedDC91133b8422e89f041B7',
  gas: 90000,
  gasPrice: '18000000000',
  hash: '0xb15681eb4bdb6b9670d305fb341ebbc95d45c2ede0ea5034ef432b74f30b1b4f',
  input: '0x7b2274696d65223a313531383933313435323537372c2274797065223a22696e666f222c226d7367223a22576562332054657374212121227d',
  nonce: 4,
  to: '0xc2b9e316F246d35052118E51B55C75BfE99d247e',
  transactionIndex: 0,
  value: '0',
  v: '0x41',
  r: '0x7fcd86c7fd975a0e98bd0e61a99da950b0155cd6c4581fefa4defbdcd404a930',
  s: '0x16f14ce1fbfadb9d59f343f8ac235cdd73dcedec5db1025ef91206b8bb17a827' }
{ time: 1518931452577, type: 'info', msg: 'Web3 Test!!!' }

```

{ time: 1518931452577, type: 'info', msg: 'Web3 Test!!!' } å°±æ˜¯ä¿å­˜åœ¨åŒºå—é“¾ä¸­çš„æ•°æ®ã€‚

### 13.2.Â ç¼–è¯‘éƒ¨ç½²æ™ºèƒ½åˆçº¦

```

console.log('Setting up...');
const fs = require ('fs');
const solc = require ('solc');
const Web3 = require ('web3');
const web3 = new Web3("http://localhost:8545");
console.log('Reading Contract...');
const input = fs.readFileSync('Netkiller.sol');
console.log('Compiling Contract...');
const output = solc.compile(input.toString(), 1);
//console.log(output);
const bytecode = output.contracts[':Netkiller'].bytecode;
//console.log(bytecode);
const abi = output.contracts[':Netkiller'].interface;
//console.log(abi);
//Contract Object
//const helloWorldContract = web3.eth.contract(JSON.parse(abi));

var myContract = new web3.eth.Contract(JSON.parse(abi), '0x5c18a33df2cc41a1beddc91133b8422e89f041b7', {
    from: '0x5c18a33df2cc41a1beddc91133b8422e89f041b7', // default from address
    gasPrice: '20000000000' // default gas price in wei, 20 gwei in this case
});

console.log('unlocking Coinbase account');
const password = "chen1980";
web3.eth.personal.unlockAccount("0x5c18a33df2cc41a1beddc91133b8422e89f041b7", password,100);

console.log("Deploying the contract");

```

### 13.3.Â éƒ¨ç½²åˆçº¦

```

var Web3 = require('web3');
var net = require('net');
var web3 = new Web3(new Web3.providers.IpcProvider("~/netkiller/ethereum/geth.ipc",net));

var abi = [...];
var bin = "";

var tokenContract = new web3.eth.Contract(abi, null, {
    from: '0xFB88dE099e13c3ED21F80a7a1E49f8CAEcF10df6' // ç›®å‰ web3 æ²¡æœ‰ api æ¥è§£é”è´¦æˆ·,åªèƒ½è‡ªå·±äº‹å…ˆè§£é”
});

tokenContract.deploy({
    data: bin,
    arguments: ['netkiller'] // è¿™é‡Œæ˜¯æ„é€ å‡½æ•°ä¼ å€¼ï¼Œå¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œè¯·åˆ é™¤è¿™è¡Œã€‚
}).send({
    from: '0xFB88dE099e13c3ED21F80a7a1E49f8CAEcF10df6',
    gas: 1500000,
    gasPrice: '30000000000000'
}, function(error, transactionHash){
    console.log("deploy tx hash:"+transactionHash)
})
.on('error', function(error){ console.error(error) })
.on('transactionHash', function(transactionHash){ console.log("hash:",transactionHash)})
.on('receipt', function(receipt){
   console.log(receipt.contractAddress) // contains the new contract address
})
.on('confirmation', function(confirmationNumber, receipt){console.log("receipt,",receipt)})
.then(function(newContractInstance){
    console.log(newContractInstance.options.address) // instance with the new contract address
});			

```

### 13.4.Â ERC20 Example

é€šè¿‡ Web3 æ“ä½œä»£å¸è½¬è´¦

```

fs = require('fs');
const Web3 = require('web3');
const web3 = new Web3('http://localhost:8545');
web3.version
const abi = fs.readFileSync('output/TokenERC20.abi', 'utf-8');

const contractAddress = "0x05A97632C197a0496bc939C4e666c2E03Cb95DD4";
const toAddress = "0x2C687bfF93677D69bd20808a36E4BC2999B4767C";

var coinbase;

web3.eth.getCoinbase().then(function (address){
  coinbase = address;
  console.log(address);
});

const contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000});

contract.methods.balanceOf('0x5c18a33DF2cc41a1bedDC91133b8422e89f041B7').call().then(console.log).catch(console.error);
contract.methods.balanceOf('0x2C687bfF93677D69bd20808a36E4BC2999B4767C').call().then(console.log).catch(console.error);

web3.eth.personal.unlockAccount(coinbase, "netkiller").then(console.log);
contract.methods.transfer('0x2C687bfF93677D69bd20808a36E4BC2999B4767C', 100).send().then(console.log).catch(console.error);

contract.methods.balanceOf('0x2C687bfF93677D69bd20808a36E4BC2999B4767C').call().then(console.log).catch(console.error);

```

## 14.Â HD Wallet(Hierarchical Deterministic wallet)

BIP32 å®šä¹‰ Hierarchical Deterministic wallet (ç®€ç§° "HD Wallet")ï¼Œæ˜¯ä¸€ä¸ªç³»ç»Ÿå¯ä»¥ä»å•ä¸ª seed äº§ç”Ÿæ ‘çŠ¶ç»“æ„å‚¨å­˜å¤šç»„ keypairsï¼ˆç§é’¥å’Œå…¬é’¥ï¼‰

BIP39 å®šä¹‰é’±åŒ…åŠ©è®°è¯å’Œ seed ç”Ÿæˆè§„åˆ™ï¼Œä¸€èˆ¬ç”± 12 -24 ä¸ªå•å­—ç»„æˆï¼Œç§°ä¸º mnemonicã€‚åŠ©è®°è¯åˆ—è¡¨ï¼Œhttps://github.com/bitcoin/bips/blob/master/bip-0039/english.txt

BIP44 åŸºäº BIP32 çš„ç³»ç»Ÿï¼Œèµ‹äºˆæ ‘çŠ¶ç»“æ„ä¸­çš„å„å±‚ç‰¹æ®Šçš„æ„ä¹‰ã€‚è®©åŒä¸€ä¸ª seed å¯ä»¥æ”¯æ´å¤šå¸ç§ã€å¤šå¸æˆ·ç­‰ ï¼ˆbtc ä¸€èˆ¬æ˜¯ m/44'/0'/0â€™/0ï¼Œeth ä¸€èˆ¬æ˜¯ m/44'/60'/0'/0ï¼‰

```

npm install bip39 ethereumjs-wallet ethereumjs-util --save

```

### 14.1.Â åˆ›å»ºé¡¹ç›®

å¯¼å…¥å¼€å‘åŒ…

```

var bip39 = require('bip39')
var hdkey = require('ethereumjs-wallet/hdkey')
var util = require('ethereumjs-util')

```

ç”Ÿæˆ mnemonic code

```

var mnemonic = bip39.generateMnemonic()

```

ç”Ÿæˆ HD Wallet é¦–å…ˆå°† mnemonic code è½¬æˆ binary äºŒè¿›åˆ¶çš„ seed

```

var seed = bip39.mnemonicToSeed(mnemonic)

```

ç”Ÿæˆ Master Key åœ°å€ "m/44'/60'/0'/0/0" ä½¿ç”¨ seed ç”Ÿæˆ HD Walletã€‚

```

var hdwallet = hdkey.fromMasterSeed(seed)

```

ä»è·¯å¾„ m/44'/60'/0'/0/0 å¯¼å…¥ Master Key å¹¶ç”Ÿæˆ Wallet ä¸­ç¬¬ä¸€ä¸ªå¸æˆ·çš„ç¬¬ä¸€ç»„ keypairã€‚

```

var key1 = hdwallet.derivePath("m/44'/60'/0'/0/0")

```

ä½¿ç”¨ keypair ä¸­çš„å…¬é’¥äº§ç”Ÿ addressã€‚

```

var address1 = util.pubToAddress(key1._hdkey._publicKey, true)

```

è·å¾—ä»¥å¤ªåŠé’±åŒ…åœ°å€

```

address1 = util.toChecksumAddress(address1.toString('hex'))

```

æ“ä½œæ¼”ç¤º

```

[ethereum@netkiller web3.js]$ node
> var bip39 = require('bip39')
undefined
> var hdkey = require('ethereumjs-wallet/hdkey')
undefined
> var util = require('ethereumjs-util')
undefined
> var mnemonic = bip39.generateMnemonic()
undefined
> mnemonic
'client dune unfair assume level width bind control mad member old crystal'
> var seed = bip39.mnemonicToSeed(mnemonic)
undefined
> seed
<Buffer 51 12 a3 47 f3 bb b9 24 80 ac 05 6c ce 8c 9f dd b2 98 c8 d3 06 8f 4d 0b 6c 90 86 aa d4 b6 41 36 35 5f b4 42 89 b5 e4 6d 43 9b cf 8d 6a d7 9b 45 3e 5a ... >
> var hdwallet = hdkey.fromMasterSeed(seed)
undefined
> hdwallet
EthereumHDKey {
  _hdkey:
   HDKey {
     versions: { private: 76066276, public: 76067358 },
     depth: 0,
     index: 0,
     _privateKey: <Buffer 1c 37 00 1b f7 1d a5 de 3a 8a 4c e8 54 2d 69 78 81 f3 aa a9 d5 3e 64 74 bd ea 76 28 44 07 d3 04>,
     _publicKey: <Buffer 03 77 fc 6b c7 f3 e3 51 01 db 95 0a a9 0f c0 7f 31 40 af 75 f8 7a 4f 5a c3 4c 93 ac cb 44 a3 20 5f>,
     chainCode: <Buffer 51 fe 32 23 a0 ab aa 10 5d ff 90 28 26 dc fc 86 fc 5f 8c dc 1b b7 39 31 7e 2d b8 a4 77 33 45 3a>,
     _fingerprint: 1056395940,
     parentFingerprint: 0,
     _identifier: <Buffer 3e f7 52 a4 ed 86 00 f7 ac 4d 1a b4 15 1c 0d 87 cd 7d fe de> } }
> var key1 = hdwallet.derivePath("m/44'/60'/0'/0/0")
undefined
> key1
EthereumHDKey {
  _hdkey:
   HDKey {
     versions: { private: 76066276, public: 76067358 },
     depth: 5,
     index: 0,
     _privateKey: <Buffer f5 92 b7 bf 06 ca 9f d7 69 6b a9 5d 6e d8 e3 57 de 6a 23 79 b6 d5 fe 1f fd 53 c6 b4 b0 63 cd 4a>,
     _publicKey: <Buffer 02 99 ff bb ea 3d 80 e1 8c d5 54 a1 6e 6a ca b2 4b 7e 69 3d 1d 2d 8a 68 f8 61 bf 18 dc 4a f8 d0 26>,
     chainCode: <Buffer 5a 9b b2 0e 7a 62 07 b0 82 db e5 5a 1f 17 4b 47 8a 64 cf 40 67 d5 49 09 89 da aa 33 66 00 d7 e6>,
     _fingerprint: 3510386860,
     parentFingerprint: 1205114865,
     _identifier: <Buffer d1 3c 40 ac 09 92 fc d7 a4 14 8e d8 91 d1 a7 21 55 7e b8 e3> } }
> var address1 = util.pubToAddress(key1._hdkey._publicKey, true)
undefined
> address1
<Buffer 37 2f da 02 e8 a1 ec a5 13 f2 ee 59 01 dc 55 b8 b5 dd 74 11>
> address1.toString('hex')
'372fda02e8a1eca513f2ee5901dc55b8b5dd7411'

```

### 14.2.Â ç”Ÿæˆç¬¬äºŒä¸ªé’±åŒ…

åªéœ€é€’å¢æœ€åä¸€ä½æ•°å³å¯ "m/44'/60'/0'/0/1"ï¼Œ "m/44'/60'/0'/0/2"ï¼Œ"m/44'/60'/0'/0/3"

```

var key2 = hdwallet.derivePath("m/44'/60'/0'/0/1")

```

ä½¿ç”¨ keypair ä¸­çš„å…¬é’¥äº§ç”Ÿ addressã€‚

```

var address2 = util.pubToAddress(key2._hdkey._publicKey, true)

```

è·å¾—ä»¥å¤ªåŠé’±åŒ…åœ°å€

```

address2 = util.toChecksumAddress(address2.toString('hex'))

```

### 14.3.Â Mnemonic Code Converter

[`iancoleman.io/bip39/`](https://iancoleman.io/bip39/)

è¾“å…¥ mnemonicï¼Œé€‰æ‹© ETH - Ethereum

| ![](img/mnemonic.png) |

ç³»ç»Ÿå°†è®¡ç®—å‡ºé’±åŒ…åœ°å€

| ![](img/walletpath.png) |

### 14.4.Â HD Wallet ä¾‹å­

```

var bip39 = require('bip39');
var hdkey = require('ethereumjs-wallet/hdkey');
var util = require('ethereumjs-util');

mnemonic = 'client dune unfair assume level width bind control mad member old crystal';
var seed = bip39.mnemonicToSeed(mnemonic);
var hdwallet = hdkey.fromMasterSeed(seed);
var key1 = hdwallet.derivePath("m/44'/60'/0'/0/0");
var address1 = util.pubToAddress(key1._hdkey._publicKey, true);
var address = util.toChecksumAddress(address1.toString('hex'));

coinbase = "0xaa96686a050e4916afbe9f6d8c5107062fa646dd";
contractAddress = "0x9ABcF16f6685fE1F79168534b1D30056c90B8A8A"

console.log(address);

fs = require('fs');
const Web3 = require('web3');
const HDWalletProvider = require("truffle-hdwallet-provider");

const web3 = new Web3(new HDWalletProvider(mnemonic,'http://localhost:8545'));
console.log(web3.version)

web3.eth.getBalance("0xaa96686a050e4916afbe9f6d8c5107062fa646dd").then(function(balance){
      console.log( web3.utils.fromWei(balance) );
});

web3.eth.getBalance(address).then(function(balance){
      console.log( web3.utils.fromWei(balance) );
});

const abi = fs.readFileSync('output/NetkillerToken.abi', 'utf-8');
const contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: address, gas: 100000});

contract.methods.balanceOf(coinbase).call().then(console.log).catch(console.log);
contract.methods.balanceOf(address).call().then(console.log).catch(console.log);

```

### 14.5.Â è·å¾—é’±åŒ…åœ°å€å’Œç§é’¥

```

const bip39 = require('bip39');
const hdkey = require('ethereumjs-wallet/hdkey');

const mnemonic = 'client dune unfair assume level width bind control mad member old crystal';
const hdwallet = hdkey.fromMasterSeed(bip39.mnemonicToSeed(mnemonic));
const path = "m/44'/60'/0'/0/0";
const wallet = hdwallet.derivePath(path).getWallet();

const address = `0x${wallet.getAddress().toString('hex')}`;
const privateKey = wallet.getPrivateKey().toString('hex');
// wallet._privKey.toString('hex');
console.log(`Address: ${address}`);
console.log(`Private Key: ${privateKey}`);

```

### 14.6.Â truffle.js ä¾‹å­

```

npm install truffle-hdwallet-provider

```

```

var HDWalletProvider = require("truffle-hdwallet-provider");

var mnemonic = "opinion destroy betray ...";

module.exports = {
  networks: {
    development: {
      host: "localhost",
      port: 8545,
      network_id: "*" // Match any network id
    },
    ropsten: {
      provider: new HDWalletProvider(mnemonic, "https://ropsten.infura.io/"),
      network_id: 3
    }
  }
};

```

### 14.7.Â Mnemonic To Seed åŠ å¯†

æ²¡æœ‰åŠ å¯† seed æ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œä»»ä½•äººéƒ½èƒ½é€šè¿‡ Mnemonic è¿˜åŸå‡ºå…¬é’¥å’Œç§é’¥ã€‚

```

var bip39 = require('bip39')
var hdkey = require('ethereumjs-wallet/hdkey')
var util = require('ethereumjs-util')
var mnemonic = bip39.generateMnemonic()

var password = "http://www.netkiller.cn"
var seed = bip39.mnemonicToSeed(mnemonic, password)
var hdwallet = hdkey.fromMasterSeed(seed)
var key1 = hdwallet.derivePath("m/44'/60'/0'/0/0")
var address1 = util.pubToAddress(key1._hdkey._publicKey, true)
address1 = util.toChecksumAddress(address1.toString('hex'))

```

### 14.8.Â ä¸­æ–‡åŠ©è®°è¯

```

var bip39 = require('bip39')
var mnemonic = bip39.generateMnemonic(128, null, bip39.wordlists.chinese_simplified)
console.log(mnemonic)

var seed = bip39.mnemonicToSeed(mnemonic)
var hdwallet = hdkey.fromMasterSeed(seed)
var key1 = hdwallet.derivePath("m/44'/60'/0'/0/0")
var address1 = util.pubToAddress(key1._hdkey._publicKey, true)
address1 = util.toChecksumAddress(address1.toString('hex'))

```

æ¼”ç¤º

```

> var bip39 = require('bip39')
undefined

> var mnemonic = bip39.generateMnemonic(128, bip39.randomBytes, bip39.wordlists.chinese_simplified)
undefined

> console.log(mnemonic)
ä¿„ åˆ¤ èŒ è¯— ä»ª å æ–¹ éƒ½ æ¿€ è¾“ å¤± ç¨€
undefined

```

### 14.9.Â ä»£å¸è½¬è´¦

## 15.Â ä» .ethereum/keystore æ–‡ä»¶å¯¼å…¥ç§é’¥

```

[ethereum@netkiller web3.example]$ npm install keythereum

```

ä»£ç 

```

var keyth=require('keythereum')
// Mac
// keystore = './Appdata/roaming/ethereum';
// Ubuntu 
// keystore = '~/.ethereum';
keystore = '../.ethereum';
var keyobj=keyth.importFromFile('0x372fda02e8a1eca513f2ee5901dc55b8b5dd7411',keystore)
var privateKey=keyth.recover('12345678',keyobj)
privateKey.toString('hex')

```

æ“ä½œæ¼”ç¤º

```

> var keyth=require('keythereum')
undefined
> keystore = '../.ethereum';
'../.ethereum'
> var keyobj=keyth.importFromFile('0x372fda02e8a1eca513f2ee5901dc55b8b5dd7411',keystore)
undefined
> var privateKey=keyth.recover('12345678',keyobj)
undefined
> privateKey.toString('hex')
'f592b7bf06ca9fd7696ba95d6ed8e357de6a2379b6d5fe1ffd53c6b4b063cd4a'

```

## 16.Â Express + web3.js å®ç°ç®€å•ç½‘é¡µé’±åŒ…

ä¸‹é¢çš„ä¾‹å­ï¼Œå®ç°æŸ¥è¯¢ä½™é¢ï¼Œåˆ›å»ºè´¦å·ï¼ŒETH è½¬è´¦ï¼Œä»£å¸è½¬è´¦ã€‚

### 16.1.Â åˆ›å»ºé¡¹ç›®

å®‰è£…ä»¥å¤ªåŠç¯å¢ƒ

```

curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/gcc/gcc.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/golang/golang-1.10.2.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/centos/go-ethereum-1.8.8.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/systemd/private.sh | bash

curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/node-v10.1.0.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/node.js/binrary/profile.d.sh | bash
curl -s https://raw.githubusercontent.com/oscm/shell/master/blockchain/ethereum/truffle/truffle.sh | bash

```

å®‰è£…å¼€å‘åŒ…

```

npm install express
npm install web3
npm install ejs

```

### 16.2.Â ä¸»ç¨‹åº main.js

```

var express = require('express');
var app = express();

app.use(express.static('public'));
app.set("view engine","ejs");
app.set('views', __dirname + '/views');  

var async = require('async');

fs = require('fs');
var net = require('net');
var Web3 = require('web3');
var web3 = new Web3('/home/ethereum/.ethereum/geth.ipc', net);
const abi = fs.readFileSync( __dirname + '/abi/NKC.abi', 'utf-8');
const coinbase = "0xaa96686a050e4916afbe9f6d62fa646dd8c51070"
const contractAddress = "0x5F75DA091aBb25e055B91172C04371Ff4Dd563a0";

console.log(web3.version)

app.get('/', function (req, res) {
  //  res.send('Hello World');
   res.render("index",{}); 
})

app.get('/account.html', function (req, res) {
  var accounts;
  web3.eth.getAccounts(function(err, acc) {
    accounts = acc
    res.render("account",{"accounts":accounts}); 
  });
})

app.get('/new', function (req, res) {
  web3.eth.personal.newAccount(req.query.password).then(function(){
    res.redirect('/account.html');
  });
})

app.get('/balance.html', function (req, res) {

  web3.eth.getAccounts(function(err, accounts) {
    res.render("balance",{"accounts":accounts}); 
  });
})
app.post('/showbalance.html', function (req, res) {
  // web3.eth.getBalance(req.query.account).then(function(balance){
  //   res.render("transfer",{"account":req.query.account, "balance": balance}); 
  // });

  res.render("showbalance",{"account": "sss", "balance": 1000}); 
})

app.get('/getbalance.html', function (req, res) {
  var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000});
  web3.eth.getBalance(req.query.account).then(function(balance){
    contract.methods.balanceOf(req.query.account).call().then(function(token){
      // console.log(contract.symbol.call());
      // contract.methods.symbol().call().then(console.log);
      contract.methods.symbol().call().then(function(name){
        res.render("showbalance",{"account":req.query.account, "balance": web3.utils.fromWei(balance, 'ether'), "token": token, "name": name}); 
      });

    });

  });
})

app.get('/transfer.html', function (req, res) {
  var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000});
  web3.eth.getAccounts(function(err, accounts) {
    contract.methods.symbol().call().then(function(symbol){
      res.render("transfer",{"accounts":accounts, "symbol": symbol}); 
    });
  });
})

app.get('/send', function (req, res) {
  // console.log(req.query)
  web3.eth.personal.unlockAccount(req.query.from, req.query.password).then(function(error){
    if(req.query.token == "ETH"){  
      web3.eth.sendTransaction({
        from: req.query.from,
        to: req.query.to,
        value: web3.utils.toWei(req.query.amount ,'ether')
      },
      function(error, result){
          if(!error) {
              console.log("#" + result + "#")
              res.render("done",{"hash":result}); 
          } else {
              console.error(error);
          }
      });

    }else{
      var contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: req.query.from , gas: 1000000});
      contract.methods.transfer(req.query.to, req.query.amount).send().then(function(hash){
        console.log(hash)
        res.render("done",{"hash":hash.transactionHash}); 
      });
    }
  });
})

var server = app.listen(8080, function () {

  var host = server.address().address
  var port = server.address().port

  console.log("åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://%s:%s", host, port)

})

```

### 16.3.Â ABI æ–‡ä»¶ abi/NKC.abi

```

[{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"burn","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_value","type":"uint256"}],"name":"burnFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"},{"name":"_extraData","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"initialSupply","type":"uint256"},{"name":"tokenName","type":"string"},{"name":"tokenSymbol","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Burn","type":"event"}]			

```

### 16.4.Â é¡µé¢è§†å›¾

#### 16.4.1.Â views/account.ejs

```

<%- include header.ejs %>

<h1>Users</h1>
<ul id="accounts">
    <% accounts.forEach(function(account, index){ %>
    <li><%= index %>, <%= account %></li>
    <% }) %>
</ul>

<p>
æ–°å»ºè´¦å·
<form method="get" action="/new">
    å¯†ç ï¼š<input type="password" name="password" />
    <input type="submit" value="æ–°å»ºè´¦å·" />
</form>
</p>

```

#### 16.4.2.Â views/balance.ejs

```

<%- include header.ejs %>

<h1>Account</h1>
<form method="get" action="/getbalance.html">

    <select name="account">
        <% accounts.forEach(function(account, index){ %>
        <option value ="<%= account %>"><%= account %></option>
        <% }) %>
    </select>
    <input type="submit" value="Submit" />
</form>

```

#### 16.4.3.Â views/done.ejs

```

<%- include header.ejs %>

<p>è½¬è´¦å®Œæˆ</p>
<p>æŸ¥çœ‹äº¤æ˜“
<a href="https://etherscan.io/tx/<%= hash %>" target="etherscan">ä¸»ç½‘<%= hash %></a> <br />
</p>

```

#### 16.4.4.Â views/header.ejs

```

<a href="/account.html">è´¦å·</a> | <a href="/balance.html">ä½™é¢</a> | <a href="/transfer.html">è½¬è´¦</a>
<br /> 
<hr />

```

#### 16.4.5.Â views/index.ejs

```

<%- include header.ejs %>

Welcome !!!

```

#### 16.4.6.Â views/showbalance.ejs

```

<%- include header.ejs %>
<p>
<h1>Account: <%= account %>, Balance: <%= balance %></h1>
</p>

<p>
    Token: <%= token%> <%= name%> 
</p>

```

#### 16.4.7.Â views/transfer.ejs

```

<%- include header.ejs %>

<h1>Account</h1>
<form method="get" action="/send">
    Fromï¼š
    <select name="from">
        <% accounts.forEach(function(account, index){ %>
        <option value ="<%= account %>"><%= account %></option>
        <% }) %>
    </select>
    <br />
    To:
    <select name="to">
        <% accounts.forEach(function(account, index){ %>
        <option value ="<%= account %>"><%= account %></option>
        <% }) %>
    </select>

    <select name="token">
        <option value ="ETH">ETH</option>
        <option value ="<%= symbol %>"><%= symbol %></option>
    </select>

    <br />
    é‡‘é¢: <input type="text" name="amount" /> ETH
    <br />
    å¯†ç ï¼š<input type="password" name="password" />
    <br />
    <input type="submit" value="Submit" />
</form>

```

### 16.5.Â å¯åŠ¨ Node æœåŠ¡

```

neo@MacBook-Pro ~/example % node main.js

```

æµè§ˆå™¨è®¿é—® http://localhost:8080/ å¯ä»¥è¿›å…¥é’±åŒ…

## ç¬¬Â 17Â ç« Â web3j v3.4.0 - Jave Client

å®˜æ–¹ç½‘ç«™ [`web3j.io`](https://web3j.io)

æ–‡æ¡£ [`github.com/web3j/web3j/tree/master/docs/source`](https://github.com/web3j/web3j/tree/master/docs/source)

Java å®¢æˆ·ç«¯ä¸ Server ä¹‹é—´é‡‡ç”¨ json-rpc åè®®è¿æ¥ã€‚

## 1.Â å®‰è£…å‘½ä»¤è¡Œå·¥å…·

web3j å‘½ä»¤ç”¨äºå°† sol åˆçº¦æ–‡ä»¶è½¬æ¢ä¸º java æ–‡ä»¶ã€‚

### 1.1.Â Mac OS

```

brew tap web3j/web3j
brew install web3j

neo@MacBook-Pro ~ % web3j

              _      _____ _     _        
             | |    |____ (_)   (_)       
__      _____| |__      / /_     _   ___  
\ \ /\ / / _ \ '_ \     \ \ |   | | / _ \ 
 \ V  V /  __/ |_) |.___/ / | _ | || (_) |
  \_/\_/ \___|_.__/ \____/| |(_)|_| \___/ 
                         _/ |             
                        |__/              

Usage: web3j version|wallet|solidity ...	

```

### 1.2.Â äºŒè¿›åˆ¶åŒ…å®‰è£…

ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ [`github.com/web3j/web3j/releases`](https://github.com/web3j/web3j/releases)

```

wget https://github.com/web3j/web3j/releases/download/v3.2.0/web3j-3.2.0.zip
unzip web3j-3.2.0.zip

$ ./web3j-3.2.0/bin/web3j

              _      _____ _     _
             | |    |____ (_)   (_)
__      _____| |__      / /_     _   ___
\ \ /\ / / _ \ '_ \     \ \ |   | | / _ \
 \ V  V /  __/ |_) |.___/ / | _ | || (_) |
  \_/\_/ \___|_.__/ \____/| |(_)|_| \___/
                         _/ |
                        |__/

Usage: web3j version|wallet|solidity ...

```

## 2.Â å¯åŠ¨ä»¥å¤ªåŠ

é¦–å…ˆå¯åŠ¨æœåŠ¡

```

neo@netkiller ~ % geth --networkid 123456 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" --nodiscover 
INFO [02-01|23:35:12] Starting peer-to-peer node               instance=Geth/v1.8.8-stable-4bb3c89d/linux-amd64/go1.10.2	
INFO [02-01|23:35:12] Allocated cache and file handles         database=/home/neo/.ethereum/geth/chaindata cache=128 handles=1024
INFO [02-01|23:35:12] Initialised chain configuration          config="{ChainID: 15 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: <nil> EIP155: 0 EIP158: 0 Byzantium: <nil> Engine: unknown}"
INFO [02-01|23:35:12] Disk storage enabled for ethash caches   dir=/home/neo/.ethereum/geth/ethash count=3
INFO [02-01|23:35:12] Disk storage enabled for ethash DAGs     dir=/home/neo/.ethash               count=2
INFO [02-01|23:35:12] Initialising Ethereum protocol           versions="[63 62]" network=123456
INFO [02-01|23:35:12] Loaded most recent local header          number=719 hash=61330bâ€¦82786e td=108754979
INFO [02-01|23:35:12] Loaded most recent local full block      number=719 hash=61330bâ€¦82786e td=108754979
INFO [02-01|23:35:12] Loaded most recent local fast block      number=719 hash=61330bâ€¦82786e td=108754979
INFO [02-01|23:35:12] Loaded local transaction journal         transactions=0 dropped=0
INFO [02-01|23:35:12] Regenerated local transaction journal    transactions=0 accounts=0
WARN [02-01|23:35:12] Blockchain not empty, fast sync disabled 
INFO [02-01|23:35:12] Starting P2P networking 
INFO [02-01|23:35:12] RLPx listener up                         self="enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@[::]:30303?discport=0"
INFO [02-01|23:35:12] IPC endpoint opened: /home/neo/.ethereum/geth.ipc 
INFO [02-01|23:35:12] HTTP endpoint opened: http://0.0.0.0:8545 
INFO [02-01|23:35:15] Mapped network port                      proto=tcp extport=30303 intport=30303 interface="UPNP IGDv1-IP1"		

```

Web3j å°†ä½¿ç”¨è¿™ä¸ªåœ°å€è¿æ¥ HTTP endpoint opened: http://your_ip_address:8545

## 3.Â Maven pom.xml æ–‡ä»¶

```

<project  
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<groupId>cn.netkiller</groupId>
	<artifactId>ethereum</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<packaging>jar</packaging>

	<name>ethereum</name>
	<url>http://maven.apache.org</url>

	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
	</properties>

	<dependencies>
		<dependency>
			<groupId>org.web3j</groupId>
			<artifactId>core</artifactId>
			<version>3.4.0</version>
		</dependency>
	</dependencies>
</project>

```

## 4.Â Java ä¸ Solidity æ•°æ®ç±»å‹æ˜ å°„å…³ç³»

```

boolean -> bool
BigInteger -> uint/int
byte[] -> bytes
String -> string and address types
List<> -> dynamic/static array			

```

## 5.Â å¸¸é‡

```

DefaultBlockParameterName.LATEST	å½“å‰å—åœ°å€
DefaultBlockParameterName.PENDING	å¤„ç†ä¸­å—åœ°å€		

```

### 5.1.Â é»˜è®¤ Gas

è·å–é»˜è®¤ GAS Transaction.DEFAULT_GAS

]

```

package cn.netkiller.wallet.ethereum;

import org.web3j.protocol.core.methods.request.Transaction;

public class Test {

	public Test() {
		// TODO Auto-generated constructor stub
	}

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		System.out.println(Transaction.DEFAULT_GAS);

	}

}

```

### 5.2.Â é»˜è®¤ gaslimit gasprice

å·²ç»åºŸå¼ƒ

```

BigInteger gasLimit = Contract.GAS_LIMIT;
BigInteger gasPrice = Contract.GAS_PRICE;			

```

æ¨èä½¿ç”¨

```

			BigInteger gasPrice = BigInteger.ZERO;
			BigInteger gasLimit = BigInteger.ZERO;

			gasPrice = DefaultGasProvider.GAS_PRICE;
			gasLimit = DefaultGasProvider.GAS_LIMIT;

			System.out.println("gasPrice: " + gasPrice.toString());
			System.out.println("gasLimit: " + gasLimit.toString());			

```

## 6.Â è¿æ¥åˆ°æœåŠ¡å™¨è·å–ç‰ˆæœ¬å·

```

package cn.netkiller.ethereum;

import java.io.IOException;

import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.methods.response.Web3ClientVersion;
import org.web3j.protocol.http.HttpService;

public class Web3JClient {
	// TODO Auto-generated method stub

	public static void main(String[] args) {
		String url = "http://172.16.0.1:8545/";
		Web3j web3j = Web3j.build(new HttpService(url)); // defaults to http://localhost:8545/

		try {
			Web3ClientVersion web3ClientVersion = web3j.web3ClientVersion().send();
			String clientVersion = web3ClientVersion.getWeb3ClientVersion();
			System.out.println(clientVersion);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}

}

```

è¿è¡Œç»“æœ

```

Geth/v1.8.8-stable-4bb3c89d/linux-amd64/go1.10.2				

```

é™¤äº† TCP æ–¹å¼è¿æ¥ï¼Œè¿˜æ”¯æŒ IPC æ–¹å¼ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒå°‘ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ localhost æ›¿ä»£ã€‚

```

// OS X/Linux/Unix:
Web3j web3 = Web3j.build(new UnixIpcService("/path/to/socketfile"));
...

// Windows
Web3j web3 = Web3j.build(new WindowsIpcService("/path/to/namedpipefile"));
...			

```

## 7.Â è·å¾—ä»¥å¤ªåŠçŠ¶æ€ä¿¡æ¯

### 7.1.Â è·å–å®¢æˆ·ç«¯ç‰ˆæœ¬

```

			Web3ClientVersion web3ClientVersion = web3j.web3ClientVersion().send();
			String clientVersion = web3ClientVersion.getWeb3ClientVersion();
			System.out.println("å®¢æˆ·ç«¯ç‰ˆæœ¬: " + clientVersion);			

```

### 7.2.Â åè®®ç‰ˆæœ¬

```

			EthProtocolVersion ethProtocolVersion = web3j.ethProtocolVersion().send();
			String protocolVersion = ethProtocolVersion.getProtocolVersion();
			System.out.println("åè®®ç‰ˆæœ¬" + protocolVersion);

```

### 7.3.Â æŸ¥çœ‹å½“å‰åŒºå—

```

			EthBlockNumber ethBlockNumber = web3j.ethBlockNumber().send();
			BigInteger blockNumber = ethBlockNumber.getBlockNumber();
			System.out.println("å½“å‰åŒºå—ï¼š" + blockNumber);			

```

### 7.4.Â åŒæ­¥çŠ¶æ€

```

			EthSyncing ethSyncing = web3j.ethSyncing().send();
			boolean isSyncing = ethSyncing.isSyncing();
			System.out.println("åŒæ­¥çŠ¶æ€ï¼š" + isSyncing);

```

### 7.5.Â æŒ–çŸ¿çŠ¶æ€

```

			EthMining ethMining = web3j.ethMining().send();
			boolean isMining = ethMining.isMining();
			System.out.println("æŒ–çŸ¿çŠ¶æ€ï¼š" + isMining);

```

### 7.6.Â çŸ¿å·¥è´¦å·

```

			EthCoinbase ethCoinbase = web3j.ethCoinbase().send();
			String coinbase = ethCoinbase.getAddress();
			System.out.println("çŸ¿å·¥è´¦å·ï¼š" + coinbase);

```

### 7.7.Â æŒ–çŸ¿é€Ÿåº¦

```

			EthHashrate ethHashrate = web3j.ethHashrate().send();
			BigInteger hashRate = ethHashrate.getHashrate();
			System.out.println("æŒ–çŸ¿é€Ÿåº¦ï¼š" + hashRate);

```

### 7.8.Â Gas ä»·æ ¼

```

			EthGasPrice ethGasPrice = web3j.ethGasPrice().send();
			BigInteger gasPrice = ethGasPrice.getGasPrice();
			System.out.println("Gas ä»·æ ¼ï¼š" + gasPrice);

```

### 7.9.Â è¯„ä¼° GAS

```

	EthEstimateGas ethEstimateGas = web3.ethEstimateGas(Transaction.createEthCallTransaction(credentials.getAddress(), null, encodedFunction)).sendAsync().get();
	BigInteger estimateGas = ethEstimateGas.getAmountUsed();
	System.out.println(estimateGas);			

    ethEstimateGas.getAmountUsed().divide(BigInteger.valueOf(100));

```

### 7.10.Â èŠ‚ç‚¹æ•°é‡

```

			NetPeerCount netPeerCount = web3j.netPeerCount().send();
			BigInteger peerCount = netPeerCount.getQuantity();
			System.out.println("èŠ‚ç‚¹æ•°é‡ï¼š" + peerCount);

```

## 8.Â å•ä½è½¬æ¢

### 8.1.Â GWEI to WEI

GWEI è½¬åŒ–ä¸º WEI

```

BigInteger wei = Convert.toWei(BigDecimal.valueOf(0.001), Convert.Unit.GWEI).toBigInteger();

BigInteger value = Convert.toWei("1.0", Convert.Unit.ETHER).toBigInteger();

```

## 9.Â è´¦å·ç®¡ç†

### 9.1.Â è·å¾—è´¦å·åˆ—è¡¨

```

	public List<String> getAccountlist() {

		try {
			return web3j.ethAccounts().send().getAccounts();
		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;
	}				

```

### 9.2.Â è·å¾—è´¦å·ä¿¡æ¯

```

	public String getAccount(int index) {
		String account = null;

		try {
			account = web3j.ethAccounts().send().getAccounts().get(index);

		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return account;
	}				

```

### 9.3.Â åˆ›å»ºè´¦å·

```

package cn.netkiller.example.ethereum.account;

import java.io.IOException;
import java.math.BigInteger;
import java.util.List;

import org.web3j.protocol.admin.Admin;
import org.web3j.protocol.admin.methods.response.NewAccountIdentifier;
import org.web3j.protocol.admin.methods.response.PersonalListAccounts;
import org.web3j.protocol.admin.methods.response.PersonalUnlockAccount;
//import org.web3j.protocol.http.HttpService;
import org.web3j.protocol.ipc.UnixIpcService;

public class AccountTest {
	private static Admin admin;

	public AccountTest() {
		// TODO Auto-generated constructor stub
		// admin = Admin.build(new HttpService("http://127.0.0.1:8545"));
		admin = Admin.build(new UnixIpcService("/Users/neo/Library/Ethereum/geth.ipc"));

	}

	private void createAccount() throws IOException {
		String password = "12345678";
		NewAccountIdentifier newAccountIdentifier = admin.personalNewAccount(password).send();
		String address = newAccountIdentifier.getAccountId();
		System.out.println("New account address: " + address);
	}

	public static void main(String[] args) throws IOException {
		// TODO Auto-generated method stub
		AccountTest account = new AccountTest();
		account.createAccount();
	}

}

```

### 9.4.Â è§£é”è´¦å·

```

Admin web3j = Admin.build(new HttpService());  // defaults to http://localhost:8545/
PersonalUnlockAccount personalUnlockAccount = web3j.personalUnlockAccount("0x000...", "a password").sendAsync().get();
if (personalUnlockAccount.accountUnlocked()) {
    // send a transaction
}				

```

```

package cn.netkiller.example.ethereum.account;

import java.io.IOException;
import java.math.BigInteger;
import java.util.List;

import org.web3j.protocol.admin.Admin;
import org.web3j.protocol.admin.methods.response.NewAccountIdentifier;
import org.web3j.protocol.admin.methods.response.PersonalListAccounts;
import org.web3j.protocol.admin.methods.response.PersonalUnlockAccount;
//import org.web3j.protocol.http.HttpService;
import org.web3j.protocol.ipc.UnixIpcService;

public class AccountTest {
	private static Admin admin;

	public AccountTest() {
		// TODO Auto-generated constructor stub
		// admin = Admin.build(new HttpService("http://127.0.0.1:8545"));
		admin = Admin.build(new UnixIpcService("/Users/neo/Library/Ethereum/geth.ipc"));

	}

	private void unlockAccount() {
		String address = "0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA";
		String password = "12345678";
		// è´¦å·è§£é”æŒç»­æ—¶é—´ å•ä½ç§’ ç¼ºçœå€¼ 300 ç§’
		BigInteger unlockDuration = BigInteger.valueOf(60L);
		try {
			PersonalUnlockAccount personalUnlockAccount = admin.personalUnlockAccount(address, password, unlockDuration).send();
			Boolean isUnlocked = personalUnlockAccount.accountUnlocked();
			System.out.println("Account unlock " + isUnlocked);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	public static void main(String[] args) throws IOException {
		// TODO Auto-generated method stub
		AccountTest account = new AccountTest();
		account.unlockAccount();
	}

}

```

## 10.Â Credentials

```

package cn.netkiller.ethereum.credentials;

import java.io.IOException;
import java.math.BigInteger;

import org.web3j.crypto.Credentials;
import org.web3j.crypto.ECKeyPair;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.http.HttpService;

public class CredentialsTest {

	public static void main(String[] args) {
		// TODO Auto-generated method stub

		String url = "http://172.16.0.1:8545/";
		Web3j web3j = Web3j.build(new HttpService(url)); // defaults to http://localhost:8545/

		try {
			String account = web3j.ethAccounts().send().getAccounts().get(0);
			Credentials credentials = Credentials.create(account);
			ECKeyPair keyPair = credentials.getEcKeyPair();
			BigInteger privateKey = keyPair.getPrivateKey();
			BigInteger publicKey = keyPair.getPublicKey();

			System.out.println(privateKey);
			System.out.println("---");
			System.out.println(publicKey);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}

}

```

## 11.Â äº¤æ˜“

### 11.1.Â è·å–ä½™é¢

```

	public BigInteger getBalance(String account) throws IOException {

		EthGetBalance ethGetBalance = web3j.ethGetBalance(account, DefaultBlockParameterName.LATEST).send();
		BigInteger balance = ethGetBalance.getBalance();
		return balance;

	}				

```

### 11.2.Â é€šè¿‡ Keystore è½¬è´¦

```

	public void transfer(String account, float coin)
			throws InterruptedException, IOException, TransactionException, Exception {
		String password = "";
		String walletfile = "/Users/neo/netkiller/UTC--2018-01-20T04-04-06.786586541Z--83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6";
		Credentials credentials = WalletUtils.loadCredentials(password, walletfile);
		TransactionReceipt transactionReceipt = Transfer.sendFunds(web3j, credentials, account, BigDecimal.valueOf(coin), Unit.ETHER).send();
		System.out.println(transactionReceipt.getStatus());
	}

```

### 11.3.Â é€šè¿‡ç§é’¥è½¬è´¦

```

package cn.netkiller.ethereum.transaction;

import org.web3j.crypto.Credentials;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.methods.response.TransactionReceipt;
import org.web3j.protocol.http.HttpService;
import org.web3j.tx.Transfer;
import org.web3j.utils.Convert;

import java.math.BigDecimal;

public class TransactionTest {
	public static void main(String[] args) throws Exception {
		Web3j web3j = Web3j.build(new HttpService("https://ropsten.infura.io/CsS9shwaAab0z7B4LP2d"));
		String toAddress = "0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA";
		Credentials credentials = Credentials.create("16690967F2BADABE13A067066558537228D8AF63ECCB022FFBDC970EC717BC3A");

		TransactionReceipt transactionReceipt = Transfer.sendFunds(web3j, credentials, toAddress, BigDecimal.valueOf(0.002), Convert.Unit.ETHER).send();

		System.out.println(transactionReceipt.getTransactionHash());
	}
}

```

### 11.4.Â æŒ‡å®š gas è´¹ç”¨

```

package cn.netkiller.ethereum.transaction;

import org.web3j.crypto.Credentials;
import org.web3j.crypto.TransactionEncoder;
import org.web3j.crypto.RawTransaction;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.DefaultBlockParameterName;
import org.web3j.protocol.core.methods.response.EthGetTransactionCount;
import org.web3j.protocol.core.methods.response.EthSendTransaction;
import org.web3j.protocol.http.HttpService;
import org.web3j.utils.Convert;
import org.web3j.utils.Numeric;

import java.math.BigInteger;
import java.util.concurrent.ExecutionException;

public class RawTransactionTest {

	public static void main(String[] args) throws InterruptedException, ExecutionException {
		// TODO Auto-generated method stub
		// è®¾ç½®éœ€è¦çš„çŸ¿å·¥è´¹
		BigInteger gasPrice = BigInteger.valueOf(18_000_000_000L);
		BigInteger gasLimit = BigInteger.valueOf(4_300_000);
		// System.out.println(gasPrice);

		// è¿æ¥ ropsten æµ‹è¯•ç¯å¢ƒï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ infura è¿™ä¸ªå®¢æˆ·ç«¯
		Web3j web3j = Web3j.build(new HttpService("https://ropsten.infura.io/CsS9shwaAab0z7B4LP2d"));
		// è½¬å‡ºè´¦æˆ·åœ°å€
		String fromAddress = "0x22c57F0537414FD95b9f0f08f1E51d8b96F14029";
		// æ¥æ”¶è´¦æˆ·åœ°å€
		String toAddress = "0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA";
		// è½¬è´¦äººçš„ç§é’¥
		Credentials credentials = Credentials.create("16697AC066558537CADABF68BDE13A06790967F2BC3A228DB022FF0EC717B3EC");

		// Nonce å°±ç›¸å½“äºæ•°æ®ä¸­ PK ä¸»é”®ï¼Œæ¯æ¬¡ Nonce ä¼šåš +1 æ“ä½œ
		EthGetTransactionCount ethGetTransactionCount = web3j.ethGetTransactionCount(fromAddress, DefaultBlockParameterName.LATEST).sendAsync().get();
		BigInteger nonce = ethGetTransactionCount.getTransactionCount();

		// åˆ›å»ºäº¤æ˜“å¹¶è½¬ 0.05 ä¸ªä»¥å¤ªå¸
		BigInteger value = Convert.toWei("0.05", Convert.Unit.ETHER).toBigInteger();
		RawTransaction rawTransaction = RawTransaction.createEtherTransaction(nonce, gasPrice, gasLimit, toAddress, value);

		// å¯¹äº¤æ˜“åšç­¾å
		byte[] signedMessage = TransactionEncoder.signMessage(rawTransaction, credentials);
		String hexValue = Numeric.toHexString(signedMessage);

		// å‘é€äº¤æ˜“
		EthSendTransaction ethSendTransaction = web3j.ethSendRawTransaction(hexValue).sendAsync().get();
		String transactionHash = ethSendTransaction.getTransactionHash();

		// è·å¾—åˆ° transactionHash åå°±å¯ä»¥åˆ°ä»¥å¤ªåŠçš„ç½‘ç«™ä¸ŠæŸ¥è¯¢è¿™ç¬”äº¤æ˜“çš„çŠ¶æ€äº†
		System.out.println("https://ropsten.etherscan.io/tx/" + transactionHash);

	}

}

```

### 11.5.Â æŸ¥è¯¢ Transaction Information

```

	public TransactionReceipt getTransactionReceipt(String transactionHash) throws InterruptedException, ExecutionException {
		EthGetTransactionReceipt ethGetTransactionReceipt = web3.ethGetTransactionReceipt(transactionHash).sendAsync().get();
		return ethGetTransactionReceipt.getResult();
	}			

```

æ‰§è¡Œè¿”å›ç»“æœ

```

TransactionReceipt{
	transactionHash='0xece52bdbc6d4fa0c8eba7578a7c6e537883265199fa07ef8e5b1038e4bcdefb9', 
	transactionIndex='0x13', blockHash='0x2642b35670872a0e024d30ab2393b6bd4f7dab449bf4fc3eac067e2677cbc085', 
	blockNumber='0x344a79', cumulativeGasUsed='0x806f54', gasUsed='0x8fee', contractAddress='null', root='null', 
	status='0x1', from='0x22c57f0537414fd95b9f0f08f1e51d8b96f14029', to='0xb3cedc76e75fcd278c988b22963c2f35c99c10b7', l
	ogs=[Log{removed=false, logIndex='0xa', transactionIndex='0x13', transactionHash='0xece52bdbc6d4fa0c8eba7578a7c6e537883265199fa07ef8e5b1038e4bcdefb9', 
	blockHash='0x2642b35670872a0e024d30ab2393b6bd4f7dab449bf4fc3eac067e2677cbc085', blockNumber='0x344a79', 
	address='0xb3cedc76e75fcd278c988b22963c2f35c99c10b7', data='0x000000000000000000000000000000000000000000000000000000000000000a', 
	type='null', topics=[0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef, 0x00000000000000000000000022c57f0537414fd95b9f0f08f1e51d8b96f14029, 0x000000000000000000000000cdf0253d8362d6c3334c8f28a6bfd74c90d03d92]}], 
	logsBloom='0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000008020000001000000000000000000000000000800000000000000000000000000000000000000000000000000000000010000000000000000000004000000000000000000000000000800000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000002000000000000000400000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
}

```

æ³¨æ„ï¼šè¯¥å‡½æ•°åªèƒ½è¿”å› TxReceipt Status: Success çŠ¶æ€æ•°æ®ï¼Œæ— æ³•è¿”å› Pending çŠ¶æ€çš„æ•°æ®ã€‚

### 11.6.Â äº¤æ˜“ç»“æœæŸ¥è¯¢

```

EthTransaction transaction = web3.ethGetTransactionByHash("TRANSACTION_HASH").sendAsync().get();
System.out.println(transaction.getResult());				

```

### 11.7.Â RawTransaction ç¼–ç ä¸è§£ç 

```

		String hexTransaction = Numeric.toHexString(TransactionEncoder.encode(rawTransaction));
		RawTransaction tx1 = TransactionDecoder.decode(hexTransaction);			

```

## 12.Â é’±åŒ…

### 12.1.Â åˆ›å»ºé’±åŒ…

```

package cn.netkiller.ethereum.wallet;

import java.io.File;
import java.io.IOException;
import java.security.InvalidAlgorithmParameterException;
import java.security.NoSuchAlgorithmException;
import java.security.NoSuchProviderException;

import org.web3j.crypto.CipherException;
import org.web3j.crypto.WalletUtils;

public class WalletMain {

	public void createWallet() throws NoSuchAlgorithmException, NoSuchProviderException,
			InvalidAlgorithmParameterException, CipherException, IOException {

		File file = new File("/tmp/ethereum/keystore");
		String password = "passw0rd";
		String fileName = WalletUtils.generateFullNewWalletFile(password, file);
		System.out.println(fileName);

	}

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		WalletMain wallet = new WalletMain();
		try {
			wallet.createWallet();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}
}

```

è¿è¡Œç»“æœ

```

neo@MacBook-Pro ~ % mkdir -p /tmp/ethereum/keystore
neo@MacBook-Pro ~ % ll /tmp/ethereum/keystore
total 8
-rw-r--r--  1 neo  wheel   491B Feb  4 18:30 UTC--2018-02-04T10-30-58.476000000Z--75d01e920d6e018445dae504058ce4d968fd2a58.json

neo@MacBook-Pro ~ % cat /tmp/ethereum/keystore/UTC--2018-02-04T10-30-58.476000000Z--75d01e920d6e018445dae504058ce4d968fd2a58.json 
{"address":"75d01e920d6e018445dae504058ce4d968fd2a58","id":"80700448-69bc-475a-aaf9-f2b836f17b13","version":3,"crypto":{"cipher":"aes-128-ctr","ciphertext":"fe86f5dbd61d15d092f9d6870e70bff7ed99a7925703ea71eef23669c8e3ec62","cipherparams":{"iv":"d058819ab660cd062080b405591ba143"},"kdf":"scrypt","kdfparams":{"dklen":32,"n":262144,"p":1,"r":8,"salt":"f69c535137b08667dbac53b8001313f5b43f81fce67a5d0e94b518c97d212d14"},"mac":"c247e34760bc838c3a4c8b2da286ccc6acec244bbc13fc6cc9ce28e88a7319d5"}}

```

### 12.2.Â ä»é’±åŒ…å–å‡ºè´¦å·

```

package cn.netkiller.ethereum.wallet;

import java.io.File;
import java.io.IOException;
import java.security.InvalidAlgorithmParameterException;
import java.security.NoSuchAlgorithmException;
import java.security.NoSuchProviderException;

import org.web3j.crypto.CipherException;
import org.web3j.crypto.Credentials;
import org.web3j.crypto.WalletUtils;

public class WalletMain {

	public void walletAddress() throws IOException, CipherException {

		File file = new File(
				"/tmp/ethereum/keystore/UTC--2018-02-04T10-43-27.339000000Z--7cab470df532710d13078c5cdc0812a27f70cf51.json");
		String password = "passw0rd";
		Credentials credentials = WalletUtils.loadCredentials(password, file);
		System.out.println(credentials.getAddress());

	}

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		WalletMain wallet = new WalletMain();
		try {
			wallet.walletAddress();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}
}

```

è¿è¡Œç»“æœ

```

0x7cab470df532710d13078c5cdc0812a27f70cf51				

```

### 12.3.Â ç”ŸæˆåŠ©è®°è¯é’±åŒ…

```

		String keystore = WalletUtils.getDefaultKeyDirectory();
		System.out.println("ç”Ÿæˆ keystore æ–‡ä»¶çš„é»˜è®¤ç›®å½•ï¼š" + keystore);
		// é€šè¿‡å¯†ç åŠ keystore ç›®å½•ç”Ÿæˆé’±åŒ…
		Bip39Wallet wallet = WalletUtils.generateBip39Wallet("yourpassword", new File(keystore));
		// keystore æ–‡ä»¶å
		System.out.println(wallet.getFilename());
		// 12 ä¸ªå•è¯çš„åŠ©è®°è¯
		System.out.println(wallet.getMnemonic());			

```

### 12.4.Â éšæœºäº§ç”ŸåŠ©è®°è¯

```

package cn.netkiller.example.ethereum.mnemonic;

import java.security.SecureRandom;
import org.web3j.crypto.MnemonicUtils;

public class MnemonicUtilsTest {

	public MnemonicUtilsTest() {
		// TODO Auto-generated constructor stub
	}

	public static void main(String[] args) {

		// TODO Auto-generated method stub
		byte[] initialEntropy = new byte[16];
		SecureRandom secureRandom = new SecureRandom();
		secureRandom.nextBytes(initialEntropy);

		String mnemonic = MnemonicUtils.generateMnemonic(initialEntropy);
		System.out.println(mnemonic);

	}

}

```

### 12.5.Â å¯¼å…¥ BIP39 é’±åŒ…

```

		Credentials credentials = WalletUtils.loadBip39Credentials("password", "spoon crisp length scrub train scrap initial inherit airport that answer tornado");
		// é’±åŒ…åœ°å€
		System.out.println(credentials.getAddress());
		// å…¬é’¥ 16 è¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤º
		System.out.println(credentials.getEcKeyPair().getPublicKey().toString(16));
		// ç§é’¥ 16 è¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤º
		System.out.println(credentials.getEcKeyPair().getPrivateKey().toString(16));			

```

## 13.Â æ™ºèƒ½åˆçº¦

```

neo@netkiller ~/ethereum/solidity % cat netkiller.sol 
pragma solidity â°.4.18;

contract Netkiller {
    string name;
    int num;
    function Netkiller() public{
        name = "default";
        num = 1;
    }
    function setName(string _name) public{
        name = _name;
    }
    function getName() public view returns(string){
        return name;
    }
    function setNum(int n) public{
        num = n;
    }
    function addNum(int m) public view returns(int res){
        res = m + num;
    }
}

```

ç¼–è¯‘æ™ºèƒ½åˆçº¦

```

$ solc /path/to/<smart-contract>.sol --bin --abi --optimize -o output/
$ web3j solidity generate /path/to/<smart-contract>.bin /path/to/<smart-contract>.abi -o /path/to/src/main/java -p com.your.organisation.name			

```

```

$ solc netkiller.sol --bin --abi --optimize -o output/
$ web3j solidity generate output/Netkiller.bin output/Netkiller.abi -p cn.netkiller.ethereum.contract -o java

              _      _____ _     _        
             | |    |____ (_)   (_)       
__      _____| |__      / /_     _   ___  
\ \ /\ / / _ \ '_ \     \ \ |   | | / _ \ 
 \ V  V /  __/ |_) |.___/ / | _ | || (_) |
  \_/\_/ \___|_.__/ \____/| |(_)|_| \___/ 
                         _/ |             
                        |__/              

Generating cn.netkiller.ethereum.contract.Netkiller ... File written to java	

neo@netkiller ~/ethereum/solidity % ll java/cn/netkiller/ethereum/contract/Netkiller.java 
-rw-rw-r-- 1 neo neo 5.9K Feb  3 23:02 java/cn/netkiller/ethereum/contract/Netkiller.java

```

å¯åŠ¨ä»¥å¤ªåŠï¼Œå¹¶å¼€å§‹æŒ–çŸ¿ã€‚æ³¨æ„å‚æ•° --mine --minerthreads 1 ï¼Œä½ ä¹Ÿå¯ä»¥å¯åŠ¨ååœ¨ JavaScript æ§åˆ¶å°é’Ÿå¯åŠ¨æŒ–çŸ¿ã€‚

```

neo@netkiller ~ % geth --networkid 123456 --rpc --rpcaddr="0.0.0.0" --rpccorsdomain "*" --mine --minerthreads 1	

```

```

package cn.netkiller.ethereum;

import java.math.BigInteger;

import org.web3j.crypto.Credentials;
import org.web3j.crypto.WalletUtils;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.http.HttpService;
import org.web3j.tx.Contract;
import org.web3j.tx.ManagedTransaction;

import cn.netkiller.ethereum.contract.Netkiller;

public class ContractTest {

	public static void main(String[] args) throws Exception {
		// TODO Auto-generated method stub

		String walletfile = "/Users/neo/Downloads/UTC--2018-01-20T04-04-06.786586541Z--83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6";

		Web3j web3j = Web3j.build(new HttpService("http://172.16.0.1:8545"));
		Credentials credentials = WalletUtils.loadCredentials("", walletfile);

		Netkiller contract = Netkiller.deploy(web3j, credentials, ManagedTransaction.GAS_PRICE, Contract.GAS_LIMIT).send();

		System.out.println(contract.isValid());
		if (contract.isValid()) {
			System.out.println("---");
			String contractAddress = contract.getContractAddress();
			System.out.println(contractAddress);
			System.out.println("---");
			String result = contract.getName().send();
			System.out.println(result);

			contract.setName("Netkiller").send();
			System.out.println(contract.getName().send());
			System.out.println("---");
			contract.setNum(BigInteger.valueOf(8)).send();
			System.out.println(contract.addNum(BigInteger.valueOf(8)).send());
			System.out.println("---");
		} else {
			System.out.println("Deploy ERROR !!!");
		}
	}

}

```

è¿è¡Œç»“æœ

```

true
---
0xef872f1b344a4b7c765c7d765a3cc82b741777a9
---
default
Netkiller
---
16
---

```

åœ¨ç¨‹åºè¿è¡Œæ˜¯ï¼Œå»çœ‹ geth æ‰“å°çš„æ—¥å¿—ï¼Œæœ‰å¦‚ä¸‹è®°å½•æ‰“å°

```

INFO [02-04|00:04:43] Submitted transaction                    fullhash=0x9f70ccb600294d2dd6dda08d090362131b107d42a692f27dd4a3b7548dbaf22c recipient=0xEF872F1b344a4B7C765c7D765a3cC82b741777a9			

```

### 13.1.Â è½½å…¥åˆçº¦

```

HelloWorld contract = HelloWorld.load(contractAddress,web3j,credentials, ManagedTransaction.GAS_PRICE, Contract.GAS_LIMIT);				

```

## 14.Â ERC20 åˆçº¦

### 14.1.Â balanceOf

```

	@SuppressWarnings("rawtypes")
	public BigInteger getTokenBalance(String account, String contractAddress) throws InterruptedException, ExecutionException {
		Function function = new Function("balanceOf", Arrays.<Type>asList(new Address(account)), Arrays.<TypeReference<?>>asList(new TypeReference<Uint256>() {
		}));

		String encodedFunction = FunctionEncoder.encode(function);

		EthCall response = web3.ethCall(Transaction.createEthCallTransaction(account, contractAddress, encodedFunction), DefaultBlockParameterName.LATEST).sendAsync().get();

		List<Type> result = FunctionReturnDecoder.decode(response.getValue(), function.getOutputParameters());

		BigInteger balance = BigInteger.ZERO;
		if (result.size() == 1) {
			balance = (BigInteger) result.get(0).getValue();
		}
		return balance;
	}				

```

åˆçº¦ balance æ˜¯ä¸å«å°æ•°ç‚¹çš„ï¼Œå› ä¸ºä¸åŒåˆçº¦é‡‡ç”¨çš„å°æ•°ç‚¹ä½æ•°ä¸åŒï¼Œæ— æ³•ä½¿ç”¨ä»¥å¤ªåŠå•ä½ç›´æ¥æ¢ç®—ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢æ–¹æ³•æ·»åŠ å°æ•°ï¼š

```

	public BigDecimal formatBalance(BigInteger balance, int decimal) {
		BigDecimal value = new BigDecimal(balance);
		value = value.divide(BigDecimal.TEN.pow(decimal));
		return value;
	}			

```

### 14.2.Â name

```

		 String methodName = "name"; 
		 String fromAddr = emptyAddress; 
		 List<Type> inputParameters = new ArrayList<>(); 
		 List<TypeReference<?>> outputParameters = new ArrayList<>(); 
		 TypeReference<Utf8String> typeReference = new TypeReference<Utf8String>() {}; outputParameters.add(typeReference);

		 Function function = new Function(methodName, inputParameters,outputParameters);

```

```

@SuppressWarnings("rawtypes")
	public String getName(String contractAddress) {
		String name = null;

		Function function = new Function("name", Arrays.<Type>asList(), Arrays.<TypeReference<?>>asList(new TypeReference<Utf8String>() {
		}));

		String data = FunctionEncoder.encode(function);
		Transaction transaction = Transaction.createEthCallTransaction(null, contractAddress, data);

		EthCall ethCall;
		try {
			ethCall = web3.ethCall(transaction, DefaultBlockParameterName.LATEST).sendAsync().get();
			List<Type> results = FunctionReturnDecoder.decode(ethCall.getValue(), function.getOutputParameters());
			name = results.get(0).getValue().toString();
		} catch (InterruptedException | ExecutionException e) {
			e.printStackTrace();
		}
		return name;
	}			

```

### 14.3.Â åˆçº¦è½¬è´¦

```

	@SuppressWarnings("rawtypes")
	public String sendTokenTransaction(String fromAddress, String password, String toAddress, BigInteger amount) {
		String txHash = null;

		try {

			PersonalUnlockAccount personalUnlockAccount = admin.personalUnlockAccount(fromAddress, password, BigInteger.valueOf(10)).send();
			if (personalUnlockAccount.accountUnlocked()) {
				String methodName = "transfer";
				List<Type> inputParameters = new ArrayList<>();
				List<TypeReference<?>> outputParameters = new ArrayList<>();

				Address tAddress = new Address(toAddress);

				Uint256 value = new Uint256(amount);
				inputParameters.add(tAddress);
				inputParameters.add(value);

				TypeReference<Bool> typeReference = new TypeReference<Bool>() {
				};
				outputParameters.add(typeReference);

				Function function = new Function(methodName, inputParameters, outputParameters);

				String data = FunctionEncoder.encode(function);

				EthGetTransactionCount ethGetTransactionCount = web3.ethGetTransactionCount(fromAddress, DefaultBlockParameterName.PENDING).sendAsync().get();
				BigInteger nonce = ethGetTransactionCount.getTransactionCount();
				BigInteger gasPrice = Convert.toWei(BigDecimal.valueOf(5), Convert.Unit.GWEI).toBigInteger();

				Transaction transaction = Transaction.createFunctionCallTransaction(fromAddress, nonce, gasPrice, BigInteger.valueOf(60000), this.contractAddress, data);

				EthSendTransaction ethSendTransaction = web3.ethSendTransaction(transaction).sendAsync().get();
				txHash = ethSendTransaction.getTransactionHash();
			}
		} catch (Exception e) {
			e.printStackTrace();
		}

		return txHash;
	}

```

### 14.4.Â å®Œæ•´çš„ ERC20 ä»£å¸å¼€å‘åº“

è¿™æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„ä»£å¸æ¥å£ï¼Œåªè¦çŸ¥é“åˆçº¦åœ°å€ï¼Œå³å¯æ“ä½œè¯¥åˆçº¦ã€‚ä¼ ç»Ÿåšæ³•æ˜¯ä½¿ç”¨ web3j å‘½ä»¤å°† .sol ç¼–è¯‘æˆ Java Class ä½†è¿™ç§ç±»åªèƒ½æ“ä½œè‡ªå·±çš„åˆçº¦ã€‚

```

package cn.netkiller.wallet.ethereum;

import java.io.IOException;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.util.concurrent.ExecutionException;

import org.web3j.protocol.core.methods.request.Transaction;
import org.web3j.protocol.core.methods.response.TransactionReceipt;
import org.web3j.tx.Contract;

public class TestToken {

	public TestToken() {
		// TODO Auto-generated constructor stub
	}

	@SuppressWarnings("deprecation")
	public static void main(String[] args) {
		// TODO Auto-generated method stub

		try {
			Token token = new Token("0xb3cedc76e75fcd278c988b22963c2f35c99c10b7", "166970EDB022C717B3ECCADAB6558537228FFBDE1F68AC063A06790967F2BC3A");
			String owner = token.getOwner();
			System.out.println("ä»£å¸åˆ›å»ºè€…ï¼š" + owner);

			String name = token.getName();
			System.out.println("ä»£å¸åç§°ï¼š" + name);

			String symbol = token.getSymbol();
			System.out.println("ä»£å¸ç¬¦å·ï¼š" + symbol);

			int decimal = token.getDecimals();
			System.out.println("å°æ•°ä½æ•°ï¼š" + decimal);

			BigInteger totalSupply = token.getTotalSupply();
			System.out.println("å‘è¡Œæ€»é‡ï¼š" + totalSupply);

			BigInteger tokenBalance = token.getTokenBalance("0x22c57F0537414FD95b9f0f08f1E51d8b96F14029");
			System.out.println("ä»£å¸ä½™é¢:" + tokenBalance);

			BigDecimal val = token.formatBalance(tokenBalance, decimal);
			System.out.println("æ ¼å¼åŒ–åï¼š" + val);

			String transactionHash = token.sendTransaction("0xCdF0253d8362d6c3334c8F28A6BFd74c90d03d92", BigInteger.valueOf(10));
			System.out.println("ä»£å¸è½¬è´¦ï¼š" + transactionHash);
			TransactionReceipt transactionReceipt = token.getTransactionReceipt("0xece52bdbc6d4fa0c8eba7578a7c6e537883265199fa07ef8e5b1038e4bcdefb9");
			System.out.println("è½¬è´¦çŠ¶æ€ï¼š" + transactionReceipt.toString());

			String hash = token.setApprove("0xCdF0253d8362d6c3334c8F28A6BFd74c90d03d92", BigInteger.valueOf(100));
			System.out.println("è®¾ç½®æˆä¿¡ï¼š" + hash);

			BigInteger value = token.getAllowance("0x22c57F0537414FD95b9f0f08f1E51d8b96F14029", "0xCdF0253d8362d6c3334c8F28A6BFd74c90d03d92");
			System.out.println("æŸ¥è¯¢æˆä¿¡ï¼š" + value);

			Token token1 = new Token("0xb3cedc76e75fcd278c988b22963c2f35c99c10b7", "8D160B668E63CC04CEE44C398C184121D63C3F5D189671D985A6FB3719FB1B5E");
			System.out.println("æˆä¿¡è½¬å‡ºï¼š" + token1.sendTransactionFrom("0x22c57F0537414FD95b9f0f08f1E51d8b96F14029", "0xCdF0253d8362d6c3334c8F28A6BFd74c90d03d92", BigInteger.valueOf(20)));

			// System.out.println(token1.getAllowance("0x22c57F0537414FD95b9f0f08f1E51d8b96F14029", "0xCdF0253d8362d6c3334c8F28A6BFd74c90d03d92"));
		} catch (InterruptedException | ExecutionException | IOException e) {
			e.printStackTrace();

		}

	}

}

```

è¿è¡Œç»“æœ

```

ä»£å¸åˆ›å»ºè€…ï¼š0x22c57f0537414fd95b9f0f08f1e51d8b96f14029
ä»£å¸åç§°ï¼šNetkiller Test Coin
ä»£å¸ç¬¦å·ï¼šNTC
å°æ•°ä½æ•°ï¼š4
å‘è¡Œæ€»é‡ï¼š1000000000000
ä»£å¸ä½™é¢:999999999430
æ ¼å¼åŒ–åï¼š99999999.943
ä»£å¸è½¬è´¦ï¼š0xe851f682457672f2ca5ddbc3ad276dd9fa56ea81e838cf9a4b1eb8c97d0d98fd
è½¬è´¦çŠ¶æ€ï¼šTransactionReceipt{transactionHash='0xece52bdbc6d4fa0c8eba7578a7c6e537883265199fa07ef8e5b1038e4bcdefb9', transactionIndex='0x13', blockHash='0x2642b35670872a0e024d30ab2393b6bd4f7dab449bf4fc3eac067e2677cbc085', blockNumber='0x344a79', cumulativeGasUsed='0x806f54', gasUsed='0x8fee', contractAddress='null', root='null', status='0x1', from='0x22c57f0537414fd95b9f0f08f1e51d8b96f14029', to='0xb3cedc76e75fcd278c988b22963c2f35c99c10b7', logs=[Log{removed=false, logIndex='0xa', transactionIndex='0x13', transactionHash='0xece52bdbc6d4fa0c8eba7578a7c6e537883265199fa07ef8e5b1038e4bcdefb9', blockHash='0x2642b35670872a0e024d30ab2393b6bd4f7dab449bf4fc3eac067e2677cbc085', blockNumber='0x344a79', address='0xb3cedc76e75fcd278c988b22963c2f35c99c10b7', data='0x000000000000000000000000000000000000000000000000000000000000000a', type='null', topics=[0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef, 0x00000000000000000000000022c57f0537414fd95b9f0f08f1e51d8b96f14029, 0x000000000000000000000000cdf0253d8362d6c3334c8f28a6bfd74c90d03d92]}], logsBloom='0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000008020000001000000000000000000000000000800000000000000000000000000000000000000000000000000000000010000000000000000000004000000000000000000000000000800000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000002000000000000000400000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'}
è®¾ç½®æˆä¿¡ï¼š0x2a6c32b5939de91d9f06f7b73913433ee0b28642a3afc095454a7dcd59da3234
æŸ¥è¯¢æˆä¿¡ï¼š100
æˆä¿¡è½¬å‡ºï¼š0x29f4824b35c47a0fc18adf2d8c72c902a3c518f249bc4235aace804e5a9f17df			

```

å¦‚éœ€ä»£ç ï¼Œæœ‰å¿æä¾›ï¼Œè¯·è”ç³»ä½œè€…ã€‚

## 15.Â Infura

```

package cn.netkiller.ethereum.infura;

import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.methods.response.Web3ClientVersion;
import org.web3j.protocol.http.HttpService;

public class Infura {
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		try {
			Web3j web3 = Web3j.build(new HttpService("https://rinkeby.infura.io/CsS9shwaAab0z7B4LP2d"));
			Web3ClientVersion web3ClientVersion = web3.web3ClientVersion().send();
			System.out.println(web3ClientVersion.getWeb3ClientVersion());
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
}

```

## 16.Â åŠ©è®°è¯

### 16.1.Â è·å–éšæœºåŠ©è®°è¯

```

package cn.netkiller.ethereum.mnemonic;

import java.io.IOException;
import java.security.SecureRandom;
import java.util.List;

import org.bitcoinj.wallet.DeterministicSeed;
import org.bitcoinj.wallet.UnreadableWalletException;

public class MnemonicTest {
	public static void main(String[] args) throws UnreadableWalletException, IOException {
		// TODO Auto-generated method stub

		String passphrase = "";
		SecureRandom secureRandom = new SecureRandom();
		long creationTimeSeconds = System.currentTimeMillis() / 1000;
		DeterministicSeed deterministicSeed = new DeterministicSeed(secureRandom, 128, passphrase, creationTimeSeconds);
		List<String> mnemonicCode = deterministicSeed.getMnemonicCode();
		System.out.println(String.join(" ", mnemonicCode));

	}
}

```

è¾“å‡º

```

romance rhythm session oyster upgrade include hammer chimney float bridge autumn accident

```

### 16.2.Â åŠ©è®°è¯å¯¼å‡ºå…¬é’¥å’Œç§é’¥

```

package cn.netkiller.ethereum.mnemonic;

import java.math.BigInteger;
import java.util.List;

import org.bitcoinj.crypto.ChildNumber;
import org.bitcoinj.crypto.DeterministicKey;
import org.bitcoinj.crypto.HDUtils;
import org.bitcoinj.wallet.DeterministicKeyChain;
import org.bitcoinj.wallet.DeterministicSeed;
import org.bitcoinj.wallet.UnreadableWalletException;
import org.web3j.crypto.Credentials;

public class Test {

	public static void main(String[] args) throws UnreadableWalletException {
		// TODO Auto-generated method stub
		String seedCode = "client dune unfair assume level width bind control mad member old crystal";

		// BitcoinJ
		DeterministicSeed seed = new DeterministicSeed(seedCode, null, "", 1409478661L);
		DeterministicKeyChain chain = DeterministicKeyChain.builder().seed(seed).build();
		List<ChildNumber> keyPath = HDUtils.parsePath("M/44H/60H/0H/0/0");
		DeterministicKey key = chain.getKeyByPath(keyPath, true);
		BigInteger privKey = key.getPrivKey();

		// Web3j

		Credentials credentials = Credentials.create(privKey.toString(16));
		String address = credentials.getAddress();
		String privateKey = privKey.toString(16);
		System.out.println(address);
		System.out.println(privateKey);
	}
}			

```

è¾“å‡º

```

0x372fda02e8a1eca513f2ee5901dc55b8b5dd7411
f592b7bf06ca9fd7696ba95d6ed8e357de6a2379b6d5fe1ffd53c6b4b063cd4a

```

## 17.Â è¿‡æ»¤å™¨ (Filter)

## 18.Â Subscription

åœ¨åŒºå—é“¾ä¸Šå‘ç”Ÿçš„äº‹ä»¶æ—¶ï¼Œèƒ½ä¸é€šçŸ¥åˆ°è®¢é˜…äº‹ä»¶è€…ã€‚

### æç¤º

ä¸»æ„ https://docs.web3j.io/filters.html æœ‰ä¸€æ®µè¯ï¼š

Note: filters are not supported on Infura.

ç›®å‰ Infura ä¸æ”¯æŒã€‚

### 18.1.Â æ¥æ”¶æ‰€æœ‰æ·»åŠ åˆ°åŒºå—é“¾çš„æ–°åŒºå—

```

Subscription subscription = web3j.blockObservable(false).subscribe(block -> {
    ...
});

```

### 18.2.Â æ¥æ”¶æ‰€æœ‰æ·»åŠ åˆ°åŒºå—é“¾çš„æ–°äº¤æ˜“

```

Subscription subscription = web3j.transactionObservable().subscribe(tx -> {
    ...
});

```

### 18.3.Â æ¥æ”¶æ‰€æœ‰å¾…å¤„ç†çš„äº‹åŠ¡

```

Subscription subscription = web3j.pendingTransactionObservable().subscribe(tx -> {
    ...
});

```

æµ‹è¯•ç¯å¢ƒ Mac, é¦–å…ˆå¯åŠ¨ Ethereum Walletï¼Œç„¶åå¯åŠ¨ä¸‹é¢ç¨‹åºï¼Œå›åˆ° Ethereum Wallet ä¸­åšä¸€ç¬”è½¬è´¦ã€‚

```

package cn.netkiller.example.ethereum.subscription;

import org.web3j.protocol.Web3j;
import org.web3j.protocol.ipc.UnixIpcService;

import rx.Subscription;

public class PendingTest {

	public PendingTest() {
		// TODO Auto-generated constructor stub
	}

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		System.out.println("Subscription Starting...");
		Web3j web3 = Web3j.build(new UnixIpcService("/Users/neo/Library/Ethereum/geth.ipc"));
		Subscription subscription = web3.pendingTransactionObservable().subscribe(block -> {
			// System.out.println(block.toString());
			System.out.println("block number: " + block.getBlockHash());
		});
		// subscription.unsubscribe();
	}

}

```

è¾“å‡º

```

block number: 0x74f7dd053dadcf01599dc85d4abf60662695e78ce7531335f44dc03f49dee326

```

### 18.4.Â å°†åŒºå—å—é‡æ”¾åˆ°å½“å‰çš„å½“å‰ä½ç½®

```

Subscription subscription = catchUpToLatestAndSubscribeToNewBlocksObservable(
        <startBlockNumber>, <fullTxObjects>)
        .subscribe(block -> {
            ...
});

ä½œè€…ï¼šChainBoard é“¾åšç§‘æŠ€
é“¾æ¥ï¼šhttps://www.jianshu.com/p/c7c5556a436b
ä¾†æºï¼šç®€ä¹¦
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚			

```

### 18.5.Â è¿‡æ»¤ä¸»é¢˜

```

EthFilter filter = new EthFilter(DefaultBlockParameterName.EARLIEST, DefaultBlockParameterName.LATEST, <contract-address>).addSingleTopic(...)|.addOptionalTopics(..., ...)|...;

web3j.ethLogObservable(filter).subscribe(log -> {
    ...
});		

```

### 18.6.Â åœæ­¢è®¢é˜… Subscriptions

```

subscription.unsubscribe();

```

### 18.7.Â 

```

Web3j web3 = Web3j.build(new HttpService("http://127.0.0.1:8080"));
        System.out.println("Connected to Ethereum client version: "
                + web3.toString());
        subscription = web3.blockObservable(false)
                .subscribe(tx -> {
                    System.out.println("observation tx:" + tx.getRawResponse());
                });
        txSubscription = web3.transactionObservable().subscribe((tx) -> {
            System.out.println("txSubscription hash:" + tx.getHash() + ":::::address:" + tx.getTo());
            if (!ValidationUtil.isEmpty(tx.getTo())) {
                System.out.println("getBlockNumber:" + tx.getBlockNumber().longValue());
                System.out.println("getValue:" + tx.getValue());
                System.out.println("getTo:" + tx.getTo());
                System.out.println("getFrom:" + tx.getFrom());
                System.out.println("getHash:" + tx.getHash());
            }
        });
        pendingSubscription = web3.pendingTransactionObservable().subscribe(tx -> {
            System.out.println("pending hash:" + tx.getHash() + ":::::address:" + tx.getTo());
        });
        latestSubscription = web3.catchUpToLatestTransactionObservable(new DefaultBlockParameterNumber(2576860)).subscribe(block ->
                System.out.println("*+observer+getblock" + block.getBlockNumber())
        );			

```

## 19.Â è§£é”è´¦å·

```

Admin admin = Admin.build(new HttpService());  // defaults to http://localhost:8545/
PersonalUnlockAccount personalUnlockAccount = admin.personalUnlockAccount("0x000...", "a password").sendAsync().get();
if (personalUnlockAccount.accountUnlocked()) {
    // send a transaction
}		

```

## 20.Â IBAN (International Bank Account Number)

[`github.com/ethereum/wiki/wiki/ICAP:-Inter-exchange-Client-Address-Protocol`](https://github.com/ethereum/wiki/wiki/ICAP:-Inter-exchange-Client-Address-Protocol)

```

iban:XE4214YF25M7C0Q6QFUF989GYBCR29987SX?amount=100&token=ETH	

```

[`github.com/arturmkrtchyan/iban4j`](https://github.com/arturmkrtchyan/iban4j)

## 21.Â Springboot with Ethereum (web3j)

### 21.1.Â Maven

```

		<dependency>
			<groupId>org.web3j</groupId>
			<artifactId>web3j-spring-boot-starter</artifactId>
			<version>1.6.0</version>
		</dependency>			

```

### 21.2.Â application.properties

```

web3j.client-address=https://ropsten.infura.io/CsS9shwaAab0z7B4LP2d
web3j.admin-client=true			

```

### 21.3.Â TestRestController

```

package cn.netkiller.wallet.restful;

import java.io.IOException;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.methods.response.Web3ClientVersion;

@RestController
public class TestRestController {
	private static final Logger logger = LoggerFactory.getLogger(TestRestController.class);

	@Autowired
	private Web3j web3j;

	public TestRestController() {
		// TODO Auto-generated constructor stub
	}

	@GetMapping("/version")
	public String version() throws IOException {
		Web3ClientVersion web3ClientVersion = web3j.web3ClientVersion().send();
		String clientVersion = web3ClientVersion.getWeb3ClientVersion();
		logger.info(clientVersion);
		return clientVersion;
	}

}

```

### 21.4.Â æµ‹è¯•

```

neo@MacBook-Pro ~ % curl http://localhost:8080/version
Geth/v1.8.3-stable/linux-amd64/go1.10

```

## ç¬¬Â 18Â ç« Â web3.py - A python interface for interacting with the Ethereum blockchain and ecosystem.

æ–‡æ¡£åœ°å€ [`web3py.readthedocs.io/`](http://web3py.readthedocs.io/)

## 1.Â å®‰è£… web3.py å¼€å‘ç¯å¢ƒ

### 1.1.Â CentOS

```

[root@iZj6c39y62jl5b1wmfv6u8Z ~]# yum install python34-pip

[root@iZj6c39y62jl5b1wmfv6u8Z ~]# pip3 install --upgrade pip
Collecting pip
  Downloading http://mirrors.aliyun.com/pypi/packages/0f/74/ecd13431bcc456ed390b44c8a6e917c1820365cbebcb6a8974d1cd045ab4/pip-10.0.1-py2.py3-none-any.whl (1.3MB)
    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1.3MB 68.9MB/s 
Installing collected packages: pip
  Found existing installation: pip 8.1.2
    Uninstalling pip-8.1.2:
      Successfully uninstalled pip-8.1.2
Successfully installed pip-10.0.1

```

```

python3.6 -m venv env --without-pip
source env/bin/activate
curl https://bootstrap.pypa.io/get-pip.py | python3
python3.6 -m pip install web3			

```

### 1.2.Â MAC OS

é¦–å…ˆå» python.org å®˜ç½‘ä¸‹è½½ Python 3.6.5 dmg æ ¼å¼ï¼Œå®‰è£…åè¿›å…¥ç»ˆç«¯ã€‚

```

You should consider upgrading via the 'pip install --upgrade pip' command.
neo@MacBook-Pro ~/ethereum/web3.py % pip3.6 install --upgrade pip
Cache entry deserialization failed, entry ignored
Collecting pip
  Using cached https://files.pythonhosted.org/packages/0f/74/ecd13431bcc456ed390b44c8a6e917c1820365cbebcb6a8974d1cd045ab4/pip-10.0.1-py2.py3-none-any.whl
Installing collected packages: pip
  Found existing installation: pip 9.0.3
    Uninstalling pip-9.0.3:
      Successfully uninstalled pip-9.0.3
Successfully installed pip-10.0.1

neo@MacBook-Pro ~/ethereum/web3.py % pip3.6 install web3

```

## 2.Â è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹

### 2.1.Â HTTP

```

>>> from web3 import Web3
>>> web3 = Web3(Web3.HTTPProvider("http://127.0.0.1:8545")

```

### 2.2.Â IPC

```

>>> from web3 import Web3
>>> web3 = Web3(Web3.IPCProvider("~/Library/Ethereum/geth.ipc"))	

```

### 2.3.Â Websocket

```

>>> from web3 import Web3
>>> web3 = Web3(Web3.WebsocketProvider("ws://127.0.0.1:8546")			

```

## 3.Â äº¤æ˜“

### 3.1.Â å‘é€ ETH

```

from web3 import Web3
web3 = Web3(Web3.IPCProvider("~/Library/Ethereum/geth.ipc"))	

fromAddress = '0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA'
toAddress = '0x997e5CA600E19447D0B82aFBf9c7F00De2B39B16'
value = 0.0001

web3.personal.unlockAccount(fromAddress, '12345678')
web3.eth.sendTransaction({'to': toAddress, 'from': fromAddress, 'value': value})

```

### 3.2.Â ç­¾åå‘é€ ETH

```

from web3 import Web3
web3 = Web3(Web3.HTTPProvider("https://ropsten.infura.io/CsS9shwaAab0z7B4LP2d"))	

privateKey = '8D16063C3F665A6FB37195D18968E63CC04CEE4BFB1B98C184121D4C31D9875E'
fromAddress = "0xb3cedc76e75fcd278c988b22963c2f35c99c10b7"
toAddress = '0x997e5CA600E19447D0B82aFBf9c7F00De2B39B16'
amount = 0.0001

signed_txn = web3.eth.account.signTransaction(dict(
    nonce=web3.eth.getTransactionCount(fromAddress),
    gasPrice=web3.eth.gasPrice,
    gas=21000,
    to=toAddress,
    value=amount,
    data=b'',
  ),
  private_key,
)
web3.eth.sendRawTransaction(signed_txn.rawTransaction)

```

## 4.Â ERC20 ä»£å¸åˆçº¦

```

from web3 import Web3
web3 = Web3(Web3.HTTPProvider("https://ropsten.infura.io/CsS9shwaAab0z7B4LP2d"))	

contract = web3.eth.contract(address='0x000000000000000000000000000000000000dead', abi=...)

contract.functions.balanceOf(address).call()

contract.functions.transfer(to, value).call()

```

### 4.1.Â ç­¾åå‘é€ ERC20 ä»£å¸

```

from web3 import Web3
from web3 import Web3, HTTPProvider, IPCProvider
# w3 = Web3(Web3.IPCProvider("~/Library/Ethereum/geth.ipc"))	

w3 = Web3(HTTPProvider("https://ropsten.infura.io/CsS9shwaAab0z7B4LP2d"))

fromAddress = '0xB94054c174995AE2A9E7fcf6c7924635FBa8ECF7'
toAddress = '0xCdF0253d8362d6c3334c8F28A6BFd74c90d03d92'
contractAddress='0xfB6916095ca1df60bB79Ce92cE3Ea74c37c5d359'
private_key = b''

# '~/.ethereum/testnet/keystore/UTC--2018-03-02T12-12-51.966823000Z--b94054c174995ae2a9e7fcf6c7924635fba8ecf7'
with open('/Users/neo/Library/Ethereum/testnet/keystore/UTC--2018-03-02T12-12-51.966823000Z--b94054c174995ae2a9e7fcf6c7924635fba8ecf7') as keyfile:
    encrypted_key = keyfile.read()
    private_key = w3.eth.account.decrypt(encrypted_key, '')

print(private_key)

interface='[ { "constant": true, "inputs": [], "name": "name", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_spender", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "approve", "outputs": [ { "name": "success", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "totalSupply", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_from", "type": "address" }, { "name": "_to", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "transferFrom", "outputs": [ { "name": "success", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "decimals", "outputs": [ { "name": "", "type": "uint8" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_value", "type": "uint256" } ], "name": "burn", "outputs": [ { "name": "success", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" } ], "name": "balanceOf", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_from", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "burnFrom", "outputs": [ { "name": "success", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "symbol", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_to", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "transfer", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "_spender", "type": "address" }, { "name": "_value", "type": "uint256" }, { "name": "_extraData", "type": "bytes" } ], "name": "approveAndCall", "outputs": [ { "name": "success", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" }, { "name": "", "type": "address" } ], "name": "allowance", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "inputs": [ { "name": "initialSupply", "type": "uint256", "index": 0, "typeShort": "uint", "bits": "256", "displayName": "initial Supply", "template": "elements_input_uint", "value": "100000" }, { "name": "tokenName", "type": "string", "index": 1, "typeShort": "string", "bits": "", "displayName": "token Name", "template": "elements_input_string", "value": "NEO" }, { "name": "tokenSymbol", "type": "string", "index": 2, "typeShort": "string", "bits": "", "displayName": "token Symbol", "template": "elements_input_string", "value": "#" } ], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "from", "type": "address" }, { "indexed": true, "name": "to", "type": "address" }, { "indexed": false, "name": "value", "type": "uint256" } ], "name": "Transfer", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "from", "type": "address" }, { "indexed": false, "name": "value", "type": "uint256" } ], "name": "Burn", "type": "event" } ]'
contract = w3.eth.contract(address=contractAddress, abi=interface)

nonce = w3.eth.getTransactionCount(fromAddress)
print(nonce)

txn = contract.functions.transfer(toAddress,5,).buildTransaction({
    'chainId': 3,
    'gas': 30000,
    'gasPrice': w3.toWei('1', 'gwei'),
    'nonce': nonce,
    })

print(txn)

signed_txn = w3.eth.account.signTransaction(txn, private_key=private_key)
print(signed_txn.hash)
print(signed_txn.rawTransaction)

tmp = w3.eth.sendRawTransaction(signed_txn.rawTransaction)  

txhash = w3.toHex(w3.sha3(signed_txn.rawTransaction))

print("https://ropsten.etherscan.io/tx/"+txhash)		

```

## ç¬¬Â 19Â ç« Â Ethereum iOS

[`github.com/MercuryProtocol/web3.swift`](https://github.com/MercuryProtocol/web3.swift)

https://medium.com/mercuryprotocol/introducing-web3-swift-for-ethereum-ios-development-1e02212b662b

## ç¬¬Â 20Â ç« Â Ethereum Developer APIs

## 1.Â API Keys

https://etherscan.io/register

| ![](img/newaccount.png) |

å‰å¾€é‚®ç®±æŸ¥çœ‹ä»¥å¤ªåŠå‘å‡ºçš„ç¡®è®¤é‚®ä»¶ï¼Œå¹¶ç‚¹å‡»é‡Œé¢é“¾æ¥åœ°å€ã€‚

| ![](img/email.png) |

ç™»é™†

| ![](img/login.png) |

åˆ›å»º API Key

| ![](img/api-keys-create.png) |

| ![](img/api-keys-token.png) |

åˆ›å»ºå®Œæˆ

| ![](img/api-keys-successfully.png) |

## 2.Â è´¦å·

### 2.1.Â ä½™é¢

è·å¾—è´¦å·çš„ä½™é¢

```

https://api.etherscan.io/api?module=account&action=balance&address=0xddbd2b932c763ba5b1b7ae3b362eac3e8d40121a&tag=latest&apikey=JFZWPE88I3TZFZWXKVHJ32INUIYQRRINJ9

```

### 2.2.Â æŸ¥è¯¢åŒºå—

```

http://api.etherscan.io/api?module=account&action=txlist&address=0x3e827461Cc53ed7c75A29187CfF39629FCAE3661&startblock=0&endblock=99999999&sort=asc&apikey=RT5JW37AKEZVSW3C91Z86IGI2FF7JDPF1N

```

Spring boot 2.0.2 å®ç°äº¤æ˜“è®°å½•æŸ¥è¯¢

```

package cn.netkiller.api.restful;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
public class TransactionsRestController {
	private static final Logger logger = LoggerFactory.getLogger(TransactionsRestController.class);

	private static final String url = "http://api.etherscan.io/api?module={module}&action={action}&address={address}&startblock={startblock}&endblock={endblock}&sort={sort}&apikey={apikey}";

	@Autowired
	public TestRestController() {
		// TODO Auto-generated constructor stub
	}

	@GetMapping("/block/{startblock}/{endblock}/{address}")
	public TransactionsResponse block(@PathVariable String startblock, @PathVariable String endblock, @PathVariable String address) {
		return this.getTransactionsByAddress(startblock, endblock, address);
	}

	private TransactionsResponse getTransactionsByAddress(String startblock, String endblock, String address) {
		Map<String, String> params = new HashMap<String, String>();
		params.put("module", "account");
		params.put("action", "txlist");
		params.put("address", address);
		params.put("startblock", startblock);
		params.put("endblock", endblock);
		params.put("sort", "asc");
		params.put("apikey", "RT5JW37AKEZVSW3C91Z86IGI2FF7JDPF1N");
		RestTemplate restTemplate = new RestTemplate();
		TransactionsResponse result = restTemplate.getForObject(url, TransactionsResponse.class, params);
		logger.info(params.toString());
		logger.info(result.toString());
		return result;
	}
}

class Transactions {

	private String blockNumber;
	private String timeStamp;
	private String hash;
	private String nonce;
	private String blockHash;
	private String transactionIndex;
	private String from;
	private String to;
	private String value;
	private String gas;
	private String gasPrice;
	private String isError;
	private String txreceipt_status;
	private String input;
	private String contractAddress;
	private String cumulativeGasUsed;
	private String gasUsed;
	private String confirmations;

	public Transactions() {
	}

	public String getBlockNumber() {
		return blockNumber;
	}

	public void setBlockNumber(String blockNumber) {
		this.blockNumber = blockNumber;
	}

	public String getTimeStamp() {
		return timeStamp;
	}

	public void setTimeStamp(String timeStamp) {
		this.timeStamp = timeStamp;
	}

	public String getHash() {
		return hash;
	}

	public void setHash(String hash) {
		this.hash = hash;
	}

	public String getNonce() {
		return nonce;
	}

	public void setNonce(String nonce) {
		this.nonce = nonce;
	}

	public String getBlockHash() {
		return blockHash;
	}

	public void setBlockHash(String blockHash) {
		this.blockHash = blockHash;
	}

	public String getTransactionIndex() {
		return transactionIndex;
	}

	public void setTransactionIndex(String transactionIndex) {
		this.transactionIndex = transactionIndex;
	}

	public String getFrom() {
		return from;
	}

	public void setFrom(String from) {
		this.from = from;
	}

	public String getTo() {
		return to;
	}

	public void setTo(String to) {
		this.to = to;
	}

	public String getValue() {
		return value;
	}

	public void setValue(String value) {
		this.value = value;
	}

	public String getGas() {
		return gas;
	}

	public void setGas(String gas) {
		this.gas = gas;
	}

	public String getGasPrice() {
		return gasPrice;
	}

	public void setGasPrice(String gasPrice) {
		this.gasPrice = gasPrice;
	}

	public String getIsError() {
		return isError;
	}

	public void setIsError(String isError) {
		this.isError = isError;
	}

	public String getTxreceipt_status() {
		return txreceipt_status;
	}

	public void setTxreceipt_status(String txreceipt_status) {
		this.txreceipt_status = txreceipt_status;
	}

	public String getInput() {
		return input;
	}

	public void setInput(String input) {
		this.input = input;
	}

	public String getContractAddress() {
		return contractAddress;
	}

	public void setContractAddress(String contractAddress) {
		this.contractAddress = contractAddress;
	}

	public String getCumulativeGasUsed() {
		return cumulativeGasUsed;
	}

	public void setCumulativeGasUsed(String cumulativeGasUsed) {
		this.cumulativeGasUsed = cumulativeGasUsed;
	}

	public String getGasUsed() {
		return gasUsed;
	}

	public void setGasUsed(String gasUsed) {
		this.gasUsed = gasUsed;
	}

	public String getConfirmations() {
		return confirmations;
	}

	public void setConfirmations(String confirmations) {
		this.confirmations = confirmations;
	}

	@Override
	public String toString() {
		return "Transactions [blockNumber=" + blockNumber + ", timeStamp=" + timeStamp + ", hash=" + hash + ", nonce=" + nonce + ", blockHash=" + blockHash + ", transactionIndex=" + transactionIndex + ", from=" + from + ", to=" + to + ", value=" + value + ", gas=" + gas + ", gasPrice=" + gasPrice + ", isError=" + isError + ", txreceipt_status=" + txreceipt_status + ", input=" + input + ", contractAddress=" + contractAddress + ", cumulativeGasUsed=" + cumulativeGasUsed + ", gasUsed=" + gasUsed + ", confirmations=" + confirmations + "]";
	}

}

class TransactionsResponse {
	private String status;
	private String message;
	private List<Transactions> result = new ArrayList<Transactions>();

	public TransactionsResponse() {
	}

	public String getStatus() {
		return status;
	}

	public void setStatus(String status) {
		this.status = status;
	}

	public String getMessage() {
		return message;
	}

	public void setMessage(String message) {
		this.message = message;
	}

	public List<Transactions> getResult() {
		return result;
	}

	public void setResult(List<Transactions> result) {
		this.result = result;
	}

	@Override
	public String toString() {
		return "TransactionsResponse [status=" + status + ", message=" + message + ", result=" + result + "]";
	}

}			

```

### 2.3.Â æŸ¥è¯¢åŒºå—

```

http://api.etherscan.io/api?module=account&action=txlistinternal&address=0x3e827461Cc53ed7c75A29187CfF39629FCAE3661&startblock=0&endblock=99999999&sort=asc&apikey=RT5JW37AKEZVSW3C91Z86IGI2FF7JDPF1N			

```

## 3.Â æŸ¥è¯¢äº¤æ˜“

### 3.1.Â æ£€æŸ¥åˆçº¦æ‰§è¡ŒçŠ¶æ€

```

https://api.etherscan.io/api?module=transaction&action=getstatus&txhash=0x6cec54f03e6d9271f2c51e0696de03df4bba82171f2aff464c63554614915500&apikey=RT5JW37AKEZVSW3C91Z86IGI2FF7JDPF1N

```

## 4.Â Geth/Parity Proxy APIs

### 4.1.Â 

```

https://api.etherscan.io/api?module=proxy&action=eth_blockNumber&apikey=RT5JW37AKEZVSW3C91Z86IGI2FF7JDPF1N			

```

```

	private String getBlockNumber() {
		final String url = "https://api.etherscan.io/api?module=proxy&action=eth_blockNumber&apikey=RT5JW37AKEZVSW3C91Z86IGI2FF7JDPF1N";
		Map<String, String> params = new HashMap<String, String>();
		params.put("module", "proxy");
		params.put("action", "eth_blockNumber");
		params.put("apikey", "RT5JW37AKEZVSW3C91Z86IGI2FF7JDPF1N");
		RestTemplate restTemplate = new RestTemplate();
		JsonRpc result = restTemplate.getForObject(url, JsonRpc.class, params);

		return Integer.valueOf(result.getResult().substring(2), 16).toString();
	}			

```

## 5.Â JSON RPC åŸç”Ÿäº¤å£è°ƒç”¨

JSON RPC æ–‡æ¡£ [`github.com/ethereum/wiki/wiki/JSON-RPC#eth_getlogs`](https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_getlogs)

```

neo@MacBook-Pro ~ % curl -XPOST -H "Accept: application/json" -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","method":"eth_getBalance","params":["0x5c18a33df2cc41a1beddc91133b8422e89f041b7", "latest"],"id":1}' http://localhost:8545 
{"jsonrpc":"2.0","id":1,"result":"0x153e5f3aeb667075800"}		

```

```

curl -X POST --data '{"jsonrpc":"2.0","method":"eth_accounts","params":[],"id":1}'		

curl -X POST --data '{"jsonrpc":"2.0","method":"eth_getBalance","params":["0x407d73d8a49eeb85d32cf465507dd71d507100c1", "latest"],"id":1}'

```

## ç¬¬Â 21Â ç« Â infura

[`infura.io/`](https://infura.io/)

SCALABLE BLOCKCHAIN INFRASTRUCTURE

We provide secure, reliable, and scalable access to Ethereum and IPFS.

## 1.Â Infura 3.0

æ³¨å†Œ Infura 3.0

| ![](img/infura-1.png) |

é‚®ä»¶ç¡®è®¤

| ![](img/infura-2.png) |

ç™»å½•

| ![](img/infura-3.png) |

ç‚¹å‡» SKIP æŒ‰é’®ï¼Œè·³è¿‡æ•™å­¦æ¨¡å¼

| ![](img/infura-4.png) |

åˆ›å»ºé¡¹ç›®

| ![](img/infura-5.png) |

è¾“å…¥é¡¹ç›®åç§°

| ![](img/infura-6.png) |

æ·»åŠ åˆçº¦åˆ°ç™½åå•

| ![](img/infura-7.png) |

æ·»åŠ å®Œæˆ

| ![](img/infura-8.png) |

å¤åˆ¶ Infura åœ°å€:

```

https://mainnet.infura.io/v3/ee07e33cb6414781a72deaf3b303ca3b
https://ropsten.infura.io/v3/ee07e33cb6414781a72deaf3b303ca3b

```

## 2.Â websocket

```

wss://mainnet.infura.io/ws
wss://ropsten.infura.io/ws
wss://rinkeby.infura.io/ws

```

### 2.1.Â è®¢é˜… newBlockHeaders

```

#!/usr/bin/env node
const Web3 = require('web3');

const web3 = new Web3(new Web3.providers.WebsocketProvider('wss://mainnet.infura.io/ws'));

const subscription = web3.eth.subscribe('newBlockHeaders', (error, blockHeader) => {
  if (error) return console.error(error);

  console.log('Successfully subscribed!', blockHeader);
}).on('data', (blockHeader) => {
  console.log('data: ', blockHeader);
});

// unsubscribes the subscription
subscription.unsubscribe((error, success) => {
  if (error) return console.error(error);

  console.log('Successfully unsubscribed!');
});			

```

## 3.Â é…ç½® Truffle

å®‰è£… truffle-hdwallet-provider

```

$ npm install truffle-hdwallet-provider			

```

ä¿®æ”¹ truffle.js æ–‡ä»¶

```

var HDWalletProvider = require("truffle-hdwallet-provider"); 

// infura ä¸ºä½ æä¾›çš„ apikey è¯·ä¸ä½ ç”³è¯·åˆ°çš„ key ä¿æŒä¸€è‡´
var infura_apikey = "CsS9shwaAab0z7B4LP2d";

// ä½ ä»¥å¤ªåŠé’±åŒ…åœ°å€ è¿›å…¥ MetaMask -> Settings -> reveal seed words å¤åˆ¶åˆ°æ­¤å¤„
var mnemonic = "drill hunt food team moment mistake bird attitude tunnel ecology sister resist"; 

module.exports = {
  networks: {
    development: {
      host: "127.0.0.1",
      port: 7545,
      network_id: "*"
    },
    private: {
      host: "localhost",
      port: 8545,
      network_id: "*" // Match any network id
    },
    ropsten: {
      provider: new HDWalletProvider(mnemonic, "https://ropsten.infura.io/"+infura_apikey),
      network_id: 3,
      gas: 3012388,
      gasPrice: 30000000000
    },
    main: {
      provider: new HDWalletProvider(mnemonic, "https://mainnet.infura.io/"+infura_apikey),
      network_id: 3,
      gas: 3012388,
      gasPrice: 1000000000
    }
  }
};

```

éƒ¨ç½²åˆçº¦åˆ° ropsten æµ‹è¯•ç½‘ï¼Œ åœ¨å‘½ä»¤è¡Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œé€šè¿‡ --network è®¾ç½®å‘å¸ƒçš„ç›®æ ‡ç½‘ç»œï¼š

```

truffle migrate --network ropsten			

```

ä¸»ç½‘ç»œå‘å¸ƒ

```

truffle migrate --network main

```

## 4.Â infura.io web3.js å¼€å‘

### 4.1.Â Web3 é€šè¿‡ infura è¿æ¥åˆ° Ropsten æµ‹è¯•ç½‘ç»œ

```

fs = require('fs');
const Web3 = require('web3');
const web3 = new Web3('https://ropsten.infura.io/CsS9shwaAab0z7B4LP2d');
console.log(web3.version)
const abi = fs.readFileSync('output/TokenERC20.abi', 'utf-8');

const contractAddress = "0x70682386d0dE84B1e549DC3c4305CCB2D261b2a8";
const coinbase = "0xB94054c174995AE2A9E7fcf6c7924635FBa8ECF7";
const toAddress = "0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA";

balanceWei = web3.eth.getBalance(coinbase);
console.log(balanceWei);

const contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000});

contract.methods.balanceOf(coinbase).call().then(console.log).catch(console.error);
contract.methods.balanceOf(toAddress).call().then(console.log).catch(console.error);	

```

### 4.2.Â ä½¿ç”¨ truffle-hdwallet-provider è¿æ¥åˆ° https://ropsten.infura.io

```

fs = require('fs');
const Web3 = require('web3');
const HDWalletProvider = require("truffle-hdwallet-provider");
const mnemonic = "drill hunt food team moment mistake bird attitude tunnel ecology sister resist";
const web3 = new Web3(new HDWalletProvider(mnemonic,'https://ropsten.infura.io/CsS8shwaCab0a7B4LP2d'));
console.log(web3.version)
const abi = fs.readFileSync('output/TokenERC20.abi', 'utf-8');

const contractAddress = "0x70682386d0dE84B1e549DC3c4305CCB2D261b2a8";
const coinbase = "0xB94054c174995AE2A9E7fcf6c7924635FBa8ECF7";
const toAddress = "0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA";

balanceWei = web3.eth.getBalance(coinbase);
console.log(balanceWei);

const contract = new web3.eth.Contract(JSON.parse(abi), contractAddress, { from: coinbase , gas: 100000});

contract.methods.balanceOf(coinbase).call().then(console.log).catch(console.log);
contract.methods.balanceOf(toAddress).call().then(console.log).catch(console.log);

```

### 4.3.Â è½¬è´¦

```

	const coinbase = "0xB94054c174995AE2A9E7fcf6c7924635FBa8ECF7";
	const toAddress = "0xf56b81a2bcb964D2806071e9Be4289A5559BB0fA";			
	const privateKey = "e33ea581d88e0bd2270c0fd109604039a3de59671b6d69882b4cb4688d3dcffd"

	var nonce = await web3.eth.getTransactionCount(coinbase);
	var gasPrice = await web3.eth.getGasPrice();
	console.log(`gasPrice: ${gasPrice}\n`)
    var gasLimit = 1000000;
	var transferAmount = 1000;
    var chainId = 1;

    var rawTransaction = {
        "from": coinbase,
        "nonce":  web3.utils.toHex(count),
        "gasPrice": web3.utils.toHex(gasPrice),
        "gasLimit": web3.utils.toHex(gasLimit),
        "to": toAddress,
        "value": "100",
        "data": "0x0",
        "chainId": web3.utils.toHex(chainId)
    };

    var privateKey = new Buffer(privateKey, 'hex');
    var tx = new Tx(rawTransaction);
    tx.sign(privateKey);
    var serializedTx = tx.serialize();

    web3.eth.sendSignedTransaction('0x' + serializedTx.toString('hex')).on('receipt', console.log);

```

```

'use strict';
const Web3 = require('web3');

const wsAddress = 'wss://rinkeby.infura.io/ws';
const contractJson = '(taken from solc or remix online compiler)';
const privateKey = '0xOOOX';
const contractAddress = '0xOOOX';
const walletAddress = '0xOOOX';

const webSocketProvider = new Web3.providers.WebsocketProvider(wsAddress);
const web3 = new Web3(new Web3.providers.WebsocketProvider(webSocketProvider));
const contract = new web3.eth.Contract(
  JSON.parse(contractJson),
  contractAddress
);
// change this to whatever contract method you are trying to call, E.G. SimpleStore("Hello World")
const query = contract.methods.SimpleStore('Hello World');
const encodedABI = query.encodeABI();
const tx = {
  from: walletAddress,
  to: contractAddress,
  gas: 2000000,
  data: encodedABI,
};

const account = web3.eth.accounts.privateKeyToAccount(privateKey);
console.log(account);
web3.eth.getBalance(walletAddress).then(console.log);

web3.eth.accounts.signTransaction(tx, privateKey).then(signed => {
  const tran = web3.eth
    .sendSignedTransaction(signed.rawTransaction)
    .on('confirmation', (confirmationNumber, receipt) => {
      console.log('=> confirmation: ' + confirmationNumber);
    })
    .on('transactionHash', hash => {
      console.log('=> hash');
      console.log(hash);
    })
    .on('receipt', receipt => {
      console.log('=> reciept');
      console.log(receipt);
    })
    .on('error', console.error);
});

```

### 4.4.Â æ‰§è¡Œåˆçº¦

```

const fs = require('fs');
const Web3 = require('web3');
const web3 = new Web3("https://mainnet.infura.io/CsS9shwaAab0z7B4LP2d");
const Tx = require('ethereumjs-tx');

const abi = [{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_status","type":"bool"}],"name":"setAirdropStatus","outputs":[{"name":"status","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"airdropStatus","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_mintedAmount","type":"uint256"}],"name":"mintAirdropToken","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"burn","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_lock","type":"bool"}],"name":"setLock","outputs":[{"name":"status","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_address","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"airdropCurrentTotal","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"target","type":"address"},{"name":"mintedAmount","type":"uint256"}],"name":"mintToken","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_value","type":"uint256"}],"name":"burnFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_amount","type":"uint256"}],"name":"setAirdropAmount","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"frozenAccount","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"airdropTotalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"touched","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"target","type":"address"},{"name":"freeze","type":"bool"}],"name":"freezeAccount","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"lock","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"airdropAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"initialSupply","type":"uint256"},{"name":"tokenName","type":"string"},{"name":"tokenSymbol","type":"string"},{"name":"decimalUnits","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Burn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"target","type":"address"},{"indexed":false,"name":"frozen","type":"bool"}],"name":"FrozenFunds","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"target","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"AirDrop","type":"event"}];
const address = "0x3e827461Cc53CAE366175A291ed7c629F87CfF39";
const key = "19A57E4F6274AF1E0B9C3F8F7E3503876A850AFEE1912B8B9C5D9358EDEA0362"

const contractAddress = "0x44cCf3d1601427Fe0B0f7588eD058216830cd13C";
const contract = new web3.eth.Contract(abi, contractAddress, { "from": address});

contract.methods.balanceOf(address).call().then(function(balance){
    console.log(balance)
});

contract.methods.decimals().call().then(function(decimals){
    console.log(decimals)
});

web3.eth.getGasPrice().then(function(gasPrice){
    var price = Number(gasPrice);

    web3.eth.getTransactionCount(address).then(function(nonce){
        var amount = "1000000";
        contract.methods.mintAirdropToken(amount).estimateGas().then(function(gas){
            var rawTransaction = {
                "nonce": web3.utils.toHex(nonce),
                "from": address,
                "to": contractAddress,
                "gas": web3.utils.toHex(gas),
                "gasPrice": web3.utils.toHex(price),
                // "gasLimit": this.web3.utils.toHex(gasLimit.gasLimit),
                "value": "0x0",
                "data": contract.methods.mintAirdropToken(amount).encodeABI()
            };

            console.log(rawTransaction);

            var privateKey = new Buffer.from(key, 'hex');
            var tx = new Tx(rawTransaction);
            tx.sign(privateKey);
            var serializedTx = tx.serialize();

            web3.eth.sendSignedTransaction('0x' + serializedTx.toString('hex')).on('receipt', function(txhash){
                console.log(txhash);
            }); 
        });
    });
});

web3.eth.getGasPrice().then(function(gasPrice){
    var price = Number(gasPrice);

    web3.eth.getTransactionCount(address).then(function(nonce){
        var amount = "10";
        contract.methods.setAirdropAmount(amount).estimateGas().then(function(gas){
            var rawTransaction = {
                "nonce": web3.utils.toHex(nonce),
                "from": address,
                "to": contractAddress,
                "gas": web3.utils.toHex(gas),
                "gasPrice": web3.utils.toHex(price),
                "value": "0x0",
                "data": contract.methods.setAirdropAmount(amount).encodeABI()
            };

            console.log(rawTransaction);

            var privateKey = new Buffer.from(key, 'hex');
            var tx = new Tx(rawTransaction);
            tx.sign(privateKey);
            var serializedTx = tx.serialize();

            web3.eth.sendSignedTransaction('0x' + serializedTx.toString('hex')).on('receipt', function(txhash){
                console.log(txhash);
            }); 
        });
    });
});

web3.eth.getGasPrice().then(function(gasPrice){
    var price = Number(gasPrice);

    web3.eth.getTransactionCount(address).then(function(nonce){
        var status = true;
        contract.methods.setAirdropStatus(status).estimateGas().then(function(gas){
            var rawTransaction = {
                "nonce": web3.utils.toHex(nonce),
                "from": address,
                "to": contractAddress,
                "gas": web3.utils.toHex(gas),
                "gasPrice": web3.utils.toHex(price),
                "value": "0x0",
                "data": contract.methods.setAirdropStatus(status).encodeABI()
            };
            console.log(rawTransaction);

            var privateKey = new Buffer.from(key, 'hex');
            var tx = new Tx(rawTransaction);
            tx.sign(privateKey);
            var serializedTx = tx.serialize();

            web3.eth.sendSignedTransaction('0x' + serializedTx.toString('hex')).on('receipt', function(txhash){
                console.log(txhash);
            }); 
        });
    });
});			

```

## 5.Â Infura IPFS

### 5.1.Â ä¸Šä¼ æ–‡ä»¶

```

neo@MacBook-Pro /tmp % cat hello.txt 
http://www.netkiller.cn

neo@MacBook-Pro /tmp % curl "https://ipfs.infura.io:5001/api/v0/add?pin=false" \
    -X POST \
    -H "Content-Type: multipart/form-data" \
    -F file=@"hello.txt"          
{"Name":"hello.txt","Hash":"QmToi4pgQH4LQX8wGMt5H8EV2dA7hD8S2EccRpd8YGUgac","Size":"32"}

```

### 5.2.Â æŸ¥çœ‹æ–‡ä»¶

```

neo@MacBook-Pro /tmp % curl "https://ipfs.infura.io:5001/api/v0/cat?arg=QmToi4pgQH4LQX8wGMt5H8EV2dA7hD8S2EccRpd8YGUgac" 
http://www.netkiller.cn

```

### 5.3.Â ä¸‹è½½æ–‡ä»¶

```

neo@MacBook-Pro /tmp % curl -s "https://ipfs.infura.io:5001/api/v0/get?arg=QmToi4pgQH4LQX8wGMt5H8EV2dA7hD8S2EccRpd8YGUgac&archive=true" -o hello.tgz

neo@MacBook-Pro /tmp % tar zxvf hello.tgz 
x QmToi4pgQH4LQX8wGMt5H8EV2dA7hD8S2EccRpd8YGUgac

neo@MacBook-Pro /tmp % cat QmToi4pgQH4LQX8wGMt5H8EV2dA7hD8S2EccRpd8YGUgac
http://www.netkiller.cn			

```

### 5.4.Â åˆ›å»ºç›®å½•

```

neo@MacBook-Pro /tmp % curl "https://ipfs.infura.io:5001/api/v0/files/mkdir?arg=/netkiller"

neo@MacBook-Pro /tmp % curl "https://ipfs.infura.io:5001/api/v0/files/stat?arg=/netkiller"        
{"Hash":"QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn","Size":0,"CumulativeSize":4,"Blocks":0,"Type":"directory"}			

```

### 5.5.Â æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€

```

neo@MacBook-Pro /tmp % curl "https://ipfs.infura.io:5001/api/v0/files/stat?arg=/netkiller"        
{"Hash":"QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn","Size":0,"CumulativeSize":4,"Blocks":0,"Type":"directory"}			

```

### 5.6.Â æŸ¥çœ‹ IPFS ç‰ˆæœ¬å·

```

neo@MacBook-Pro ~/workspace % curl "https://ipfs.infura.io:5001/api/v0/version"
{"Version":"0.4.14","Commit":"","Repo":"6","System":"amd64/linux","Golang":"go1.10"}			

```

## 6.Â Infura 2.0 (å·²ç»åºŸå¼ƒ)

### 6.1.Â æ³¨å†Œè´¦å·

[`infura.io/signup`](https://infura.io/signup)

è¾“å…¥ç”¨æˆ·åå’Œé‚®ç®±å³å¯æ³¨å†Œ

| ![](img/signup.png) |

è¿™äº›åœ°å€ä½ éœ€è¦ç‰¢è®°

| ![](img/network.png) |

NETWORK DESCRIPTION URL
Mainnet productionÂ network https://mainnet.infura.io/CsS9shwaAab0z7B4LP2d
Ropsten testÂ network https://ropsten.infura.io/CsS9shwaAab0z7B4LP2d
INFURAnet testÂ network https://infuranet.infura.io/CsS9shwaAab0z7B4LP2d
Kovan testÂ network https://kovan.infura.io/CsS9shwaAab0z7B4LP2d
Rinkeby testÂ network https://rinkeby.infura.io/CsS9shwaAab0z7B4LP2d
IPFS gateway https://ipfs.infura.io

è¿™æ˜¯ä½ çš„ api key CsS9shwaAab0z7B4LP2d è¯·ä¿å­˜å¥½

Mainnet æ˜¯ä»¥å¤ªåŠä¸»ç½‘

IPFS æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åŒºä¸­å¿ƒåŒ–çš„æ–‡ä»¶ç³»ç»Ÿã€‚

### 6.2.Â infura æ¥å£

#### 6.2.1.Â jsonrpc

JSONRPC æ–‡æ¡£ [`github.com/INFURA/infura/blob/master/docs/source/index.html.md#choosing-a-client-to-handle-your-request`](https://github.com/INFURA/infura/blob/master/docs/source/index.html.md#choosing-a-client-to-handle-your-request)

```

$ curl -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc": "2.0", "id": 1, "method": "eth_blockNumber", "params": []}' \
  "https://mainnet.infura.io/CsS9shwaAab0z7B4LP2d"

```

#### 6.2.2.Â INFURA API

```

https://api.infura.io/v1/jsonrpc/mainnet/eth_blockNumber?token=CsS9shwaAab0z7B4LP2d				

```

## ç¬¬Â 22Â ç« Â ä»¥å¤ªåŠæ¡ˆä¾‹

## 1.Â EtherDelta

[`github.com/etherdelta/smart_contract`](https://github.com/etherdelta/smart_contract)

## 2.Â ä»¥å¤ªçŒ«ï¼ˆCryptoKittiesï¼‰

é¦–å…ˆä½ è¦æ‹¥æœ‰ä»¥å¤ªå¸ï¼Œå¯ä»¥å»äº¤æ˜“æ‰€è´­ä¹°ï¼Œç„¶åä½¿ç”¨è°·æ­Œæµè§ˆå™¨è¿›å…¥ä¸‹é¢ç½‘ç«™ï¼Œç‚¹å‡»â€œStart meowâ€ æŒ‰é’®ï¼Œå†ç‚¹å‡» â€œI Installed MetaMaskâ€ å®‰è£…æµè§ˆå™¨æ’ä»¶ï¼Œ

ä»¥å¤ªçŒ«å®˜ç½‘ [`www.cryptokitties.co`](https://www.cryptokitties.co)

åˆçº¦æºç åœ°å€

[`etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#code`](https://etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#code)

ä¸‹é¢æ˜¯ä»¥å¤ªçŒ«æ™ºèƒ½åˆçº¦ï¼š

```

pragma solidity â°.4.11;

/**
 * @title Ownable
 * @dev The Ownable contract has an owner address, and provides basic authorization control
 * functions, this simplifies the implementation of "user permissions".
 */
contract Ownable {
  address public owner;

  /**
   * @dev The Ownable constructor sets the original `owner` of the contract to the sender
   * account.
   */
  function Ownable() {
    owner = msg.sender;
  }

  /**
   * @dev Throws if called by any account other than the owner.
   */
  modifier onlyOwner() {
    require(msg.sender == owner);
    _;
  }

  /**
   * @dev Allows the current owner to transfer control of the contract to a newOwner.
   * @param newOwner The address to transfer ownership to.
   */
  function transferOwnership(address newOwner) onlyOwner {
    if (newOwner != address(0)) {
      owner = newOwner;
    }
  }

}

/// @title Interface for contracts conforming to ERC-721: Non-Fungible Tokens
/// @author Dieter Shirley <dete@axiomzen.co> (https://github.com/dete)
contract ERC721 {
    // Required methods
    function totalSupply() public view returns (uint256 total);
    function balanceOf(address _owner) public view returns (uint256 balance);
    function ownerOf(uint256 _tokenId) external view returns (address owner);
    function approve(address _to, uint256 _tokenId) external;
    function transfer(address _to, uint256 _tokenId) external;
    function transferFrom(address _from, address _to, uint256 _tokenId) external;

    // Events
    event Transfer(address from, address to, uint256 tokenId);
    event Approval(address owner, address approved, uint256 tokenId);

    // Optional
    // function name() public view returns (string name);
    // function symbol() public view returns (string symbol);
    // function tokensOfOwner(address _owner) external view returns (uint256[] tokenIds);
    // function tokenMetadata(uint256 _tokenId, string _preferredTransport) public view returns (string infoUrl);

    // ERC-165 Compatibility (https://github.com/ethereum/EIPs/issues/165)
    function supportsInterface(bytes4 _interfaceID) external view returns (bool);
}

// // Auction wrapper functions

// Auction wrapper functions

/// @title SEKRETOOOO
contract GeneScienceInterface {
    /// @dev simply a boolean to indicate this is the contract we expect to be
    function isGeneScience() public pure returns (bool);

    /// @dev given genes of kitten 1 & 2, return a genetic combination - may have a random factor
    /// @param genes1 genes of mom
    /// @param genes2 genes of sire
    /// @return the genes that are supposed to be passed down the child
    function mixGenes(uint256 genes1, uint256 genes2, uint256 targetBlock) public returns (uint256);
}

/// @title A facet of KittyCore that manages special access privileges.
/// @author Axiom Zen (https://www.axiomzen.co)
/// @dev See the KittyCore contract documentation to understand how the various contract facets are arranged.
contract KittyAccessControl {
    // This facet controls access control for CryptoKitties. There are four roles managed here:
    //
    //     - The CEO: The CEO can reassign other roles and change the addresses of our dependent smart
    //         contracts. It is also the only role that can unpause the smart contract. It is initially
    //         set to the address that created the smart contract in the KittyCore constructor.
    //
    //     - The CFO: The CFO can withdraw funds from KittyCore and its auction contracts.
    //
    //     - The COO: The COO can release gen0 kitties to auction, and mint promo cats.
    //
    // It should be noted that these roles are distinct without overlap in their access abilities, the
    // abilities listed for each role above are exhaustive. In particular, while the CEO can assign any
    // address to any role, the CEO address itself doesn't have the ability to act in those roles. This
    // restriction is intentional so that we aren't tempted to use the CEO address frequently out of
    // convenience. The less we use an address, the less likely it is that we somehow compromise the
    // account.

    /// @dev Emited when contract is upgraded - See README.md for updgrade plan
    event ContractUpgrade(address newContract);

    // The addresses of the accounts (or contracts) that can execute actions within each roles.
    address public ceoAddress;
    address public cfoAddress;
    address public cooAddress;

    // @dev Keeps track whether the contract is paused. When that is true, most actions are blocked
    bool public paused = false;

    /// @dev Access modifier for CEO-only functionality
    modifier onlyCEO() {
        require(msg.sender == ceoAddress);
        _;
    }

    /// @dev Access modifier for CFO-only functionality
    modifier onlyCFO() {
        require(msg.sender == cfoAddress);
        _;
    }

    /// @dev Access modifier for COO-only functionality
    modifier onlyCOO() {
        require(msg.sender == cooAddress);
        _;
    }

    modifier onlyCLevel() {
        require(
            msg.sender == cooAddress ||
            msg.sender == ceoAddress ||
            msg.sender == cfoAddress
        );
        _;
    }

    /// @dev Assigns a new address to act as the CEO. Only available to the current CEO.
    /// @param _newCEO The address of the new CEO
    function setCEO(address _newCEO) external onlyCEO {
        require(_newCEO != address(0));

        ceoAddress = _newCEO;
    }

    /// @dev Assigns a new address to act as the CFO. Only available to the current CEO.
    /// @param _newCFO The address of the new CFO
    function setCFO(address _newCFO) external onlyCEO {
        require(_newCFO != address(0));

        cfoAddress = _newCFO;
    }

    /// @dev Assigns a new address to act as the COO. Only available to the current CEO.
    /// @param _newCOO The address of the new COO
    function setCOO(address _newCOO) external onlyCEO {
        require(_newCOO != address(0));

        cooAddress = _newCOO;
    }

    /*** Pausable functionality adapted from OpenZeppelin ***/

    /// @dev Modifier to allow actions only when the contract IS NOT paused
    modifier whenNotPaused() {
        require(!paused);
        _;
    }

    /// @dev Modifier to allow actions only when the contract IS paused
    modifier whenPaused {
        require(paused);
        _;
    }

    /// @dev Called by any "C-level" role to pause the contract. Used only when
    ///  a bug or exploit is detected and we need to limit damage.
    function pause() external onlyCLevel whenNotPaused {
        paused = true;
    }

    /// @dev Unpauses the smart contract. Can only be called by the CEO, since
    ///  one reason we may pause the contract is when CFO or COO accounts are
    ///  compromised.
    /// @notice This is public rather than external so it can be called by
    ///  derived contracts.
    function unpause() public onlyCEO whenPaused {
        // can't unpause if contract was upgraded
        paused = false;
    }
}

/// @title Base contract for CryptoKitties. Holds all common structs, events and base variables.
/// @author Axiom Zen (https://www.axiomzen.co)
/// @dev See the KittyCore contract documentation to understand how the various contract facets are arranged.
contract KittyBase is KittyAccessControl {
    /*** EVENTS ***/

    /// @dev The Birth event is fired whenever a new kitten comes into existence. This obviously
    ///  includes any time a cat is created through the giveBirth method, but it is also called
    ///  when a new gen0 cat is created.
    event Birth(address owner, uint256 kittyId, uint256 matronId, uint256 sireId, uint256 genes);

    /// @dev Transfer event as defined in current draft of ERC721\. Emitted every time a kitten
    ///  ownership is assigned, including births.
    event Transfer(address from, address to, uint256 tokenId);

    /*** DATA TYPES ***/

    /// @dev The main Kitty struct. Every cat in CryptoKitties is represented by a copy
    ///  of this structure, so great care was taken to ensure that it fits neatly into
    ///  exactly two 256-bit words. Note that the order of the members in this structure
    ///  is important because of the byte-packing rules used by Ethereum.
    ///  Ref: http://solidity.readthedocs.io/en/develop/miscellaneous.html
    struct Kitty {
        // The Kitty's genetic code is packed into these 256-bits, the format is
        // sooper-sekret! A cat's genes never change.
        uint256 genes;

        // The timestamp from the block when this cat came into existence.
        uint64 birthTime;

        // The minimum timestamp after which this cat can engage in breeding
        // activities again. This same timestamp is used for the pregnancy
        // timer (for matrons) as well as the siring cooldown.
        uint64 cooldownEndBlock;

        // The ID of the parents of this kitty, set to 0 for gen0 cats.
        // Note that using 32-bit unsigned integers limits us to a "mere"
        // 4 billion cats. This number might seem small until you realize
        // that Ethereum currently has a limit of about 500 million
        // transactions per year! So, this definitely won't be a problem
        // for several years (even as Ethereum learns to scale).
        uint32 matronId;
        uint32 sireId;

        // Set to the ID of the sire cat for matrons that are pregnant,
        // zero otherwise. A non-zero value here is how we know a cat
        // is pregnant. Used to retrieve the genetic material for the new
        // kitten when the birth transpires.
        uint32 siringWithId;

        // Set to the index in the cooldown array (see below) that represents
        // the current cooldown duration for this Kitty. This starts at zero
        // for gen0 cats, and is initialized to floor(generation/2) for others.
        // Incremented by one for each successful breeding action, regardless
        // of whether this cat is acting as matron or sire.
        uint16 cooldownIndex;

        // The "generation number" of this cat. Cats minted by the CK contract
        // for sale are called "gen0" and have a generation number of 0\. The
        // generation number of all other cats is the larger of the two generation
        // numbers of their parents, plus one.
        // (i.e. max(matron.generation, sire.generation) + 1)
        uint16 generation;
    }

    /*** CONSTANTS ***/

    /// @dev A lookup table indicating the cooldown duration after any successful
    ///  breeding action, called "pregnancy time" for matrons and "siring cooldown"
    ///  for sires. Designed such that the cooldown roughly doubles each time a cat
    ///  is bred, encouraging owners not to just keep breeding the same cat over
    ///  and over again. Caps out at one week (a cat can breed an unbounded number
    ///  of times, and the maximum cooldown is always seven days).
    uint32[14] public cooldowns = [
        uint32(1 minutes),
        uint32(2 minutes),
        uint32(5 minutes),
        uint32(10 minutes),
        uint32(30 minutes),
        uint32(1 hours),
        uint32(2 hours),
        uint32(4 hours),
        uint32(8 hours),
        uint32(16 hours),
        uint32(1 days),
        uint32(2 days),
        uint32(4 days),
        uint32(7 days)
    ];

    // An approximation of currently how many seconds are in between blocks.
    uint256 public secondsPerBlock = 15;

    /*** STORAGE ***/

    /// @dev An array containing the Kitty struct for all Kitties in existence. The ID
    ///  of each cat is actually an index into this array. Note that ID 0 is a negacat,
    ///  the unKitty, the mythical beast that is the parent of all gen0 cats. A bizarre
    ///  creature that is both matron and sire... to itself! Has an invalid genetic code.
    ///  In other words, cat ID 0 is invalid... ;-)
    Kitty[] kitties;

    /// @dev A mapping from cat IDs to the address that owns them. All cats have
    ///  some valid owner address, even gen0 cats are created with a non-zero owner.
    mapping (uint256 => address) public kittyIndexToOwner;

    // @dev A mapping from owner address to count of tokens that address owns.
    //  Used internally inside balanceOf() to resolve ownership count.
    mapping (address => uint256) ownershipTokenCount;

    /// @dev A mapping from KittyIDs to an address that has been approved to call
    ///  transferFrom(). Each Kitty can only have one approved address for transfer
    ///  at any time. A zero value means no approval is outstanding.
    mapping (uint256 => address) public kittyIndexToApproved;

    /// @dev A mapping from KittyIDs to an address that has been approved to use
    ///  this Kitty for siring via breedWith(). Each Kitty can only have one approved
    ///  address for siring at any time. A zero value means no approval is outstanding.
    mapping (uint256 => address) public sireAllowedToAddress;

    /// @dev The address of the ClockAuction contract that handles sales of Kitties. This
    ///  same contract handles both peer-to-peer sales as well as the gen0 sales which are
    ///  initiated every 15 minutes.
    SaleClockAuction public saleAuction;

    /// @dev The address of a custom ClockAuction subclassed contract that handles siring
    ///  auctions. Needs to be separate from saleAuction because the actions taken on success
    ///  after a sales and siring auction are quite different.
    SiringClockAuction public siringAuction;

    /// @dev Assigns ownership of a specific Kitty to an address.
    function _transfer(address _from, address _to, uint256 _tokenId) internal {
        // Since the number of kittens is capped to 2Â³Â² we can't overflow this
        ownershipTokenCount[_to]++;
        // transfer ownership
        kittyIndexToOwner[_tokenId] = _to;
        // When creating new kittens _from is 0x0, but we can't account that address.
        if (_from != address(0)) {
            ownershipTokenCount[_from]--;
            // once the kitten is transferred also clear sire allowances
            delete sireAllowedToAddress[_tokenId];
            // clear any previously approved ownership exchange
            delete kittyIndexToApproved[_tokenId];
        }
        // Emit the transfer event.
        Transfer(_from, _to, _tokenId);
    }

    /// @dev An internal method that creates a new kitty and stores it. This
    ///  method doesn't do any checking and should only be called when the
    ///  input data is known to be valid. Will generate both a Birth event
    ///  and a Transfer event.
    /// @param _matronId The kitty ID of the matron of this cat (zero for gen0)
    /// @param _sireId The kitty ID of the sire of this cat (zero for gen0)
    /// @param _generation The generation number of this cat, must be computed by caller.
    /// @param _genes The kitty's genetic code.
    /// @param _owner The inital owner of this cat, must be non-zero (except for the unKitty, ID 0)
    function _createKitty(
        uint256 _matronId,
        uint256 _sireId,
        uint256 _generation,
        uint256 _genes,
        address _owner
    )
        internal
        returns (uint)
    {
        // These requires are not strictly necessary, our calling code should make
        // sure that these conditions are never broken. However! _createKitty() is already
        // an expensive call (for storage), and it doesn't hurt to be especially careful
        // to ensure our data structures are always valid.
        require(_matronId == uint256(uint32(_matronId)));
        require(_sireId == uint256(uint32(_sireId)));
        require(_generation == uint256(uint16(_generation)));

        // New kitty starts with the same cooldown as parent gen/2
        uint16 cooldownIndex = uint16(_generation / 2);
        if (cooldownIndex > 13) {
            cooldownIndex = 13;
        }

        Kitty memory _kitty = Kitty({
            genes: _genes,
            birthTime: uint64(now),
            cooldownEndBlock: 0,
            matronId: uint32(_matronId),
            sireId: uint32(_sireId),
            siringWithId: 0,
            cooldownIndex: cooldownIndex,
            generation: uint16(_generation)
        });
        uint256 newKittenId = kitties.push(_kitty) - 1;

        // It's probably never going to happen, 4 billion cats is A LOT, but
        // let's just be 100% sure we never let this happen.
        require(newKittenId == uint256(uint32(newKittenId)));

        // emit the birth event
        Birth(
            _owner,
            newKittenId,
            uint256(_kitty.matronId),
            uint256(_kitty.sireId),
            _kitty.genes
        );

        // This will assign ownership, and also emit the Transfer event as
        // per ERC721 draft
        _transfer(0, _owner, newKittenId);

        return newKittenId;
    }

    // Any C-level can fix how many seconds per blocks are currently observed.
    function setSecondsPerBlock(uint256 secs) external onlyCLevel {
        require(secs < cooldowns[0]);
        secondsPerBlock = secs;
    }
}

/// @title The external contract that is responsible for generating metadata for the kitties,
///  it has one function that will return the data as bytes.
contract ERC721Metadata {
    /// @dev Given a token Id, returns a byte array that is supposed to be converted into string.
    function getMetadata(uint256 _tokenId, string) public view returns (bytes32[4] buffer, uint256 count) {
        if (_tokenId == 1) {
            buffer[0] = "Hello World! :D";
            count = 15;
        } else if (_tokenId == 2) {
            buffer[0] = "I would definitely choose a medi";
            buffer[1] = "um length string.";
            count = 49;
        } else if (_tokenId == 3) {
            buffer[0] = "Lorem ipsum dolor sit amet, mi e";
            buffer[1] = "st accumsan dapibus augue lorem,";
            buffer[2] = " tristique vestibulum id, libero";
            buffer[3] = " suscipit varius sapien aliquam.";
            count = 128;
        }
    }
}

/// @title The facet of the CryptoKitties core contract that manages ownership, ERC-721 (draft) compliant.
/// @author Axiom Zen (https://www.axiomzen.co)
/// @dev Ref: https://github.com/ethereum/EIPs/issues/721
///  See the KittyCore contract documentation to understand how the various contract facets are arranged.
contract KittyOwnership is KittyBase, ERC721 {

    /// @notice Name and symbol of the non fungible token, as defined in ERC721.
    string public constant name = "CryptoKitties";
    string public constant symbol = "CK";

    // The contract that will return kitty metadata
    ERC721Metadata public erc721Metadata;

    bytes4 constant InterfaceSignature_ERC165 =
        bytes4(keccak256('supportsInterface(bytes4)'));

    bytes4 constant InterfaceSignature_ERC721 =
        bytes4(keccak256('name()')) ^
        bytes4(keccak256('symbol()')) ^
        bytes4(keccak256('totalSupply()')) ^
        bytes4(keccak256('balanceOf(address)')) ^
        bytes4(keccak256('ownerOf(uint256)')) ^
        bytes4(keccak256('approve(address,uint256)')) ^
        bytes4(keccak256('transfer(address,uint256)')) ^
        bytes4(keccak256('transferFrom(address,address,uint256)')) ^
        bytes4(keccak256('tokensOfOwner(address)')) ^
        bytes4(keccak256('tokenMetadata(uint256,string)'));

    /// @notice Introspection interface as per ERC-165 (https://github.com/ethereum/EIPs/issues/165).
    ///  Returns true for any standardized interfaces implemented by this contract. We implement
    ///  ERC-165 (obviously!) and ERC-721.
    function supportsInterface(bytes4 _interfaceID) external view returns (bool)
    {
        // DEBUG ONLY
        //require((InterfaceSignature_ERC165 == 0x01ffc9a7) && (InterfaceSignature_ERC721 == 0x9a20483d));

        return ((_interfaceID == InterfaceSignature_ERC165) || (_interfaceID == InterfaceSignature_ERC721));
    }

    /// @dev Set the address of the sibling contract that tracks metadata.
    ///  CEO only.
    function setMetadataAddress(address _contractAddress) public onlyCEO {
        erc721Metadata = ERC721Metadata(_contractAddress);
    }

    // Internal utility functions: These functions all assume that their input arguments
    // are valid. We leave it to public methods to sanitize their inputs and follow
    // the required logic.

    /// @dev Checks if a given address is the current owner of a particular Kitty.
    /// @param _claimant the address we are validating against.
    /// @param _tokenId kitten id, only valid when > 0
    function _owns(address _claimant, uint256 _tokenId) internal view returns (bool) {
        return kittyIndexToOwner[_tokenId] == _claimant;
    }

    /// @dev Checks if a given address currently has transferApproval for a particular Kitty.
    /// @param _claimant the address we are confirming kitten is approved for.
    /// @param _tokenId kitten id, only valid when > 0
    function _approvedFor(address _claimant, uint256 _tokenId) internal view returns (bool) {
        return kittyIndexToApproved[_tokenId] == _claimant;
    }

    /// @dev Marks an address as being approved for transferFrom(), overwriting any previous
    ///  approval. Setting _approved to address(0) clears all transfer approval.
    ///  NOTE: _approve() does NOT send the Approval event. This is intentional because
    ///  _approve() and transferFrom() are used together for putting Kitties on auction, and
    ///  there is no value in spamming the log with Approval events in that case.
    function _approve(uint256 _tokenId, address _approved) internal {
        kittyIndexToApproved[_tokenId] = _approved;
    }

    /// @notice Returns the number of Kitties owned by a specific address.
    /// @param _owner The owner address to check.
    /// @dev Required for ERC-721 compliance
    function balanceOf(address _owner) public view returns (uint256 count) {
        return ownershipTokenCount[_owner];
    }

    /// @notice Transfers a Kitty to another address. If transferring to a smart
    ///  contract be VERY CAREFUL to ensure that it is aware of ERC-721 (or
    ///  CryptoKitties specifically) or your Kitty may be lost forever. Seriously.
    /// @param _to The address of the recipient, can be a user or contract.
    /// @param _tokenId The ID of the Kitty to transfer.
    /// @dev Required for ERC-721 compliance.
    function transfer(
        address _to,
        uint256 _tokenId
    )
        external
        whenNotPaused
    {
        // Safety check to prevent against an unexpected 0x0 default.
        require(_to != address(0));
        // Disallow transfers to this contract to prevent accidental misuse.
        // The contract should never own any kitties (except very briefly
        // after a gen0 cat is created and before it goes on auction).
        require(_to != address(this));
        // Disallow transfers to the auction contracts to prevent accidental
        // misuse. Auction contracts should only take ownership of kitties
        // through the allow + transferFrom flow.
        require(_to != address(saleAuction));
        require(_to != address(siringAuction));

        // You can only send your own cat.
        require(_owns(msg.sender, _tokenId));

        // Reassign ownership, clear pending approvals, emit Transfer event.
        _transfer(msg.sender, _to, _tokenId);
    }

    /// @notice Grant another address the right to transfer a specific Kitty via
    ///  transferFrom(). This is the preferred flow for transfering NFTs to contracts.
    /// @param _to The address to be granted transfer approval. Pass address(0) to
    ///  clear all approvals.
    /// @param _tokenId The ID of the Kitty that can be transferred if this call succeeds.
    /// @dev Required for ERC-721 compliance.
    function approve(
        address _to,
        uint256 _tokenId
    )
        external
        whenNotPaused
    {
        // Only an owner can grant transfer approval.
        require(_owns(msg.sender, _tokenId));

        // Register the approval (replacing any previous approval).
        _approve(_tokenId, _to);

        // Emit approval event.
        Approval(msg.sender, _to, _tokenId);
    }

    /// @notice Transfer a Kitty owned by another address, for which the calling address
    ///  has previously been granted transfer approval by the owner.
    /// @param _from The address that owns the Kitty to be transfered.
    /// @param _to The address that should take ownership of the Kitty. Can be any address,
    ///  including the caller.
    /// @param _tokenId The ID of the Kitty to be transferred.
    /// @dev Required for ERC-721 compliance.
    function transferFrom(
        address _from,
        address _to,
        uint256 _tokenId
    )
        external
        whenNotPaused
    {
        // Safety check to prevent against an unexpected 0x0 default.
        require(_to != address(0));
        // Disallow transfers to this contract to prevent accidental misuse.
        // The contract should never own any kitties (except very briefly
        // after a gen0 cat is created and before it goes on auction).
        require(_to != address(this));
        // Check for approval and valid ownership
        require(_approvedFor(msg.sender, _tokenId));
        require(_owns(_from, _tokenId));

        // Reassign ownership (also clears pending approvals and emits Transfer event).
        _transfer(_from, _to, _tokenId);
    }

    /// @notice Returns the total number of Kitties currently in existence.
    /// @dev Required for ERC-721 compliance.
    function totalSupply() public view returns (uint) {
        return kitties.length - 1;
    }

    /// @notice Returns the address currently assigned ownership of a given Kitty.
    /// @dev Required for ERC-721 compliance.
    function ownerOf(uint256 _tokenId)
        external
        view
        returns (address owner)
    {
        owner = kittyIndexToOwner[_tokenId];

        require(owner != address(0));
    }

    /// @notice Returns a list of all Kitty IDs assigned to an address.
    /// @param _owner The owner whose Kitties we are interested in.
    /// @dev This method MUST NEVER be called by smart contract code. First, it's fairly
    ///  expensive (it walks the entire Kitty array looking for cats belonging to owner),
    ///  but it also returns a dynamic array, which is only supported for web3 calls, and
    ///  not contract-to-contract calls.
    function tokensOfOwner(address _owner) external view returns(uint256[] ownerTokens) {
        uint256 tokenCount = balanceOf(_owner);

        if (tokenCount == 0) {
            // Return an empty array
            return new uint256[](0);
        } else {
            uint256[] memory result = new uint256[](tokenCount);
            uint256 totalCats = totalSupply();
            uint256 resultIndex = 0;

            // We count on the fact that all cats have IDs starting at 1 and increasing
            // sequentially up to the totalCat count.
            uint256 catId;

            for (catId = 1; catId <= totalCats; catId++) {
                if (kittyIndexToOwner[catId] == _owner) {
                    result[resultIndex] = catId;
                    resultIndex++;
                }
            }

            return result;
        }
    }

    /// @dev Adapted from memcpy() by @arachnid (Nick Johnson <arachnid@notdot.net>)
    ///  This method is licenced under the Apache License.
    ///  Ref: https://github.com/Arachnid/solidity-stringutils/blob/2f6ca9accb48ae14c66f1437ec50ed19a0616f78/strings.sol
    function _memcpy(uint _dest, uint _src, uint _len) private view {
        // Copy word-length chunks while possible
        for(; _len >= 32; _len -= 32) {
            assembly {
                mstore(_dest, mload(_src))
            }
            _dest += 32;
            _src += 32;
        }

        // Copy remaining bytes
        uint256 mask = 256 ** (32 - _len) - 1;
        assembly {
            let srcpart := and(mload(_src), not(mask))
            let destpart := and(mload(_dest), mask)
            mstore(_dest, or(destpart, srcpart))
        }
    }

    /// @dev Adapted from toString(slice) by @arachnid (Nick Johnson <arachnid@notdot.net>)
    ///  This method is licenced under the Apache License.
    ///  Ref: https://github.com/Arachnid/solidity-stringutils/blob/2f6ca9accb48ae14c66f1437ec50ed19a0616f78/strings.sol
    function _toString(bytes32[4] _rawBytes, uint256 _stringLength) private view returns (string) {
        var outputString = new string(_stringLength);
        uint256 outputPtr;
        uint256 bytesPtr;

        assembly {
            outputPtr := add(outputString, 32)
            bytesPtr := _rawBytes
        }

        _memcpy(outputPtr, bytesPtr, _stringLength);

        return outputString;
    }

    /// @notice Returns a URI pointing to a metadata package for this token conforming to
    ///  ERC-721 (https://github.com/ethereum/EIPs/issues/721)
    /// @param _tokenId The ID number of the Kitty whose metadata should be returned.
    function tokenMetadata(uint256 _tokenId, string _preferredTransport) external view returns (string infoUrl) {
        require(erc721Metadata != address(0));
        bytes32[4] memory buffer;
        uint256 count;
        (buffer, count) = erc721Metadata.getMetadata(_tokenId, _preferredTransport);

        return _toString(buffer, count);
    }
}

/// @title A facet of KittyCore that manages Kitty siring, gestation, and birth.
/// @author Axiom Zen (https://www.axiomzen.co)
/// @dev See the KittyCore contract documentation to understand how the various contract facets are arranged.
contract KittyBreeding is KittyOwnership {

    /// @dev The Pregnant event is fired when two cats successfully breed and the pregnancy
    ///  timer begins for the matron.
    event Pregnant(address owner, uint256 matronId, uint256 sireId, uint256 cooldownEndBlock);

    /// @notice The minimum payment required to use breedWithAuto(). This fee goes towards
    ///  the gas cost paid by whatever calls giveBirth(), and can be dynamically updated by
    ///  the COO role as the gas price changes.
    uint256 public autoBirthFee = 2 finney;

    // Keeps track of number of pregnant kitties.
    uint256 public pregnantKitties;

    /// @dev The address of the sibling contract that is used to implement the sooper-sekret
    ///  genetic combination algorithm.
    GeneScienceInterface public geneScience;

    /// @dev Update the address of the genetic contract, can only be called by the CEO.
    /// @param _address An address of a GeneScience contract instance to be used from this point forward.
    function setGeneScienceAddress(address _address) external onlyCEO {
        GeneScienceInterface candidateContract = GeneScienceInterface(_address);

        // NOTE: verify that a contract is what we expect - https://github.com/Lunyr/crowdsale-contracts/blob/cfadd15986c30521d8ba7d5b6f57b4fefcc7ac38/contracts/LunyrToken.sol#L117
        require(candidateContract.isGeneScience());

        // Set the new contract address
        geneScience = candidateContract;
    }

    /// @dev Checks that a given kitten is able to breed. Requires that the
    ///  current cooldown is finished (for sires) and also checks that there is
    ///  no pending pregnancy.
    function _isReadyToBreed(Kitty _kit) internal view returns (bool) {
        // In addition to checking the cooldownEndBlock, we also need to check to see if
        // the cat has a pending birth; there can be some period of time between the end
        // of the pregnacy timer and the birth event.
        return (_kit.siringWithId == 0) && (_kit.cooldownEndBlock <= uint64(block.number));
    }

    /// @dev Check if a sire has authorized breeding with this matron. True if both sire
    ///  and matron have the same owner, or if the sire has given siring permission to
    ///  the matron's owner (via approveSiring()).
    function _isSiringPermitted(uint256 _sireId, uint256 _matronId) internal view returns (bool) {
        address matronOwner = kittyIndexToOwner[_matronId];
        address sireOwner = kittyIndexToOwner[_sireId];

        // Siring is okay if they have same owner, or if the matron's owner was given
        // permission to breed with this sire.
        return (matronOwner == sireOwner || sireAllowedToAddress[_sireId] == matronOwner);
    }

    /// @dev Set the cooldownEndTime for the given Kitty, based on its current cooldownIndex.
    ///  Also increments the cooldownIndex (unless it has hit the cap).
    /// @param _kitten A reference to the Kitty in storage which needs its timer started.
    function _triggerCooldown(Kitty storage _kitten) internal {
        // Compute an estimation of the cooldown time in blocks (based on current cooldownIndex).
        _kitten.cooldownEndBlock = uint64((cooldowns[_kitten.cooldownIndex]/secondsPerBlock) + block.number);

        // Increment the breeding count, clamping it at 13, which is the length of the
        // cooldowns array. We could check the array size dynamically, but hard-coding
        // this as a constant saves gas. Yay, Solidity!
        if (_kitten.cooldownIndex < 13) {
            _kitten.cooldownIndex += 1;
        }
    }

    /// @notice Grants approval to another user to sire with one of your Kitties.
    /// @param _addr The address that will be able to sire with your Kitty. Set to
    ///  address(0) to clear all siring approvals for this Kitty.
    /// @param _sireId A Kitty that you own that _addr will now be able to sire with.
    function approveSiring(address _addr, uint256 _sireId)
        external
        whenNotPaused
    {
        require(_owns(msg.sender, _sireId));
        sireAllowedToAddress[_sireId] = _addr;
    }

    /// @dev Updates the minimum payment required for calling giveBirthAuto(). Can only
    ///  be called by the COO address. (This fee is used to offset the gas cost incurred
    ///  by the autobirth daemon).
    function setAutoBirthFee(uint256 val) external onlyCOO {
        autoBirthFee = val;
    }

    /// @dev Checks to see if a given Kitty is pregnant and (if so) if the gestation
    ///  period has passed.
    function _isReadyToGiveBirth(Kitty _matron) private view returns (bool) {
        return (_matron.siringWithId != 0) && (_matron.cooldownEndBlock <= uint64(block.number));
    }

    /// @notice Checks that a given kitten is able to breed (i.e. it is not pregnant or
    ///  in the middle of a siring cooldown).
    /// @param _kittyId reference the id of the kitten, any user can inquire about it
    function isReadyToBreed(uint256 _kittyId)
        public
        view
        returns (bool)
    {
        require(_kittyId > 0);
        Kitty storage kit = kitties[_kittyId];
        return _isReadyToBreed(kit);
    }

    /// @dev Checks whether a kitty is currently pregnant.
    /// @param _kittyId reference the id of the kitten, any user can inquire about it
    function isPregnant(uint256 _kittyId)
        public
        view
        returns (bool)
    {
        require(_kittyId > 0);
        // A kitty is pregnant if and only if this field is set
        return kitties[_kittyId].siringWithId != 0;
    }

    /// @dev Internal check to see if a given sire and matron are a valid mating pair. DOES NOT
    ///  check ownership permissions (that is up to the caller).
    /// @param _matron A reference to the Kitty struct of the potential matron.
    /// @param _matronId The matron's ID.
    /// @param _sire A reference to the Kitty struct of the potential sire.
    /// @param _sireId The sire's ID
    function _isValidMatingPair(
        Kitty storage _matron,
        uint256 _matronId,
        Kitty storage _sire,
        uint256 _sireId
    )
        private
        view
        returns(bool)
    {
        // A Kitty can't breed with itself!
        if (_matronId == _sireId) {
            return false;
        }

        // Kitties can't breed with their parents.
        if (_matron.matronId == _sireId || _matron.sireId == _sireId) {
            return false;
        }
        if (_sire.matronId == _matronId || _sire.sireId == _matronId) {
            return false;
        }

        // We can short circuit the sibling check (below) if either cat is
        // gen zero (has a matron ID of zero).
        if (_sire.matronId == 0 || _matron.matronId == 0) {
            return true;
        }

        // Kitties can't breed with full or half siblings.
        if (_sire.matronId == _matron.matronId || _sire.matronId == _matron.sireId) {
            return false;
        }
        if (_sire.sireId == _matron.matronId || _sire.sireId == _matron.sireId) {
            return false;
        }

        // Everything seems cool! Let's get DTF.
        return true;
    }

    /// @dev Internal check to see if a given sire and matron are a valid mating pair for
    ///  breeding via auction (i.e. skips ownership and siring approval checks).
    function _canBreedWithViaAuction(uint256 _matronId, uint256 _sireId)
        internal
        view
        returns (bool)
    {
        Kitty storage matron = kitties[_matronId];
        Kitty storage sire = kitties[_sireId];
        return _isValidMatingPair(matron, _matronId, sire, _sireId);
    }

    /// @notice Checks to see if two cats can breed together, including checks for
    ///  ownership and siring approvals. Does NOT check that both cats are ready for
    ///  breeding (i.e. breedWith could still fail until the cooldowns are finished).
    ///  TODO: Shouldn't this check pregnancy and cooldowns?!?
    /// @param _matronId The ID of the proposed matron.
    /// @param _sireId The ID of the proposed sire.
    function canBreedWith(uint256 _matronId, uint256 _sireId)
        external
        view
        returns(bool)
    {
        require(_matronId > 0);
        require(_sireId > 0);
        Kitty storage matron = kitties[_matronId];
        Kitty storage sire = kitties[_sireId];
        return _isValidMatingPair(matron, _matronId, sire, _sireId) &&
            _isSiringPermitted(_sireId, _matronId);
    }

    /// @dev Internal utility function to initiate breeding, assumes that all breeding
    ///  requirements have been checked.
    function _breedWith(uint256 _matronId, uint256 _sireId) internal {
        // Grab a reference to the Kitties from storage.
        Kitty storage sire = kitties[_sireId];
        Kitty storage matron = kitties[_matronId];

        // Mark the matron as pregnant, keeping track of who the sire is.
        matron.siringWithId = uint32(_sireId);

        // Trigger the cooldown for both parents.
        _triggerCooldown(sire);
        _triggerCooldown(matron);

        // Clear siring permission for both parents. This may not be strictly necessary
        // but it's likely to avoid confusion!
        delete sireAllowedToAddress[_matronId];
        delete sireAllowedToAddress[_sireId];

        // Every time a kitty gets pregnant, counter is incremented.
        pregnantKitties++;

        // Emit the pregnancy event.
        Pregnant(kittyIndexToOwner[_matronId], _matronId, _sireId, matron.cooldownEndBlock);
    }

    /// @notice Breed a Kitty you own (as matron) with a sire that you own, or for which you
    ///  have previously been given Siring approval. Will either make your cat pregnant, or will
    ///  fail entirely. Requires a pre-payment of the fee given out to the first caller of giveBirth()
    /// @param _matronId The ID of the Kitty acting as matron (will end up pregnant if successful)
    /// @param _sireId The ID of the Kitty acting as sire (will begin its siring cooldown if successful)
    function breedWithAuto(uint256 _matronId, uint256 _sireId)
        external
        payable
        whenNotPaused
    {
        // Checks for payment.
        require(msg.value >= autoBirthFee);

        // Caller must own the matron.
        require(_owns(msg.sender, _matronId));

        // Neither sire nor matron are allowed to be on auction during a normal
        // breeding operation, but we don't need to check that explicitly.
        // For matron: The caller of this function can't be the owner of the matron
        //   because the owner of a Kitty on auction is the auction house, and the
        //   auction house will never call breedWith().
        // For sire: Similarly, a sire on auction will be owned by the auction house
        //   and the act of transferring ownership will have cleared any oustanding
        //   siring approval.
        // Thus we don't need to spend gas explicitly checking to see if either cat
        // is on auction.

        // Check that matron and sire are both owned by caller, or that the sire
        // has given siring permission to caller (i.e. matron's owner).
        // Will fail for _sireId = 0
        require(_isSiringPermitted(_sireId, _matronId));

        // Grab a reference to the potential matron
        Kitty storage matron = kitties[_matronId];

        // Make sure matron isn't pregnant, or in the middle of a siring cooldown
        require(_isReadyToBreed(matron));

        // Grab a reference to the potential sire
        Kitty storage sire = kitties[_sireId];

        // Make sure sire isn't pregnant, or in the middle of a siring cooldown
        require(_isReadyToBreed(sire));

        // Test that these cats are a valid mating pair.
        require(_isValidMatingPair(
            matron,
            _matronId,
            sire,
            _sireId
        ));

        // All checks passed, kitty gets pregnant!
        _breedWith(_matronId, _sireId);
    }

    /// @notice Have a pregnant Kitty give birth!
    /// @param _matronId A Kitty ready to give birth.
    /// @return The Kitty ID of the new kitten.
    /// @dev Looks at a given Kitty and, if pregnant and if the gestation period has passed,
    ///  combines the genes of the two parents to create a new kitten. The new Kitty is assigned
    ///  to the current owner of the matron. Upon successful completion, both the matron and the
    ///  new kitten will be ready to breed again. Note that anyone can call this function (if they
    ///  are willing to pay the gas!), but the new kitten always goes to the mother's owner.
    function giveBirth(uint256 _matronId)
        external
        whenNotPaused
        returns(uint256)
    {
        // Grab a reference to the matron in storage.
        Kitty storage matron = kitties[_matronId];

        // Check that the matron is a valid cat.
        require(matron.birthTime != 0);

        // Check that the matron is pregnant, and that its time has come!
        require(_isReadyToGiveBirth(matron));

        // Grab a reference to the sire in storage.
        uint256 sireId = matron.siringWithId;
        Kitty storage sire = kitties[sireId];

        // Determine the higher generation number of the two parents
        uint16 parentGen = matron.generation;
        if (sire.generation > matron.generation) {
            parentGen = sire.generation;
        }

        // Call the sooper-sekret gene mixing operation.
        uint256 childGenes = geneScience.mixGenes(matron.genes, sire.genes, matron.cooldownEndBlock - 1);

        // Make the new kitten!
        address owner = kittyIndexToOwner[_matronId];
        uint256 kittenId = _createKitty(_matronId, matron.siringWithId, parentGen + 1, childGenes, owner);

        // Clear the reference to sire from the matron (REQUIRED! Having siringWithId
        // set is what marks a matron as being pregnant.)
        delete matron.siringWithId;

        // Every time a kitty gives birth counter is decremented.
        pregnantKitties--;

        // Send the balance fee to the person who made birth happen.
        msg.sender.send(autoBirthFee);

        // return the new kitten's ID
        return kittenId;
    }
}

/// @title Auction Core
/// @dev Contains models, variables, and internal methods for the auction.
/// @notice We omit a fallback function to prevent accidental sends to this contract.
contract ClockAuctionBase {

    // Represents an auction on an NFT
    struct Auction {
        // Current owner of NFT
        address seller;
        // Price (in wei) at beginning of auction
        uint128 startingPrice;
        // Price (in wei) at end of auction
        uint128 endingPrice;
        // Duration (in seconds) of auction
        uint64 duration;
        // Time when auction started
        // NOTE: 0 if this auction has been concluded
        uint64 startedAt;
    }

    // Reference to contract tracking NFT ownership
    ERC721 public nonFungibleContract;

    // Cut owner takes on each auction, measured in basis points (1/100 of a percent).
    // Values 0-10,000 map to 0%-100%
    uint256 public ownerCut;

    // Map from token ID to their corresponding auction.
    mapping (uint256 => Auction) tokenIdToAuction;

    event AuctionCreated(uint256 tokenId, uint256 startingPrice, uint256 endingPrice, uint256 duration);
    event AuctionSuccessful(uint256 tokenId, uint256 totalPrice, address winner);
    event AuctionCancelled(uint256 tokenId);

    /// @dev Returns true if the claimant owns the token.
    /// @param _claimant - Address claiming to own the token.
    /// @param _tokenId - ID of token whose ownership to verify.
    function _owns(address _claimant, uint256 _tokenId) internal view returns (bool) {
        return (nonFungibleContract.ownerOf(_tokenId) == _claimant);
    }

    /// @dev Escrows the NFT, assigning ownership to this contract.
    /// Throws if the escrow fails.
    /// @param _owner - Current owner address of token to escrow.
    /// @param _tokenId - ID of token whose approval to verify.
    function _escrow(address _owner, uint256 _tokenId) internal {
        // it will throw if transfer fails
        nonFungibleContract.transferFrom(_owner, this, _tokenId);
    }

    /// @dev Transfers an NFT owned by this contract to another address.
    /// Returns true if the transfer succeeds.
    /// @param _receiver - Address to transfer NFT to.
    /// @param _tokenId - ID of token to transfer.
    function _transfer(address _receiver, uint256 _tokenId) internal {
        // it will throw if transfer fails
        nonFungibleContract.transfer(_receiver, _tokenId);
    }

    /// @dev Adds an auction to the list of open auctions. Also fires the
    ///  AuctionCreated event.
    /// @param _tokenId The ID of the token to be put on auction.
    /// @param _auction Auction to add.
    function _addAuction(uint256 _tokenId, Auction _auction) internal {
        // Require that all auctions have a duration of
        // at least one minute. (Keeps our math from getting hairy!)
        require(_auction.duration >= 1 minutes);

        tokenIdToAuction[_tokenId] = _auction;

        AuctionCreated(
            uint256(_tokenId),
            uint256(_auction.startingPrice),
            uint256(_auction.endingPrice),
            uint256(_auction.duration)
        );
    }

    /// @dev Cancels an auction unconditionally.
    function _cancelAuction(uint256 _tokenId, address _seller) internal {
        _removeAuction(_tokenId);
        _transfer(_seller, _tokenId);
        AuctionCancelled(_tokenId);
    }

    /// @dev Computes the price and transfers winnings.
    /// Does NOT transfer ownership of token.
    function _bid(uint256 _tokenId, uint256 _bidAmount)
        internal
        returns (uint256)
    {
        // Get a reference to the auction struct
        Auction storage auction = tokenIdToAuction[_tokenId];

        // Explicitly check that this auction is currently live.
        // (Because of how Ethereum mappings work, we can't just count
        // on the lookup above failing. An invalid _tokenId will just
        // return an auction object that is all zeros.)
        require(_isOnAuction(auction));

        // Check that the bid is greater than or equal to the current price
        uint256 price = _currentPrice(auction);
        require(_bidAmount >= price);

        // Grab a reference to the seller before the auction struct
        // gets deleted.
        address seller = auction.seller;

        // The bid is good! Remove the auction before sending the fees
        // to the sender so we can't have a reentrancy attack.
        _removeAuction(_tokenId);

        // Transfer proceeds to seller (if there are any!)
        if (price > 0) {
            // Calculate the auctioneer's cut.
            // (NOTE: _computeCut() is guaranteed to return a
            // value <= price, so this subtraction can't go negative.)
            uint256 auctioneerCut = _computeCut(price);
            uint256 sellerProceeds = price - auctioneerCut;

            // NOTE: Doing a transfer() in the middle of a complex
            // method like this is generally discouraged because of
            // reentrancy attacks and DoS attacks if the seller is
            // a contract with an invalid fallback function. We explicitly
            // guard against reentrancy attacks by removing the auction
            // before calling transfer(), and the only thing the seller
            // can DoS is the sale of their own asset! (And if it's an
            // accident, they can call cancelAuction(). )
            seller.transfer(sellerProceeds);
        }

        // Calculate any excess funds included with the bid. If the excess
        // is anything worth worrying about, transfer it back to bidder.
        // NOTE: We checked above that the bid amount is greater than or
        // equal to the price so this cannot underflow.
        uint256 bidExcess = _bidAmount - price;

        // Return the funds. Similar to the previous transfer, this is
        // not susceptible to a re-entry attack because the auction is
        // removed before any transfers occur.
        msg.sender.transfer(bidExcess);

        // Tell the world!
        AuctionSuccessful(_tokenId, price, msg.sender);

        return price;
    }

    /// @dev Removes an auction from the list of open auctions.
    /// @param _tokenId - ID of NFT on auction.
    function _removeAuction(uint256 _tokenId) internal {
        delete tokenIdToAuction[_tokenId];
    }

    /// @dev Returns true if the NFT is on auction.
    /// @param _auction - Auction to check.
    function _isOnAuction(Auction storage _auction) internal view returns (bool) {
        return (_auction.startedAt > 0);
    }

    /// @dev Returns current price of an NFT on auction. Broken into two
    ///  functions (this one, that computes the duration from the auction
    ///  structure, and the other that does the price computation) so we
    ///  can easily test that the price computation works correctly.
    function _currentPrice(Auction storage _auction)
        internal
        view
        returns (uint256)
    {
        uint256 secondsPassed = 0;

        // A bit of insurance against negative values (or wraparound).
        // Probably not necessary (since Ethereum guarnatees that the
        // now variable doesn't ever go backwards).
        if (now > _auction.startedAt) {
            secondsPassed = now - _auction.startedAt;
        }

        return _computeCurrentPrice(
            _auction.startingPrice,
            _auction.endingPrice,
            _auction.duration,
            secondsPassed
        );
    }

    /// @dev Computes the current price of an auction. Factored out
    ///  from _currentPrice so we can run extensive unit tests.
    ///  When testing, make this function public and turn on
    ///  `Current price computation` test suite.
    function _computeCurrentPrice(
        uint256 _startingPrice,
        uint256 _endingPrice,
        uint256 _duration,
        uint256 _secondsPassed
    )
        internal
        pure
        returns (uint256)
    {
        // NOTE: We don't use SafeMath (or similar) in this function because
        //  all of our public functions carefully cap the maximum values for
        //  time (at 64-bits) and currency (at 128-bits). _duration is
        //  also known to be non-zero (see the require() statement in
        //  _addAuction())
        if (_secondsPassed >= _duration) {
            // We've reached the end of the dynamic pricing portion
            // of the auction, just return the end price.
            return _endingPrice;
        } else {
            // Starting price can be higher than ending price (and often is!), so
            // this delta can be negative.
            int256 totalPriceChange = int256(_endingPrice) - int256(_startingPrice);

            // This multiplication can't overflow, _secondsPassed will easily fit within
            // 64-bits, and totalPriceChange will easily fit within 128-bits, their product
            // will always fit within 256-bits.
            int256 currentPriceChange = totalPriceChange * int256(_secondsPassed) / int256(_duration);

            // currentPriceChange can be negative, but if so, will have a magnitude
            // less that _startingPrice. Thus, this result will always end up positive.
            int256 currentPrice = int256(_startingPrice) + currentPriceChange;

            return uint256(currentPrice);
        }
    }

    /// @dev Computes owner's cut of a sale.
    /// @param _price - Sale price of NFT.
    function _computeCut(uint256 _price) internal view returns (uint256) {
        // NOTE: We don't use SafeMath (or similar) in this function because
        //  all of our entry functions carefully cap the maximum values for
        //  currency (at 128-bits), and ownerCut <= 10000 (see the require()
        //  statement in the ClockAuction constructor). The result of this
        //  function is always guaranteed to be <= _price.
        return _price * ownerCut / 10000;
    }

}

/**
 * @title Pausable
 * @dev Base contract which allows children to implement an emergency stop mechanism.
 */
contract Pausable is Ownable {
  event Pause();
  event Unpause();

  bool public paused = false;

  /**
   * @dev modifier to allow actions only when the contract IS paused
   */
  modifier whenNotPaused() {
    require(!paused);
    _;
  }

  /**
   * @dev modifier to allow actions only when the contract IS NOT paused
   */
  modifier whenPaused {
    require(paused);
    _;
  }

  /**
   * @dev called by the owner to pause, triggers stopped state
   */
  function pause() onlyOwner whenNotPaused returns (bool) {
    paused = true;
    Pause();
    return true;
  }

  /**
   * @dev called by the owner to unpause, returns to normal state
   */
  function unpause() onlyOwner whenPaused returns (bool) {
    paused = false;
    Unpause();
    return true;
  }
}

/// @title Clock auction for non-fungible tokens.
/// @notice We omit a fallback function to prevent accidental sends to this contract.
contract ClockAuction is Pausable, ClockAuctionBase {

    /// @dev The ERC-165 interface signature for ERC-721.
    ///  Ref: https://github.com/ethereum/EIPs/issues/165
    ///  Ref: https://github.com/ethereum/EIPs/issues/721
    bytes4 constant InterfaceSignature_ERC721 = bytes4(0x9a20483d);

    /// @dev Constructor creates a reference to the NFT ownership contract
    ///  and verifies the owner cut is in the valid range.
    /// @param _nftAddress - address of a deployed contract implementing
    ///  the Nonfungible Interface.
    /// @param _cut - percent cut the owner takes on each auction, must be
    ///  between 0-10,000.
    function ClockAuction(address _nftAddress, uint256 _cut) public {
        require(_cut <= 10000);
        ownerCut = _cut;

        ERC721 candidateContract = ERC721(_nftAddress);
        require(candidateContract.supportsInterface(InterfaceSignature_ERC721));
        nonFungibleContract = candidateContract;
    }

    /// @dev Remove all Ether from the contract, which is the owner's cuts
    ///  as well as any Ether sent directly to the contract address.
    ///  Always transfers to the NFT contract, but can be called either by
    ///  the owner or the NFT contract.
    function withdrawBalance() external {
        address nftAddress = address(nonFungibleContract);

        require(
            msg.sender == owner ||
            msg.sender == nftAddress
        );
        // We are using this boolean method to make sure that even if one fails it will still work
        bool res = nftAddress.send(this.balance);
    }

    /// @dev Creates and begins a new auction.
    /// @param _tokenId - ID of token to auction, sender must be owner.
    /// @param _startingPrice - Price of item (in wei) at beginning of auction.
    /// @param _endingPrice - Price of item (in wei) at end of auction.
    /// @param _duration - Length of time to move between starting
    ///  price and ending price (in seconds).
    /// @param _seller - Seller, if not the message sender
    function createAuction(
        uint256 _tokenId,
        uint256 _startingPrice,
        uint256 _endingPrice,
        uint256 _duration,
        address _seller
    )
        external
        whenNotPaused
    {
        // Sanity check that no inputs overflow how many bits we've allocated
        // to store them in the auction struct.
        require(_startingPrice == uint256(uint128(_startingPrice)));
        require(_endingPrice == uint256(uint128(_endingPrice)));
        require(_duration == uint256(uint64(_duration)));

        require(_owns(msg.sender, _tokenId));
        _escrow(msg.sender, _tokenId);
        Auction memory auction = Auction(
            _seller,
            uint128(_startingPrice),
            uint128(_endingPrice),
            uint64(_duration),
            uint64(now)
        );
        _addAuction(_tokenId, auction);
    }

    /// @dev Bids on an open auction, completing the auction and transferring
    ///  ownership of the NFT if enough Ether is supplied.
    /// @param _tokenId - ID of token to bid on.
    function bid(uint256 _tokenId)
        external
        payable
        whenNotPaused
    {
        // _bid will throw if the bid or funds transfer fails
        _bid(_tokenId, msg.value);
        _transfer(msg.sender, _tokenId);
    }

    /// @dev Cancels an auction that hasn't been won yet.
    ///  Returns the NFT to original owner.
    /// @notice This is a state-modifying function that can
    ///  be called while the contract is paused.
    /// @param _tokenId - ID of token on auction
    function cancelAuction(uint256 _tokenId)
        external
    {
        Auction storage auction = tokenIdToAuction[_tokenId];
        require(_isOnAuction(auction));
        address seller = auction.seller;
        require(msg.sender == seller);
        _cancelAuction(_tokenId, seller);
    }

    /// @dev Cancels an auction when the contract is paused.
    ///  Only the owner may do this, and NFTs are returned to
    ///  the seller. This should only be used in emergencies.
    /// @param _tokenId - ID of the NFT on auction to cancel.
    function cancelAuctionWhenPaused(uint256 _tokenId)
        whenPaused
        onlyOwner
        external
    {
        Auction storage auction = tokenIdToAuction[_tokenId];
        require(_isOnAuction(auction));
        _cancelAuction(_tokenId, auction.seller);
    }

    /// @dev Returns auction info for an NFT on auction.
    /// @param _tokenId - ID of NFT on auction.
    function getAuction(uint256 _tokenId)
        external
        view
        returns
    (
        address seller,
        uint256 startingPrice,
        uint256 endingPrice,
        uint256 duration,
        uint256 startedAt
    ) {
        Auction storage auction = tokenIdToAuction[_tokenId];
        require(_isOnAuction(auction));
        return (
            auction.seller,
            auction.startingPrice,
            auction.endingPrice,
            auction.duration,
            auction.startedAt
        );
    }

    /// @dev Returns the current price of an auction.
    /// @param _tokenId - ID of the token price we are checking.
    function getCurrentPrice(uint256 _tokenId)
        external
        view
        returns (uint256)
    {
        Auction storage auction = tokenIdToAuction[_tokenId];
        require(_isOnAuction(auction));
        return _currentPrice(auction);
    }

}

/// @title Reverse auction modified for siring
/// @notice We omit a fallback function to prevent accidental sends to this contract.
contract SiringClockAuction is ClockAuction {

    // @dev Sanity check that allows us to ensure that we are pointing to the
    //  right auction in our setSiringAuctionAddress() call.
    bool public isSiringClockAuction = true;

    // Delegate constructor
    function SiringClockAuction(address _nftAddr, uint256 _cut) public
        ClockAuction(_nftAddr, _cut) {}

    /// @dev Creates and begins a new auction. Since this function is wrapped,
    /// require sender to be KittyCore contract.
    /// @param _tokenId - ID of token to auction, sender must be owner.
    /// @param _startingPrice - Price of item (in wei) at beginning of auction.
    /// @param _endingPrice - Price of item (in wei) at end of auction.
    /// @param _duration - Length of auction (in seconds).
    /// @param _seller - Seller, if not the message sender
    function createAuction(
        uint256 _tokenId,
        uint256 _startingPrice,
        uint256 _endingPrice,
        uint256 _duration,
        address _seller
    )
        external
    {
        // Sanity check that no inputs overflow how many bits we've allocated
        // to store them in the auction struct.
        require(_startingPrice == uint256(uint128(_startingPrice)));
        require(_endingPrice == uint256(uint128(_endingPrice)));
        require(_duration == uint256(uint64(_duration)));

        require(msg.sender == address(nonFungibleContract));
        _escrow(_seller, _tokenId);
        Auction memory auction = Auction(
            _seller,
            uint128(_startingPrice),
            uint128(_endingPrice),
            uint64(_duration),
            uint64(now)
        );
        _addAuction(_tokenId, auction);
    }

    /// @dev Places a bid for siring. Requires the sender
    /// is the KittyCore contract because all bid methods
    /// should be wrapped. Also returns the kitty to the
    /// seller rather than the winner.
    function bid(uint256 _tokenId)
        external
        payable
    {
        require(msg.sender == address(nonFungibleContract));
        address seller = tokenIdToAuction[_tokenId].seller;
        // _bid checks that token ID is valid and will throw if bid fails
        _bid(_tokenId, msg.value);
        // We transfer the kitty back to the seller, the winner will get
        // the offspring
        _transfer(seller, _tokenId);
    }

}

/// @title Clock auction modified for sale of kitties
/// @notice We omit a fallback function to prevent accidental sends to this contract.
contract SaleClockAuction is ClockAuction {

    // @dev Sanity check that allows us to ensure that we are pointing to the
    //  right auction in our setSaleAuctionAddress() call.
    bool public isSaleClockAuction = true;

    // Tracks last 5 sale price of gen0 kitty sales
    uint256 public gen0SaleCount;
    uint256[5] public lastGen0SalePrices;

    // Delegate constructor
    function SaleClockAuction(address _nftAddr, uint256 _cut) public
        ClockAuction(_nftAddr, _cut) {}

    /// @dev Creates and begins a new auction.
    /// @param _tokenId - ID of token to auction, sender must be owner.
    /// @param _startingPrice - Price of item (in wei) at beginning of auction.
    /// @param _endingPrice - Price of item (in wei) at end of auction.
    /// @param _duration - Length of auction (in seconds).
    /// @param _seller - Seller, if not the message sender
    function createAuction(
        uint256 _tokenId,
        uint256 _startingPrice,
        uint256 _endingPrice,
        uint256 _duration,
        address _seller
    )
        external
    {
        // Sanity check that no inputs overflow how many bits we've allocated
        // to store them in the auction struct.
        require(_startingPrice == uint256(uint128(_startingPrice)));
        require(_endingPrice == uint256(uint128(_endingPrice)));
        require(_duration == uint256(uint64(_duration)));

        require(msg.sender == address(nonFungibleContract));
        _escrow(_seller, _tokenId);
        Auction memory auction = Auction(
            _seller,
            uint128(_startingPrice),
            uint128(_endingPrice),
            uint64(_duration),
            uint64(now)
        );
        _addAuction(_tokenId, auction);
    }

    /// @dev Updates lastSalePrice if seller is the nft contract
    /// Otherwise, works the same as default bid method.
    function bid(uint256 _tokenId)
        external
        payable
    {
        // _bid verifies token ID size
        address seller = tokenIdToAuction[_tokenId].seller;
        uint256 price = _bid(_tokenId, msg.value);
        _transfer(msg.sender, _tokenId);

        // If not a gen0 auction, exit
        if (seller == address(nonFungibleContract)) {
            // Track gen0 sale prices
            lastGen0SalePrices[gen0SaleCount % 5] = price;
            gen0SaleCount++;
        }
    }

    function averageGen0SalePrice() external view returns (uint256) {
        uint256 sum = 0;
        for (uint256 i = 0; i < 5; i++) {
            sum += lastGen0SalePrices[i];
        }
        return sum / 5;
    }

}

/// @title Handles creating auctions for sale and siring of kitties.
///  This wrapper of ReverseAuction exists only so that users can create
///  auctions with only one transaction.
contract KittyAuction is KittyBreeding {

    // @notice The auction contract variables are defined in KittyBase to allow
    //  us to refer to them in KittyOwnership to prevent accidental transfers.
    // `saleAuction` refers to the auction for gen0 and p2p sale of kitties.
    // `siringAuction` refers to the auction for siring rights of kitties.

    /// @dev Sets the reference to the sale auction.
    /// @param _address - Address of sale contract.
    function setSaleAuctionAddress(address _address) external onlyCEO {
        SaleClockAuction candidateContract = SaleClockAuction(_address);

        // NOTE: verify that a contract is what we expect - https://github.com/Lunyr/crowdsale-contracts/blob/cfadd15986c30521d8ba7d5b6f57b4fefcc7ac38/contracts/LunyrToken.sol#L117
        require(candidateContract.isSaleClockAuction());

        // Set the new contract address
        saleAuction = candidateContract;
    }

    /// @dev Sets the reference to the siring auction.
    /// @param _address - Address of siring contract.
    function setSiringAuctionAddress(address _address) external onlyCEO {
        SiringClockAuction candidateContract = SiringClockAuction(_address);

        // NOTE: verify that a contract is what we expect - https://github.com/Lunyr/crowdsale-contracts/blob/cfadd15986c30521d8ba7d5b6f57b4fefcc7ac38/contracts/LunyrToken.sol#L117
        require(candidateContract.isSiringClockAuction());

        // Set the new contract address
        siringAuction = candidateContract;
    }

    /// @dev Put a kitty up for auction.
    ///  Does some ownership trickery to create auctions in one tx.
    function createSaleAuction(
        uint256 _kittyId,
        uint256 _startingPrice,
        uint256 _endingPrice,
        uint256 _duration
    )
        external
        whenNotPaused
    {
        // Auction contract checks input sizes
        // If kitty is already on any auction, this will throw
        // because it will be owned by the auction contract.
        require(_owns(msg.sender, _kittyId));
        // Ensure the kitty is not pregnant to prevent the auction
        // contract accidentally receiving ownership of the child.
        // NOTE: the kitty IS allowed to be in a cooldown.
        require(!isPregnant(_kittyId));
        _approve(_kittyId, saleAuction);
        // Sale auction throws if inputs are invalid and clears
        // transfer and sire approval after escrowing the kitty.
        saleAuction.createAuction(
            _kittyId,
            _startingPrice,
            _endingPrice,
            _duration,
            msg.sender
        );
    }

    /// @dev Put a kitty up for auction to be sire.
    ///  Performs checks to ensure the kitty can be sired, then
    ///  delegates to reverse auction.
    function createSiringAuction(
        uint256 _kittyId,
        uint256 _startingPrice,
        uint256 _endingPrice,
        uint256 _duration
    )
        external
        whenNotPaused
    {
        // Auction contract checks input sizes
        // If kitty is already on any auction, this will throw
        // because it will be owned by the auction contract.
        require(_owns(msg.sender, _kittyId));
        require(isReadyToBreed(_kittyId));
        _approve(_kittyId, siringAuction);
        // Siring auction throws if inputs are invalid and clears
        // transfer and sire approval after escrowing the kitty.
        siringAuction.createAuction(
            _kittyId,
            _startingPrice,
            _endingPrice,
            _duration,
            msg.sender
        );
    }

    /// @dev Completes a siring auction by bidding.
    ///  Immediately breeds the winning matron with the sire on auction.
    /// @param _sireId - ID of the sire on auction.
    /// @param _matronId - ID of the matron owned by the bidder.
    function bidOnSiringAuction(
        uint256 _sireId,
        uint256 _matronId
    )
        external
        payable
        whenNotPaused
    {
        // Auction contract checks input sizes
        require(_owns(msg.sender, _matronId));
        require(isReadyToBreed(_matronId));
        require(_canBreedWithViaAuction(_matronId, _sireId));

        // Define the current price of the auction.
        uint256 currentPrice = siringAuction.getCurrentPrice(_sireId);
        require(msg.value >= currentPrice + autoBirthFee);

        // Siring auction will throw if the bid fails.
        siringAuction.bid.value(msg.value - autoBirthFee)(_sireId);
        _breedWith(uint32(_matronId), uint32(_sireId));
    }

    /// @dev Transfers the balance of the sale auction contract
    /// to the KittyCore contract. We use two-step withdrawal to
    /// prevent two transfer calls in the auction bid function.
    function withdrawAuctionBalances() external onlyCLevel {
        saleAuction.withdrawBalance();
        siringAuction.withdrawBalance();
    }
}

/// @title all functions related to creating kittens
contract KittyMinting is KittyAuction {

    // Limits the number of cats the contract owner can ever create.
    uint256 public constant PROMO_CREATION_LIMIT = 5000;
    uint256 public constant GEN0_CREATION_LIMIT = 45000;

    // Constants for gen0 auctions.
    uint256 public constant GEN0_STARTING_PRICE = 10 finney;
    uint256 public constant GEN0_AUCTION_DURATION = 1 days;

    // Counts the number of cats the contract owner has created.
    uint256 public promoCreatedCount;
    uint256 public gen0CreatedCount;

    /// @dev we can create promo kittens, up to a limit. Only callable by COO
    /// @param _genes the encoded genes of the kitten to be created, any value is accepted
    /// @param _owner the future owner of the created kittens. Default to contract COO
    function createPromoKitty(uint256 _genes, address _owner) external onlyCOO {
        address kittyOwner = _owner;
        if (kittyOwner == address(0)) {
             kittyOwner = cooAddress;
        }
        require(promoCreatedCount < PROMO_CREATION_LIMIT);

        promoCreatedCount++;
        _createKitty(0, 0, 0, _genes, kittyOwner);
    }

    /// @dev Creates a new gen0 kitty with the given genes and
    ///  creates an auction for it.
    function createGen0Auction(uint256 _genes) external onlyCOO {
        require(gen0CreatedCount < GEN0_CREATION_LIMIT);

        uint256 kittyId = _createKitty(0, 0, 0, _genes, address(this));
        _approve(kittyId, saleAuction);

        saleAuction.createAuction(
            kittyId,
            _computeNextGen0Price(),
            0,
            GEN0_AUCTION_DURATION,
            address(this)
        );

        gen0CreatedCount++;
    }

    /// @dev Computes the next gen0 auction starting price, given
    ///  the average of the past 5 prices + 50%.
    function _computeNextGen0Price() internal view returns (uint256) {
        uint256 avePrice = saleAuction.averageGen0SalePrice();

        // Sanity check to ensure we don't overflow arithmetic
        require(avePrice == uint256(uint128(avePrice)));

        uint256 nextPrice = avePrice + (avePrice / 2);

        // We never auction for less than starting price
        if (nextPrice < GEN0_STARTING_PRICE) {
            nextPrice = GEN0_STARTING_PRICE;
        }

        return nextPrice;
    }
}

/// @title CryptoKitties: Collectible, breedable, and oh-so-adorable cats on the Ethereum blockchain.
/// @author Axiom Zen (https://www.axiomzen.co)
/// @dev The main CryptoKitties contract, keeps track of kittens so they don't wander around and get lost.
contract KittyCore is KittyMinting {

    // This is the main CryptoKitties contract. In order to keep our code seperated into logical sections,
    // we've broken it up in two ways. First, we have several seperately-instantiated sibling contracts
    // that handle auctions and our super-top-secret genetic combination algorithm. The auctions are
    // seperate since their logic is somewhat complex and there's always a risk of subtle bugs. By keeping
    // them in their own contracts, we can upgrade them without disrupting the main contract that tracks
    // kitty ownership. The genetic combination algorithm is kept seperate so we can open-source all of
    // the rest of our code without making it _too_ easy for folks to figure out how the genetics work.
    // Don't worry, I'm sure someone will reverse engineer it soon enough!
    //
    // Secondly, we break the core contract into multiple files using inheritence, one for each major
    // facet of functionality of CK. This allows us to keep related code bundled together while still
    // avoiding a single giant file with everything in it. The breakdown is as follows:
    //
    //      - KittyBase: This is where we define the most fundamental code shared throughout the core
    //             functionality. This includes our main data storage, constants and data types, plus
    //             internal functions for managing these items.
    //
    //      - KittyAccessControl: This contract manages the various addresses and constraints for operations
    //             that can be executed only by specific roles. Namely CEO, CFO and COO.
    //
    //      - KittyOwnership: This provides the methods required for basic non-fungible token
    //             transactions, following the draft ERC-721 spec (https://github.com/ethereum/EIPs/issues/721).
    //
    //      - KittyBreeding: This file contains the methods necessary to breed cats together, including
    //             keeping track of siring offers, and relies on an external genetic combination contract.
    //
    //      - KittyAuctions: Here we have the public methods for auctioning or bidding on cats or siring
    //             services. The actual auction functionality is handled in two sibling contracts (one
    //             for sales and one for siring), while auction creation and bidding is mostly mediated
    //             through this facet of the core contract.
    //
    //      - KittyMinting: This final facet contains the functionality we use for creating new gen0 cats.
    //             We can make up to 5000 "promo" cats that can be given away (especially important when
    //             the community is new), and all others can only be created and then immediately put up
    //             for auction via an algorithmically determined starting price. Regardless of how they
    //             are created, there is a hard limit of 50k gen0 cats. After that, it's all up to the
    //             community to breed, breed, breed!

    // Set in case the core contract is broken and an upgrade is required
    address public newContractAddress;

    /// @notice Creates the main CryptoKitties smart contract instance.
    function KittyCore() public {
        // Starts paused.
        paused = true;

        // the creator of the contract is the initial CEO
        ceoAddress = msg.sender;

        // the creator of the contract is also the initial COO
        cooAddress = msg.sender;

        // start with the mythical kitten 0 - so we don't have generation-0 parent issues
        _createKitty(0, 0, 0, uint256(-1), address(0));
    }

    /// @dev Used to mark the smart contract as upgraded, in case there is a serious
    ///  breaking bug. This method does nothing but keep track of the new contract and
    ///  emit a message indicating that the new address is set. It's up to clients of this
    ///  contract to update to the new contract address in that case. (This contract will
    ///  be paused indefinitely if such an upgrade takes place.)
    /// @param _v2Address new address
    function setNewAddress(address _v2Address) external onlyCEO whenPaused {
        // See README.md for updgrade plan
        newContractAddress = _v2Address;
        ContractUpgrade(_v2Address);
    }

    /// @notice No tipping!
    /// @dev Reject all Ether from being sent here, unless it's from one of the
    ///  two auction contracts. (Hopefully, we can prevent user accidents.)
    function() external payable {
        require(
            msg.sender == address(saleAuction) ||
            msg.sender == address(siringAuction)
        );
    }

    /// @notice Returns all the relevant information about a specific kitty.
    /// @param _id The ID of the kitty of interest.
    function getKitty(uint256 _id)
        external
        view
        returns (
        bool isGestating,
        bool isReady,
        uint256 cooldownIndex,
        uint256 nextActionAt,
        uint256 siringWithId,
        uint256 birthTime,
        uint256 matronId,
        uint256 sireId,
        uint256 generation,
        uint256 genes
    ) {
        Kitty storage kit = kitties[_id];

        // if this variable is 0 then it's not gestating
        isGestating = (kit.siringWithId != 0);
        isReady = (kit.cooldownEndBlock <= block.number);
        cooldownIndex = uint256(kit.cooldownIndex);
        nextActionAt = uint256(kit.cooldownEndBlock);
        siringWithId = uint256(kit.siringWithId);
        birthTime = uint256(kit.birthTime);
        matronId = uint256(kit.matronId);
        sireId = uint256(kit.sireId);
        generation = uint256(kit.generation);
        genes = kit.genes;
    }

    /// @dev Override unpause so it requires all external contract addresses
    ///  to be set before contract can be unpaused. Also, we can't have
    ///  newContractAddress set either, because then the contract was upgraded.
    /// @notice This is public rather than external so we can call super.unpause
    ///  without using an expensive CALL.
    function unpause() public onlyCEO whenPaused {
        require(saleAuction != address(0));
        require(siringAuction != address(0));
        require(geneScience != address(0));
        require(newContractAddress == address(0));

        // Actually unpause the contract.
        super.unpause();
    }

    // @dev Allows the CFO to capture the balance available to the contract.
    function withdrawBalance() external onlyCFO {
        uint256 balance = this.balance;
        // Subtract all the currently pregnant kittens we have, plus 1 of margin.
        uint256 subtractFees = (pregnantKitties + 1) * autoBirthFee;

        if (balance > subtractFees) {
            cfoAddress.send(balance - subtractFees);
        }
    }
}		

```

## 3.Â CryptoZombies

[`www.cryptozombies.io`](http://www.cryptozombies.io)

ä¸€æ¬¾æ¸¸æˆ

## 4.Â Augur Project

Augur æ˜¯å»ºç«‹åœ¨ä»¥å¤ªåŠå¹³å°ä¸Šçš„å»ä¸­å¿ƒåŒ–é¢„æµ‹å¸‚åœºå¹³å°ï¼Œä¹Ÿæ˜¯ä»¥å¤ªåŠå¹³å°ä¸Šç¬¬ä¸€ä¸ªä¼—ç­¹çš„åº”ç”¨ï¼Œåˆ©ç”¨ Augur ä»»ä½•äººéƒ½å¯ä»¥ä¸ºä»»ä½•è‡ªå·±æ„Ÿå…´è¶£çš„ä¸»é¢˜åˆ›å»ºä¸€ä¸ªé¢„æµ‹å¸‚åœºï¼Œå¹¶æä¾›åˆå§‹æµåŠ¨æ€§ã€‚Augur é¡¹ç›®äº 2015 å¹´ 8 æœˆå¼€å¯ä»£å¸ä¼—ç­¹ï¼Œä¸€å…±ä¼—ç­¹åˆ° 500 ä¸‡ç¾å…ƒï¼Œä»£å¸åç§°ä¸º REPã€‚

https://www.augur.net

åˆçº¦ä»£ç åœ°å€ https://github.com/AugurProject/augur-core

Token sale contract and tools: https://github.com/AugurProject/token-sale

## 5.Â Golem

Golem æ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„å…¨çƒç®—åŠ›å¸‚åœºã€‚Golem äº 2016 å¹´ 11 æœˆ 11 æ—¥å¼€å¯ä¼—ç­¹ï¼Œçº¦åŠä¸ªå°æ—¶å®Œæˆä¼—ç­¹ä¸Šé™ 82 ä¸‡ ETHï¼Œä»¥å½“æ—¥ ETH71 å…ƒäººæ°‘å¸çš„æ”¶ç›˜ä»·è®¡ç®—ï¼Œå…±ç­¹å¾—çº¦ 5822 ä¸‡å…ƒäººæ°‘å¸ï¼Œæ¯æšä»£å¸æˆæœ¬çº¦ä¸º 0.071 å…ƒäººæ°‘å¸ï¼Œä»£å¸åç§°ä¸º GNTã€‚

Golem ICO ä¼—ç­¹åˆçº¦ä»£ç ç”± Token.sol å’Œ GNTAllocation.sol ä¸¤ä¸ªæ–‡ä»¶ç»„æˆï¼Œå…¶ä¸­ GNTAllocation.sol ä¸­å®šä¹‰äº†åˆ†é…ç»™ Golem å…¬å¸å’Œå¼€å‘è€…çš„ Token æ•°é‡ï¼Œä¸»è¦éƒ¨åˆ†çš„åˆçº¦å†™åœ¨ Token.sol ä¸­ã€‚

åˆçº¦æºç åœ°å€ï¼š [`github.com/golemfactory/golem-crowdfunding`](https://github.com/golemfactory/golem-crowdfunding)

## 6.Â FirstBlood

ç¬¬ä¸€æ»´è¡€æ˜¯ä¸€ä¸ªå¯ä»¥è®©ç©å®¶éšæ—¶éšåœ°å‚ä¸ç«èµ›å¹¶ä¸”è·å¾—èµé‡‘çš„å»ä¸­å¿ƒåŒ–ç”µç«å¹³å°ã€‚ç¬¬ä¸€æ»´è¡€ ICO äº 2016 å¹´ 9 æœˆ 26 æ—¥å¼€å§‹ï¼Œè¾¾æˆä¼—ç­¹é¢åº¦ä»…è€—è´¹ä¸¤åˆ†é’Ÿï¼Œå…±ç­¹å¾—çº¦ 465ï¼Œ313ETHï¼Œå‘æ”¾ä»£å¸ 1SF çº¦ 7910 ä¸‡æšï¼Œæ¯æšä»£å¸æˆæœ¬çº¦ä¸º 0.5 å…ƒäººæ°‘å¸ã€‚

åˆçº¦æºç åœ°å€ï¼šhttps://github.com/Firstbloodio/token

## 7.Â Bancor

Bancor åè®®æ˜¯ä¸€ç§åŸºäºä»¥å¤ªåŠçš„åº•å±‚è´§å¸åè®®ï¼Œé€šè¿‡åŒºå—é“¾æŠ€æœ¯å’Œæ™ºèƒ½åˆçº¦å®ç°å°å‹åŠ å¯†æ•°å­—è´§å¸ä¹‹é—´çš„è¿ç»­æµåŠ¨æ€§å’Œå¼‚æ­¥ä»·æ ¼å‘ç°ã€‚Bancor äº 2017 å¹´ 6 æœˆ 13 æ—¥å¼€å¯ä¼—ç­¹ï¼Œæ•°æ®æ˜¾ç¤ºï¼Œåœ¨ ICO äº 18:00 ç»“æŸæ—¶å·²ç»ç­¹é›†äº†è¶…è¿‡ 39 ä¸‡ä¸ªä»¥å¤ªï¼Œå‘è¡Œäº†å°†è¿‘ 8000 ä¸‡çš„ BNTã€‚

åˆçº¦æºç åœ°å€ï¼š [`github.com/bancorprotocol/contracts`](https://github.com/bancorprotocol/contracts)

## ç¬¬Â 23Â ç« Â FAQ

## 1.Â Error: etherbase missing: etherbase address must be explicitly specified

```

ERROR[02-10|16:12:45] Cannot start mining without etherbase    err="etherbase address must be explicitly specified"
Error: etherbase missing: etherbase address must be explicitly specified
    at web3.js:3143:20
    at web3.js:6347:15
    at web3.js:5081:36
    at <anonymous>:1:1		

```

åŸå› æ˜¯å½“å‰ç¯å¢ƒæ²¡æœ‰è´¦æˆ·ï¼Œéœ€è¦å»ºç«‹ä¸€ä¸ªè´¦æˆ·

```

> personal.newAccount("chen")
"0x1b94732fca6f62a4f74fb2f7c80bfc89d567fdfb"

```

ç°åœ¨å¯åŠ¨æŒ–çŸ¿å°±ä¸ä¼šå‡ºç°é—®é¢˜äº†

## ç¬¬Â 23Â ç« Â FAQ

## 1.Â Error: etherbase missing: etherbase address must be explicitly specified

```

ERROR[02-10|16:12:45] Cannot start mining without etherbase    err="etherbase address must be explicitly specified"
Error: etherbase missing: etherbase address must be explicitly specified
    at web3.js:3143:20
    at web3.js:6347:15
    at web3.js:5081:36
    at <anonymous>:1:1		

```

åŸå› æ˜¯å½“å‰ç¯å¢ƒæ²¡æœ‰è´¦æˆ·ï¼Œéœ€è¦å»ºç«‹ä¸€ä¸ªè´¦æˆ·

```

> personal.newAccount("chen")
"0x1b94732fca6f62a4f74fb2f7c80bfc89d567fdfb"

```

ç°åœ¨å¯åŠ¨æŒ–çŸ¿å°±ä¸ä¼šå‡ºç°é—®é¢˜äº†

## 3.Â Error: authentication needed: password or unlock

```

> eth.sendTransaction({from: '0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6', to: '0xe8abf98484325fd6afc59b804ac15804b978e607', value: web3.toWei(1, "ether")})
Error: authentication needed: password or unlock
    at web3.js:3143:20
    at web3.js:6347:15
    at web3.js:5081:36
    at <anonymous>:1:1			

```

è§£é”è½¬å‡ºè´¦å·

```

> personal.unlockAccount("0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6", "your_password", 300)
true
> eth.sendTransaction({from: '0x83fda0ba7e6cfa8d7319d78fa0e6b753a2bcb5a6', to: '0xe8abf98484325fd6afc59b804ac15804b978e607', value: web3.toWei(1, "ether")})
"0xd9e8c8fdc71e24ee8052048de4ff0acd7157b872393f37344c8ec2083f3fe48f"			

```

## 4.Â æ–°å¢èŠ‚ç‚¹åä¸ç”Ÿæ•ˆ

æ–°å¢èŠ‚ç‚¹æ˜¾ç¤º true ,ä½†æ˜¯ä½¿ç”¨ admin.peers æŸ¥çœ‹ä¸åˆ°ã€‚

```

> admin.addPeer("enode://c4586276391b3c88ec23889d1bc825d0c7d69bd5765d4545686f835608068b8dc48799d2686a04ea0f9e17aed099bf9b56935679fa6493e9b17151624a320714@172.16.0.17:30303")
true
> admin.peers
[]			

```

æŸ¥çœ‹èŠ‚ç‚¹ï¼Œå¦‚æœå‘ç° ip: "::" åŒæ—¶ discovery: 0

```

> admin.nodeInfo
{
  enode: "enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@[::]:30303?discport=0",
  id: "9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527",
  ip: "::",
  listenAddr: "[::]:30303",
  name: "Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9.1",
  ports: {
    discovery: 0,
    listener: 30303
  },
  protocols: {
    eth: {
      difficulty: 131072,
      genesis: "0x611596e7979cd4e7ca1531260fa706093a5492ecbdf58f20a39545397e424d04",
      head: "0x611596e7979cd4e7ca1531260fa706093a5492ecbdf58f20a39545397e424d04",
      network: 123456
    }
  }
}
> 

```

è§£å†³æ–¹æ¡ˆå¯åŠ¨æ—¶å¯èƒ½å¢åŠ äº† --nodiscover å‚æ•°ï¼Œå»æ‰å‚æ•°åå¯ä»¥è§£å†³ã€‚

æœ‰ä¸‰ç§æ–¹æ³•æ–°å¢èŠ‚ç‚¹

ç¬¬ä¸€ç§ï¼Œå¯åŠ¨æŒ‡å®š

```

geth --bootnodes enode://pubkey1@ip1:port1,enode://pubkey2@ip2:port2,enode://pubkey3@ip3:port3

```

ç¬¬äºŒç§ï¼Œåœ¨æ§åˆ¶å°ä¸­æ·»åŠ 

```

> admin.addPeer('enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@172.16.0.1:30303')				

```

ç¬¬ä¸‰ç§ï¼Œåœ¨æ–‡ä»¶ ~/.ethereum/geth/static-nodes.json ä¸­æ·»åŠ èŠ‚ç‚¹æ•°æ®

```

[
  "enode://9f6490ffb5236f2ddc5710ae73d47c740e0a3644bbd2d67029cf4a6c4693d2f470b642fd2cc3507f7e851df60aaeb730a1270b7a477f91ec5b6b17a8a4b40527@172.16.0.17:30303",
  "enode://pubkey@ip:port"
]

```

è¿™ä¸ªæ–‡ä»¶å†…å®¹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç±»ä¼¼ ["","",""] ã€‚

## 5.Â Unhandled rejection Error: Returned error: The method personal_unlockAccount does not exist/is not available

```

> Unhandled rejection Error: Returned error: The method personal_unlockAccount does not exist/is not available
    at Object.ErrorResponse (/Users/neo/ethereum/web3/node_modules/web3-core-helpers/src/errors.js:29:16)
    at /Users/neo/ethereum/web3/node_modules/web3-core-requestmanager/src/index.js:137:36
    at XMLHttpRequest.request.onreadystatechange (/Users/neo/ethereum/web3/node_modules/web3-providers-http/src/index.js:77:13)
    at XMLHttpRequestEventTarget.dispatchEvent (/Users/neo/ethereum/web3/node_modules/xhr2/lib/xhr2.js:64:18)
    at XMLHttpRequest._setReadyState (/Users/neo/ethereum/web3/node_modules/xhr2/lib/xhr2.js:354:12)
    at XMLHttpRequest._onHttpResponseEnd (/Users/neo/ethereum/web3/node_modules/xhr2/lib/xhr2.js:509:12)
    at IncomingMessage.<anonymous> (/Users/neo/ethereum/web3/node_modules/xhr2/lib/xhr2.js:469:24)
    at IncomingMessage.emit (events.js:165:20)
    at endReadableNT (_stream_readable.js:1101:12)
    at process._tickCallback (internal/process/next_tick.js:152:19)

```

è§£å†³æ–¹æ³•

```

$ geth --rpc --rpcapi personal,db,eth,net,web3

```

åœ¨ --rpcapi é€‰é¡¹ä¸­å¢åŠ  personal

## 6.Â Error: exceeds block gas limit

```

neo@MacBook-Pro ~/ethereum/truffle/Conference % truffle migrate --reset
\Using network 'development'.

Running migration: 1_initial_conference.js
  Deploying Conference...
  ... undefined
Error encountered, bailing. Network state unknown. Review successful transactions manually.
Error: exceeds block gas limit
    at Object.InvalidResponse (/usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/errors.js:38:1)
    at /usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/requestmanager.js:86:1
    at /usr/local/lib/node_modules/truffle/build/webpack:/~/truffle-migrate/index.js:225:1
    at /usr/local/lib/node_modules/truffle/build/webpack:/~/truffle-provider/wrapper.js:134:1
    at XMLHttpRequest.request.onreadystatechange (/usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/httpprovider.js:128:1)
    at XMLHttpRequestEventTarget.dispatchEvent (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:64:1)
    at XMLHttpRequest._setReadyState (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:354:1)
    at XMLHttpRequest._onHttpResponseEnd (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:509:1)
    at IncomingMessage.<anonymous> (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:469:1)
    at IncomingMessage.emit (events.js:165:20)

```

```

neo@MacBook-Pro ~/ethereum/truffle/contracts % geth attach            
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.1-stable/darwin-amd64/go1.10
coinbase: 0x5c18a33df2cc41a1beddc91133b8422e89f041b7
at block: 5381 (Wed, 28 Feb 2018 23:20:05 CST)
 datadir: /Users/neo/Library/Ethereum
 modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

> web3.eth.getBlock("pending").gasLimit
4712388		

```

æˆ–è€…

```

$ truffle console
truffle(development)> web3.eth.getBlock("pending").gasLimit
6712390

```

ä¿®æ”¹ truffle.js æ–‡ä»¶ï¼ŒåŠ å…¥ gas å€¼ä¸ºä¸Šé¢æ‰€æŸ¥è¯¢çš„å€¼:

```

module.exports = {
  networks: {
    development: {
      host: "localhost",
      port: 8545,
      gas: 6712390,
      network_id: "*" // Match any network id
    }
  }
};			

```

## 7.Â Migrations.sol:11:3: Warning: Defining constructors as functions with the same name as the contract is deprecated. Use "constructor(...) { ... }" instead.

Solidity 0.4.23 åˆçº¦æ„é€ æ–¹æ³•ä¸ä¹‹å‰çš„ç‰ˆæœ¬ä¸åŒ

```

[ethereum@netkiller truffle]$ cat contracts/Migrations.sol
pragma solidity â°.4.17;

contract Migrations {
  address public owner;
  uint public last_completed_migration;

  modifier restricted() {
    if (msg.sender == owner) _;
  }

  function Migrations() public {
    owner = msg.sender;
  }

  function setCompleted(uint completed) public restricted {
    last_completed_migration = completed;
  }

  function upgrade(address new_address) public restricted {
    Migrations upgraded = Migrations(new_address);
    upgraded.setCompleted(last_completed_migration);
  }
}

```

```

[ethereum@netkiller truffle]$ cat contracts/Migrations.sol
pragma solidity â°.4.17;

contract Migrations {
  address public owner;
  uint public last_completed_migration;

  modifier restricted() {
    if (msg.sender == owner) _;
  }

  constructor() public {
    owner = msg.sender;
  }

  function setCompleted(uint completed) public restricted {
    last_completed_migration = completed;
  }

  function upgrade(address new_address) public restricted {
    Migrations upgraded = Migrations(new_address);
    upgraded.setCompleted(last_completed_migration);
  }
}

```

## 8.Â Exception in thread "main" rx.exceptions.OnErrorNotImplementedException: Invalid response received: okhttp3.internal.http.RealResponseBody@6c25e6c4

å¼‚å¸¸å‡ºç°åœ¨ Subscription è®¢é˜…çš„æ—¶å€™ï¼ŒåŸå› æ˜¯ web3j Subscription æ“ä½œåªèƒ½ä½¿ç”¨ ipc, rpcï¼Œ infura.io ä¸æ”¯æŒè¯¥æ“ä½œã€‚

```

Exception in thread "main" rx.exceptions.OnErrorNotImplementedException: Invalid response received: okhttp3.internal.http.RealResponseBody@6c25e6c4
	at rx.internal.util.InternalObservableUtils$ErrorNotImplementedAction.call(InternalObservableUtils.java:386)
	at rx.internal.util.InternalObservableUtils$ErrorNotImplementedAction.call(InternalObservableUtils.java:383)
	at rx.internal.util.ActionSubscriber.onError(ActionSubscriber.java:44)
	at rx.observers.SafeSubscriber._onError(SafeSubscriber.java:153)
	at rx.observers.SafeSubscriber.onError(SafeSubscriber.java:115)
	at rx.internal.operators.OnSubscribeMap$MapSubscriber.onError(OnSubscribeMap.java:88)
	at rx.internal.operators.OnSubscribeFilter$FilterSubscriber.onError(OnSubscribeFilter.java:90)
	at rx.internal.operators.OperatorMerge$MergeSubscriber.reportError(OperatorMerge.java:266)
	at rx.internal.operators.OperatorMerge$MergeSubscriber.checkTerminate(OperatorMerge.java:818)
	at rx.internal.operators.OperatorMerge$MergeSubscriber.emitLoop(OperatorMerge.java:579)
	at rx.internal.operators.OperatorMerge$MergeSubscriber.emit(OperatorMerge.java:568)
	at rx.internal.operators.OperatorMerge$MergeSubscriber.onError(OperatorMerge.java:276)
	at rx.internal.operators.OnSubscribeMap$MapSubscriber.onError(OnSubscribeMap.java:88)
	at rx.Observable.unsafeSubscribe(Observable.java:10334)
	at rx.internal.operators.OnSubscribeMap.call(OnSubscribeMap.java:48)
	at rx.internal.operators.OnSubscribeMap.call(OnSubscribeMap.java:33)
	at rx.internal.operators.OnSubscribeLift.call(OnSubscribeLift.java:48)
	at rx.internal.operators.OnSubscribeLift.call(OnSubscribeLift.java:30)
	at rx.Observable.unsafeSubscribe(Observable.java:10327)
	at rx.internal.operators.OnSubscribeFilter.call(OnSubscribeFilter.java:45)
	at rx.internal.operators.OnSubscribeFilter.call(OnSubscribeFilter.java:30)
	at rx.Observable.unsafeSubscribe(Observable.java:10327)
	at rx.internal.operators.OnSubscribeMap.call(OnSubscribeMap.java:48)
	at rx.internal.operators.OnSubscribeMap.call(OnSubscribeMap.java:33)
	at rx.Observable.subscribe(Observable.java:10423)
	at rx.Observable.subscribe(Observable.java:10390)
	at rx.Observable.subscribe(Observable.java:10195)
	at cn.netkiller.example.ethereum.subscription.PendingTest.main(PendingTest.java:20)
Caused by: org.web3j.protocol.exceptions.ClientConnectionException: Invalid response received: okhttp3.internal.http.RealResponseBody@6c25e6c4
	at org.web3j.protocol.http.HttpService.performIO(HttpService.java:114)
	at org.web3j.protocol.Service.send(Service.java:31)
	at org.web3j.protocol.core.Request.send(Request.java:71)
	at org.web3j.protocol.core.filters.PendingTransactionFilter.sendRequest(PendingTransactionFilter.java:24)
	at org.web3j.protocol.core.filters.Filter.run(Filter.java:45)
	at org.web3j.protocol.rx.JsonRpc2_0Rx.run(JsonRpc2_0Rx.java:73)
	at org.web3j.protocol.rx.JsonRpc2_0Rx.lambda$ethPendingTransactionHashObservable$1(JsonRpc2_0Rx.java:55)
	at rx.Observable.unsafeSubscribe(Observable.java:10327)
	... 14 more

```